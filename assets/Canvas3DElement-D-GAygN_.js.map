{"version":3,"file":"Canvas3DElement-D-GAygN_.js","sources":["../../src/lib/3d/3d_dynamique/solidesThreeJs.ts","../../src/lib/3d/3d_dynamique/Canvas3DElement.ts"],"sourcesContent":["import { range } from '../../outils/nombres'\nimport { BufferGeometryUtils, Text, THREE } from './threeInstance'\n\n// Three.js pur pour créer un prisme polygonal utilisable dans une scène Three.js en perspective avec arêtes cachées en pointillés.\nexport function createPrismGeometry(\n  sides: number,\n  radius: number,\n  bottom: number,\n  top: number,\n  withBottomBase = false,\n  withTopBase = false,\n): THREE.BufferGeometry {\n  const geometry = new THREE.BufferGeometry()\n  const vertices: number[] = []\n  const base: THREE.Vector3[] = []\n  const topBase: THREE.Vector3[] = []\n\n  // Sommets des deux bases\n  for (let i = 0; i < sides; i++) {\n    const theta = (i / sides) * Math.PI * 2\n    const x = radius * Math.cos(theta)\n    const z = radius * Math.sin(theta)\n    base.push(new THREE.Vector3(x, bottom, z))\n    topBase.push(new THREE.Vector3(x, top, z))\n  }\n\n  // Triangulation de la base inférieure\n  if (withBottomBase) {\n    for (let i = 1; i < sides - 1; i++) {\n      vertices.push(\n        base[0].x,\n        base[0].y,\n        base[0].z,\n        base[i + 1].x,\n        base[i + 1].y,\n        base[i + 1].z,\n        base[i].x,\n        base[i].y,\n        base[i].z,\n      )\n    }\n  }\n\n  // Triangulation de la base supérieure\n  if (withTopBase) {\n    for (let i = 1; i < sides - 1; i++) {\n      vertices.push(\n        topBase[0].x,\n        topBase[0].y,\n        topBase[0].z,\n        topBase[i].x,\n        topBase[i].y,\n        topBase[i].z,\n        topBase[i + 1].x,\n        topBase[i + 1].y,\n        topBase[i + 1].z,\n      )\n    }\n  }\n\n  // Side faces (un seul rectangle par côté, découpé en 2 triangles)\n  for (let i = 0; i < sides; i++) {\n    const a = base[i]\n    const b = base[(i + 1) % sides]\n    const c = topBase[(i + 1) % sides]\n    const d = topBase[i]\n\n    // Premier triangle\n    vertices.push(a.x, a.y, a.z, b.x, b.y, b.z, d.x, d.y, d.z)\n    // Second triangle\n    vertices.push(b.x, b.y, b.z, c.x, c.y, c.z, d.x, d.y, d.z)\n  }\n\n  geometry.setAttribute(\n    'position',\n    new THREE.Float32BufferAttribute(vertices, 3),\n  )\n  geometry.computeVertexNormals()\n  return geometry\n}\n\nexport function createPyramidGeometry(\n  sides: number,\n  radius: number,\n  bottom: number,\n  top: number,\n  withBase = false, // <-- nouveau paramètre, false par défaut\n): THREE.BufferGeometry {\n  const geometry = new THREE.BufferGeometry()\n  const vertices: number[] = []\n  const apex = new THREE.Vector3(0, top, 0)\n  const base: THREE.Vector3[] = []\n\n  for (let i = 0; i < sides; i++) {\n    const theta = (i / sides) * Math.PI * 2\n    const x = radius * Math.cos(theta)\n    const z = radius * Math.sin(theta)\n    base.push(new THREE.Vector3(x, bottom, z))\n  }\n\n  // Base face (triangulation) si demandé\n  if (withBase) {\n    for (let i = 1; i < sides - 1; i++) {\n      vertices.push(\n        base[0].x,\n        base[0].y,\n        base[0].z,\n        base[i + 1].x,\n        base[i + 1].y,\n        base[i + 1].z,\n        base[i].x,\n        base[i].y,\n        base[i].z,\n      )\n    }\n  }\n\n  // Side faces\n  for (let i = 0; i < sides; i++) {\n    const a = base[i]\n    const b = base[(i + 1) % sides]\n    vertices.push(a.x, a.y, a.z, b.x, b.y, b.z, apex.x, apex.y, apex.z)\n  }\n\n  geometry.setAttribute(\n    'position',\n    new THREE.Float32BufferAttribute(vertices, 3),\n  )\n  geometry.computeVertexNormals()\n  return geometry\n}\n\nexport function createTruncatedPyramidGeometry(\n  sides: number,\n  bottomRadius: number,\n  topRadius: number,\n  bottom: number,\n  top: number,\n  withBottomBase = false,\n  withTopBase = false,\n): THREE.BufferGeometry {\n  const geometry = new THREE.BufferGeometry()\n  const vertices: number[] = []\n  const bottomVerts: THREE.Vector3[] = []\n  const topVerts: THREE.Vector3[] = []\n\n  for (let i = 0; i < sides; i++) {\n    const theta = (i / sides) * Math.PI * 2\n    bottomVerts.push(\n      new THREE.Vector3(\n        bottomRadius * Math.cos(theta),\n        bottom,\n        bottomRadius * Math.sin(theta),\n      ),\n    )\n    topVerts.push(\n      new THREE.Vector3(\n        topRadius * Math.cos(theta),\n        top,\n        topRadius * Math.sin(theta),\n      ),\n    )\n  }\n\n  // Bottom face (triangulation) si demandé\n  if (withBottomBase) {\n    for (let i = 1; i < sides - 1; i++) {\n      vertices.push(\n        bottomVerts[0].x,\n        bottomVerts[0].y,\n        bottomVerts[0].z,\n        bottomVerts[i + 1].x,\n        bottomVerts[i + 1].y,\n        bottomVerts[i + 1].z,\n        bottomVerts[i].x,\n        bottomVerts[i].y,\n        bottomVerts[i].z,\n      )\n    }\n  }\n\n  // Top face (triangulation) si demandé\n  if (withTopBase) {\n    for (let i = 1; i < sides - 1; i++) {\n      vertices.push(\n        topVerts[0].x,\n        topVerts[0].y,\n        topVerts[0].z,\n        topVerts[i].x,\n        topVerts[i].y,\n        topVerts[i].z,\n        topVerts[i + 1].x,\n        topVerts[i + 1].y,\n        topVerts[i + 1].z,\n      )\n    }\n  }\n\n  // Side faces (un seul rectangle par côté, découpé en 2 triangles)\n  for (let i = 0; i < sides; i++) {\n    const a = bottomVerts[i]\n    const b = bottomVerts[(i + 1) % sides]\n    const c = topVerts[(i + 1) % sides]\n    const d = topVerts[i]\n\n    // Premier triangle\n    vertices.push(a.x, a.y, a.z, b.x, b.y, b.z, d.x, d.y, d.z)\n    // Second triangle\n    vertices.push(b.x, b.y, b.z, c.x, c.y, c.z, d.x, d.y, d.z)\n  }\n\n  geometry.setAttribute(\n    'position',\n    new THREE.Float32BufferAttribute(vertices, 3),\n  )\n  geometry.computeVertexNormals()\n  return geometry\n}\nexport function createMeshFromGeometry(\n  geometry: THREE.BufferGeometry,\n  material?: THREE.Material | THREE.Material[],\n): THREE.Mesh {\n  const mat = material ?? new THREE.MeshStandardMaterial({ color: '#fff' })\n  return new THREE.Mesh(geometry, mat)\n}\n\nexport function createEdgesFromGeometry(\n  geometry: THREE.BufferGeometry,\n  dashed = false,\n): THREE.LineSegments {\n  const edges = new THREE.EdgesGeometry(geometry)\n  let material: THREE.Material\n  if (dashed) {\n    material = new THREE.LineDashedMaterial({\n      color: 0x000000,\n      dashSize: 0.05,\n      gapSize: 0.025,\n      depthTest: false,\n      transparent: true,\n      opacity: 0.5, // ou 0.5 si tu veux atténuer les pointillés\n    })\n  } else {\n    material = new THREE.LineBasicMaterial({\n      color: 0x000000,\n      depthTest: true,\n      transparent: true,\n      opacity: 1,\n    })\n  }\n  const line = new THREE.LineSegments(edges, material)\n  if (dashed && line.computeLineDistances) line.computeLineDistances()\n  return line\n}\n\n// Template sans arêtes\nconst coloredCubeMeshTemplate = (() => {\n  const geometry = new THREE.BoxGeometry(1, 1, 1)\n  const materials = [\n    new THREE.MeshPhongMaterial({ color: 'red' }),\n    new THREE.MeshPhongMaterial({ color: 'red' }),\n    new THREE.MeshPhongMaterial({ color: 'green' }),\n    new THREE.MeshPhongMaterial({ color: 'green' }),\n    new THREE.MeshPhongMaterial({ color: 'blue' }),\n    new THREE.MeshPhongMaterial({ color: 'blue' }),\n  ]\n  const mesh = new THREE.Mesh(geometry, materials)\n  return mesh\n})()\n\n// Template avec arêtes\nconst coloredCubeWithEdgesTemplate = (() => {\n  const geometry = new THREE.BoxGeometry(1, 1, 1)\n  const materials = [\n    new THREE.MeshPhongMaterial({ color: 'red' }),\n    new THREE.MeshPhongMaterial({ color: 'red' }),\n    new THREE.MeshPhongMaterial({ color: 'green' }),\n    new THREE.MeshPhongMaterial({ color: 'green' }),\n    new THREE.MeshPhongMaterial({ color: 'blue' }),\n    new THREE.MeshPhongMaterial({ color: 'blue' }),\n  ]\n  const mesh = new THREE.Mesh(geometry, materials)\n  const edges = new THREE.EdgesGeometry(geometry)\n  const line = new THREE.LineSegments(\n    edges,\n    new THREE.LineBasicMaterial({ color: 0x000000 }),\n  )\n  const group = new THREE.Group()\n  group.add(mesh)\n  group.add(line)\n  return group\n})()\n\nexport function createColoredCube(\n  position: [number, number, number],\n  size = 1,\n  options?: {\n    edges?: boolean // true pour ajouter les arêtes\n    edgesColor?: number // couleur des arêtes (ex: 0x000000)\n    edgesOpacity?: number // opacité des arêtes (ex: 1)\n    colors: number[]\n  },\n): THREE.Group | THREE.Mesh {\n  const colors = range(6).map(\n    (n) => (options?.colors ?? [0xffffff])[n % (options?.colors?.length ?? 1)],\n  )\n  const geometry = new THREE.BoxGeometry(size, size, size)\n  const materials = [\n    new THREE.MeshPhongMaterial({ color: colors[0] }), // +X\n    new THREE.MeshPhongMaterial({ color: colors[1] }), // -X\n    new THREE.MeshPhongMaterial({ color: colors[2] }), // +Y\n    new THREE.MeshPhongMaterial({ color: colors[3] }), // -Y\n    new THREE.MeshPhongMaterial({ color: colors[4] }), // +Z\n    new THREE.MeshPhongMaterial({ color: colors[5] }), // -Z\n  ]\n  const mesh = new THREE.Mesh(geometry, materials)\n  mesh.position.set(...position)\n\n  if (options?.edges) {\n    const edges = new THREE.EdgesGeometry(geometry)\n    const line = new THREE.LineSegments(\n      edges,\n      new THREE.LineBasicMaterial({\n        color: options.edgesColor ?? 0x000000,\n        opacity: options.edgesOpacity ?? 1,\n        transparent: (options.edgesOpacity ?? 1) < 1,\n      }),\n    )\n    line.position.copy(mesh.position)\n    // On regroupe mesh et edges dans un Group\n    const group = new THREE.Group()\n    group.add(mesh)\n    group.add(line)\n    return group\n  } else {\n    return mesh\n  }\n}\n\nexport function createColoredCubeInstance(\n  position: [number, number, number],\n  size = 1,\n  withEdges = false,\n  colors: number[],\n): THREE.Group | THREE.Mesh {\n  const template = withEdges\n    ? coloredCubeWithEdgesTemplate\n    : coloredCubeMeshTemplate\n  const clone = template.clone(true)\n  clone.position.set(...position)\n  clone.scale.set(size, size, size)\n  return clone\n}\n\nexport function createRealisticEarthSphere(desc: {\n  position?: [number, number, number]\n  radius?: number\n  greenwichAlignment?: number\n  segmentsWidth?: number\n  segmentsHeight?: number\n  onTextureLoaded?: () => void // optionnel, pour forcer un render\n}): THREE.Mesh {\n  const DIFFUSE_MAP = 'images/earth_day_4096.jpg'\n  const NORMAL_MAP = 'images/earth_normal_2048.jpg'\n\n  const geometry = new THREE.SphereGeometry(\n    desc.radius ?? 1,\n    desc.segmentsWidth ?? 64,\n    desc.segmentsHeight ?? 32,\n  )\n\n  const loader = new THREE.TextureLoader()\n  const material = new THREE.MeshStandardMaterial({\n    color: 0xffffff,\n    metalness: 0.2,\n    roughness: 0.8,\n    bumpScale: 0.1,\n    normalScale: new THREE.Vector2(1, 1),\n    emissive: 0x222222,\n  })\n\n  const mesh = new THREE.Mesh(geometry, material)\n  if (desc.position) mesh.position.set(...desc.position)\n  if (desc.greenwichAlignment)\n    mesh.rotation.y = THREE.MathUtils.degToRad(desc.greenwichAlignment)\n\n  // Charge la texture diffuse\n  loader.load(DIFFUSE_MAP, (diffuse) => {\n    diffuse.colorSpace = THREE.SRGBColorSpace\n    material.map = diffuse\n    material.needsUpdate = true\n    desc.onTextureLoaded?.()\n  })\n\n  // Charge la normalMap\n  loader.load(NORMAL_MAP, (normal) => {\n    material.normalMap = normal\n    material.needsUpdate = true\n    desc.onTextureLoaded?.()\n  })\n\n  return mesh\n}\n\nexport function createGeoPoint(desc: {\n  spherePosition?: [number, number, number]\n  sphereRadius?: number\n  latitude: number\n  longitude: number\n  altitude?: number\n  pointRadius?: number\n  pointColor?: string | number\n  label?: string\n  labelColor?: string\n  labelOffset?: number\n  labelSize?: number\n  font?: string // chemin vers le .json MSDF\n  fontTexture?: string // chemin vers le .png MSDF\n  transparent?: boolean\n}): THREE.Group {\n  // Valeurs par défaut\n  const spherePos = desc.spherePosition ?? [0, 0, 0]\n  const r = (desc.sphereRadius ?? 1) + (desc.altitude ?? 0)\n  const latRad = (desc.latitude * Math.PI) / 180\n  const lonRad = (desc.longitude * Math.PI) / 180\n\n  // Calcul coordonnées sphériques\n  const [x, y, z] = sphericalToCartesian(\n    desc.latitude,\n    desc.longitude,\n    r,\n    spherePos,\n  )\n\n  // Création du point (petite sphère)\n  const geometry = new THREE.SphereGeometry(desc.pointRadius ?? 0.03, 16, 16)\n  const material = new THREE.MeshPhongMaterial({\n    color: desc.pointColor ?? 0xff0000,\n  })\n  const point = new THREE.Mesh(geometry, material)\n  point.position.set(x, y, z)\n\n  const group = new THREE.Group()\n  group.add(point)\n\n  // Ajout du label si demandé\n  if (desc.label) {\n    const [x, y, z] = sphericalToCartesian(\n      desc.latitude - 3,\n      desc.longitude,\n      r,\n      spherePos,\n    )\n    const textMesh = new Text()\n    // Label position avec offset\n    // Normal à la sphère au point du label\n    const normal = new THREE.Vector3(x, y, z).normalize()\n    const labelOffset = desc.labelOffset ?? 0.05\n    const labelPos = normal.clone().multiplyScalar(r + labelOffset)\n\n    // Appliquer\n    textMesh.position.copy(labelPos)\n    textMesh.text = desc.label\n    textMesh.fontSize = desc.labelSize ?? 0.5\n    textMesh.color = desc.labelColor ?? '#ffffff'\n    textMesh.anchorX = 'center'\n    textMesh.anchorY = 'middle'\n    textMesh.font = desc.font ?? 'fonts/Arial Rounded Bold.ttf'\n    const euler = new THREE.Euler(0, lonRad, 0, 'YXZ')\n    euler.x = -latRad // rotation latitude\n    textMesh.setRotationFromEuler(euler)\n\n    textMesh.sync()\n    group.add(textMesh)\n  }\n\n  return group\n}\nexport function createGeoPoints(desc: {\n  spherePosition?: [number, number, number]\n  sphereRadius?: number\n  points: Array<{\n    latitude: number\n    longitude: number\n    altitude?: number\n    pointRadius?: number\n    pointColor?: string | number\n    label?: string\n    labelColor?: string\n    labelOffset?: number\n    labelSize?: number\n    font?: string\n    transparent?: boolean\n  }>\n}): THREE.Group {\n  const group = new THREE.Group()\n  desc.points.forEach((pointDesc) => {\n    group.add(\n      createGeoPoint({\n        spherePosition: desc.spherePosition,\n        sphereRadius: desc.sphereRadius,\n        ...pointDesc,\n      }),\n    )\n  })\n  return group\n}\n\nexport function sphericalToCartesian(\n  latitude: number,\n  longitude: number,\n  radius: number,\n  center: [number, number, number],\n): [number, number, number] {\n  const latRad = (latitude * Math.PI) / 180\n  const lonRad = (longitude * Math.PI) / 180\n  return [\n    center[0] + radius * Math.cos(latRad) * Math.sin(lonRad),\n    center[1] + radius * Math.sin(latRad),\n    center[2] + radius * Math.cos(latRad) * Math.cos(lonRad),\n  ]\n}\n\n/**\n * Crée une sphère filaire personnalisée (parallèles, méridiens, équateur, Greenwich)\n */\nexport function createCustomWireSphere(\n  desc: {\n    position?: [number, number, number]\n    radius?: number\n    parallels?: number\n    meridians?: number\n    segments?: number\n    parallelColor?: string | number\n    meridianColor?: string | number\n    showParallels?: boolean\n    showMeridians?: boolean\n    showEquator?: boolean\n    equatorColor?: string | number\n    equatorThickness?: number\n    showGreenwich?: boolean\n    greenwichColor?: string | number\n    greenwichThickness?: number\n  } = {},\n): THREE.Group {\n  const {\n    position = [0, 0, 0],\n    radius = 1,\n    parallels = 4,\n    meridians = 8,\n    segments = 32,\n    parallelColor = 0xcccccc,\n    meridianColor = 0xcccc00,\n    showParallels = true,\n    showMeridians = true,\n    showEquator = true,\n    equatorColor = 0xffff00,\n    equatorThickness = 0.02,\n    showGreenwich = false,\n    greenwichColor = 0x00ffff,\n    greenwichThickness = 0.02,\n  } = desc\n\n  const group = new THREE.Group()\n  group.position.set(...position)\n\n  // Parallèles (hors équateur)\n  if (showParallels) {\n    for (let i = 1; i <= parallels; i++) {\n      const phi = (Math.PI * i) / (parallels + 1)\n      const circle = new THREE.EllipseCurve(\n        0,\n        0,\n        radius * Math.sin(phi),\n        radius * Math.sin(phi),\n        0,\n        2 * Math.PI,\n        false,\n        0,\n      )\n      const points = circle.getPoints(segments)\n      const geometry = new THREE.BufferGeometry().setFromPoints(\n        points.map((p) => new THREE.Vector3(p.x, radius * Math.cos(phi), p.y)),\n      )\n      const material = new THREE.LineBasicMaterial({ color: parallelColor })\n      const line = new THREE.LineLoop(geometry, material)\n      group.add(line)\n    }\n  }\n\n  // Méridiens\n  if (showMeridians) {\n    for (let i = 0; i < meridians; i++) {\n      const theta = (2 * Math.PI * i) / meridians\n      const points: THREE.Vector3[] = []\n      for (let j = 0; j <= segments; j++) {\n        const phi = (Math.PI * j) / segments\n        const x = radius * Math.sin(phi) * Math.sin(theta)\n        const y = radius * Math.cos(phi)\n        const z = radius * Math.sin(phi) * Math.cos(theta)\n        points.push(new THREE.Vector3(x, y, z))\n      }\n      const geometry = new THREE.BufferGeometry().setFromPoints(points)\n      const material = new THREE.LineBasicMaterial({ color: meridianColor })\n      const line = new THREE.Line(geometry, material)\n      group.add(line)\n    }\n  }\n\n  // Équateur\n  if (showEquator) {\n    const circle = new THREE.EllipseCurve(\n      0,\n      0,\n      radius,\n      radius,\n      0,\n      2 * Math.PI,\n      false,\n      0,\n    )\n    const points = circle.getPoints(segments)\n    const geometry = new THREE.BufferGeometry().setFromPoints(\n      points.map((p) => new THREE.Vector3(p.x, 0, p.y)),\n    )\n    const material = new THREE.LineBasicMaterial({\n      color: equatorColor,\n      linewidth: equatorThickness ? Math.max(1, equatorThickness * 10) : 2,\n    })\n    const line = new THREE.LineLoop(geometry, material)\n    group.add(line)\n  }\n\n  // Méridien de Greenwich\n  if (showGreenwich) {\n    const points: THREE.Vector3[] = []\n    for (let j = 0; j <= segments; j++) {\n      const phi = (Math.PI * j) / segments\n      const x = 0\n      const y = radius * Math.cos(phi)\n      const z = radius * Math.sin(phi)\n      points.push(new THREE.Vector3(x, y, z))\n    }\n    const geometry = new THREE.BufferGeometry().setFromPoints(points)\n    const material = new THREE.LineBasicMaterial({\n      color: greenwichColor,\n      linewidth: greenwichThickness ? Math.max(1, greenwichThickness * 10) : 2,\n    })\n    const line = new THREE.Line(geometry, material)\n    group.add(line)\n  }\n\n  return group\n}\n\nexport function createSkySphere(desc: {\n  radius?: number\n  image: string\n  onTextureLoaded?: (mesh: THREE.Mesh) => void\n}): THREE.Mesh {\n  const geometry = new THREE.SphereGeometry(desc.radius ?? 200, 64, 32)\n  const textureLoader = new THREE.TextureLoader()\n  const material = new THREE.MeshBasicMaterial({ side: THREE.DoubleSide })\n  const mesh = new THREE.Mesh(geometry, material)\n  textureLoader.load(desc.image, (texture) => {\n    texture.colorSpace = THREE.SRGBColorSpace\n    material.map = texture\n    material.needsUpdate = true\n    desc.onTextureLoaded?.(mesh)\n  })\n  return mesh\n}\n\n/**\n * Fusionne plusieurs géométries en une seule BufferGeometry (suppression des sommets dupliqués).\n * @param geometries Array de THREE.BufferGeometry à fusionner\n * @returns Une BufferGeometry fusionnée\n */\n\nexport function createWireframeUnion(\n  items: (THREE.BufferGeometry | THREE.Object3D)[],\n  options?: {\n    meshOpacity?: number\n    meshColor?: THREE.ColorRepresentation\n    dashedColor?: THREE.ColorRepresentation\n    solidColor?: THREE.ColorRepresentation\n  },\n): THREE.Group {\n  // 1. Récupère toutes les BufferGeometry récursivement\n  const geometries: THREE.BufferGeometry[] = []\n\n  function collectGeometries(obj: THREE.BufferGeometry | THREE.Object3D) {\n    if (\n      obj instanceof THREE.BufferGeometry &&\n      !(obj instanceof THREE.EdgesGeometry)\n    ) {\n      geometries.push(obj)\n    } else if (\n      (obj as THREE.Mesh).geometry instanceof THREE.BufferGeometry &&\n      !((obj as THREE.Mesh).geometry instanceof THREE.EdgesGeometry)\n    ) {\n      geometries.push((obj as THREE.Mesh).geometry)\n    } else if (obj instanceof THREE.Group || obj instanceof THREE.Object3D) {\n      obj.children.forEach((child) => collectGeometries(child))\n    }\n  }\n\n  items.forEach((item) => collectGeometries(item))\n\n  if (geometries.length === 0) {\n    throw new Error('Aucune BufferGeometry trouvée pour la fusion')\n  }\n\n  // 2. Fusionne les géométries\n  const mergedGeometry = BufferGeometryUtils.mergeGeometries(geometries, true)\n  if (!mergedGeometry) {\n    throw new Error('La fusion des géométries a échoué (vérifiez les entrées)')\n  }\n  mergedGeometry.computeVertexNormals()\n  // Inverser les faces dont la normale pointe vers l'intérieur\n  const pos = mergedGeometry.getAttribute('position')\n\n  // Calcul du barycentre\n  const sum = new THREE.Vector3(0, 0, 0)\n  for (let i = 0; i < pos.count; i++) {\n    sum.x += pos.getX(i)\n    sum.y += pos.getY(i)\n    sum.z += pos.getZ(i)\n  }\n  const barycenter = sum.multiplyScalar(1 / pos.count)\n\n  for (let i = 0; i < pos.count; i += 3) {\n    // Calcul de la normale du triangle (A, B, C)\n    const ax = pos.getX(i)\n    const ay = pos.getY(i)\n    const az = pos.getZ(i)\n    const bx = pos.getX(i + 1)\n    const by = pos.getY(i + 1)\n    const bz = pos.getZ(i + 1)\n    const cx = pos.getX(i + 2)\n    const cy = pos.getY(i + 2)\n    const cz = pos.getZ(i + 2)\n    const ab = new THREE.Vector3(bx - ax, by - ay, bz - az)\n    const ac = new THREE.Vector3(cx - ax, cy - ay, cz - az)\n    const normal = new THREE.Vector3().crossVectors(ab, ac).normalize()\n    const center = new THREE.Vector3(\n      (ax + bx + cx) / 3,\n      (ay + by + cy) / 3,\n      (az + bz + cz) / 3,\n    )\n    const toBarycenter = barycenter.clone().sub(center).normalize()\n    if (normal.dot(toBarycenter) > 0) {\n      // La normale pointe vers l'intérieur, il faut inverser B et C\n      pos.setXYZ(i + 1, cx, cy, cz)\n      pos.setXYZ(i + 2, bx, by, bz)\n    }\n  }\n  // 3. Crée le group (identique à avant)\n  const group = new THREE.Group()\n\n  // 4. Ajoute le mesh (optionnel)\n  const mesh = new THREE.Mesh(\n    mergedGeometry,\n    new THREE.MeshPhongMaterial({\n      color: options?.meshColor ?? 0xffffff,\n      transparent: true,\n      opacity: options?.meshOpacity ?? 0.5,\n      polygonOffset: true,\n      polygonOffsetFactor: 1,\n      polygonOffsetUnits: 1,\n    }),\n  )\n  group.add(mesh)\n\n  // 5. Arêtes cachées (pointillés)\n  const edgesDashed = new THREE.EdgesGeometry(mergedGeometry)\n  const dashedMaterial = new THREE.LineDashedMaterial({\n    color: options?.dashedColor ?? 0x888888,\n    dashSize: 0.08,\n    gapSize: 0.04,\n    linewidth: 1,\n    transparent: true,\n    opacity: 0.7,\n    depthTest: true,\n  })\n  const dashedLines = new THREE.LineSegments(edgesDashed, dashedMaterial)\n  dashedLines.computeLineDistances()\n  group.add(dashedLines)\n\n  // 6. Arêtes visibles (traits pleins)\n  const edgesSolid = new THREE.EdgesGeometry(mergedGeometry)\n  const solidMaterial = new THREE.LineBasicMaterial({\n    color: options?.solidColor ?? 0x000000,\n    linewidth: 2,\n    transparent: false,\n    depthTest: true,\n  })\n  const solidLines = new THREE.LineSegments(edgesSolid, solidMaterial)\n  group.add(solidLines)\n\n  return group\n}\nexport function createPrismWithWireframe(\n  sides: number,\n  radius: number,\n  bottom: number,\n  top: number,\n  withBottomBase = false,\n  withTopBase = false,\n  meshOpacity = 0.5,\n): THREE.Group {\n  const group = new THREE.Group()\n\n  // 1. Mesh (faces pleines, légèrement transparentes)\n  const geometry = createPrismGeometry(\n    sides,\n    radius,\n    bottom,\n    top,\n    withBottomBase,\n    withTopBase,\n  )\n  const mesh = new THREE.Mesh(\n    geometry,\n    new THREE.MeshPhongMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: meshOpacity,\n      polygonOffset: true,\n      polygonOffsetFactor: 1,\n      polygonOffsetUnits: 1,\n    }),\n  )\n  group.add(mesh)\n\n  // 2. Arêtes cachées (pointillés)\n  const edgesDashed = new THREE.EdgesGeometry(geometry)\n  const dashedMaterial = new THREE.LineDashedMaterial({\n    color: 0x888888,\n    dashSize: 0.08,\n    gapSize: 0.04,\n    linewidth: 1,\n    transparent: true,\n    opacity: 0.7,\n    depthTest: true,\n  })\n  const dashedLines = new THREE.LineSegments(edgesDashed, dashedMaterial)\n  dashedLines.computeLineDistances()\n  group.add(dashedLines)\n\n  // 3. Arêtes visibles (traits pleins, par-dessus)\n  const edgesSolid = new THREE.EdgesGeometry(geometry)\n  const solidMaterial = new THREE.LineBasicMaterial({\n    color: 0x000000,\n    linewidth: 2,\n    transparent: false,\n    depthTest: true,\n  })\n  const solidLines = new THREE.LineSegments(edgesSolid, solidMaterial)\n  group.add(solidLines)\n\n  return group\n}\n\nexport function createPyramidWithWireframe(\n  sides: number,\n  radius: number,\n  bottom: number,\n  top: number,\n  withBase = false,\n  meshOpacity = 0.5,\n): THREE.Group {\n  const group = new THREE.Group()\n\n  // 1. Mesh (faces pleines, légèrement transparentes)\n  const geometry = createPyramidGeometry(sides, radius, bottom, top, withBase)\n\n  const mesh = new THREE.Mesh(\n    geometry,\n    new THREE.MeshPhongMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: meshOpacity,\n      polygonOffset: true,\n      polygonOffsetFactor: 1,\n      polygonOffsetUnits: 1,\n    }),\n  )\n  group.add(mesh)\n\n  // 2. Arêtes cachées (pointillés)\n  const edgesDashed = new THREE.EdgesGeometry(geometry)\n  const dashedMaterial = new THREE.LineDashedMaterial({\n    color: 0x888888,\n    dashSize: 0.08,\n    gapSize: 0.04,\n    linewidth: 1,\n    transparent: true,\n    opacity: 0.7,\n    depthTest: true,\n  })\n  const dashedLines = new THREE.LineSegments(edgesDashed, dashedMaterial)\n  dashedLines.computeLineDistances()\n  group.add(dashedLines)\n\n  // 3. Arêtes visibles (traits pleins, par-dessus)\n  const edgesSolid = new THREE.EdgesGeometry(geometry)\n  const solidMaterial = new THREE.LineBasicMaterial({\n    color: 0x000000,\n    linewidth: 2,\n    transparent: false,\n    depthTest: true,\n  })\n  const solidLines = new THREE.LineSegments(edgesSolid, solidMaterial)\n  group.add(solidLines)\n\n  return group\n}\n\nexport function createTruncatedPyramidWithWireframe(\n  sides: number,\n  bottomRadius: number,\n  topRadius: number,\n  bottom: number,\n  top: number,\n  withBottomBase = false,\n  withTopBase = false,\n  meshOpacity = 0.5,\n): THREE.Group {\n  const group = new THREE.Group()\n\n  // 1. Mesh (faces pleines, légèrement transparentes)\n  const geometry = createTruncatedPyramidGeometry(\n    sides,\n    bottomRadius,\n    topRadius,\n    bottom,\n    top,\n    withBottomBase,\n    withTopBase,\n  )\n  const mesh = new THREE.Mesh(\n    geometry,\n    new THREE.MeshPhongMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: meshOpacity,\n      polygonOffset: true,\n      polygonOffsetFactor: 1,\n      polygonOffsetUnits: 1,\n    }),\n  )\n  group.add(mesh)\n\n  // 2. Arêtes cachées (pointillés)\n  const edgesDashed = new THREE.EdgesGeometry(geometry)\n  const dashedMaterial = new THREE.LineDashedMaterial({\n    color: 0x888888,\n    dashSize: 0.08,\n    gapSize: 0.04,\n    linewidth: 1,\n    transparent: true,\n    opacity: 0.7,\n    depthTest: true,\n  })\n  const dashedLines = new THREE.LineSegments(edgesDashed, dashedMaterial)\n  dashedLines.computeLineDistances()\n  group.add(dashedLines)\n\n  // 3. Arêtes visibles (traits pleins, par-dessus)\n  const edgesSolid = new THREE.EdgesGeometry(geometry)\n  const solidMaterial = new THREE.LineBasicMaterial({\n    color: 0x000000,\n    linewidth: 2,\n    transparent: false,\n    depthTest: true,\n  })\n  const solidLines = new THREE.LineSegments(edgesSolid, solidMaterial)\n  group.add(solidLines)\n\n  return group\n}\n","import {\n  createColoredCube,\n  createCustomWireSphere,\n  createEdgesFromGeometry,\n  createGeoPoint,\n  createGeoPoints,\n  createRealisticEarthSphere,\n  createSkySphere,\n} from './solidesThreeJs'\nimport { OrbitControls, Text, THREE, type Object3DJSON } from './threeInstance'\n\nclass Canvas3dElement extends HTMLElement {\n  private background: number = 0xeeeeee\n  private width: number = 500\n  private height: number = 300\n  private renderer: THREE.WebGLRenderer | null = null\n  private scene: THREE.Scene | null = null\n  private camera: THREE.PerspectiveCamera | null = null\n  private controls: OrbitControls | null = null\n  private _objects: THREE.Object3D[] = []\n  private _imgElement?: HTMLImageElement\n  private _contentDescription?: any\n  private _animationFrameId: number | null = null\n  private _fullscreenBtn?: HTMLButtonElement\n  private _cameraPosition: THREE.Vector3 = new THREE.Vector3(8, 8, 8)\n  private _cameraTarget: THREE.Vector3 = new THREE.Vector3(0, 0, 0)\n\n  private _imgClickHandler?: (ev: MouseEvent) => void\n\n  set objects(objs: THREE.Object3D[]) {\n    this._objects = objs\n    if (this.scene) {\n      this.setObjects(objs)\n    }\n  }\n\n  get objects() {\n    return this._objects\n  }\n\n  connectedCallback() {\n    this.style.display = 'inline-block'\n    this.width = parseInt(this.getAttribute('width') || '') || 500\n    this.height = parseInt(this.getAttribute('height') || '') || 300\n    this.style.width = `${this.width}px`\n    this.style.height = `${this.height}px`\n    this.style.position = 'relative'\n    if (!this.camera) {\n      // Valeurs par défaut\n      const defaultPosition = new THREE.Vector3(8, 8, 8)\n      const defaultTarget = new THREE.Vector3(0, 0, 0)\n      this._cameraPosition = defaultPosition.clone()\n      this._cameraTarget = defaultTarget.clone()\n      this.camera = new THREE.PerspectiveCamera(\n        35,\n        this.width / this.height,\n        0.1,\n        1000,\n      )\n      this.camera.position.copy(this._cameraPosition)\n      this.camera.lookAt(this._cameraTarget)\n    }\n    // Parsing du content\n    const contentAttr = this.getAttribute('content')\n    if (contentAttr) {\n      try {\n        const contentDescription = JSON.parse(decodeURIComponent(contentAttr))\n        this._contentDescription = contentDescription\n        const margin = contentDescription.autoCenterZoomMargin ?? 1.2 // 1.2 par défaut\n        if (Array.isArray(contentDescription.cameraPosition)) {\n          const pos = contentDescription.cameraPosition\n          this._cameraPosition.set(pos[0], pos[1], pos[2])\n          if (this.camera) this.camera.position.set(pos[0], pos[1], pos[2])\n        }\n        if (Array.isArray(contentDescription.cameraTarget)) {\n          const tgt = contentDescription.cameraTarget\n          this._cameraTarget.set(tgt[0], tgt[1], tgt[2])\n          if (this.camera) this.camera.lookAt(tgt[0], tgt[1], tgt[2])\n          if (this.controls) {\n            this.controls.target.set(tgt[0], tgt[1], tgt[2])\n            this.controls.update()\n          }\n        }\n        const objects = contentDescription.objects\n          .map((desc: any) => {\n            if (desc.type === 'geoPoint') {\n              return createGeoPoint(desc)\n            }\n            if (desc.type === 'geoPoints') {\n              return createGeoPoints(desc)\n            }\n            if (desc.type === 'cube') {\n              return createColoredCube(desc.pos, desc.size, {\n                edges: desc.edges,\n                edgesColor: desc.edgesColor,\n                edgesOpacity: desc.edgesOpacity,\n                colors: desc.colors ?? DEFAULT_CUBE_COLORS,\n              })\n            }\n            if (desc.type === 'bufferGeometry') {\n              if (desc.geometry.type === 'BufferGeometry') {\n                // JSON de BufferGeometry\n                const loader = new THREE.BufferGeometryLoader()\n                const geometry = loader.parse(desc.geometry)\n                // Création du group filaire à la main (comme dans createPrismWithWireframe)\n                const group = new THREE.Group()\n\n                // Mesh (faces pleines, transparentes)\n                const mesh = new THREE.Mesh(\n                  geometry,\n                  new THREE.MeshPhongMaterial({\n                    color: 0xffffff,\n                    transparent: true,\n                    opacity: 0.5,\n                    polygonOffset: true,\n                    polygonOffsetFactor: 1,\n                    polygonOffsetUnits: 1,\n                  }),\n                )\n                group.add(mesh)\n\n                // Arêtes cachées (pointillés)\n                const edgesDashed = new THREE.EdgesGeometry(geometry)\n                const dashedMaterial = new THREE.LineDashedMaterial({\n                  color: 0x888888,\n                  dashSize: 0.08,\n                  gapSize: 0.04,\n                  linewidth: 1,\n                  transparent: true,\n                  opacity: 0.7,\n                  depthTest: true,\n                })\n                const dashedLines = new THREE.LineSegments(\n                  edgesDashed,\n                  dashedMaterial,\n                )\n                dashedLines.computeLineDistances()\n                group.add(dashedLines)\n\n                // Arêtes visibles (traits pleins)\n                const edgesSolid = new THREE.EdgesGeometry(geometry)\n                const solidMaterial = new THREE.LineBasicMaterial({\n                  color: 0x000000,\n                  linewidth: 2,\n                  transparent: false,\n                  depthTest: true,\n                })\n                const solidLines = new THREE.LineSegments(\n                  edgesSolid,\n                  solidMaterial,\n                )\n                group.add(solidLines)\n\n                return group\n              } else if (Array.isArray(desc.geometry.geometries)) {\n                const loader = new THREE.BufferGeometryLoader()\n                // On ne garde que les BufferGeometry (ignore EdgesGeometry)\n                const bufferGeometries = desc.geometry.geometries\n                  .filter((g: any) => g.type === 'BufferGeometry')\n                  .map((g: any) => loader.parse(g))\n                // Fusionne si plusieurs géométries, sinon prend la seule\n                let geometry: THREE.BufferGeometry\n                if (bufferGeometries.length === 1) {\n                  geometry = bufferGeometries[0]\n                } else {\n                  // Nécessite BufferGeometryUtils\n                  geometry = (THREE as any).BufferGeometryUtils.mergeGeometries(\n                    bufferGeometries,\n                    true,\n                  )\n                }\n                // Création du group filaire à la main (comme dans createPrismWithWireframe)\n                const group = new THREE.Group()\n\n                // Mesh (faces pleines, transparentes)\n                const mesh = new THREE.Mesh(\n                  geometry,\n                  new THREE.MeshPhongMaterial({\n                    color: 0x222222,\n                    transparent: true,\n                    opacity: 0.5,\n                    polygonOffset: true,\n                    polygonOffsetFactor: 1,\n                    polygonOffsetUnits: 1,\n                  }),\n                )\n                this.applyPolygonOffset(mesh)\n                mesh.renderOrder = 0\n                group.add(mesh)\n\n                // Arêtes cachées (pointillés)\n                const edgesDashed = createEdgesFromGeometry(geometry, true)\n                edgesDashed.renderOrder = 1\n                const edgesSolid = createEdgesFromGeometry(geometry, false)\n                edgesSolid.renderOrder = 2\n                group.add(edgesDashed)\n                group.add(edgesSolid)\n\n                return group\n              }\n            }\n            if (desc.type === 'realisticEarthSphere') {\n              return createRealisticEarthSphere({\n                ...desc,\n                onTextureLoaded: () => {\n                  // Quand la texture est chargée, on refait le rendu statique\n                  this.renderStaticImage()\n                },\n              })\n            }\n\n            if (desc.type === 'customWireSphere') {\n              return createCustomWireSphere(desc)\n            }\n            if (desc.type === 'geoPoint') {\n              return createGeoPoint(desc)\n            }\n            if (desc.type === 'ambientLight') {\n              return new THREE.AmbientLight(\n                desc.color ?? 0xffffff,\n                desc.intensity ?? 1,\n              )\n            }\n            if (desc.type === 'directionalLight') {\n              const light = new THREE.DirectionalLight(\n                desc.color ?? 0xffffff,\n                desc.intensity ?? 1,\n              )\n              if (desc.position)\n                light.position.set(\n                  ...(desc.position as [number, number, number]),\n                )\n              return light\n            }\n            if (desc.type === 'skySphere') {\n              const sky = createSkySphere({\n                ...desc,\n                onTextureLoaded: () => {},\n              })\n              ;(sky as any).isSkySphere = true\n              return sky\n            }\n            if (desc.type === 'group') {\n              const loader = new THREE.ObjectLoader()\n              const group = loader.parse(desc.object)\n              return group\n            }\n            if (desc.type === 'canvas3dButton') {\n              const btn = document.createElement('button')\n              btn.id = desc.id\n              btn.textContent = desc.text\n              applyDefaultMathaleaButtonStyle(btn)\n              btn.type = 'button'\n              btn.style.cursor = 'pointer'\n              if (desc.position) Object.assign(btn.style, desc.position)\n              if (desc.style) Object.assign(btn.style, desc.style)\n              btn.style.zIndex = '20'\n              btn.style.pointerEvents = 'auto'\n\n              // Event custom\n              const handler = () => {\n                this.dispatchEvent(\n                  new CustomEvent(desc.onClick, {\n                    bubbles: true,\n                    composed: true,\n                  }),\n                )\n              }\n              btn.addEventListener('click', handler)\n\n              // Ajout dans l'overlay\n              let overlay = this.querySelector(\n                '.canvas-threejs-overlay',\n              ) as HTMLDivElement\n              if (!overlay) {\n                overlay = document.createElement('div')\n                overlay.className = 'canvas-threejs-overlay'\n                overlay.style.position = 'absolute'\n                overlay.style.top = '0'\n                overlay.style.left = '0'\n                overlay.style.width = '100%'\n                overlay.style.height = '100%'\n                overlay.style.pointerEvents = 'none'\n                overlay.style.zIndex = '10'\n                this.appendChild(overlay)\n              }\n              overlay.appendChild(btn)\n              return null\n            }\n            // ...autres types\n            return null\n          })\n          .filter(Boolean)\n\n        this._objects = objects\n        this.setObjects(objects)\n        if (\n          !(\n            Array.isArray(this._contentDescription?.cameraPosition) ||\n            Array.isArray(this._contentDescription?.cameraTarget)\n          )\n        ) {\n          this.autoCenterZoom(objects, margin)\n        }\n        const overlay = this.querySelector(\n          '.canvas-threejs-overlay',\n        ) as HTMLDivElement\n        if (overlay) {\n          overlay.style.display = 'none'\n        }\n        if (contentDescription.backgroundColor) {\n          this.background = contentDescription.backgroundColor\n          this.setBackground(contentDescription.backgroundColor)\n        }\n      } catch (e) {\n        console.error('Erreur de parsing content:', e)\n      }\n    }\n\n    // Création unique de l'image\n    if (!this._imgElement) {\n      this._imgElement = document.createElement('img')\n      this._imgElement.style.position = 'absolute'\n      this._imgElement.style.top = '0'\n      this._imgElement.style.left = '0'\n      this._imgElement.style.objectFit = 'contain'\n      this._imgElement.style.zIndex = '1'\n      this._imgElement.style.pointerEvents = 'auto'\n      this._imgElement.style.cursor = 'zoom-in'\n      this._imgElement.style.width = this.width + 'px'\n      this._imgElement.style.height = this.height + 'px'\n      this._imgClickHandler = () => this.enterFullscreen()\n      this._imgElement.addEventListener('click', this._imgClickHandler)\n      this.appendChild(this._imgElement)\n    }\n    // Création unique du bouton\n    if (!this._fullscreenBtn) {\n      this._fullscreenBtn = document.createElement('button')\n      this._fullscreenBtn.innerHTML =\n        '<i class=\"bx bx-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors\"></i>'\n      this._fullscreenBtn.title = 'Plein écran'\n      this._fullscreenBtn.style.position = 'absolute'\n      this._fullscreenBtn.style.top = '5px'\n      this._fullscreenBtn.style.right = '5px'\n      this._fullscreenBtn.style.zIndex = '10'\n      this._fullscreenBtn.style.pointerEvents = 'auto'\n      this._fullscreenBtn.style.background = '#fff' // Fond blanc opaque\n      this._fullscreenBtn.style.border = '1px solid #888' // Bordure grise\n      this._fullscreenBtn.style.borderRadius = '6px'\n      this._fullscreenBtn.style.width = '48px'\n      this._fullscreenBtn.style.height = '48px'\n      this._fullscreenBtn.style.display = 'flex'\n      this._fullscreenBtn.style.alignItems = 'center'\n      this._fullscreenBtn.style.justifyContent = 'center'\n      this._fullscreenBtn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)'\n      this._fullscreenBtn.style.cursor = 'pointer'\n      this._fullscreenBtn.style.color = '#222'\n      this._fullscreenBtn.style.opacity = '1'\n      this._fullscreenBtn.onclick = () => this.enterFullscreen()\n      this.appendChild(this._fullscreenBtn)\n    }\n\n    const textMeshes = getAllTroikaTextMeshes(this._objects)\n    if (textMeshes.length > 0) {\n      let readyCount = 0\n      textMeshes.forEach((textMesh) => {\n        textMesh.addEventListener(\n          'synccomplete',\n          () => {\n            readyCount++\n            if (readyCount === textMeshes.length) {\n              this.renderStaticImage()\n            }\n          },\n          { once: true },\n        )\n      })\n    } else {\n      this.renderStaticImage()\n    }\n  }\n\n  disconnectedCallback() {\n    if (this._imgElement && this._imgClickHandler) {\n      this._imgElement.removeEventListener('click', this._imgClickHandler)\n      this._imgClickHandler = undefined\n    }\n    this.removeDynamicButtonListeners()\n    this.destroyRenderer()\n  }\n\n  private renderStaticImage() {\n    const width = this.width\n    const height = this.height\n    // Crée un renderer temporaire\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    canvas.style.width = width + 'px'\n    canvas.style.height = height + 'px'\n    const renderer = new THREE.WebGLRenderer({\n      canvas,\n      antialias: true,\n      alpha: true,\n      preserveDrawingBuffer: true,\n    })\n    if (this.renderer && this.background) {\n      this.setBackground(this.background)\n    }\n    const scene = new THREE.Scene()\n    const camera = new THREE.PerspectiveCamera(35, width / height, 0.1, 1000)\n    camera.position.copy(this._cameraPosition)\n    camera.lookAt(this._cameraTarget)\n    this._objects.forEach((obj) => scene.add(obj))\n    renderer.setSize(width, height, false)\n    renderer.render(scene, camera)\n    const dataUrl = canvas.toDataURL('image/png')\n    renderer.dispose()\n    if (typeof renderer.forceContextLoss === 'function') {\n      renderer.forceContextLoss()\n    }\n    // Met à jour le src de l'image existante\n\n    if (this._imgElement) {\n      this._imgElement.style.width = width + 'px'\n      this._imgElement.style.height = height + 'px'\n      this._imgElement.width = width\n      this._imgElement.height = height\n      this._imgElement.src = dataUrl\n    } else {\n      console.error(\n        \"Il n'y a pas de this._imgElement alors qu'on est dans renderStaticImage\",\n      )\n    }\n  }\n\n  private enterFullscreen() {\n    // Masque l'image et le bouton\n    if (this._imgElement && this._fullscreenBtn) {\n      this._imgElement.style.display = 'none'\n      this._fullscreenBtn.style.display = 'none'\n    }\n\n    // Détection mobile simple (largeur < 800px ou userAgent)\n    const isMobile =\n      window.innerWidth < 800 ||\n      /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(\n        navigator.userAgent,\n      )\n\n    if (isMobile) {\n      // Canvas plein écran natif sur mobile\n      const width = window.innerWidth\n      const height = window.innerHeight\n      const canvas = document.createElement('canvas')\n      canvas.width = width\n      canvas.height = height\n      canvas.style.width = '100vw'\n      canvas.style.height = '100vh'\n      canvas.style.position = 'fixed'\n      canvas.style.top = '0'\n      canvas.style.left = '0'\n      canvas.style.zIndex = '5000'\n      document.body.appendChild(canvas)\n\n      // Demande le fullscreen natif\n      if (canvas.requestFullscreen) {\n        canvas.requestFullscreen()\n      } else if ((canvas as any).webkitRequestFullscreen) {\n        ;(canvas as any).webkitRequestFullscreen()\n      }\n\n      // Ajoute le bouton de sortie\n      const exitBtn = document.createElement('button')\n      exitBtn.type = 'button'\n      exitBtn.style.position = 'fixed'\n      exitBtn.style.top = '20px'\n      exitBtn.style.right = '30px'\n      exitBtn.style.zIndex = '6000'\n      exitBtn.style.background = '#fff'\n      exitBtn.style.border = '1px solid #888'\n      exitBtn.style.borderRadius = '6px'\n      exitBtn.style.width = '48px'\n      exitBtn.style.height = '48px'\n      exitBtn.style.fontSize = '1.8em'\n      exitBtn.style.display = 'flex'\n      exitBtn.style.alignItems = 'center'\n      exitBtn.style.justifyContent = 'center'\n      exitBtn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)'\n      exitBtn.style.cursor = 'pointer'\n      exitBtn.innerHTML =\n        '<i class=\"bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors\"></i>'\n      exitBtn.title = 'Quitter le plein écran'\n      document.body.appendChild(exitBtn)\n\n      // Crée le renderer et la scène\n      this.renderer = new THREE.WebGLRenderer({\n        canvas,\n        antialias: true,\n        alpha: false,\n      })\n      if (this.renderer && this.background) {\n        this.setBackground(this.background)\n      }\n      this.scene = new THREE.Scene()\n      this.camera = new THREE.PerspectiveCamera(35, width / height, 0.1, 1000)\n      this.camera.position.copy(this._cameraPosition)\n      this.camera.lookAt(this._cameraTarget)\n      this.controls = new OrbitControls(this.camera, canvas)\n      this.controls.target.copy(this._cameraTarget)\n      this.controls.update()\n      this._objects.forEach((obj) => this.scene!.add(obj))\n      this.renderer.setSize(width, height, false)\n      this.startAnimationLoop()\n\n      // Sortie du fullscreen natif\n      const exit = () => {\n        if (document.body.contains(exitBtn)) {\n          document.body.removeChild(exitBtn)\n        }\n        this.stopAnimationLoop()\n        if (this.renderer) {\n          this.renderer.dispose()\n          if (typeof this.renderer.forceContextLoss === 'function') {\n            this.renderer.forceContextLoss()\n          }\n        }\n        if (document.body.contains(canvas)) {\n          document.body.removeChild(canvas)\n        }\n        this.renderer = null\n        this.scene = null\n        this.camera = null\n        this.controls = null\n        this.renderStaticImage()\n        if (this._fullscreenBtn) {\n          this._fullscreenBtn.style.display = ''\n        }\n        if (this._imgElement) {\n          this._imgElement.style.display = ''\n        }\n        // Quitte le fullscreen natif si actif\n        if (document.fullscreenElement) {\n          document.exitFullscreen?.()\n        }\n      }\n      exitBtn.onclick = exit\n\n      // Quitte le plein écran si l'utilisateur utilise le geste natif\n      document.addEventListener(\n        'fullscreenchange',\n        () => {\n          if (!document.fullscreenElement) {\n            exit()\n          }\n        },\n        { once: true },\n      )\n\n      return\n    }\n\n    // --- Comportement desktop inchangé ---\n    // Ajout du bouton dans enterFullscreen()\n    const exitBtn = document.createElement('button')\n    exitBtn.type = 'button'\n    exitBtn.style.position = 'fixed'\n    exitBtn.style.top = '20px'\n    exitBtn.style.right = '30px'\n    exitBtn.style.zIndex = '2000'\n    exitBtn.style.background = '#fff'\n    exitBtn.style.border = '1px solid #888'\n    exitBtn.style.borderRadius = '6px'\n    exitBtn.style.width = '48px'\n    exitBtn.style.height = '48px'\n    exitBtn.style.fontSize = '1.8em'\n    exitBtn.style.display = 'flex'\n    exitBtn.style.alignItems = 'center'\n    exitBtn.style.justifyContent = 'center'\n    exitBtn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)'\n    exitBtn.style.cursor = 'pointer'\n\n    exitBtn.innerHTML =\n      '<i class=\"bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors\"></i>'\n    exitBtn.title = 'Quitter le plein écran'\n    exitBtn.style.zIndex = '6000'\n\n    exitBtn.onclick = () => {\n      exit()\n    }\n    document.body.appendChild(exitBtn)\n\n    // Crée le canvas fullscreen\n    const width = window.innerWidth\n    const height = window.innerHeight\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    canvas.style.position = 'absolute'\n    canvas.style.top = '0'\n    canvas.style.left = '0'\n    canvas.style.width = '100%'\n    canvas.style.height = '100%'\n    canvas.style.zIndex = '5000'\n    document.body.appendChild(canvas)\n    const overlay = this.querySelector(\n      '.canvas-threejs-overlay',\n    ) as HTMLDivElement\n    if (overlay) {\n      overlay.style.position = 'fixed'\n      overlay.style.display = 'block'\n      overlay.style.top = '0'\n      overlay.style.left = '0'\n      overlay.style.width = '100vw'\n      overlay.style.height = '100vh'\n      overlay.style.zIndex = '6000' // supérieur au canvas\n      overlay.style.pointerEvents = 'none' // sauf pour les boutons\n      // Pour chaque bouton dans l'overlay\n      overlay.querySelectorAll('button').forEach((btn) => {\n        btn.style.zIndex = '6010'\n        btn.style.pointerEvents = 'auto'\n      })\n    }\n\n    // Crée le renderer et la scène\n    this.renderer = new THREE.WebGLRenderer({\n      canvas,\n      antialias: true,\n      alpha: false,\n    })\n    if (this.renderer && this.background) {\n      this.setBackground(this.background)\n    }\n    this.scene = new THREE.Scene()\n    this.camera = new THREE.PerspectiveCamera(35, width / height, 0.1, 1000)\n    this.camera.position.copy(this._cameraPosition)\n    this.camera.lookAt(this._cameraTarget)\n    this.controls = new OrbitControls(this.camera, canvas)\n    this.controls.target.copy(this._cameraTarget)\n    this.controls.update()\n    this._objects.forEach((obj) => this.scene!.add(obj))\n    this.renderer.setSize(width, height, false)\n\n    // Animation\n    this.startAnimationLoop()\n\n    // Sortie du fullscreen simulé\n    const exit = () => {\n      if (document.body.contains(exitBtn)) {\n        document.body.removeChild(exitBtn)\n      }\n      if (overlay) {\n        overlay.style.position = 'absolute'\n        overlay.style.display = 'none'\n        overlay.style.top = '0'\n        overlay.style.left = '0'\n        overlay.style.width = '100%'\n        overlay.style.height = '100%'\n        overlay.style.zIndex = '10'\n        overlay.style.pointerEvents = 'none'\n        overlay.querySelectorAll('button').forEach((btn) => {\n          btn.style.zIndex = '20'\n          btn.style.pointerEvents = 'auto'\n        })\n      }\n\n      this.stopAnimationLoop()\n      if (this.renderer) {\n        this.renderer.dispose()\n        if (typeof this.renderer.forceContextLoss === 'function') {\n          this.renderer.forceContextLoss()\n        }\n      }\n      document.body.removeChild(canvas)\n      this.renderer = null\n      this.scene = null\n      this.camera = null\n      this.controls = null\n      this.renderStaticImage()\n      if (this._fullscreenBtn) {\n        this._fullscreenBtn.style.display = ''\n      }\n      if (this._imgElement) {\n        this._imgElement.style.display = ''\n      }\n    }\n  }\n\n  private setObjects(objects: THREE.Object3D[]) {\n    if (!this.scene) return\n    this.scene.clear()\n    objects.forEach((obj) => this.scene!.add(obj))\n    this.renderer?.render(this.scene, this.camera!)\n  }\n\n  private startAnimationLoop() {\n    if (this._animationFrameId) return\n    const loop = () => {\n      this.renderer?.render(this.scene!, this.camera!)\n      // Stocke la position et la cible actuelles\n      if (this.camera) {\n        this._cameraPosition.copy(this.camera.position)\n        if (this.controls) {\n          this._cameraTarget.copy(this.controls.target)\n        } else {\n          // Si pas de controls, cible = lookAt\n          // (optionnel, selon ton usage)\n        }\n      }\n      this._animationFrameId = requestAnimationFrame(loop)\n    }\n    loop()\n  }\n\n  private stopAnimationLoop() {\n    if (this._animationFrameId) {\n      cancelAnimationFrame(this._animationFrameId)\n      this._animationFrameId = null\n    }\n  }\n\n  private applyPolygonOffset(mesh: THREE.Mesh) {\n    const materials = Array.isArray(mesh.material)\n      ? mesh.material\n      : [mesh.material]\n    for (const mat of materials) {\n      mat.polygonOffset = true\n      mat.polygonOffsetFactor = 1\n      mat.polygonOffsetUnits = 1\n    }\n  }\n\n  autoCenterZoom(objects: THREE.Object3D[], margin: number = 1.2) {\n    const objs = objects\n      .filter((obj) => !(obj as any).isSkySphere)\n      .filter(\n        (obj) => obj.type !== 'DirectionalLight' && obj.type !== 'AmbientLight',\n      )\n\n    const box = new THREE.Box3()\n    objs.forEach((obj) => {\n      if (obj instanceof THREE.Object3D) {\n        const objBox = new THREE.Box3().setFromObject(obj)\n        box.union(objBox)\n        if (obj instanceof THREE.LineSegments && obj.userData.sourceGeometry) {\n          const tempMesh = new THREE.Mesh(obj.userData.sourceGeometry)\n          const geomBox = new THREE.Box3().setFromObject(tempMesh)\n          box.union(geomBox)\n        }\n      }\n    })\n\n    const center = box.getCenter(new THREE.Vector3())\n    const size = box.getSize(new THREE.Vector3())\n    const dx = size.x\n    const dy = size.y\n    const dz = size.z\n\n    // ...calcul du center et de la distance...\n    if (margin > 0 && this.camera) {\n      // Calcule la nouvelle position\n      const fovRad = (this.camera.fov * Math.PI) / 180\n      const aspect = this.width / this.height\n      const fovHorizontalRad = 2 * Math.atan(Math.tan(fovRad / 2) * aspect)\n      const distanceV = dy / (2 * Math.tan(fovRad / 2))\n      const distanceH = dx / (2 * Math.tan(fovHorizontalRad / 2))\n      const distance = margin * Math.max(distanceV, distanceH, dz)\n      const newPosition = new THREE.Vector3(\n        center.x + distance,\n        center.y + distance,\n        center.z + distance,\n      )\n      this._cameraPosition.copy(newPosition) // <-- MAJ la position de référence\n      this.camera.position.copy(newPosition)\n    }\n    // Centre la cible\n    this._cameraTarget.copy(center) // <-- MAJ la cible de référence\n    if (this.controls) {\n      this.controls.target.copy(center)\n      this.controls.update()\n    } else if (this.camera) {\n      this.camera.lookAt(center)\n    }\n  }\n\n  private destroyRenderer() {\n    this.stopAnimationLoop()\n    if (this.renderer) {\n      this.renderer.dispose()\n      if (typeof this.renderer.forceContextLoss === 'function') {\n        this.renderer.forceContextLoss()\n      }\n    }\n    this.renderer = null\n    this.scene = null\n    this.camera = null\n    this.controls = null\n  }\n\n  setBackground(color: string | number) {\n    if (this.renderer) {\n      this.renderer.setClearColor(color)\n    }\n  }\n\n  private removeDynamicButtonListeners() {\n    // Sélectionne tous les boutons dynamiques dans l'overlay\n    const overlay = this.querySelector(\n      '.canvas-threejs-overlay',\n    ) as HTMLDivElement\n    if (overlay) {\n      const buttons = overlay.querySelectorAll('button')\n      buttons.forEach((btn) => {\n        // Clone le bouton pour supprimer tous les listeners\n        const clone = btn.cloneNode(true) as HTMLButtonElement\n        overlay.replaceChild(clone, btn)\n      })\n      // Optionnel : retire l'overlay du DOM\n      this.removeChild(overlay)\n    }\n  }\n}\n\ncustomElements.define('canvas-3d', Canvas3dElement)\nexport default Canvas3dElement\nexport const DEFAULT_CUBE_COLORS = [\n  0xff0000, // red\n  0xa70909, // dark red\n  0xffa35c, // orange\n  0xda8427, // dark orange\n  0xffff00, // yellow\n  0xcaca1a, // dark yellow\n]\n\ninterface CubeDescription {\n  type: 'cube'\n  pos: [number, number, number]\n  size: number\n  edges?: boolean\n  [key: string]: any\n}\n\ninterface AmbientLightDescription {\n  type: 'ambientLight'\n  color?: number\n  intensity?: number\n  [key: string]: any\n}\n\ninterface DirectionalLightDescription {\n  type: 'directionalLight'\n  color?: number\n  intensity?: number\n  position?: [number, number, number]\n  [key: string]: any\n}\n\ninterface SphereDescription {\n  type: 'sphere'\n  position?: [number, number, number]\n  radius: number\n  color?: string | number\n  wireframe?: boolean\n  [key: string]: any\n}\n\ninterface GeoPointDescription {\n  type: 'geoPoint'\n  latitude: number\n  longitude: number\n  spherePosition?: [number, number, number]\n  sphereRadius?: number\n  label?: string\n  pointColor?: string | number\n  pointRadius?: number\n  labelColor?: string\n  labelSize?: number\n  font?: string\n  transparent?: boolean\n  [key: string]: any\n}\nexport interface BufferGeometryDescription {\n  type: 'bufferGeometry'\n  geometry:\n    | {\n        type: 'BufferGeometry'\n        [key: string]: any // JSON exporté par BufferGeometry.toJSON()\n      }\n    | {\n        geometries: Array<{\n          type: 'BufferGeometry'\n          [key: string]: any\n        }>\n        [key: string]: any // Peut contenir d'autres propriétés (materials, object, etc.)\n      }\n    | {\n        type: 'Object'\n        geometries: Array<any>\n        materials?: Array<any>\n        object?: any\n        [key: string]: any\n      }\n}\n\nexport type LineSegmentsDescription = {\n  type: 'lineSegments'\n  geometry: THREE.LineSegments\n}\n\nexport interface GroupDescription {\n  type: 'group'\n  object: Object3DJSON\n}\n\nexport interface Canvas3dButtonDescription {\n  type: 'canvas3dButton'\n  id: string\n  text: string\n  position?: { top?: string; left?: string; right?: string; bottom?: string }\n  style?: Partial<CSSStyleDeclaration>\n  onClick: string // nom de l'event custom à déclencher\n}\n\n// Ajoute d'autres types ici...\n\nexport type Elements3DDescription =\n  | BufferGeometryDescription\n  | CubeDescription\n  | SphereDescription\n  | GroupDescription\n  | GeoPointDescription\n  | AmbientLightDescription\n  | DirectionalLightDescription\n  | Canvas3dButtonDescription\n// ...autres types\n\nexport function ajouteCanvas3d({\n  id,\n  content,\n  width = 200,\n  height = 200,\n}: {\n  id: string\n  content: { objects: Elements3DDescription[]; autoCenterZoomMargin?: number }\n  width: number\n  height: number\n}): string {\n  const contentJson = encodeURIComponent(JSON.stringify(content))\n  return `<canvas-3d id=\"${id}\" content='${contentJson}' width=\"${width}\" height=\"${height}\"></canvas-3d>`\n}\n\nfunction applyDefaultMathaleaButtonStyle(btn: HTMLButtonElement) {\n  btn.className =\n    'inline-flex px-6 py-2.5 ml-6 bg-coopmaths-action dark:bg-coopmathsdark-action text-coopmaths-canvas dark:text-coopmathsdark-canvas font-medium text-xs leading-tight uppercase rounded shadow-md transform hover:bg-coopmaths-action-lightest dark:hover:bg-coopmathsdark-action-lightest hover:shadow-lg focus:bg-coopmaths-action-lightest dark:focus:bg-coopmathsdark-action-lightest focus:shadow-lg focus:outline-none focus:ring-0 active:bg-coopmaths-action-lightest dark:active:bg-coopmathsdark-action-lightest active:shadow-lg transition duration-150 ease-in-out'\n  btn.setAttribute('type', 'button')\n}\n\nfunction getAllTroikaTextMeshes(objects: THREE.Object3D[]): any[] {\n  const texts: any[] = []\n  objects.forEach((obj) => {\n    obj.traverse((child) => {\n      if (child instanceof Text) texts.push(child)\n    })\n  })\n  return texts\n}\n"],"names":["createPrismGeometry","sides","radius","bottom","top","withBottomBase","withTopBase","geometry","THREE.BufferGeometry","vertices","base","topBase","i","theta","x","z","THREE.Vector3","a","b","c","d","THREE.Float32BufferAttribute","createPyramidGeometry","withBase","apex","createTruncatedPyramidGeometry","bottomRadius","topRadius","bottomVerts","topVerts","createEdgesFromGeometry","dashed","edges","THREE.EdgesGeometry","material","THREE.LineDashedMaterial","THREE.LineBasicMaterial","line","THREE.LineSegments","THREE.BoxGeometry","materials","THREE.MeshPhongMaterial","THREE.Mesh","mesh","group","THREE.Group","createColoredCube","position","size","options","colors","range","n","_a","createRealisticEarthSphere","desc","DIFFUSE_MAP","NORMAL_MAP","THREE.SphereGeometry","loader","THREE.TextureLoader","THREE.MeshStandardMaterial","THREE.Vector2","THREE.MathUtils","diffuse","THREE.SRGBColorSpace","normal","createGeoPoint","spherePos","r","latRad","lonRad","y","sphericalToCartesian","point","textMesh","Text","labelOffset","labelPos","euler","THREE.Euler","createGeoPoints","pointDesc","latitude","longitude","center","createCustomWireSphere","parallels","meridians","segments","parallelColor","meridianColor","showParallels","showMeridians","showEquator","equatorColor","equatorThickness","showGreenwich","greenwichColor","greenwichThickness","phi","points","THREE.EllipseCurve","p","THREE.LineLoop","j","THREE.Line","createSkySphere","textureLoader","THREE.MeshBasicMaterial","THREE.DoubleSide","texture","createWireframeUnion","items","geometries","collectGeometries","obj","THREE.Object3D","child","item","mergedGeometry","BufferGeometryUtils.mergeGeometries","pos","sum","barycenter","ax","ay","az","bx","by","bz","cx","cy","cz","ab","ac","toBarycenter","edgesDashed","dashedMaterial","dashedLines","edgesSolid","solidMaterial","solidLines","createPrismWithWireframe","meshOpacity","createPyramidWithWireframe","createTruncatedPyramidWithWireframe","Canvas3dElement","__publicField","objs","defaultPosition","defaultTarget","THREE.PerspectiveCamera","contentAttr","contentDescription","margin","tgt","objects","DEFAULT_CUBE_COLORS","THREE.BufferGeometryLoader","bufferGeometries","g","THREE.BufferGeometryUtils","THREE.AmbientLight","light","THREE.DirectionalLight","sky","THREE.ObjectLoader","btn","applyDefaultMathaleaButtonStyle","handler","overlay","_b","e","textMeshes","getAllTroikaTextMeshes","readyCount","width","height","canvas","renderer","THREE.WebGLRenderer","scene","THREE.Scene","camera","dataUrl","exitBtn","OrbitControls","exit","loop","mat","box","THREE.Box3","objBox","tempMesh","geomBox","dx","dy","dz","fovRad","aspect","fovHorizontalRad","distanceV","distanceH","distance","newPosition","color","clone","ajouteCanvas3d","id","content","contentJson","texts"],"mappings":"kjBAIO,SAASA,GACdC,EACAC,EACAC,EACAC,EACAC,EAAiB,GACjBC,EAAc,GACQ,CACtB,MAAMC,EAAW,IAAIC,EACfC,EAAqB,CAAA,EACrBC,EAAwB,CAAA,EACxBC,EAA2B,CAAA,EAGjC,QAASC,EAAI,EAAGA,EAAIX,EAAOW,IAAK,CAC9B,MAAMC,EAASD,EAAIX,EAAS,KAAK,GAAK,EAChCa,EAAIZ,EAAS,KAAK,IAAIW,CAAK,EAC3BE,EAAIb,EAAS,KAAK,IAAIW,CAAK,EACjCH,EAAK,KAAK,IAAIM,EAAcF,EAAGX,EAAQY,CAAC,CAAC,EACzCJ,EAAQ,KAAK,IAAIK,EAAcF,EAAGV,EAAKW,CAAC,CAAC,CAC3C,CAGA,GAAIV,EACF,QAASO,EAAI,EAAGA,EAAIX,EAAQ,EAAGW,IAC7BH,EAAS,KACPC,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,EACRA,EAAKE,EAAI,CAAC,EAAE,EACZF,EAAKE,EAAI,CAAC,EAAE,EACZF,EAAKE,EAAI,CAAC,EAAE,EACZF,EAAKE,CAAC,EAAE,EACRF,EAAKE,CAAC,EAAE,EACRF,EAAKE,CAAC,EAAE,CAAA,EAMd,GAAIN,EACF,QAASM,EAAI,EAAGA,EAAIX,EAAQ,EAAGW,IAC7BH,EAAS,KACPE,EAAQ,CAAC,EAAE,EACXA,EAAQ,CAAC,EAAE,EACXA,EAAQ,CAAC,EAAE,EACXA,EAAQC,CAAC,EAAE,EACXD,EAAQC,CAAC,EAAE,EACXD,EAAQC,CAAC,EAAE,EACXD,EAAQC,EAAI,CAAC,EAAE,EACfD,EAAQC,EAAI,CAAC,EAAE,EACfD,EAAQC,EAAI,CAAC,EAAE,CAAA,EAMrB,QAASA,EAAI,EAAGA,EAAIX,EAAOW,IAAK,CAC9B,MAAMK,EAAIP,EAAKE,CAAC,EACVM,EAAIR,GAAME,EAAI,GAAKX,CAAK,EACxBkB,EAAIR,GAASC,EAAI,GAAKX,CAAK,EAC3BmB,EAAIT,EAAQC,CAAC,EAGnBH,EAAS,KAAKQ,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGE,EAAE,EAAGA,EAAE,EAAGA,EAAE,CAAC,EAEzDX,EAAS,KAAKS,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,CAAC,CAC3D,CAEA,OAAAb,EAAS,aACP,WACA,IAAIc,EAA6BZ,EAAU,CAAC,CAAA,EAE9CF,EAAS,qBAAA,EACFA,CACT,CAEO,SAASe,GACdrB,EACAC,EACAC,EACAC,EACAmB,EAAW,GACW,CACtB,MAAMhB,EAAW,IAAIC,EACfC,EAAqB,CAAA,EACrBe,EAAO,IAAIR,EAAc,EAAGZ,EAAK,CAAC,EAClCM,EAAwB,CAAA,EAE9B,QAAS,EAAI,EAAG,EAAIT,EAAO,IAAK,CAC9B,MAAMY,EAAS,EAAIZ,EAAS,KAAK,GAAK,EAChCa,EAAIZ,EAAS,KAAK,IAAIW,CAAK,EAC3BE,EAAIb,EAAS,KAAK,IAAIW,CAAK,EACjCH,EAAK,KAAK,IAAIM,EAAcF,EAAGX,EAAQY,CAAC,CAAC,CAC3C,CAGA,GAAIQ,EACF,QAAS,EAAI,EAAG,EAAItB,EAAQ,EAAG,IAC7BQ,EAAS,KACPC,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,EACRA,EAAK,EAAI,CAAC,EAAE,EACZA,EAAK,EAAI,CAAC,EAAE,EACZA,EAAK,EAAI,CAAC,EAAE,EACZA,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,EACRA,EAAK,CAAC,EAAE,CAAA,EAMd,QAAS,EAAI,EAAG,EAAIT,EAAO,IAAK,CAC9B,MAAMgB,EAAIP,EAAK,CAAC,EACVQ,EAAIR,GAAM,EAAI,GAAKT,CAAK,EAC9BQ,EAAS,KAAKQ,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGM,EAAK,EAAGA,EAAK,EAAGA,EAAK,CAAC,CACpE,CAEA,OAAAjB,EAAS,aACP,WACA,IAAIc,EAA6BZ,EAAU,CAAC,CAAA,EAE9CF,EAAS,qBAAA,EACFA,CACT,CAEO,SAASkB,GACdxB,EACAyB,EACAC,EACAxB,EACAC,EACAC,EAAiB,GACjBC,EAAc,GACQ,CACtB,MAAMC,EAAW,IAAIC,EACfC,EAAqB,CAAA,EACrBmB,EAA+B,CAAA,EAC/BC,EAA4B,CAAA,EAElC,QAASjB,EAAI,EAAGA,EAAIX,EAAOW,IAAK,CAC9B,MAAMC,EAASD,EAAIX,EAAS,KAAK,GAAK,EACtC2B,EAAY,KACV,IAAIZ,EACFU,EAAe,KAAK,IAAIb,CAAK,EAC7BV,EACAuB,EAAe,KAAK,IAAIb,CAAK,CAAA,CAC/B,EAEFgB,EAAS,KACP,IAAIb,EACFW,EAAY,KAAK,IAAId,CAAK,EAC1BT,EACAuB,EAAY,KAAK,IAAId,CAAK,CAAA,CAC5B,CAEJ,CAGA,GAAIR,EACF,QAASO,EAAI,EAAGA,EAAIX,EAAQ,EAAGW,IAC7BH,EAAS,KACPmB,EAAY,CAAC,EAAE,EACfA,EAAY,CAAC,EAAE,EACfA,EAAY,CAAC,EAAE,EACfA,EAAYhB,EAAI,CAAC,EAAE,EACnBgB,EAAYhB,EAAI,CAAC,EAAE,EACnBgB,EAAYhB,EAAI,CAAC,EAAE,EACnBgB,EAAYhB,CAAC,EAAE,EACfgB,EAAYhB,CAAC,EAAE,EACfgB,EAAYhB,CAAC,EAAE,CAAA,EAMrB,GAAIN,EACF,QAASM,EAAI,EAAGA,EAAIX,EAAQ,EAAGW,IAC7BH,EAAS,KACPoB,EAAS,CAAC,EAAE,EACZA,EAAS,CAAC,EAAE,EACZA,EAAS,CAAC,EAAE,EACZA,EAASjB,CAAC,EAAE,EACZiB,EAASjB,CAAC,EAAE,EACZiB,EAASjB,CAAC,EAAE,EACZiB,EAASjB,EAAI,CAAC,EAAE,EAChBiB,EAASjB,EAAI,CAAC,EAAE,EAChBiB,EAASjB,EAAI,CAAC,EAAE,CAAA,EAMtB,QAASA,EAAI,EAAGA,EAAIX,EAAOW,IAAK,CAC9B,MAAMK,EAAIW,EAAYhB,CAAC,EACjBM,EAAIU,GAAahB,EAAI,GAAKX,CAAK,EAC/BkB,EAAIU,GAAUjB,EAAI,GAAKX,CAAK,EAC5BmB,EAAIS,EAASjB,CAAC,EAGpBH,EAAS,KAAKQ,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGE,EAAE,EAAGA,EAAE,EAAGA,EAAE,CAAC,EAEzDX,EAAS,KAAKS,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGA,EAAE,CAAC,CAC3D,CAEA,OAAAb,EAAS,aACP,WACA,IAAIc,EAA6BZ,EAAU,CAAC,CAAA,EAE9CF,EAAS,qBAAA,EACFA,CACT,CASO,SAASuB,EACdvB,EACAwB,EAAS,GACW,CACpB,MAAMC,EAAQ,IAAIC,EAAoB1B,CAAQ,EAC9C,IAAI2B,EACAH,EACFG,EAAW,IAAIC,EAAyB,CACtC,MAAO,EACP,SAAU,IACV,QAAS,KACT,UAAW,GACX,YAAa,GACb,QAAS,EAAA,CACV,EAEDD,EAAW,IAAIE,EAAwB,CACrC,MAAO,EACP,UAAW,GACX,YAAa,GACb,QAAS,CAAA,CACV,EAEH,MAAMC,EAAO,IAAIC,EAAmBN,EAAOE,CAAQ,EACnD,OAAIH,GAAUM,EAAK,sBAAsBA,EAAK,qBAAA,EACvCA,CACT,EAGiC,IAAM,CACrC,MAAM9B,EAAW,IAAIgC,EAAkB,EAAG,EAAG,CAAC,EACxCC,EAAY,CAChB,IAAIC,EAAwB,CAAE,MAAO,MAAO,EAC5C,IAAIA,EAAwB,CAAE,MAAO,MAAO,EAC5C,IAAIA,EAAwB,CAAE,MAAO,QAAS,EAC9C,IAAIA,EAAwB,CAAE,MAAO,QAAS,EAC9C,IAAIA,EAAwB,CAAE,MAAO,OAAQ,EAC7C,IAAIA,EAAwB,CAAE,MAAO,OAAQ,CAAA,EAG/C,OADa,IAAIC,EAAWnC,EAAUiC,CAAS,CAEjD,GAAA,GAGsC,IAAM,CAC1C,MAAMjC,EAAW,IAAIgC,EAAkB,EAAG,EAAG,CAAC,EACxCC,EAAY,CAChB,IAAIC,EAAwB,CAAE,MAAO,MAAO,EAC5C,IAAIA,EAAwB,CAAE,MAAO,MAAO,EAC5C,IAAIA,EAAwB,CAAE,MAAO,QAAS,EAC9C,IAAIA,EAAwB,CAAE,MAAO,QAAS,EAC9C,IAAIA,EAAwB,CAAE,MAAO,OAAQ,EAC7C,IAAIA,EAAwB,CAAE,MAAO,OAAQ,CAAA,EAEzCE,EAAO,IAAID,EAAWnC,EAAUiC,CAAS,EACzCR,EAAQ,IAAIC,EAAoB1B,CAAQ,EACxC8B,EAAO,IAAIC,EACfN,EACA,IAAII,EAAwB,CAAE,MAAO,EAAU,CAAA,EAE3CQ,EAAQ,IAAIC,EAClB,OAAAD,EAAM,IAAID,CAAI,EACdC,EAAM,IAAIP,CAAI,EACPO,CACT,GAAA,EAEO,SAASE,GACdC,EACAC,EAAO,EACPC,EAM0B,CAC1B,MAAMC,EAASC,GAAM,CAAC,EAAE,IACrBC,GAAA,OAAO,QAAAH,GAAA,YAAAA,EAAS,SAAU,CAAC,QAAQ,GAAGG,KAAKC,EAAAJ,GAAA,YAAAA,EAAS,SAAT,YAAAI,EAAiB,SAAU,EAAE,EAAA,EAErE9C,EAAW,IAAIgC,EAAkBS,EAAMA,EAAMA,CAAI,EACjDR,EAAY,CAChB,IAAIC,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,EAChD,IAAIT,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,EAChD,IAAIT,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,EAChD,IAAIT,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,EAChD,IAAIT,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,EAChD,IAAIT,EAAwB,CAAE,MAAOS,EAAO,CAAC,EAAG,CAAA,EAE5CP,EAAO,IAAID,EAAWnC,EAAUiC,CAAS,EAG/C,GAFAG,EAAK,SAAS,IAAI,GAAGI,CAAQ,EAEzBE,GAAA,MAAAA,EAAS,MAAO,CAClB,MAAMjB,EAAQ,IAAIC,EAAoB1B,CAAQ,EACxC8B,EAAO,IAAIC,EACfN,EACA,IAAII,EAAwB,CAC1B,MAAOa,EAAQ,YAAc,EAC7B,QAASA,EAAQ,cAAgB,EACjC,aAAcA,EAAQ,cAAgB,GAAK,CAAA,CAC5C,CAAA,EAEHZ,EAAK,SAAS,KAAKM,EAAK,QAAQ,EAEhC,MAAMC,EAAQ,IAAIC,EAClB,OAAAD,EAAM,IAAID,CAAI,EACdC,EAAM,IAAIP,CAAI,EACPO,CACT,KACE,QAAOD,CAEX,CAiBO,SAASW,GAA2BC,EAO5B,CACb,MAAMC,EAAc,4BACdC,EAAa,+BAEblD,EAAW,IAAImD,EACnBH,EAAK,QAAU,EACfA,EAAK,eAAiB,GACtBA,EAAK,gBAAkB,EAAA,EAGnBI,EAAS,IAAIC,GACb1B,EAAW,IAAI2B,GAA2B,CAC9C,MAAO,SACP,UAAW,GACX,UAAW,GACX,UAAW,GACX,YAAa,IAAIC,GAAc,EAAG,CAAC,EACnC,SAAU,OAAA,CACX,EAEKnB,EAAO,IAAID,EAAWnC,EAAU2B,CAAQ,EAC9C,OAAIqB,EAAK,UAAUZ,EAAK,SAAS,IAAI,GAAGY,EAAK,QAAQ,EACjDA,EAAK,qBACPZ,EAAK,SAAS,EAAIoB,GAAgB,SAASR,EAAK,kBAAkB,GAGpEI,EAAO,KAAKH,EAAcQ,GAAY,OACpCA,EAAQ,WAAaC,GACrB/B,EAAS,IAAM8B,EACf9B,EAAS,YAAc,IACvBmB,EAAAE,EAAK,kBAAL,MAAAF,EAAA,KAAAE,EACF,CAAC,EAGDI,EAAO,KAAKF,EAAaS,GAAW,OAClChC,EAAS,UAAYgC,EACrBhC,EAAS,YAAc,IACvBmB,EAAAE,EAAK,kBAAL,MAAAF,EAAA,KAAAE,EACF,CAAC,EAEMZ,CACT,CAEO,SAASwB,EAAeZ,EAef,CAEd,MAAMa,EAAYb,EAAK,gBAAkB,CAAC,EAAG,EAAG,CAAC,EAC3Cc,GAAKd,EAAK,cAAgB,IAAMA,EAAK,UAAY,GACjDe,EAAUf,EAAK,SAAW,KAAK,GAAM,IACrCgB,EAAUhB,EAAK,UAAY,KAAK,GAAM,IAGtC,CAACzC,EAAG0D,EAAGzD,CAAC,EAAI0D,EAChBlB,EAAK,SACLA,EAAK,UACLc,EACAD,CAAA,EAII7D,EAAW,IAAImD,EAAqBH,EAAK,aAAe,IAAM,GAAI,EAAE,EACpErB,EAAW,IAAIO,EAAwB,CAC3C,MAAOc,EAAK,YAAc,QAAA,CAC3B,EACKmB,EAAQ,IAAIhC,EAAWnC,EAAU2B,CAAQ,EAC/CwC,EAAM,SAAS,IAAI5D,EAAG0D,EAAGzD,CAAC,EAE1B,MAAM6B,EAAQ,IAAIC,EAIlB,GAHAD,EAAM,IAAI8B,CAAK,EAGXnB,EAAK,MAAO,CACd,KAAM,CAACzC,EAAG0D,EAAGzD,CAAC,EAAI0D,EAChBlB,EAAK,SAAW,EAChBA,EAAK,UACLc,EACAD,CAAA,EAEIO,EAAW,IAAIC,EAGfV,EAAS,IAAIlD,EAAcF,EAAG0D,EAAGzD,CAAC,EAAE,UAAA,EACpC8D,EAActB,EAAK,aAAe,IAClCuB,EAAWZ,EAAO,MAAA,EAAQ,eAAeG,EAAIQ,CAAW,EAG9DF,EAAS,SAAS,KAAKG,CAAQ,EAC/BH,EAAS,KAAOpB,EAAK,MACrBoB,EAAS,SAAWpB,EAAK,WAAa,GACtCoB,EAAS,MAAQpB,EAAK,YAAc,UACpCoB,EAAS,QAAU,SACnBA,EAAS,QAAU,SACnBA,EAAS,KAAOpB,EAAK,MAAQ,+BAC7B,MAAMwB,EAAQ,IAAIC,GAAY,EAAGT,EAAQ,EAAG,KAAK,EACjDQ,EAAM,EAAI,CAACT,EACXK,EAAS,qBAAqBI,CAAK,EAEnCJ,EAAS,KAAA,EACT/B,EAAM,IAAI+B,CAAQ,CACpB,CAEA,OAAO/B,CACT,CACO,SAASqC,GAAgB1B,EAgBhB,CACd,MAAMX,EAAQ,IAAIC,EAClB,OAAAU,EAAK,OAAO,QAAS2B,GAAc,CACjCtC,EAAM,IACJuB,EAAe,CACb,eAAgBZ,EAAK,eACrB,aAAcA,EAAK,aACnB,GAAG2B,CAAA,CACJ,CAAA,CAEL,CAAC,EACMtC,CACT,CAEO,SAAS6B,EACdU,EACAC,EACAlF,EACAmF,EAC0B,CAC1B,MAAMf,EAAUa,EAAW,KAAK,GAAM,IAChCZ,EAAUa,EAAY,KAAK,GAAM,IACvC,MAAO,CACLC,EAAO,CAAC,EAAInF,EAAS,KAAK,IAAIoE,CAAM,EAAI,KAAK,IAAIC,CAAM,EACvDc,EAAO,CAAC,EAAInF,EAAS,KAAK,IAAIoE,CAAM,EACpCe,EAAO,CAAC,EAAInF,EAAS,KAAK,IAAIoE,CAAM,EAAI,KAAK,IAAIC,CAAM,CAAA,CAE3D,CAKO,SAASe,GACd/B,EAgBI,GACS,CACb,KAAM,CACJ,SAAAR,EAAW,CAAC,EAAG,EAAG,CAAC,EACnB,OAAA7C,EAAS,EACT,UAAAqF,EAAY,EACZ,UAAAC,EAAY,EACZ,SAAAC,EAAW,GACX,cAAAC,EAAgB,SAChB,cAAAC,EAAgB,SAChB,cAAAC,EAAgB,GAChB,cAAAC,EAAgB,GAChB,YAAAC,EAAc,GACd,aAAAC,EAAe,SACf,iBAAAC,EAAmB,IACnB,cAAAC,EAAgB,GAChB,eAAAC,EAAiB,MACjB,mBAAAC,EAAqB,GAAA,EACnB5C,EAEEX,EAAQ,IAAIC,EAIlB,GAHAD,EAAM,SAAS,IAAI,GAAGG,CAAQ,EAG1B6C,EACF,QAAShF,EAAI,EAAGA,GAAK2E,EAAW3E,IAAK,CACnC,MAAMwF,EAAO,KAAK,GAAKxF,GAAM2E,EAAY,GAWnCc,EAVS,IAAIC,EACjB,EACA,EACApG,EAAS,KAAK,IAAIkG,CAAG,EACrBlG,EAAS,KAAK,IAAIkG,CAAG,EACrB,EACA,EAAI,KAAK,GACT,GACA,CAAA,EAEoB,UAAUX,CAAQ,EAClClF,EAAW,IAAIC,EAAM,EAAiB,cAC1C6F,EAAO,IAAKE,GAAM,IAAIvF,EAAcuF,EAAE,EAAGrG,EAAS,KAAK,IAAIkG,CAAG,EAAGG,EAAE,CAAC,CAAC,CAAA,EAEjErE,EAAW,IAAIE,EAAwB,CAAE,MAAOsD,EAAe,EAC/DrD,EAAO,IAAImE,EAAejG,EAAU2B,CAAQ,EAClDU,EAAM,IAAIP,CAAI,CAChB,CAIF,GAAIwD,EACF,QAASjF,EAAI,EAAGA,EAAI4E,EAAW5E,IAAK,CAClC,MAAMC,EAAS,EAAI,KAAK,GAAKD,EAAK4E,EAC5Ba,EAA0B,CAAA,EAChC,QAASI,EAAI,EAAGA,GAAKhB,EAAUgB,IAAK,CAClC,MAAML,EAAO,KAAK,GAAKK,EAAKhB,EACtB3E,EAAIZ,EAAS,KAAK,IAAIkG,CAAG,EAAI,KAAK,IAAIvF,CAAK,EAC3C2D,EAAItE,EAAS,KAAK,IAAIkG,CAAG,EACzBrF,EAAIb,EAAS,KAAK,IAAIkG,CAAG,EAAI,KAAK,IAAIvF,CAAK,EACjDwF,EAAO,KAAK,IAAIrF,EAAcF,EAAG0D,EAAGzD,CAAC,CAAC,CACxC,CACA,MAAMR,EAAW,IAAIC,IAAuB,cAAc6F,CAAM,EAC1DnE,EAAW,IAAIE,EAAwB,CAAE,MAAOuD,EAAe,EAC/DtD,EAAO,IAAIqE,EAAWnG,EAAU2B,CAAQ,EAC9CU,EAAM,IAAIP,CAAI,CAChB,CAIF,GAAIyD,EAAa,CAWf,MAAMO,EAVS,IAAIC,EACjB,EACA,EACApG,EACAA,EACA,EACA,EAAI,KAAK,GACT,GACA,CAAA,EAEoB,UAAUuF,CAAQ,EAClClF,EAAW,IAAIC,EAAM,EAAiB,cAC1C6F,EAAO,IAAKE,GAAM,IAAIvF,EAAcuF,EAAE,EAAG,EAAGA,EAAE,CAAC,CAAC,CAAA,EAE5CrE,EAAW,IAAIE,EAAwB,CAC3C,MAAO2D,EACP,UAAWC,EAAmB,KAAK,IAAI,EAAGA,EAAmB,EAAE,EAAI,CAAA,CACpE,EACK3D,EAAO,IAAImE,EAAejG,EAAU2B,CAAQ,EAClDU,EAAM,IAAIP,CAAI,CAChB,CAGA,GAAI4D,EAAe,CACjB,MAAMI,EAA0B,CAAA,EAChC,QAASI,EAAI,EAAGA,GAAKhB,EAAUgB,IAAK,CAClC,MAAML,EAAO,KAAK,GAAKK,EAAKhB,EACtB3E,EAAI,EACJ0D,EAAItE,EAAS,KAAK,IAAIkG,CAAG,EACzBrF,EAAIb,EAAS,KAAK,IAAIkG,CAAG,EAC/BC,EAAO,KAAK,IAAIrF,EAAcF,EAAG0D,EAAGzD,CAAC,CAAC,CACxC,CACA,MAAMR,EAAW,IAAIC,IAAuB,cAAc6F,CAAM,EAC1DnE,EAAW,IAAIE,EAAwB,CAC3C,MAAO8D,EACP,UAAWC,EAAqB,KAAK,IAAI,EAAGA,EAAqB,EAAE,EAAI,CAAA,CACxE,EACK9D,EAAO,IAAIqE,EAAWnG,EAAU2B,CAAQ,EAC9CU,EAAM,IAAIP,CAAI,CAChB,CAEA,OAAOO,CACT,CAEO,SAAS+D,GAAgBpD,EAIjB,CACb,MAAMhD,EAAW,IAAImD,EAAqBH,EAAK,QAAU,IAAK,GAAI,EAAE,EAC9DqD,EAAgB,IAAIhD,GACpB1B,EAAW,IAAI2E,GAAwB,CAAE,KAAMC,GAAkB,EACjEnE,EAAO,IAAID,EAAWnC,EAAU2B,CAAQ,EAC9C,OAAA0E,EAAc,KAAKrD,EAAK,MAAQwD,GAAY,CAC1CA,EAAQ,WAAa9C,GACrB/B,EAAS,IAAM6E,EACf7E,EAAS,YAAc,EAEzB,CAAC,EACMS,CACT,CAQO,SAASqE,GACdC,EACAhE,EAMa,CAEb,MAAMiE,EAAqC,CAAA,EAE3C,SAASC,EAAkBC,EAA4C,CAEnEA,aAAe5G,GACf,EAAE4G,aAAenF,GAEjBiF,EAAW,KAAKE,CAAG,EAElBA,EAAmB,oBAAoB5G,GACxC,EAAG4G,EAAmB,oBAAoBnF,GAE1CiF,EAAW,KAAME,EAAmB,QAAQ,GACnCA,aAAevE,GAAeuE,aAAeC,KACtDD,EAAI,SAAS,QAASE,GAAUH,EAAkBG,CAAK,CAAC,CAE5D,CAIA,GAFAL,EAAM,QAASM,GAASJ,EAAkBI,CAAI,CAAC,EAE3CL,EAAW,SAAW,EACxB,MAAM,IAAI,MAAM,8CAA8C,EAIhE,MAAMM,EAAiBC,GAAoCP,EAAY,EAAI,EAC3E,GAAI,CAACM,EACH,MAAM,IAAI,MAAM,0DAA0D,EAE5EA,EAAe,qBAAA,EAEf,MAAME,EAAMF,EAAe,aAAa,UAAU,EAG5CG,EAAM,IAAI3G,EAAc,EAAG,EAAG,CAAC,EACrC,QAASJ,EAAI,EAAGA,EAAI8G,EAAI,MAAO9G,IAC7B+G,EAAI,GAAKD,EAAI,KAAK9G,CAAC,EACnB+G,EAAI,GAAKD,EAAI,KAAK9G,CAAC,EACnB+G,EAAI,GAAKD,EAAI,KAAK9G,CAAC,EAErB,MAAMgH,EAAaD,EAAI,eAAe,EAAID,EAAI,KAAK,EAEnD,QAAS9G,EAAI,EAAGA,EAAI8G,EAAI,MAAO9G,GAAK,EAAG,CAErC,MAAMiH,EAAKH,EAAI,KAAK9G,CAAC,EACfkH,EAAKJ,EAAI,KAAK9G,CAAC,EACfmH,EAAKL,EAAI,KAAK9G,CAAC,EACfoH,EAAKN,EAAI,KAAK9G,EAAI,CAAC,EACnBqH,EAAKP,EAAI,KAAK9G,EAAI,CAAC,EACnBsH,EAAKR,EAAI,KAAK9G,EAAI,CAAC,EACnBuH,EAAKT,EAAI,KAAK9G,EAAI,CAAC,EACnBwH,EAAKV,EAAI,KAAK9G,EAAI,CAAC,EACnByH,EAAKX,EAAI,KAAK9G,EAAI,CAAC,EACnB0H,EAAK,IAAItH,EAAcgH,EAAKH,EAAII,EAAKH,EAAII,EAAKH,CAAE,EAChDQ,EAAK,IAAIvH,EAAcmH,EAAKN,EAAIO,EAAKN,EAAIO,EAAKN,CAAE,EAChD7D,GAAS,IAAIlD,EAAM,EAAU,aAAasH,EAAIC,CAAE,EAAE,UAAA,EAClDlD,GAAS,IAAIrE,GAChB6G,EAAKG,EAAKG,GAAM,GAChBL,EAAKG,EAAKG,GAAM,GAChBL,EAAKG,EAAKG,GAAM,CAAA,EAEbG,GAAeZ,EAAW,MAAA,EAAQ,IAAIvC,EAAM,EAAE,UAAA,EAChDnB,GAAO,IAAIsE,EAAY,EAAI,IAE7Bd,EAAI,OAAO9G,EAAI,EAAGuH,EAAIC,EAAIC,CAAE,EAC5BX,EAAI,OAAO9G,EAAI,EAAGoH,EAAIC,EAAIC,CAAE,EAEhC,CAEA,MAAMtF,EAAQ,IAAIC,EAGZF,EAAO,IAAID,EACf8E,EACA,IAAI/E,EAAwB,CAC1B,MAA6B,SAC7B,YAAa,GACb,QAAiC,GACjC,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEHG,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc,IAAIxG,EAAoBuF,CAAc,EACpDkB,EAAiB,IAAIvG,EAAyB,CAClD,MAA+B,QAC/B,SAAU,IACV,QAAS,IACT,UAAW,EACX,YAAa,GACb,QAAS,GACT,UAAW,EAAA,CACZ,EACKwG,EAAc,IAAIrG,EAAmBmG,EAAaC,CAAc,EACtEC,EAAY,qBAAA,EACZ/F,EAAM,IAAI+F,CAAW,EAGrB,MAAMC,EAAa,IAAI3G,EAAoBuF,CAAc,EACnDqB,EAAgB,IAAIzG,EAAwB,CAChD,MAA8B,EAC9B,UAAW,EACX,YAAa,GACb,UAAW,EAAA,CACZ,EACK0G,EAAa,IAAIxG,EAAmBsG,EAAYC,CAAa,EACnE,OAAAjG,EAAM,IAAIkG,CAAU,EAEblG,CACT,CACO,SAASmG,GACd9I,EACAC,EACAC,EACAC,EACAC,EAAiB,GACjBC,EAAc,GACd0I,EAAc,GACD,CACb,MAAMpG,EAAQ,IAAIC,EAGZtC,EAAWP,GACfC,EACAC,EACAC,EACAC,EACAC,EACAC,CAAA,EAEIqC,EAAO,IAAID,EACfnC,EACA,IAAIkC,EAAwB,CAC1B,MAAO,SACP,YAAa,GACb,QAASuG,EACT,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEHpG,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc,IAAIxG,EAAoB1B,CAAQ,EAC9CmI,EAAiB,IAAIvG,EAAyB,CAClD,MAAO,QACP,SAAU,IACV,QAAS,IACT,UAAW,EACX,YAAa,GACb,QAAS,GACT,UAAW,EAAA,CACZ,EACKwG,EAAc,IAAIrG,EAAmBmG,EAAaC,CAAc,EACtEC,EAAY,qBAAA,EACZ/F,EAAM,IAAI+F,CAAW,EAGrB,MAAMC,EAAa,IAAI3G,EAAoB1B,CAAQ,EAC7CsI,EAAgB,IAAIzG,EAAwB,CAChD,MAAO,EACP,UAAW,EACX,YAAa,GACb,UAAW,EAAA,CACZ,EACK0G,EAAa,IAAIxG,EAAmBsG,EAAYC,CAAa,EACnE,OAAAjG,EAAM,IAAIkG,CAAU,EAEblG,CACT,CAEO,SAASqG,GACdhJ,EACAC,EACAC,EACAC,EACAmB,EAAW,GACXyH,EAAc,GACD,CACb,MAAMpG,EAAQ,IAAIC,EAGZtC,EAAWe,GAAsBrB,EAAOC,EAAQC,EAAQC,EAAKmB,CAAQ,EAErEoB,EAAO,IAAID,EACfnC,EACA,IAAIkC,EAAwB,CAC1B,MAAO,SACP,YAAa,GACb,QAASuG,EACT,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEHpG,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc,IAAIxG,EAAoB1B,CAAQ,EAC9CmI,EAAiB,IAAIvG,EAAyB,CAClD,MAAO,QACP,SAAU,IACV,QAAS,IACT,UAAW,EACX,YAAa,GACb,QAAS,GACT,UAAW,EAAA,CACZ,EACKwG,EAAc,IAAIrG,EAAmBmG,EAAaC,CAAc,EACtEC,EAAY,qBAAA,EACZ/F,EAAM,IAAI+F,CAAW,EAGrB,MAAMC,EAAa,IAAI3G,EAAoB1B,CAAQ,EAC7CsI,EAAgB,IAAIzG,EAAwB,CAChD,MAAO,EACP,UAAW,EACX,YAAa,GACb,UAAW,EAAA,CACZ,EACK0G,EAAa,IAAIxG,EAAmBsG,EAAYC,CAAa,EACnE,OAAAjG,EAAM,IAAIkG,CAAU,EAEblG,CACT,CAEO,SAASsG,GACdjJ,EACAyB,EACAC,EACAxB,EACAC,EACAC,EAAiB,GACjBC,EAAc,GACd0I,EAAc,GACD,CACb,MAAMpG,EAAQ,IAAIC,EAGZtC,EAAWkB,GACfxB,EACAyB,EACAC,EACAxB,EACAC,EACAC,EACAC,CAAA,EAEIqC,EAAO,IAAID,EACfnC,EACA,IAAIkC,EAAwB,CAC1B,MAAO,SACP,YAAa,GACb,QAASuG,EACT,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEHpG,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc,IAAIxG,EAAoB1B,CAAQ,EAC9CmI,EAAiB,IAAIvG,EAAyB,CAClD,MAAO,QACP,SAAU,IACV,QAAS,IACT,UAAW,EACX,YAAa,GACb,QAAS,GACT,UAAW,EAAA,CACZ,EACKwG,EAAc,IAAIrG,EAAmBmG,EAAaC,CAAc,EACtEC,EAAY,qBAAA,EACZ/F,EAAM,IAAI+F,CAAW,EAGrB,MAAMC,EAAa,IAAI3G,EAAoB1B,CAAQ,EAC7CsI,EAAgB,IAAIzG,EAAwB,CAChD,MAAO,EACP,UAAW,EACX,YAAa,GACb,UAAW,EAAA,CACZ,EACK0G,EAAa,IAAIxG,EAAmBsG,EAAYC,CAAa,EACnE,OAAAjG,EAAM,IAAIkG,CAAU,EAEblG,CACT,CCz8BA,MAAMuG,WAAwB,WAAY,CAA1C,kCACUC,EAAA,kBAAqB,UACrBA,EAAA,aAAgB,KAChBA,EAAA,cAAiB,KACjBA,EAAA,gBAAuC,MACvCA,EAAA,aAA4B,MAC5BA,EAAA,cAAyC,MACzCA,EAAA,gBAAiC,MACjCA,EAAA,gBAA6B,CAAA,GAC7BA,EAAA,oBACAA,EAAA,4BACAA,EAAA,yBAAmC,MACnCA,EAAA,uBACAA,EAAA,uBAAiC,IAAIpI,EAAc,EAAG,EAAG,CAAC,GAC1DoI,EAAA,qBAA+B,IAAIpI,EAAc,EAAG,EAAG,CAAC,GAExDoI,EAAA,yBAER,IAAI,QAAQC,EAAwB,CAClC,KAAK,SAAWA,EACZ,KAAK,OACP,KAAK,WAAWA,CAAI,CAExB,CAEA,IAAI,SAAU,CACZ,OAAO,KAAK,QACd,CAEA,mBAAoB,SAOlB,GANA,KAAK,MAAM,QAAU,eACrB,KAAK,MAAQ,SAAS,KAAK,aAAa,OAAO,GAAK,EAAE,GAAK,IAC3D,KAAK,OAAS,SAAS,KAAK,aAAa,QAAQ,GAAK,EAAE,GAAK,IAC7D,KAAK,MAAM,MAAQ,GAAG,KAAK,KAAK,KAChC,KAAK,MAAM,OAAS,GAAG,KAAK,MAAM,KAClC,KAAK,MAAM,SAAW,WAClB,CAAC,KAAK,OAAQ,CAEhB,MAAMC,EAAkB,IAAItI,EAAc,EAAG,EAAG,CAAC,EAC3CuI,EAAgB,IAAIvI,EAAc,EAAG,EAAG,CAAC,EAC/C,KAAK,gBAAkBsI,EAAgB,MAAA,EACvC,KAAK,cAAgBC,EAAc,MAAA,EACnC,KAAK,OAAS,IAAIC,EAChB,GACA,KAAK,MAAQ,KAAK,OAClB,GACA,GAAA,EAEF,KAAK,OAAO,SAAS,KAAK,KAAK,eAAe,EAC9C,KAAK,OAAO,OAAO,KAAK,aAAa,CACvC,CAEA,MAAMC,EAAc,KAAK,aAAa,SAAS,EAC/C,GAAIA,EACF,GAAI,CACF,MAAMC,EAAqB,KAAK,MAAM,mBAAmBD,CAAW,CAAC,EACrE,KAAK,oBAAsBC,EAC3B,MAAMC,EAASD,EAAmB,sBAAwB,IAC1D,GAAI,MAAM,QAAQA,EAAmB,cAAc,EAAG,CACpD,MAAMhC,EAAMgC,EAAmB,eAC/B,KAAK,gBAAgB,IAAIhC,EAAI,CAAC,EAAGA,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,EAC3C,KAAK,QAAQ,KAAK,OAAO,SAAS,IAAIA,EAAI,CAAC,EAAGA,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,CAClE,CACA,GAAI,MAAM,QAAQgC,EAAmB,YAAY,EAAG,CAClD,MAAME,EAAMF,EAAmB,aAC/B,KAAK,cAAc,IAAIE,EAAI,CAAC,EAAGA,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,EACzC,KAAK,QAAQ,KAAK,OAAO,OAAOA,EAAI,CAAC,EAAGA,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,EACtD,KAAK,WACP,KAAK,SAAS,OAAO,IAAIA,EAAI,CAAC,EAAGA,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,EAC/C,KAAK,SAAS,OAAA,EAElB,CACA,MAAMC,EAAUH,EAAmB,QAChC,IAAKnG,GAAc,CAClB,GAAIA,EAAK,OAAS,WAChB,OAAOY,EAAeZ,CAAI,EAE5B,GAAIA,EAAK,OAAS,YAChB,OAAO0B,GAAgB1B,CAAI,EAE7B,GAAIA,EAAK,OAAS,OAChB,OAAOT,GAAkBS,EAAK,IAAKA,EAAK,KAAM,CAC5C,MAAOA,EAAK,MACZ,WAAYA,EAAK,WACjB,aAAcA,EAAK,aACnB,OAAQA,EAAK,QAAUuG,EAAA,CACxB,EAEH,GAAIvG,EAAK,OAAS,kBAChB,GAAIA,EAAK,SAAS,OAAS,iBAAkB,CAG3C,MAAMhD,EADS,IAAIwJ,EAAM,EACD,MAAMxG,EAAK,QAAQ,EAErCX,EAAQ,IAAIC,EAGZF,EAAO,IAAID,EACfnC,EACA,IAAIkC,EAAwB,CAC1B,MAAO,SACP,YAAa,GACb,QAAS,GACT,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEHG,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc,IAAIxG,EAAoB1B,CAAQ,EAC9CmI,EAAiB,IAAIvG,EAAyB,CAClD,MAAO,QACP,SAAU,IACV,QAAS,IACT,UAAW,EACX,YAAa,GACb,QAAS,GACT,UAAW,EAAA,CACZ,EACKwG,EAAc,IAAIrG,EACtBmG,EACAC,CAAA,EAEFC,EAAY,qBAAA,EACZ/F,EAAM,IAAI+F,CAAW,EAGrB,MAAMC,EAAa,IAAI3G,EAAoB1B,CAAQ,EAC7CsI,EAAgB,IAAIzG,EAAwB,CAChD,MAAO,EACP,UAAW,EACX,YAAa,GACb,UAAW,EAAA,CACZ,EACK0G,EAAa,IAAIxG,EACrBsG,EACAC,CAAA,EAEF,OAAAjG,EAAM,IAAIkG,CAAU,EAEblG,CACT,SAAW,MAAM,QAAQW,EAAK,SAAS,UAAU,EAAG,CAClD,MAAMI,EAAS,IAAIoG,EAEbC,EAAmBzG,EAAK,SAAS,WACpC,OAAQ0G,GAAWA,EAAE,OAAS,gBAAgB,EAC9C,IAAKA,GAAWtG,EAAO,MAAMsG,CAAC,CAAC,EAElC,IAAI1J,EACAyJ,EAAiB,SAAW,EAC9BzJ,EAAWyJ,EAAiB,CAAC,EAG7BzJ,EAAY2J,SAAkC,gBAC5CF,EACA,EAAA,EAIJ,MAAMpH,EAAQ,IAAIC,EAGZF,EAAO,IAAID,EACfnC,EACA,IAAIkC,EAAwB,CAC1B,MAAO,QACP,YAAa,GACb,QAAS,GACT,cAAe,GACf,oBAAqB,EACrB,mBAAoB,CAAA,CACrB,CAAA,EAEH,KAAK,mBAAmBE,CAAI,EAC5BA,EAAK,YAAc,EACnBC,EAAM,IAAID,CAAI,EAGd,MAAM8F,EAAc3G,EAAwBvB,EAAU,EAAI,EAC1DkI,EAAY,YAAc,EAC1B,MAAMG,EAAa9G,EAAwBvB,EAAU,EAAK,EAC1D,OAAAqI,EAAW,YAAc,EACzBhG,EAAM,IAAI6F,CAAW,EACrB7F,EAAM,IAAIgG,CAAU,EAEbhG,CACT,EAEF,GAAIW,EAAK,OAAS,uBAChB,OAAOD,GAA2B,CAChC,GAAGC,EACH,gBAAiB,IAAM,CAErB,KAAK,kBAAA,CACP,CAAA,CACD,EAGH,GAAIA,EAAK,OAAS,mBAChB,OAAO+B,GAAuB/B,CAAI,EAEpC,GAAIA,EAAK,OAAS,WAChB,OAAOY,EAAeZ,CAAI,EAE5B,GAAIA,EAAK,OAAS,eAChB,OAAO,IAAI4G,GACT5G,EAAK,OAAS,SACdA,EAAK,WAAa,CAAA,EAGtB,GAAIA,EAAK,OAAS,mBAAoB,CACpC,MAAM6G,EAAQ,IAAIC,GAChB9G,EAAK,OAAS,SACdA,EAAK,WAAa,CAAA,EAEpB,OAAIA,EAAK,UACP6G,EAAM,SAAS,IACb,GAAI7G,EAAK,QAAA,EAEN6G,CACT,CACA,GAAI7G,EAAK,OAAS,YAAa,CAC7B,MAAM+G,EAAM3D,GAAgB,CAC1B,GAAGpD,EACH,gBAAiB,IAAM,CAAC,CAAA,CACzB,EACC,OAAA+G,EAAY,YAAc,GACrBA,CACT,CACA,GAAI/G,EAAK,OAAS,QAGhB,OAFe,IAAIgH,GAAM,EACJ,MAAMhH,EAAK,MAAM,EAGxC,GAAIA,EAAK,OAAS,iBAAkB,CAClC,MAAMiH,EAAM,SAAS,cAAc,QAAQ,EAC3CA,EAAI,GAAKjH,EAAK,GACdiH,EAAI,YAAcjH,EAAK,KACvBkH,GAAgCD,CAAG,EACnCA,EAAI,KAAO,SACXA,EAAI,MAAM,OAAS,UACfjH,EAAK,UAAU,OAAO,OAAOiH,EAAI,MAAOjH,EAAK,QAAQ,EACrDA,EAAK,OAAO,OAAO,OAAOiH,EAAI,MAAOjH,EAAK,KAAK,EACnDiH,EAAI,MAAM,OAAS,KACnBA,EAAI,MAAM,cAAgB,OAG1B,MAAME,EAAU,IAAM,CACpB,KAAK,cACH,IAAI,YAAYnH,EAAK,QAAS,CAC5B,QAAS,GACT,SAAU,EAAA,CACX,CAAA,CAEL,EACAiH,EAAI,iBAAiB,QAASE,CAAO,EAGrC,IAAIC,EAAU,KAAK,cACjB,yBAAA,EAEF,OAAKA,IACHA,EAAU,SAAS,cAAc,KAAK,EACtCA,EAAQ,UAAY,yBACpBA,EAAQ,MAAM,SAAW,WACzBA,EAAQ,MAAM,IAAM,IACpBA,EAAQ,MAAM,KAAO,IACrBA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,cAAgB,OAC9BA,EAAQ,MAAM,OAAS,KACvB,KAAK,YAAYA,CAAO,GAE1BA,EAAQ,YAAYH,CAAG,EAChB,IACT,CAEA,OAAO,IACT,CAAC,EACA,OAAO,OAAO,EAEjB,KAAK,SAAWX,EAChB,KAAK,WAAWA,CAAO,EAGnB,MAAM,SAAQxG,EAAA,KAAK,sBAAL,YAAAA,EAA0B,cAAc,GACtD,MAAM,SAAQuH,EAAA,KAAK,sBAAL,YAAAA,EAA0B,YAAY,GAGtD,KAAK,eAAef,EAASF,CAAM,EAErC,MAAMgB,EAAU,KAAK,cACnB,yBAAA,EAEEA,IACFA,EAAQ,MAAM,QAAU,QAEtBjB,EAAmB,kBACrB,KAAK,WAAaA,EAAmB,gBACrC,KAAK,cAAcA,EAAmB,eAAe,EAEzD,OAASmB,EAAG,CACV,QAAQ,MAAM,6BAA8BA,CAAC,CAC/C,CAIG,KAAK,cACR,KAAK,YAAc,SAAS,cAAc,KAAK,EAC/C,KAAK,YAAY,MAAM,SAAW,WAClC,KAAK,YAAY,MAAM,IAAM,IAC7B,KAAK,YAAY,MAAM,KAAO,IAC9B,KAAK,YAAY,MAAM,UAAY,UACnC,KAAK,YAAY,MAAM,OAAS,IAChC,KAAK,YAAY,MAAM,cAAgB,OACvC,KAAK,YAAY,MAAM,OAAS,UAChC,KAAK,YAAY,MAAM,MAAQ,KAAK,MAAQ,KAC5C,KAAK,YAAY,MAAM,OAAS,KAAK,OAAS,KAC9C,KAAK,iBAAmB,IAAM,KAAK,gBAAA,EACnC,KAAK,YAAY,iBAAiB,QAAS,KAAK,gBAAgB,EAChE,KAAK,YAAY,KAAK,WAAW,GAG9B,KAAK,iBACR,KAAK,eAAiB,SAAS,cAAc,QAAQ,EACrD,KAAK,eAAe,UAClB,+FACF,KAAK,eAAe,MAAQ,cAC5B,KAAK,eAAe,MAAM,SAAW,WACrC,KAAK,eAAe,MAAM,IAAM,MAChC,KAAK,eAAe,MAAM,MAAQ,MAClC,KAAK,eAAe,MAAM,OAAS,KACnC,KAAK,eAAe,MAAM,cAAgB,OAC1C,KAAK,eAAe,MAAM,WAAa,OACvC,KAAK,eAAe,MAAM,OAAS,iBACnC,KAAK,eAAe,MAAM,aAAe,MACzC,KAAK,eAAe,MAAM,MAAQ,OAClC,KAAK,eAAe,MAAM,OAAS,OACnC,KAAK,eAAe,MAAM,QAAU,OACpC,KAAK,eAAe,MAAM,WAAa,SACvC,KAAK,eAAe,MAAM,eAAiB,SAC3C,KAAK,eAAe,MAAM,UAAY,6BACtC,KAAK,eAAe,MAAM,OAAS,UACnC,KAAK,eAAe,MAAM,MAAQ,OAClC,KAAK,eAAe,MAAM,QAAU,IACpC,KAAK,eAAe,QAAU,IAAM,KAAK,gBAAA,EACzC,KAAK,YAAY,KAAK,cAAc,GAGtC,MAAMC,EAAaC,GAAuB,KAAK,QAAQ,EACvD,GAAID,EAAW,OAAS,EAAG,CACzB,IAAIE,EAAa,EACjBF,EAAW,QAASnG,GAAa,CAC/BA,EAAS,iBACP,eACA,IAAM,CACJqG,IACIA,IAAeF,EAAW,QAC5B,KAAK,kBAAA,CAET,EACA,CAAE,KAAM,EAAA,CAAK,CAEjB,CAAC,CACH,MACE,KAAK,kBAAA,CAET,CAEA,sBAAuB,CACjB,KAAK,aAAe,KAAK,mBAC3B,KAAK,YAAY,oBAAoB,QAAS,KAAK,gBAAgB,EACnE,KAAK,iBAAmB,QAE1B,KAAK,6BAAA,EACL,KAAK,gBAAA,CACP,CAEQ,mBAAoB,CAC1B,MAAMG,EAAQ,KAAK,MACbC,EAAS,KAAK,OAEdC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQF,EACfE,EAAO,OAASD,EAChBC,EAAO,MAAM,MAAQF,EAAQ,KAC7BE,EAAO,MAAM,OAASD,EAAS,KAC/B,MAAME,EAAW,IAAIC,EAAoB,CACvC,OAAAF,EACA,UAAW,GACX,MAAO,GACP,sBAAuB,EAAA,CACxB,EACG,KAAK,UAAY,KAAK,YACxB,KAAK,cAAc,KAAK,UAAU,EAEpC,MAAMG,EAAQ,IAAIC,EACZC,EAAS,IAAIhC,EAAwB,GAAIyB,EAAQC,EAAQ,GAAK,GAAI,EACxEM,EAAO,SAAS,KAAK,KAAK,eAAe,EACzCA,EAAO,OAAO,KAAK,aAAa,EAChC,KAAK,SAAS,QAASpE,GAAQkE,EAAM,IAAIlE,CAAG,CAAC,EAC7CgE,EAAS,QAAQH,EAAOC,EAAQ,EAAK,EACrCE,EAAS,OAAOE,EAAOE,CAAM,EAC7B,MAAMC,EAAUN,EAAO,UAAU,WAAW,EAC5CC,EAAS,QAAA,EACL,OAAOA,EAAS,kBAAqB,YACvCA,EAAS,iBAAA,EAIP,KAAK,aACP,KAAK,YAAY,MAAM,MAAQH,EAAQ,KACvC,KAAK,YAAY,MAAM,OAASC,EAAS,KACzC,KAAK,YAAY,MAAQD,EACzB,KAAK,YAAY,OAASC,EAC1B,KAAK,YAAY,IAAMO,GAEvB,QAAQ,MACN,yEAAA,CAGN,CAEQ,iBAAkB,CAcxB,GAZI,KAAK,aAAe,KAAK,iBAC3B,KAAK,YAAY,MAAM,QAAU,OACjC,KAAK,eAAe,MAAM,QAAU,QAKpC,OAAO,WAAa,KACpB,uDAAuD,KACrD,UAAU,SAAA,EAGA,CAEZ,MAAMR,EAAQ,OAAO,WACfC,EAAS,OAAO,YAChBC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQF,EACfE,EAAO,OAASD,EAChBC,EAAO,MAAM,MAAQ,QACrBA,EAAO,MAAM,OAAS,QACtBA,EAAO,MAAM,SAAW,QACxBA,EAAO,MAAM,IAAM,IACnBA,EAAO,MAAM,KAAO,IACpBA,EAAO,MAAM,OAAS,OACtB,SAAS,KAAK,YAAYA,CAAM,EAG5BA,EAAO,kBACTA,EAAO,kBAAA,EACGA,EAAe,yBACvBA,EAAe,wBAAA,EAInB,MAAMO,EAAU,SAAS,cAAc,QAAQ,EAC/CA,EAAQ,KAAO,SACfA,EAAQ,MAAM,SAAW,QACzBA,EAAQ,MAAM,IAAM,OACpBA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,WAAa,OAC3BA,EAAQ,MAAM,OAAS,iBACvBA,EAAQ,MAAM,aAAe,MAC7BA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,SAAW,QACzBA,EAAQ,MAAM,QAAU,OACxBA,EAAQ,MAAM,WAAa,SAC3BA,EAAQ,MAAM,eAAiB,SAC/BA,EAAQ,MAAM,UAAY,6BAC1BA,EAAQ,MAAM,OAAS,UACvBA,EAAQ,UACN,oGACFA,EAAQ,MAAQ,yBAChB,SAAS,KAAK,YAAYA,CAAO,EAGjC,KAAK,SAAW,IAAIL,EAAoB,CACtC,OAAAF,EACA,UAAW,GACX,MAAO,EAAA,CACR,EACG,KAAK,UAAY,KAAK,YACxB,KAAK,cAAc,KAAK,UAAU,EAEpC,KAAK,MAAQ,IAAII,EACjB,KAAK,OAAS,IAAI/B,EAAwB,GAAIyB,EAAQC,EAAQ,GAAK,GAAI,EACvE,KAAK,OAAO,SAAS,KAAK,KAAK,eAAe,EAC9C,KAAK,OAAO,OAAO,KAAK,aAAa,EACrC,KAAK,SAAW,IAAIS,EAAc,KAAK,OAAQR,CAAM,EACrD,KAAK,SAAS,OAAO,KAAK,KAAK,aAAa,EAC5C,KAAK,SAAS,OAAA,EACd,KAAK,SAAS,QAAS/D,GAAQ,KAAK,MAAO,IAAIA,CAAG,CAAC,EACnD,KAAK,SAAS,QAAQ6D,EAAOC,EAAQ,EAAK,EAC1C,KAAK,mBAAA,EAGL,MAAMU,EAAO,IAAM,OACb,SAAS,KAAK,SAASF,CAAO,GAChC,SAAS,KAAK,YAAYA,CAAO,EAEnC,KAAK,kBAAA,EACD,KAAK,WACP,KAAK,SAAS,QAAA,EACV,OAAO,KAAK,SAAS,kBAAqB,YAC5C,KAAK,SAAS,iBAAA,GAGd,SAAS,KAAK,SAASP,CAAM,GAC/B,SAAS,KAAK,YAAYA,CAAM,EAElC,KAAK,SAAW,KAChB,KAAK,MAAQ,KACb,KAAK,OAAS,KACd,KAAK,SAAW,KAChB,KAAK,kBAAA,EACD,KAAK,iBACP,KAAK,eAAe,MAAM,QAAU,IAElC,KAAK,cACP,KAAK,YAAY,MAAM,QAAU,IAG/B,SAAS,qBACX9H,EAAA,SAAS,iBAAT,MAAAA,EAAA,eAEJ,EACAqI,EAAQ,QAAUE,EAGlB,SAAS,iBACP,mBACA,IAAM,CACC,SAAS,mBACZA,EAAAA,CAEJ,EACA,CAAE,KAAM,EAAA,CAAK,EAGf,MACF,CAIA,MAAMF,EAAU,SAAS,cAAc,QAAQ,EAC/CA,EAAQ,KAAO,SACfA,EAAQ,MAAM,SAAW,QACzBA,EAAQ,MAAM,IAAM,OACpBA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,WAAa,OAC3BA,EAAQ,MAAM,OAAS,iBACvBA,EAAQ,MAAM,aAAe,MAC7BA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,SAAW,QACzBA,EAAQ,MAAM,QAAU,OACxBA,EAAQ,MAAM,WAAa,SAC3BA,EAAQ,MAAM,eAAiB,SAC/BA,EAAQ,MAAM,UAAY,6BAC1BA,EAAQ,MAAM,OAAS,UAEvBA,EAAQ,UACN,oGACFA,EAAQ,MAAQ,yBAChBA,EAAQ,MAAM,OAAS,OAEvBA,EAAQ,QAAU,IAAM,CACtBE,EAAA,CACF,EACA,SAAS,KAAK,YAAYF,CAAO,EAGjC,MAAMT,EAAQ,OAAO,WACfC,EAAS,OAAO,YAChBC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQF,EACfE,EAAO,OAASD,EAChBC,EAAO,MAAM,SAAW,WACxBA,EAAO,MAAM,IAAM,IACnBA,EAAO,MAAM,KAAO,IACpBA,EAAO,MAAM,MAAQ,OACrBA,EAAO,MAAM,OAAS,OACtBA,EAAO,MAAM,OAAS,OACtB,SAAS,KAAK,YAAYA,CAAM,EAChC,MAAMR,EAAU,KAAK,cACnB,yBAAA,EAEEA,IACFA,EAAQ,MAAM,SAAW,QACzBA,EAAQ,MAAM,QAAU,QACxBA,EAAQ,MAAM,IAAM,IACpBA,EAAQ,MAAM,KAAO,IACrBA,EAAQ,MAAM,MAAQ,QACtBA,EAAQ,MAAM,OAAS,QACvBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,cAAgB,OAE9BA,EAAQ,iBAAiB,QAAQ,EAAE,QAASH,GAAQ,CAClDA,EAAI,MAAM,OAAS,OACnBA,EAAI,MAAM,cAAgB,MAC5B,CAAC,GAIH,KAAK,SAAW,IAAIa,EAAoB,CACtC,OAAAF,EACA,UAAW,GACX,MAAO,EAAA,CACR,EACG,KAAK,UAAY,KAAK,YACxB,KAAK,cAAc,KAAK,UAAU,EAEpC,KAAK,MAAQ,IAAII,EACjB,KAAK,OAAS,IAAI/B,EAAwB,GAAIyB,EAAQC,EAAQ,GAAK,GAAI,EACvE,KAAK,OAAO,SAAS,KAAK,KAAK,eAAe,EAC9C,KAAK,OAAO,OAAO,KAAK,aAAa,EACrC,KAAK,SAAW,IAAIS,EAAc,KAAK,OAAQR,CAAM,EACrD,KAAK,SAAS,OAAO,KAAK,KAAK,aAAa,EAC5C,KAAK,SAAS,OAAA,EACd,KAAK,SAAS,QAAS/D,GAAQ,KAAK,MAAO,IAAIA,CAAG,CAAC,EACnD,KAAK,SAAS,QAAQ6D,EAAOC,EAAQ,EAAK,EAG1C,KAAK,mBAAA,EAGL,MAAMU,EAAO,IAAM,CACb,SAAS,KAAK,SAASF,CAAO,GAChC,SAAS,KAAK,YAAYA,CAAO,EAE/Bf,IACFA,EAAQ,MAAM,SAAW,WACzBA,EAAQ,MAAM,QAAU,OACxBA,EAAQ,MAAM,IAAM,IACpBA,EAAQ,MAAM,KAAO,IACrBA,EAAQ,MAAM,MAAQ,OACtBA,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,OAAS,KACvBA,EAAQ,MAAM,cAAgB,OAC9BA,EAAQ,iBAAiB,QAAQ,EAAE,QAASH,GAAQ,CAClDA,EAAI,MAAM,OAAS,KACnBA,EAAI,MAAM,cAAgB,MAC5B,CAAC,GAGH,KAAK,kBAAA,EACD,KAAK,WACP,KAAK,SAAS,QAAA,EACV,OAAO,KAAK,SAAS,kBAAqB,YAC5C,KAAK,SAAS,iBAAA,GAGlB,SAAS,KAAK,YAAYW,CAAM,EAChC,KAAK,SAAW,KAChB,KAAK,MAAQ,KACb,KAAK,OAAS,KACd,KAAK,SAAW,KAChB,KAAK,kBAAA,EACD,KAAK,iBACP,KAAK,eAAe,MAAM,QAAU,IAElC,KAAK,cACP,KAAK,YAAY,MAAM,QAAU,GAErC,CACF,CAEQ,WAAWtB,EAA2B,OACvC,KAAK,QACV,KAAK,MAAM,MAAA,EACXA,EAAQ,QAASzC,GAAQ,KAAK,MAAO,IAAIA,CAAG,CAAC,GAC7C/D,EAAA,KAAK,WAAL,MAAAA,EAAe,OAAO,KAAK,MAAO,KAAK,QACzC,CAEQ,oBAAqB,CAC3B,GAAI,KAAK,kBAAmB,OAC5B,MAAMwI,EAAO,IAAM,QACjBxI,EAAA,KAAK,WAAL,MAAAA,EAAe,OAAO,KAAK,MAAQ,KAAK,QAEpC,KAAK,SACP,KAAK,gBAAgB,KAAK,KAAK,OAAO,QAAQ,EAC1C,KAAK,UACP,KAAK,cAAc,KAAK,KAAK,SAAS,MAAM,GAMhD,KAAK,kBAAoB,sBAAsBwI,CAAI,CACrD,EACAA,EAAA,CACF,CAEQ,mBAAoB,CACtB,KAAK,oBACP,qBAAqB,KAAK,iBAAiB,EAC3C,KAAK,kBAAoB,KAE7B,CAEQ,mBAAmBlJ,EAAkB,CAC3C,MAAMH,EAAY,MAAM,QAAQG,EAAK,QAAQ,EACzCA,EAAK,SACL,CAACA,EAAK,QAAQ,EAClB,UAAWmJ,KAAOtJ,EAChBsJ,EAAI,cAAgB,GACpBA,EAAI,oBAAsB,EAC1BA,EAAI,mBAAqB,CAE7B,CAEA,eAAejC,EAA2BF,EAAiB,IAAK,CAC9D,MAAMN,EAAOQ,EACV,OAAQzC,GAAQ,CAAEA,EAAY,WAAW,EACzC,OACEA,GAAQA,EAAI,OAAS,oBAAsBA,EAAI,OAAS,cAAA,EAGvD2E,EAAM,IAAIC,EAChB3C,EAAK,QAASjC,GAAQ,CACpB,GAAIA,aAAeC,GAAgB,CACjC,MAAM4E,EAAS,IAAID,IAAa,cAAc5E,CAAG,EAEjD,GADA2E,EAAI,MAAME,CAAM,EACZ7E,aAAe9E,GAAsB8E,EAAI,SAAS,eAAgB,CACpE,MAAM8E,EAAW,IAAIxJ,EAAW0E,EAAI,SAAS,cAAc,EACrD+E,EAAU,IAAIH,IAAa,cAAcE,CAAQ,EACvDH,EAAI,MAAMI,CAAO,CACnB,CACF,CACF,CAAC,EAED,MAAM9G,EAAS0G,EAAI,UAAU,IAAI/K,CAAe,EAC1CgC,EAAO+I,EAAI,QAAQ,IAAI/K,CAAe,EACtCoL,EAAKpJ,EAAK,EACVqJ,EAAKrJ,EAAK,EACVsJ,EAAKtJ,EAAK,EAGhB,GAAI2G,EAAS,GAAK,KAAK,OAAQ,CAE7B,MAAM4C,EAAU,KAAK,OAAO,IAAM,KAAK,GAAM,IACvCC,EAAS,KAAK,MAAQ,KAAK,OAC3BC,EAAmB,EAAI,KAAK,KAAK,KAAK,IAAIF,EAAS,CAAC,EAAIC,CAAM,EAC9DE,EAAYL,GAAM,EAAI,KAAK,IAAIE,EAAS,CAAC,GACzCI,EAAYP,GAAM,EAAI,KAAK,IAAIK,EAAmB,CAAC,GACnDG,EAAWjD,EAAS,KAAK,IAAI+C,EAAWC,EAAWL,CAAE,EACrDO,EAAc,IAAI7L,EACtBqE,EAAO,EAAIuH,EACXvH,EAAO,EAAIuH,EACXvH,EAAO,EAAIuH,CAAA,EAEb,KAAK,gBAAgB,KAAKC,CAAW,EACrC,KAAK,OAAO,SAAS,KAAKA,CAAW,CACvC,CAEA,KAAK,cAAc,KAAKxH,CAAM,EAC1B,KAAK,UACP,KAAK,SAAS,OAAO,KAAKA,CAAM,EAChC,KAAK,SAAS,OAAA,GACL,KAAK,QACd,KAAK,OAAO,OAAOA,CAAM,CAE7B,CAEQ,iBAAkB,CACxB,KAAK,kBAAA,EACD,KAAK,WACP,KAAK,SAAS,QAAA,EACV,OAAO,KAAK,SAAS,kBAAqB,YAC5C,KAAK,SAAS,iBAAA,GAGlB,KAAK,SAAW,KAChB,KAAK,MAAQ,KACb,KAAK,OAAS,KACd,KAAK,SAAW,IAClB,CAEA,cAAcyH,EAAwB,CAChC,KAAK,UACP,KAAK,SAAS,cAAcA,CAAK,CAErC,CAEQ,8BAA+B,CAErC,MAAMnC,EAAU,KAAK,cACnB,yBAAA,EAEEA,IACcA,EAAQ,iBAAiB,QAAQ,EACzC,QAASH,GAAQ,CAEvB,MAAMuC,EAAQvC,EAAI,UAAU,EAAI,EAChCG,EAAQ,aAAaoC,EAAOvC,CAAG,CACjC,CAAC,EAED,KAAK,YAAYG,CAAO,EAE5B,CACF,CAEA,eAAe,OAAO,YAAaxB,EAAe,EAE3C,MAAMW,GAAsB,CACjC,SACA,SACA,SACA,SACA,SACA,QACF,EAwGO,SAASkD,GAAe,CAC7B,GAAAC,EACA,QAAAC,EACA,MAAAjC,EAAQ,IACR,OAAAC,EAAS,GACX,EAKW,CACT,MAAMiC,EAAc,mBAAmB,KAAK,UAAUD,CAAO,CAAC,EAC9D,MAAO,kBAAkBD,CAAE,cAAcE,CAAW,YAAYlC,CAAK,aAAaC,CAAM,gBAC1F,CAEA,SAAST,GAAgCD,EAAwB,CAC/DA,EAAI,UACF,ijBACFA,EAAI,aAAa,OAAQ,QAAQ,CACnC,CAEA,SAASO,GAAuBlB,EAAkC,CAChE,MAAMuD,EAAe,CAAA,EACrB,OAAAvD,EAAQ,QAASzC,GAAQ,CACvBA,EAAI,SAAUE,GAAU,CAClBA,aAAiB1C,GAAMwI,EAAM,KAAK9F,CAAK,CAC7C,CAAC,CACH,CAAC,EACM8F,CACT"}