{"version":3,"file":"CM2G5C-1-CyDXZe4W.js","sources":["../../src/lib/3d/utilsPatrons.ts","../../src/lib/3d/3d_dynamique/patrons3d.ts","../../src/exercices/CM2/CM2G5C-1.ts"],"sourcesContent":["export type FaceNode = {\n  x: number\n  y: number\n  parent?: FaceNode\n  children: FaceNode[]\n  directionFromParent?: 'T' | 'B' | 'L' | 'R'\n}\nexport type objetFace = {\n  width?: number\n  height?: number\n  numero: number\n  isFace: boolean\n  collision?: number // optionnel car pas présent partout\n}\n\nexport const vraiCubes: number[][][] = [\n  [\n    [0, 1, 0],\n    [1, 1, 1],\n    [0, 1, 0],\n    [0, 1, 0],\n  ],\n  [\n    [0, 1, 0],\n    [0, 1, 1],\n    [1, 1, 0],\n    [0, 1, 0],\n  ],\n  [\n    [1, 1, 0],\n    [0, 1, 1],\n    [0, 1, 0],\n    [0, 1, 0],\n  ],\n  [\n    [1, 1, 0],\n    [0, 1, 0],\n    [0, 1, 1],\n    [0, 1, 0],\n  ],\n  [\n    [1, 0, 0],\n    [1, 1, 1],\n    [0, 1, 0],\n    [0, 1, 0],\n  ],\n  [\n    [0, 1, 0],\n    [0, 1, 1],\n    [1, 1, 0],\n    [1, 0, 0],\n  ],\n  [\n    [1, 1, 1],\n    [0, 1, 0],\n    [0, 1, 0],\n    [0, 1, 0],\n  ],\n  [\n    [0, 1, 1],\n    [0, 1, 0],\n    [0, 1, 0],\n    [1, 1, 0],\n  ],\n  [\n    [0, 1, 1],\n    [0, 1, 0],\n    [1, 1, 0],\n    [1, 0, 0],\n  ],\n  [\n    [1, 0],\n    [1, 0],\n    [1, 1],\n    [0, 1],\n    [0, 1],\n  ],\n  [\n    [0, 0, 1],\n    [0, 1, 1],\n    [1, 1, 0],\n    [1, 0, 0],\n  ],\n]\n\nexport const fauxCubes: number[][][] = [\n  [\n    [1, 0],\n    [1, 0],\n    [1, 1],\n    [1, 0],\n    [1, 0],\n  ],\n  [\n    [1, 0, 0],\n    [1, 1, 1],\n    [1, 0, 0],\n    [1, 0, 0],\n  ],\n  [\n    [1, 0],\n    [1, 1],\n    [1, 0],\n    [1, 0],\n    [1, 0],\n  ],\n  [\n    [1, 1],\n    [1, 0],\n    [1, 1],\n    [1, 0],\n  ],\n  [\n    [1, 0, 1],\n    [1, 1, 1],\n    [0, 1, 0],\n  ],\n  [\n    [0, 1, 0],\n    [1, 1, 1],\n    [1, 0, 0],\n    [1, 0, 0],\n  ],\n  [\n    [1, 1, 1],\n    [0, 1, 0],\n    [1, 1, 0],\n  ],\n  [[1], [1], [1], [1], [1], [1]],\n  [\n    [1, 1],\n    [1, 0],\n    [1, 0],\n    [1, 0],\n    [1, 0],\n  ],\n  [\n    [1, 1],\n    [1, 0],\n    [1, 0],\n    [1, 1],\n  ],\n  [\n    [0, 1],\n    [1, 1],\n    [1, 0],\n    [1, 0],\n    [1, 0],\n  ],\n  [\n    [1, 1, 1],\n    [1, 0, 0],\n    [1, 0, 0],\n    [1, 0, 0],\n  ],\n  [\n    [1, 1],\n    [1, 0],\n    [1, 1],\n    [0, 1],\n  ],\n  [\n    [1, 1, 1],\n    [1, 0, 1],\n    [1, 0, 0],\n  ],\n  [\n    [0, 0, 1],\n    [1, 1, 1],\n    [1, 0, 0],\n    [1, 0, 0],\n  ],\n  [\n    [0, 1, 1],\n    [1, 1, 0],\n    [1, 0, 0],\n    [1, 0, 0],\n  ],\n]\n\nexport const cubesObj: objetFace[][][] = [\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ],\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n    ],\n  ],\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ],\n]\n\nexport const fauxCubesObj: objetFace[][][] = [\n  [\n    [\n      { numero: 1, isFace: true, collision: 6 },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true, collision: 6 },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true, collision: 5 },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true, collision: 2 },\n      { numero: 0, isFace: false },\n      { numero: 2, isFace: true },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true, collision: 5 },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [{ numero: 1, isFace: true, collision: 5 }],\n    [{ numero: 2, isFace: true, collision: 6 }],\n    [{ numero: 3, isFace: true }],\n    [{ numero: 4, isFace: true }],\n    [{ numero: 5, isFace: true }],\n    [{ numero: 6, isFace: true }],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true, collision: 6 },\n      { numero: 2, isFace: true },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 6, isFace: true },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true, collision: 5 },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 4, isFace: true },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 0, isFace: false },\n      { numero: 6, isFace: true },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 4, isFace: true, collision: 5 },\n      { numero: 0, isFace: false },\n      { numero: 5, isFace: true },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait ce patron ci dessus risque de poser problème a l'animation\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n    ],\n    [\n      { numero: 2, isFace: true },\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n  [\n    [\n      { numero: 0, isFace: false },\n      { numero: 1, isFace: true },\n      { numero: 2, isFace: true, collision: 6 },\n    ],\n    [\n      { numero: 3, isFace: true },\n      { numero: 4, isFace: true },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 5, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n    [\n      { numero: 6, isFace: true },\n      { numero: 0, isFace: false },\n      { numero: 0, isFace: false },\n    ],\n  ], // fait\n]\n\n/* const matrice = [\n[{ width: 1, height: 1,numero: 1, isFace: true, collision: 5}],\n[{ width: 1, height: 1,numero: 2, isFace: true, collision: 6}],\n[{ width: 1, height: 1,numero: 3, isFace: true}],\n[{ width: 1, height: 1,numero: 4, isFace: true}],\n[{ width: 1, height: 1,numero: 5, isFace: true}],\n[{ width: 1, height: 1,numero: 6, isFace: true}]\n] */\n\nfunction getVoisins(matrice: objetFace[][], x: number, y: number) {\n  const dirs = [\n    { dx: 0, dy: -1, dir: 'T' },\n    { dx: 0, dy: 1, dir: 'B' },\n    { dx: -1, dy: 0, dir: 'L' },\n    { dx: 1, dy: 0, dir: 'R' },\n  ] as const\n  return dirs\n    .filter(({ dx, dy }) => matrice[y + dy]?.[x + dx]?.isFace)\n    .map(({ dx, dy, dir }) => ({ x: x + dx, y: y + dy, dir }))\n}\n\n// 1. Trouver la face pivot (celle avec le plus de voisins)\nexport function findPivot(matrice: objetFace[][]) {\n  let maxVoisins = -1\n  let pivot = { x: 0, y: 0 }\n  for (let y = 0; y < matrice.length; y++) {\n    for (let x = 0; x < matrice[0].length; x++) {\n      if (matrice[y][x].isFace) {\n        const voisins = getVoisins(matrice, x, y)\n        if (voisins.length > maxVoisins) {\n          maxVoisins = voisins.length\n          pivot = { x, y }\n        }\n      }\n    }\n  }\n  return pivot\n}\n\n// 2. Construire l’arbre des faces\nexport function buildFaceTree(\n  matrice: objetFace[][],\n  x: number,\n  y: number,\n  parent?: FaceNode,\n  directionFromParent?: 'T' | 'B' | 'L' | 'R',\n  visited = new Set<string>(),\n): FaceNode {\n  const key = `${x},${y}`\n  if (visited.has(key)) return null as any\n  visited.add(key)\n  const node: FaceNode = { x, y, parent, children: [], directionFromParent }\n  for (const voisin of getVoisins(matrice, x, y)) {\n    if (!visited.has(`${voisin.x},${voisin.y}`)) {\n      // Ajoute ce log :\n      if (Math.abs(voisin.x - x) + Math.abs(voisin.y - y) !== 1) {\n        console.warn(\n          `Parent (${x},${y}) et enfant (${voisin.x},${voisin.y}) ne sont pas adjacents !`,\n        )\n      }\n      const child = buildFaceTree(\n        matrice,\n        voisin.x,\n        voisin.y,\n        node,\n        voisin.dir,\n        visited,\n      )\n      if (child) node.children.push(child)\n    }\n  }\n  return node\n}\n\nconst EPSILON = 0.001 // ou 0.005 selon le rendu souhaité\n\nexport function getAbsolutePositions(\n  tree: FaceNode,\n  taille: number,\n  pos: [number, number, number] = [0, 0, 0],\n  positions = new Map<string, [number, number, number]>(),\n) {\n  const key = `${tree.x},${tree.y}`\n  positions.set(key, pos)\n  for (const child of tree.children) {\n    let offset: [number, number, number] = [0, 0, 0]\n    switch (child.directionFromParent) {\n      case 'T':\n        offset = [0, 0, -(taille + EPSILON)]\n        break\n      case 'B':\n        offset = [0, 0, taille + EPSILON]\n        break\n      case 'L':\n        offset = [-(taille + EPSILON), 0, 0]\n        break\n      case 'R':\n        offset = [taille + EPSILON, 0, 0]\n        break\n    }\n    getAbsolutePositions(\n      child,\n      taille,\n      [pos[0] + offset[0], pos[1] + offset[1], pos[2] + offset[2]],\n      positions,\n    )\n  }\n  return positions\n}\n\nexport function getPivotPositions(\n  node: FaceNode,\n  taille: number,\n  facePositions: Map<string, [number, number, number]>,\n  pivotPositions: Map<string, [number, number, number]>,\n) {\n  const key = `${node.x},${node.y}`\n  const faceAbsPos = facePositions.get(key) ?? [0, 0, 0]\n  let pivotAbsPos: [number, number, number]\n  if (!node.parent) {\n    pivotAbsPos = faceAbsPos\n  } else {\n    const parentKey = `${node.parent.x},${node.parent.y}`\n    const parentFaceAbsPos = facePositions.get(parentKey) ?? [0, 0, 0]\n    pivotAbsPos = [\n      (parentFaceAbsPos[0] + faceAbsPos[0]) / 2,\n      (parentFaceAbsPos[1] + faceAbsPos[1]) / 2,\n      (parentFaceAbsPos[2] + faceAbsPos[2]) / 2,\n    ]\n  }\n  pivotPositions.set(key, pivotAbsPos)\n  for (const child of node.children) {\n    getPivotPositions(child, taille, facePositions, pivotPositions)\n  }\n  return pivotPositions\n}\n","import {\n  type objetFace,\n  type FaceNode,\n  findPivot,\n  buildFaceTree,\n  getAbsolutePositions,\n  getPivotPositions,\n} from '../utilsPatrons'\nimport type { GroupDescription } from './Canvas3DElement'\nimport { THREE } from './threeInstance'\n\nexport function addFaceRecursive3D(\n  node: FaceNode,\n  taille: number,\n  facePositions: Map<string, [number, number, number]>,\n  pivotPositions: Map<string, [number, number, number]>,\n  couleurs: string[],\n  faceCount: { value: number } = { value: 0 },\n): THREE.Group {\n  const EPSILON = 0.002\n  const boxWidth = taille - 2 * EPSILON\n  const boxDepth = taille - 2 * EPSILON\n\n  const colorIndex = faceCount.value % couleurs.length\n  faceCount.value++\n  const couleur = couleurs[colorIndex]\n\n  const key = `${node.x},${node.y}`\n  const faceAbsPos = facePositions.get(key) ?? [0, 0, 0]\n  const pivotAbsPos = pivotPositions.get(key) ?? [0, 0, 0]\n  const parentPivotAbsPos = node.parent\n    ? (pivotPositions.get(`${node.parent.x},${node.parent.y}`) ?? [0, 0, 0])\n    : [0, 0, 0]\n\n  // Création du groupe pour ce noeud (pivot)\n  const pivotGroup = new THREE.Group()\n  if (node.parent && node.directionFromParent) {\n    pivotGroup.userData.directionFromParent = node.directionFromParent\n  }\n\n  // Positionnement du pivot\n  if (node.parent && node.directionFromParent) {\n    // Position du pivot relatif au pivot parent\n    pivotGroup.position.set(\n      pivotAbsPos[0] - parentPivotAbsPos[0],\n      pivotAbsPos[1] - parentPivotAbsPos[1],\n      pivotAbsPos[2] - parentPivotAbsPos[2],\n    )\n  } else {\n    // Racine\n    pivotGroup.position.set(faceAbsPos[0], faceAbsPos[1], faceAbsPos[2])\n  }\n\n  // Création de la face (Mesh)\n  const geometry = new THREE.BoxGeometry(boxWidth, 0.01, boxDepth)\n  const material = new THREE.MeshPhongMaterial({\n    color: couleur,\n    side: THREE.DoubleSide,\n  })\n  const mesh = new THREE.Mesh(geometry, material)\n\n  // Position de la face dans son pivot\n  if (node.parent && node.directionFromParent) {\n    mesh.position.set(\n      faceAbsPos[0] - pivotAbsPos[0],\n      faceAbsPos[1] - pivotAbsPos[1],\n      faceAbsPos[2] - pivotAbsPos[2],\n    )\n  } else {\n    mesh.position.set(0, 0, 0)\n  }\n  pivotGroup.add(mesh)\n\n  // Ajout récursif des enfants\n  for (const child of node.children) {\n    const childGroup = addFaceRecursive3D(\n      child,\n      taille,\n      facePositions,\n      pivotPositions,\n      couleurs,\n      faceCount,\n    )\n    pivotGroup.add(childGroup)\n  }\n\n  return pivotGroup\n}\n\nexport function generateContent3D(\n  matrice: objetFace[][],\n  id: string,\n): GroupDescription {\n  const pivot = findPivot(matrice)\n  const taille = 1.5\n  const tree = buildFaceTree(matrice, pivot.x, pivot.y)\n  const facePositions = getAbsolutePositions(\n    tree,\n    taille,\n    [pivot.x, 0, pivot.y],\n    new Map<string, [number, number, number]>(),\n  )\n  const pivotsPositions = getPivotPositions(\n    tree,\n    taille,\n    facePositions,\n    new Map<string, [number, number, number]>(),\n  )\n  const couleurs = [\n    '#3498db',\n    '#2ecc71',\n    '#e67e22',\n    '#9b59b6',\n    '#f1c40f',\n    '#5dade2',\n  ]\n  const group = addFaceRecursive3D(\n    tree,\n    taille,\n    facePositions,\n    pivotsPositions,\n    couleurs,\n  )\n  group.traverse((obj) => obj.updateMatrix())\n  const groupJson = group.toJSON()\n  return {\n    type: 'group',\n    object: groupJson,\n  }\n}\n\nexport const blinkColors = [\n  '#ff0000', // rouge vif\n  '#00ff00', // vert fluo\n  '#0000ff', // bleu électrique\n  '#ffff00', // jaune pétant\n  '#ff00ff', // magenta\n  '#00ffff', // cyan\n  '#ff8800', // orange vif\n  '#ff0080', // rose flashy\n  '#00ff88', // vert menthe\n  '#8800ff', // violet flashy\n]\n/**\n *\n * @param box La fonction qui fait clignoter les faces\n * @param color\n * @param times\n * @param interval\n * @returns\n */\nexport function blinkABox(\n  box: Element,\n  color = '#ff0000',\n  times = 26,\n  interval = 200,\n) {\n  let count = 0\n  let stopped = false\n  const originalColor = String(box.getAttribute('color'))\n  function stop() {\n    stopped = true\n    box.setAttribute('color', originalColor)\n  }\n  const blink = () => {\n    if (stopped) return\n    box.setAttribute('color', count % 2 === 0 ? color : '#ffffff')\n    count++\n    if (count < times * 2) setTimeout(blink, interval)\n    else box.setAttribute('color', originalColor)\n  }\n  blink()\n  return stop\n}\n\n/**\n * affichePatron3D est une fonction qui crée un canvas-3d avec un patron dedans pour être ajouté au DOM.\n * Mais cette utilisation est inadaptée au workflow de Mathaléa qui crée du html en dehors du DOM pour être injecté plus tard.\n * On pourra éventuellement utiliser le canvas-3d retourné dans un listener 'exerciceAffiches'\n * Mais dans le workflow normal, il faut privilégier la fonction ajouteCanvas3d() en utilisant la fonction generateContent3d présente ci-dessus.\n * Voir l'exercice 6G45 pour un exemple du workflow normal sans listener.\n * @param matrice\n * @param id\n * @returns\n */\nexport function affichePatron3D(\n  matrice: objetFace[][],\n  id: string,\n): HTMLElement {\n  const objects = [\n    generateContent3D(matrice, id),\n    { type: 'ambientLight', color: 0xffffff },\n    { type: 'directionalLight', color: 0xffffff, position: [8, 8, 8] },\n  ]\n  const content = { objects, autoCenterZoomMargin: 1.2 }\n  const canvas3d = document.createElement('canvas-3d')\n  canvas3d.setAttribute('id', id)\n  canvas3d.setAttribute('width', '300')\n  canvas3d.setAttribute('height', '300')\n  canvas3d.setAttribute('content', JSON.stringify(content))\n  return canvas3d\n}\n\nexport function createEtatPatron() {\n  return {\n    pliageEnCours: false,\n    depliageEnCours: false,\n    estPlie: false,\n    estDeplie: true,\n    blinkEnCours: false,\n  }\n}\n\nexport function ajouteListenersThreeJS(\n  canvas3d: HTMLElement,\n  group: THREE.Group,\n  id: string,\n) {\n  // Crée et stocke l’état sur le canvas\n  ;(canvas3d as any)._etatPatron = createEtatPatron()\n\n  // Récupère les boutons\n  const btnPlier = canvas3d.querySelector(\n    `#btnPlier-${id}`,\n  ) as HTMLButtonElement\n  const btnDeplier = canvas3d.querySelector(\n    `#btnDeplier-${id}`,\n  ) as HTMLButtonElement\n\n  // Initialisation des boutons\n  if (btnPlier) btnPlier.disabled = false\n  if (btnDeplier) btnDeplier.disabled = true\n  // Listener pliage\n  canvas3d.addEventListener(`pliage-${id}`, () => {\n    const etat = (canvas3d as any)._etatPatron\n    if (!etat.estDeplie || etat.pliageEnCours) return\n    etat.pliageEnCours = true\n    etat.estDeplie = false\n    btnPlier.disabled = true\n    btnDeplier.disabled = true\n\n    // Lance l’animation de pliage\n    animePliageThreeJS(group, () => {\n      etat.pliageEnCours = false\n      etat.estPlie = true\n      // Test de collision\n      // Test de collision\n      let collision = false\n      const meshes: THREE.Mesh[] = []\n      group.traverse((obj) => {\n        if (obj instanceof THREE.Mesh) meshes.push(obj)\n      })\n      const collidedMeshes: THREE.Mesh[] = []\n      for (let i = 0; i < meshes.length; i++) {\n        const boxA = new THREE.Box3().setFromObject(meshes[i])\n        for (let j = i + 1; j < meshes.length; j++) {\n          const boxB = new THREE.Box3().setFromObject(meshes[j])\n          const intersectionBox = boxA.clone()\n          intersectionBox.intersect(boxB)\n          const size = intersectionBox.getSize(new THREE.Vector3())\n          const volume = size.x * size.y * size.z\n          if (volume > 0.01) {\n            // seuil à ajuster selon la précision souhaitée\n            collision = true\n            collidedMeshes.push(meshes[i], meshes[j])\n          }\n        }\n      }\n      if (collision) {\n        etat.blinkEnCours = true\n        btnDeplier.disabled = true\n        // Blink sur tous les meshes en collision\n        let pending = collidedMeshes.length\n        collidedMeshes.forEach((mesh) => {\n          blinkMesh(mesh, '#ff0000', 7, 200, () => {\n            pending--\n            if (pending === 0) {\n              etat.blinkEnCours = false\n              btnDeplier.disabled = false\n            }\n          })\n        })\n      } else {\n        btnDeplier.disabled = false // Activation directe si pas de collision\n      }\n    })\n  })\n\n  // Listener dépliage\n  canvas3d.addEventListener(`depliage-${id}`, () => {\n    const etat = (canvas3d as any)._etatPatron\n    if (!etat.estPlie || etat.depliageEnCours || etat.blinkEnCours) return\n    etat.depliageEnCours = true\n    etat.estPlie = false\n    btnDeplier.disabled = true\n    btnPlier.disabled = true\n    // Lance l’animation de dépliage\n    animeDepliageThreeJS(group, () => {\n      etat.depliageEnCours = false\n      etat.estDeplie = true\n      btnPlier.disabled = false // Retour à l’état initial\n    })\n  })\n}\n\nexport function animePliageThreeJS(\n  group: THREE.Group,\n  onComplete?: () => void,\n  duration = 1000,\n) {\n  const pivots: THREE.Group[] = []\n  group.traverse((obj) => {\n    if (obj instanceof THREE.Group && obj.userData.directionFromParent) {\n      pivots.push(obj)\n    }\n  })\n  let pending = pivots.length\n  pivots.forEach((obj) => {\n    const from = obj.rotation.clone()\n    const to = new THREE.Euler()\n    switch (obj.userData.directionFromParent) {\n      case 'T':\n        to.set(Math.PI / 2, 0, 0)\n        break\n      case 'B':\n        to.set(-Math.PI / 2, 0, 0)\n        break\n      case 'L':\n        to.set(0, 0, -Math.PI / 2)\n        break\n      case 'R':\n        to.set(0, 0, Math.PI / 2)\n        break\n    }\n    animateRotation(obj, from, to, duration, () => {\n      pending--\n      if (pending === 0 && onComplete) onComplete()\n    })\n  })\n}\nexport function animeDepliageThreeJS(\n  group: THREE.Group,\n  onComplete?: () => void,\n  duration = 1000,\n) {\n  const pivots: THREE.Group[] = []\n  group.traverse((obj) => {\n    if (obj instanceof THREE.Group && obj.userData.directionFromParent) {\n      pivots.push(obj)\n    }\n  })\n  let pending = pivots.length\n  pivots.forEach((obj) => {\n    const from = obj.rotation.clone()\n    const to = new THREE.Euler(0, 0, 0)\n    animateRotation(obj, from, to, duration, () => {\n      pending--\n      if (pending === 0 && onComplete) onComplete()\n    })\n  })\n}\n\nexport function onCorrectionsAffichees() {\n  // Sélectionne tous les canvas-3d présents dans le DOM\n  const canvasList = document.querySelectorAll('canvas-3d')\n  canvasList.forEach((canvas3d) => {\n    // Récupère l'id unique (doit être défini lors de la création)\n    const idCanvas = canvas3d.getAttribute('id') || ''\n    const match = idCanvas.match(/Ex\\d+Q\\d+/)\n    const idEvent = match ? match[0] : ''\n\n    // Récupère le groupe Three.js via le getter objects\n    const objects = (canvas3d as any).objects\n    const group = Array.isArray(objects)\n      ? objects.find((obj) => obj instanceof THREE.Group)\n      : undefined\n\n    if (group && idEvent) {\n      ajouteListenersThreeJS(canvas3d as HTMLElement, group, idEvent)\n    }\n  })\n  // Supprime l'écouteur pour éviter les doublons\n  document.removeEventListener('correctionsAffichees', onCorrectionsAffichees)\n}\n\nfunction animateRotation(\n  obj: THREE.Group,\n  from: THREE.Euler,\n  to: THREE.Euler,\n  duration: number,\n  onComplete?: () => void,\n) {\n  const start = performance.now()\n  function step(now: number) {\n    const t = Math.min((now - start) / duration, 1)\n    obj.rotation.set(\n      from.x + (to.x - from.x) * t,\n      from.y + (to.y - from.y) * t,\n      from.z + (to.z - from.z) * t,\n    )\n    if (t < 1) {\n      requestAnimationFrame(step)\n    } else {\n      obj.rotation.copy(to)\n      if (onComplete) onComplete()\n    }\n  }\n  requestAnimationFrame(step)\n}\n\nfunction blinkMesh(\n  mesh: THREE.Mesh,\n  color = '#ff0000',\n  times = 26,\n  interval = 200,\n  onComplete?: () => void,\n) {\n  let count = 0\n  const stopped = false\n  // Vérifie que le matériau possède une couleur\n  const material = mesh.material as THREE.Material & { color?: THREE.Color }\n  if (!material.color) {\n    if (onComplete) onComplete()\n    return () => {}\n  }\n  const originalColor = material.color.clone()\n\n  function blink() {\n    if (stopped) return\n    if (material.color) {\n      material.color.set(count % 2 === 0 ? color : '#ffffff')\n    }\n    count++\n    if (count < times * 2) setTimeout(blink, interval)\n    else {\n      if (material.color) {\n        material.color.copy(originalColor)\n      }\n      if (onComplete) onComplete()\n    }\n  }\n  blink()\n}\n","import { BoiteBuilder } from '../../lib/2d/BoiteBuilder'\nimport {\n  arrayClone,\n  choice,\n  combinaisonListes,\n  shuffle,\n} from '../../lib/outils/arrayOutils'\nimport { listeQuestionsToContenu, randint } from '../../modules/outils'\nimport Exercice from '../Exercice'\n\nimport { fixeBordures } from '../../lib/2d/fixeBordures'\nimport { texteParPosition } from '../../lib/2d/textes'\nimport {\n  ajouteCanvas3d,\n  type Elements3DDescription,\n  type GroupDescription,\n} from '../../lib/3d/3d_dynamique/Canvas3DElement'\nimport {\n  generateContent3D,\n  onCorrectionsAffichees,\n} from '../../lib/3d/3d_dynamique/patrons3d'\nimport type { objetFace } from '../../lib/3d/utilsPatrons'\nimport { cubesObj, fauxCubesObj } from '../../lib/3d/utilsPatrons'\nimport { setCliqueFigure } from '../../lib/interactif/gestionInteractif'\nimport type { MathaleaSVG } from '../../lib/types'\nimport { context } from '../../modules/context'\nimport { mathalea2d } from '../../modules/mathalea2d'\nimport type { NestedObjetMathalea2dArray } from '../../types/2d'\nexport const amcReady = true\nexport const amcType = 'qcmMono'\nexport const interactifReady = true\nexport const interactifType = 'cliqueFigure'\n\nexport const titre = 'Choisir le patron de cube'\nexport const dateDePublication = '18/07/2025'\n\nexport const uuid = 'f57fe'\nexport const refs = {\n  'fr-fr': ['CM2G5C-1'],\n  'fr-2016': ['6G45'],\n  'fr-ch': [],\n}\n\nfunction retrouveMatrices(liste: objetFace[][][]): {\n  indexVraiPatron: number\n  indexPas6Faces: number\n  indexFauxPatrons: { index: number; collision: [number, number][] }[]\n} {\n  const indexVraiPatron = liste.findIndex((matrice) => {\n    return (\n      matrice.flat().filter((face) => face.isFace).length === 6 &&\n      matrice.flat().filter((face) => face.collision !== undefined).length === 0\n    )\n  })\n  const indexPas6Faces = liste.findIndex((matrice) => {\n    return matrice.flat().filter((face) => face.isFace).length !== 6\n  })\n  const indexFauxPatrons = liste\n    .map((matrice, index) => {\n      const collisions = matrice.flat().reduce(\n        (acc, face) => {\n          if (face.collision !== undefined) {\n            acc.push([index, face.collision])\n          }\n          return acc\n        },\n        [] as [number, number][],\n      )\n      return { index, collision: collisions }\n    })\n    .filter((item) => item.collision.length > 0)\n  if (indexFauxPatrons.length === 0) {\n    throw new Error('Aucun faux patron trouvé dans la liste fournie.') // ça ne doit jamais arrivé.\n  }\n  return { indexVraiPatron, indexPas6Faces, indexFauxPatrons }\n}\n\n/**\n * Choisir le bon patron parmi ceux proposés\n * @author Olivier Mimeau\n */\nexport default class choixPatron extends Exercice {\n  listeMatrices: objetFace[][][][]\n  listeners: (() => void)[]\n\n  constructor() {\n    super()\n    this.nbQuestions = 1\n    // pour plus tard cubes Paves ...\n    // this.besoinFormulaireNumerique = ['Type de questions', 3, '1 : patrons de cubes\\n 2 : patrons de pavés droits']\n\n    this.besoinFormulaire2CaseACocher = ['3d dynamique', true]\n    this.sup2 = true\n    this.listeMatrices = []\n    this.listeners = []\n  }\n\n  nouvelleVersion() {\n    this.figures = []\n    this.consigne =\n      'Parmi les dessins suivants, lequel est un patron de cube ? <br>' // 'Consigne'\n    this.consigne += this.interactif\n      ? 'Cliquer sur'\n      : context.vue !== 'diap' && !context.isAmc\n        ? 'Entourer'\n        : 'Choisir' /// Penser ici à AMC aussi.\n    this.consigne += ' la bonne figure.'\n    // context.pixelsParCm = 10\n    // xmin: -1, xmax: 6, ymin: -1, scale: 0.4\n    const zoom = 0.4 // scale: 0.4\n    const zoomAMC = 0.3 // si 0.4 c'est trop proche de la taille de la case à cocher\n    const typeQuestionsDisponibles = ['type1'] // 'type2',, 'type3']\n    const listeTypeQuestions = combinaisonListes(\n      typeQuestionsDisponibles,\n      this.nbQuestions,\n    )\n    const listeTypeVraiPatrons = combinaisonListes(\n      ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'],\n      this.nbQuestions,\n    )\n    const listeVraisPatrons: UnPatron[] = initListePatrons(cubesObj)\n    const listeFauxPatrons: UnPatron[] = initListePatrons(fauxCubesObj)\n    for (let i = 0, cpt = 0; i < this.nbQuestions && cpt < 50; ) {\n      let texte = ''\n      let texteCorr = ''\n\n      const indexMelangés = shuffle([0, 1, 2, 3])\n      const patronsOriginaux: UnPatron[] = []\n      const patronsAffiches: UnPatron[] = []\n      this.listeMatrices[i] = []\n\n      switch (listeTypeQuestions[i]) {\n        case 'type1':\n          {\n            texte = '' // `Question ${i + 1} de type 1<br>`\n            // texte += `listeVraisPatrons :  ${listeVraisPatrons.length} <br>`\n            patronsOriginaux.push(\n              listeVraisPatrons[Number(listeTypeVraiPatrons[i]) - 1],\n            )\n            const numPatron2 = randint(0, listeFauxPatrons.length - 1)\n            patronsOriginaux.push(listeFauxPatrons[randint(0, numPatron2)])\n            patronsOriginaux.push(\n              listeFauxPatrons[\n                randint(0, listeFauxPatrons.length - 1, numPatron2)\n              ],\n            )\n            const taillePatronAuPif = choice([5, 7])\n            patronsOriginaux.push(faitUnPatronAuPif(taillePatronAuPif))\n            for (let k = 0; k < 4; k++) {\n              patronsOriginaux[k].braceMatrice()\n              patronsAffiches[k] = patronsOriginaux[indexMelangés[k]]\n              this.listeMatrices[i][k] =\n                patronsOriginaux[indexMelangés[k]].matrice\n            }\n            const indexVraiPatron = retrouveMatrices(\n              this.listeMatrices[i],\n            ).indexVraiPatron\n            const indexPas6Faces = retrouveMatrices(\n              this.listeMatrices[i],\n            ).indexPas6Faces\n            const indexFauxPatrons = retrouveMatrices(\n              this.listeMatrices[i],\n            ).indexFauxPatrons\n            const fig0 = patronsAffiches[0].dessineMatrice({\n              numeroterFaces: false,\n              numeroDessin: 0,\n            })\n            const fig1 = patronsAffiches[1].dessineMatrice({\n              numeroterFaces: false,\n              numeroDessin: 1,\n            })\n            const fig2 = patronsAffiches[2].dessineMatrice({\n              numeroterFaces: false,\n              numeroDessin: 2,\n            })\n            const fig3 = patronsAffiches[3].dessineMatrice({\n              numeroterFaces: false,\n              numeroDessin: 3,\n            })\n            const fig0AMC = mathalea2d(\n              Object.assign(\n                {\n                  style: 'display: inline-block',\n                  scale: zoomAMC,\n                  id: `cliquefigure0Ex${this.numeroExercice}Q${i}`,\n                },\n                fixeBordures(fig0),\n              ),\n              fig0,\n            )\n            const fig1AMC = mathalea2d(\n              Object.assign(\n                {\n                  style: 'display: inline-block',\n                  scale: zoomAMC,\n                  id: `cliquefigure1Ex${this.numeroExercice}Q${i}`,\n                },\n                fixeBordures(fig1),\n              ),\n              fig1,\n            )\n            const fig2AMC = mathalea2d(\n              Object.assign(\n                {\n                  style: 'display: inline-block',\n                  scale: zoomAMC,\n                  id: `cliquefigure2Ex${this.numeroExercice}Q${i}`,\n                },\n                fixeBordures(fig2),\n              ),\n              fig2,\n            )\n            const fig3AMC = mathalea2d(\n              Object.assign(\n                {\n                  style: 'display: inline-block',\n                  scale: zoomAMC,\n                  id: `cliquefigure3Ex${this.numeroExercice}Q${i}`,\n                },\n                fixeBordures(fig3),\n              ),\n              fig3,\n            )\n\n            this.autoCorrection[i] = {}\n\n            this.autoCorrection[i].enonce = this.consigne + texte\n            this.autoCorrection[i].propositions = [\n              {\n                texte: fig0AMC,\n                statut: indexVraiPatron === 0,\n              },\n              {\n                texte: fig1AMC,\n                statut: indexVraiPatron === 1,\n              },\n              {\n                texte: fig2AMC,\n                statut: indexVraiPatron === 2,\n              },\n              {\n                texte: fig3AMC,\n                statut: indexVraiPatron === 3,\n              },\n            ]\n            this.autoCorrection[i].options = {\n              ordered: true,\n              lastChoice: 4,\n            }\n            setCliqueFigure(this.autoCorrection[i])\n            this.figures[i] = [\n              {\n                id: `cliquefigure0Ex${this.numeroExercice}Q${i}`,\n                solution: indexVraiPatron === 0,\n              },\n              {\n                id: `cliquefigure1Ex${this.numeroExercice}Q${i}`,\n                solution: indexVraiPatron === 1,\n              },\n              {\n                id: `cliquefigure2Ex${this.numeroExercice}Q${i}`,\n                solution: indexVraiPatron === 2,\n              },\n              {\n                id: `cliquefigure3Ex${this.numeroExercice}Q${i}`,\n                solution: indexVraiPatron === 3,\n              },\n            ]\n            // const figures =  [figPatronOkAMC, figPatronFaux1AMC, figPatronFaux2AMC, figPatronFaux3AMC]\n            const figuresEnonce = [fig0AMC, fig1AMC, fig2AMC, fig3AMC]\n            if (!context.isAmc) {\n              texte += figuresEnonce.join('') + '<br><br>'\n              if (this.interactif && context.isHtml) {\n                texte += `<span id=\"resultatCheckEx${this.numeroExercice}Q${i}\"></span>`\n              }\n\n              texteCorr = 'Procédons par élimination:<br>'\n              texteCorr += `- Le dessin ${indexPas6Faces + 1} contient ${taillePatronAuPif} faces au lieu de 6 faces.<br><br>`\n              texteCorr += `- Le dessin ${indexFauxPatrons[0].index + 1} poséde des faces qui vont se superposer :<br>`\n              const fig1 = patronsAffiches[\n                indexFauxPatrons[0].index\n              ].dessineMatrice({\n                numeroterFaces: true,\n                numeroDessin: indexFauxPatrons[0].index,\n              })\n              texteCorr +=\n                mathalea2d(\n                  Object.assign(\n                    {\n                      style: 'display: inline-block',\n                      scale: zoom,\n                      id: `correction0Ex${this.numeroExercice}Q${i}`,\n                    },\n                    fixeBordures(fig1),\n                  ),\n                  fig1,\n                ) + '<br>'\n              texteCorr +=\n                patronsAffiches[\n                  indexFauxPatrons[0].index\n                ].ecritFacesQuiSeSuperposent() + '<br><br>'\n              texteCorr += `- Le dessin ${indexFauxPatrons[1].index + 1} poséde des faces qui vont se superposer :<br>`\n              const fig2 = patronsAffiches[\n                indexFauxPatrons[1].index\n              ].dessineMatrice({\n                numeroterFaces: true,\n                numeroDessin: indexFauxPatrons[1].index,\n              })\n              texteCorr +=\n                mathalea2d(\n                  Object.assign(\n                    {\n                      style: 'display: inline-block',\n                      scale: zoom,\n                      id: `correction1Ex${this.numeroExercice}Q${i}`,\n                    },\n                    fixeBordures(fig2),\n                  ),\n                  fig2,\n                ) + '<br>'\n              texteCorr +=\n                patronsAffiches[\n                  indexFauxPatrons[1].index\n                ].ecritFacesQuiSeSuperposent() + '<br><br>'\n              texteCorr += `Le dessin ${indexVraiPatron + 1} posséde 6 faces qui ne vont pas se superposer en le pliant, c'est donc le dessin d'un patron.<br>`\n              const fig3 = patronsAffiches[indexVraiPatron].dessineMatrice({\n                numeroterFaces: true,\n                numeroDessin: indexVraiPatron,\n              })\n              texteCorr +=\n                mathalea2d(\n                  Object.assign(\n                    {\n                      style: 'display: inline-block',\n                      scale: zoom,\n                      id: `correction2Ex${this.numeroExercice}Q${i}`,\n                    },\n                    fixeBordures(fig3),\n                  ),\n                  fig3,\n                ) + '<br><br>'\n            }\n          }\n          break\n        case 'type2':\n          texte = `Question ${i + 1} de type 2`\n\n          texteCorr = `Correction ${i + 1} de type 2`\n          break\n        case 'type3':\n          texte = `Question ${i + 1} de type 3`\n          texteCorr = `Correction ${i + 1} de type 3`\n          break\n      }\n      if (this.questionJamaisPosee(i, texte)) {\n        if (context.isHtml && this.sup2) {\n          // On insère directement le canvas-3d pour la correction\n          const indexVraiPatron = retrouveMatrices(\n            this.listeMatrices[i],\n          ).indexVraiPatron\n          const content = generateContent3D(\n            this.listeMatrices[i][indexVraiPatron],\n            `patron3dEx${this.numeroExercice}Q${i}`,\n          )\n          const objects: Elements3DDescription[] = [\n            content as GroupDescription,\n            { type: 'ambientLight' as const, color: 0xffffff },\n            {\n              type: 'directionalLight' as const,\n              color: 0xffffff,\n              position: [8, 8, 8],\n            },\n            {\n              type: 'canvas3dButton',\n              id: `btnPlier-Ex${this.numeroExercice}Q${i}`,\n              text: 'Plier',\n              position: { left: '10px', bottom: '10px' },\n              onClick: `pliage-Ex${this.numeroExercice}Q${i}`, // id = identifiant unique du canvas\n            },\n            {\n              type: 'canvas3dButton',\n              id: `btnDeplier-Ex${this.numeroExercice}Q${i}`,\n              text: 'Déplier',\n              position: { left: '90px', bottom: '10px' },\n              onClick: `depliage-Ex${this.numeroExercice}Q${i}`,\n            },\n          ]\n          const content3d = { objects, autoCenterZoomMargin: 1 }\n          texteCorr += ajouteCanvas3d({\n            id: `canvas3dEx${this.numeroExercice}Q${i}`,\n            content: content3d,\n            width: 200,\n            height: 200,\n          })\n        }\n        this.listeQuestions[i] = texte\n        this.listeCorrections[i] = texteCorr ?? ''\n        i++\n      }\n      cpt++\n    }\n    listeQuestionsToContenu(this)\n    // Ce onCorrectionAffichees est dédié à la gestion du pliage/dépliage de patrons3d : il n'est pas à utiliser dans un autre contexte.\n    // On pourra éventuellement remplacer 'correctionsAffichees' par 'exercicesAffiches' si les patrons sont dans l'énoncé et pas dans la correction.\n    document.addEventListener('correctionsAffichees', onCorrectionsAffichees, {\n      once: true,\n    }) // listener auto-détruit à la première utilisation\n  }\n\n  callback(exercice: Exercice, i: number): void {\n    if (\n      'listeMatrices' in exercice &&\n      Array.isArray(exercice.listeMatrices) &&\n      exercice.listeMatrices.length >= i\n    ) {\n      // On commence par trouver l'élément cliqué... enfin son index.\n      // Trouver tous les SVG dont l'id correspond au format 'cliquefigure{n}Ex{exercice.numeroExercice}Q{i}'\n      const figElements = Array.from(\n        document.querySelectorAll<MathaleaSVG>(\n          `[id^=\"cliquefigure\"][id$=\"Ex${exercice.numeroExercice}Q${i}\"]`,\n        ),\n      ).filter((el) => {\n        // Vérifie que l'id correspond exactement au format voulu (un seul chiffre pour n)\n        const regex = new RegExp(\n          `^cliquefigure\\\\dEx${exercice.numeroExercice}Q${i}$`,\n        )\n        return regex.test(el.id)\n      })\n\n      let indexClique = Array.from(figElements as MathaleaSVG[]).findIndex(\n        (el: MathaleaSVG) => Boolean(el.etat),\n      )\n      if (\n        indexClique === -1 &&\n        Array.isArray(exercice.autoCorrection[i].propositions)\n      ) {\n        indexClique = retrouveMatrices(\n          exercice.listeMatrices[i],\n        ).indexVraiPatron\n      }\n      const content = generateContent3D(\n        exercice.listeMatrices[i][indexClique],\n        `patron3dEx${exercice.numeroExercice}Q${i}`,\n      )\n      const objects: Elements3DDescription[] = [\n        content as GroupDescription,\n        { type: 'ambientLight' as const, color: 0xffffff },\n        {\n          type: 'directionalLight' as const,\n          color: 0xffffff,\n          position: [8, 8, 8],\n        },\n        {\n          type: 'canvas3dButton',\n          id: `btnPlier-Ex${exercice.numeroExercice}Q${i}`,\n          text: 'Plier',\n          position: { left: '10px', bottom: '10px' },\n          onClick: `pliage-Ex${exercice.numeroExercice}Q${i}`, // id = identifiant unique du canvas\n        },\n        {\n          type: 'canvas3dButton',\n          id: `btnDeplier-Ex${exercice.numeroExercice}Q${i}`,\n          text: 'Déplier',\n          position: { left: '90px', bottom: '10px' },\n          onClick: `depliage-Ex${exercice.numeroExercice}Q${i}`,\n        },\n      ]\n      const content3d = { objects, autoCenterZoomMargin: 1.2 }\n\n      const nouveauCanvas = ajouteCanvas3d({\n        id: `canvas3dEx${exercice.numeroExercice}Q${i}`,\n        content: content3d, // généré avec la matrice du patron cliqué\n        width: 200,\n        height: 200,\n      })\n      exercice.listeCorrections[i] = exercice.listeCorrections[i].replace(\n        /<canvas-3d[^>]*>.*?<\\/canvas-3d>/s,\n        nouveauCanvas,\n      )\n    }\n  }\n}\n\nconst tailleCarre = 1\n\n// const initMatrice = (largeur: number, longueur: number, digit:number = 0, face:boolean = false): objetFace[][] =>\n//  Array.from({ length: longueur }, () => Array(largeur).fill({ numero: digit, isFace: face }))\n\nfunction initListePatrons(listeMatrices: objetFace[][][]): UnPatron[] {\n  const listePatrons: UnPatron[] = []\n  for (const uneMatrice of listeMatrices) {\n    const patron = new UnPatron(uneMatrice[0].length, uneMatrice.length)\n    // patron.initMatrice(uneMatrice[0].length, uneMatrice.length, 0)\n    patron.matrice = uneMatrice.map((ligne) => [...ligne]) // copie de la matrice\n    listePatrons.push(patron)\n  }\n  return listePatrons\n}\n\nfunction faitUnPatronAuPif(taille: number): UnPatron {\n  const tempcouples: SerieCouples = new SerieCouples()\n  tempcouples.faitUnPatron(taille)\n  tempcouples.faitUnPatronMatrice()\n  return tempcouples.matrice\n}\n\nclass UnPatron {\n  matrice: objetFace[][] = []\n  constructor(\n    largeur: number,\n    longueur: number,\n    digit: number = 0,\n    face: boolean = false,\n  ) {\n    for (let l = 0; l < longueur; l++) {\n      this.matrice[l] = []\n      for (let k = 0; k < largeur; k++) {\n        this.matrice[l][k] = { numero: digit, isFace: face } // l * largeur + k // digit\n      }\n    }\n  }\n\n  get larg(): number {\n    return this.matrice.reduce((max, row) => Math.max(max, row.length), 0)\n  }\n\n  get long(): number {\n    return this.matrice.length\n  }\n\n  /* initMatrice = (largeur: number, longueur: number, digit:number = 0, face:boolean = false): objetFace[][] =>\n    Array.from({ length: longueur }, () => Array(largeur).fill({ numero: digit, isFace: face })) */\n\n  initMatrice(\n    largeur: number,\n    longueur: number,\n    digit: number = 0,\n    face: boolean = false,\n  ): void {\n    for (let l = 0; l < longueur; l++) {\n      this.matrice[l] = []\n      for (let k = 0; k < largeur; k++) {\n        this.matrice[l][k] = { numero: digit, isFace: face }\n      }\n    }\n  }\n\n  setcell(x: number, y: number, value: number, face: boolean): void {\n    if (y < this.long && x < this.larg) {\n      this.matrice[y][x] = { numero: value, isFace: face }\n    }\n  }\n\n  dimensions(): [number, number] {\n    return [this.larg, this.long]\n  }\n\n  ecritMatrice(): string {\n    let texte = '[\\n' // numbers.length\n    // bollean vers valeurs 0,1\n    const valeursBooleennes = this.matrice.map((row) =>\n      row.map((element) => (element.isFace ? 1 : 0)),\n    )\n    texte += valeursBooleennes.map((row) => `[${row.join(', ')}]`).join(',\\n')\n    texte += ']\\n'\n    return texte\n  }\n\n  braceMatrice(): void {\n    const [largeur, longueur] = [this.larg, this.long]\n    const patronTemp = new UnPatron(largeur, longueur)\n    patronTemp.matrice = arrayClone(this.matrice) // copie de la matrice\n    let transfo = choice([1, 2, 3, 3, 0])\n    switch (transfo) {\n      case 1:\n        patronTemp.symetrieMatriceH()\n        break\n      case 2:\n        patronTemp.symetrieMatriceV()\n        break\n      case 3:\n        patronTemp.symetrieMatriceD()\n        break\n      default:\n        // ne fait rien\n        break\n    }\n    transfo = choice([1, 1, 2, 3, 3, 3, 3, 0])\n    switch (transfo) {\n      case 1:\n        patronTemp.rotationMatrice90p()\n        break\n      case 2:\n        patronTemp.rotationMatrice90n()\n        break\n      case 3:\n        patronTemp.rotationMatrice180()\n        break\n      default:\n        // ne fait rien\n        break\n    }\n    this.matrice = arrayClone(patronTemp.matrice)\n  }\n\n  ecritFacesQuiSeSuperposent(): string {\n    let texte: string = ''\n    for (let i = 0; i < this.long; i++) {\n      for (let j = 0; j < this.larg; j++) {\n        if (this.matrice[i][j].isFace && this.matrice[i][j].collision) {\n          texte += ` Les faces ${this.matrice[i][j].numero} et  ${this.matrice[i][j].collision} vont se superposer.`\n        }\n      }\n    }\n    return texte\n  }\n\n  dessineMatrice({\n    numeroterFaces,\n    numeroDessin,\n  }: {\n    numeroterFaces?: boolean\n    numeroDessin?: number\n  }): any[] {\n    const correction = numeroterFaces ?? false\n\n    const leDessin: NestedObjetMathalea2dArray = []\n    for (let i = 0; i < this.long; i++) {\n      for (let j = 0; j < this.larg; j++) {\n        if (this.matrice[i][j].isFace) {\n          const face1 = new BoiteBuilder({\n            xMin: i * tailleCarre,\n            yMin: j * tailleCarre,\n            xMax: (i + 1) * tailleCarre,\n            yMax: (j + 1) * tailleCarre,\n          })\n          if (correction) {\n            // face1.addColor({ colorBackground: 'gray' }) // 'gray''blue'\n            face1.addTextIn({\n              textIn: `${this.matrice[i][j].numero}` /* , color: couleurTexte1 */,\n            })\n          }\n          const laFace1 = face1.render()\n          leDessin.push(laFace1)\n        }\n      }\n    }\n    const { xmin, xmax } = fixeBordures(leDessin)\n    if (numeroDessin !== undefined && typeof numeroDessin === 'number') {\n      const Numdessin = texteParPosition(\n        `Dessin ${numeroDessin + 1}`,\n        (xmin + xmax) / 2,\n        -0.5,\n        0,\n        'black',\n        1,\n        'milieu',\n        false,\n        1,\n      )\n      leDessin.push(Numdessin)\n    }\n\n    return leDessin\n  }\n\n  symetrieMatriceH(): void {\n    // symetrie horizontale\n    // inverse les lignes\n    const [largeur, longueur] = [this.larg, this.long]\n    const matriceTemp = new UnPatron(largeur, longueur) // objetFace[][] = this.initMatrice(largeur, longueur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        matriceTemp.matrice[longueur - 1 - l][k] = this.matrice[l][k]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n\n  symetrieMatriceV(): void {\n    // symetrie verticale\n    // inverse les colonnes\n    const [largeur, longueur] = [this.larg, this.long]\n    const matriceTemp = new UnPatron(largeur, longueur) // : objetFace[][] = this.initMatrice(largeur, longueur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        matriceTemp.matrice[l][largeur - 1 - k] = this.matrice[l][k]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n\n  symetrieMatriceD(): void {\n    // symetrie diagonale (ex Transpose la matrice)\n    // inverse les lignes et les colonnes\n    const [largeur, longueur] = [this.larg, this.long]\n    const matriceTemp = new UnPatron(longueur, largeur) // : objetFace[][] = this.initMatrice(longueur, largeur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        //  matriceTemp[largeur - 1 - k][longueur - 1 - l] = this.matrice[l][k]\n        matriceTemp.matrice[k][l] = this.matrice[l][k]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n\n  rotationMatrice90p(): void {\n    // rotation de 90°\n    const [largeur, longueur] = [this.long, this.larg]\n    const matriceTemp = new UnPatron(largeur, longueur) // : objetFace[][] = this.initMatrice(longueur, largeur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        matriceTemp.matrice[l][largeur - k - 1] = this.matrice[k][l]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n\n  rotationMatrice90n(): void {\n    // rotation de 90° autre sens\n    const [largeur, longueur] = [this.long, this.larg]\n    const matriceTemp = new UnPatron(largeur, longueur) // : objetFace[][] = this.initMatrice(longueur, largeur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        matriceTemp.matrice[longueur - l - 1][k] = this.matrice[k][l]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n\n  rotationMatrice180(): void {\n    // rotation de 180°\n    const [largeur, longueur] = [this.larg, this.long]\n    const matriceTemp = new UnPatron(largeur, longueur) // : objetFace[][] = this.initMatrice(largeur, longueur, 4)\n    for (let l = 0; l < longueur; l++) {\n      for (let k = 0; k < largeur; k++) {\n        matriceTemp.matrice[longueur - 1 - l][largeur - 1 - k] =\n          this.matrice[l][k]\n      }\n    }\n    this.matrice = arrayClone(matriceTemp.matrice)\n  }\n}\n\ntype couple = [number, number]\n\nclass SerieCouples {\n  private _couples: couple[] = []\n  private _matrice: UnPatron = new UnPatron(0, 0)\n  constructor() {\n    this._couples = [\n      [0, 0],\n      [1, 0],\n    ]\n  }\n\n  get couples(): couple[] {\n    return this._couples\n  }\n\n  get matrice(): UnPatron {\n    return this._matrice\n  }\n\n  set couples(value: couple[]) {\n    // ne fait rien\n  }\n\n  ecritCouples(): string {\n    return this._couples.map(([a, b]) => `[${a}, ${b}]`).join('; ')\n  }\n\n  ecritlongueur(): number {\n    return this._couples.length\n  }\n\n  faitUnPatron(long: number = 6): void {\n    const sens = [-1, 1]\n    const longDejaEcrite = this._couples.length\n    for (let l = 0; l < long - longDejaEcrite; l++) {\n      const couplesPossibles: couple[] = []\n      // parcours la liste des couples et liste les cas possibles\n      for (let j = 0; j < this._couples.length; j++) {\n        const [a, b] = this._couples[j]\n        for (const k of sens) {\n          if (\n            !this._couples.some(\n              ([x, y]) =>\n                x === a + k && (y === b || y === b + 1 || y === b - 1),\n            )\n          ) {\n            couplesPossibles.push([a + k, b])\n          }\n        }\n        for (const k of sens) {\n          if (\n            !this._couples.some(\n              ([x, y]) =>\n                y === b + k && (x === a || x === a + 1 || x === a - 1),\n            )\n          ) {\n            couplesPossibles.push([a, b + k])\n          }\n        }\n      }\n      this._couples.push(\n        couplesPossibles[randint(0, couplesPossibles.length - 1)],\n      )\n    }\n  }\n\n  faitUnPatronMatrice(): void {\n    let aMin = 0\n    let bMin = 0\n    let aMax = 0\n    let bMax = 0\n    for (const [a, b] of this._couples) {\n      aMax = Math.max(aMax, a)\n      bMax = Math.max(bMax, b)\n      aMin = Math.min(aMin, a)\n      bMin = Math.min(bMin, b)\n    }\n    const couplesLargeur = aMax - aMin + 1\n    const couplesLongueur = bMax - bMin + 1\n    this._matrice.initMatrice(couplesLargeur, couplesLongueur)\n    for (const [a, b] of this._couples) {\n      this._matrice.setcell(a - aMin, bMax - b, 1, true)\n    }\n  }\n}\n"],"names":["cubesObj","fauxCubesObj","getVoisins","matrice","x","y","dx","dy","_b","_a","dir","findPivot","maxVoisins","pivot","voisins","buildFaceTree","parent","directionFromParent","visited","key","node","voisin","child","EPSILON","getAbsolutePositions","tree","taille","pos","positions","offset","getPivotPositions","facePositions","pivotPositions","faceAbsPos","pivotAbsPos","parentKey","parentFaceAbsPos","addFaceRecursive3D","couleurs","faceCount","boxWidth","boxDepth","colorIndex","couleur","parentPivotAbsPos","pivotGroup","THREE.Group","geometry","THREE.BoxGeometry","material","THREE.MeshPhongMaterial","THREE.DoubleSide","mesh","THREE.Mesh","childGroup","generateContent3D","id","pivotsPositions","group","obj","createEtatPatron","ajouteListenersThreeJS","canvas3d","btnPlier","btnDeplier","etat","animePliageThreeJS","collision","meshes","collidedMeshes","i","boxA","THREE.Box3","j","boxB","intersectionBox","size","THREE.Vector3","pending","blinkMesh","animeDepliageThreeJS","onComplete","duration","pivots","from","to","THREE.Euler","animateRotation","onCorrectionsAffichees","match","idEvent","objects","start","step","now","t","color","times","interval","count","originalColor","blink","amcReady","amcType","interactifReady","interactifType","titre","dateDePublication","uuid","refs","retrouveMatrices","liste","indexVraiPatron","face","indexPas6Faces","indexFauxPatrons","index","collisions","acc","item","choixPatron","Exercice","__publicField","context","zoom","zoomAMC","listeTypeQuestions","combinaisonListes","listeTypeVraiPatrons","listeVraisPatrons","initListePatrons","listeFauxPatrons","cpt","texte","texteCorr","indexMelangés","shuffle","patronsOriginaux","patronsAffiches","numPatron2","randint","taillePatronAuPif","choice","faitUnPatronAuPif","k","fig0","fig1","fig2","fig3","fig0AMC","mathalea2d","fixeBordures","fig1AMC","fig2AMC","fig3AMC","setCliqueFigure","figuresEnonce","content3d","ajouteCanvas3d","listeQuestionsToContenu","exercice","figElements","el","indexClique","nouveauCanvas","tailleCarre","listeMatrices","listePatrons","uneMatrice","patron","UnPatron","ligne","tempcouples","SerieCouples","largeur","longueur","digit","l","max","row","value","valeursBooleennes","element","patronTemp","arrayClone","transfo","numeroterFaces","numeroDessin","correction","leDessin","face1","BoiteBuilder","laFace1","xmin","xmax","Numdessin","texteParPosition","matriceTemp","a","b","long","sens","longDejaEcrite","couplesPossibles","aMin","bMin","aMax","bMax","couplesLargeur","couplesLongueur"],"mappings":"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"}