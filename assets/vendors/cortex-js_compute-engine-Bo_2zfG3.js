var Kg=Object.defineProperty;var Xg=(li,dt,Ct)=>dt in li?Kg(li,dt,{enumerable:!0,configurable:!0,writable:!0,value:Ct}):li[dt]=Ct;var m=(li,dt,Ct)=>Xg(li,typeof dt!="symbol"?dt+"":dt,Ct);var hr={exports:{}},ed=hr.exports,ju;function td(){return ju||(ju=1,(function(li,dt){(function(Ct,An){An(dt)})(ed,(function(Ct){var An=(()=>{var O,Vu,Bu,Zu,Uu,Gu,Ht;var $n=Object.defineProperty,Ku=Object.getOwnPropertyDescriptor,Xu=Object.getOwnPropertyNames,ec=Object.prototype.hasOwnProperty,tc=(e,t)=>{for(var i in t)$n(e,i,{get:t[i],enumerable:!0})},ic=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Xu(t))!ec.call(e,n)&&n!==i&&$n(e,n,{get:()=>t[n],enumerable:!(r=Ku(t,n))||r.enumerable});return e},rc=e=>ic($n({},"__esModule",{value:!0}),e),da={};tc(da,{BoxedType:()=>$,ComputeEngine:()=>Ou,NumericValue:()=>pe,version:()=>Jg});var Te=Math.cosh||function(e){return Math.abs(e)<1e-9?1-e:(Math.exp(e)+Math.exp(-e))*.5},Ze=Math.sinh||function(e){return Math.abs(e)<1e-9?e:(Math.exp(e)-Math.exp(-e))*.5},nc=function(e){var t=Math.PI/4;if(-t>e||e>t)return Math.cos(e)-1;var i=e*e;return i*(i*(i*(i*(i*(i*(i*(i/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-1/2)},sc=function(e,t){var i=Math.abs(e),r=Math.abs(t);return i<3e3&&r<3e3?Math.sqrt(i*i+r*r):(i<r?(i=r,r=e/t):r=t/e,i*Math.sqrt(1+r*r))},ui=function(){throw SyntaxError("Invalid Param")};function Cn(e,t){var i=Math.abs(e),r=Math.abs(t);return e===0?Math.log(r):t===0?Math.log(i):i<3e3&&r<3e3?Math.log(e*e+t*t)*.5:(e=e/2,t=t/2,.5*Math.log(e*e+t*t)+Math.LN2)}var ac=function(e,t){var i={re:0,im:0};if(e==null)i.re=i.im=0;else if(t!==void 0)i.re=e,i.im=t;else switch(typeof e){case"object":if("im"in e&&"re"in e)i.re=e.re,i.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return W.INFINITY;i.re=e.abs*Math.cos(e.arg),i.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return W.INFINITY;i.re=e.r*Math.cos(e.phi),i.im=e.r*Math.sin(e.phi)}else e.length===2?(i.re=e[0],i.im=e[1]):ui();break;case"string":i.im=i.re=0;var r=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),n=1,s=0;r===null&&ui();for(var a=0;a<r.length;a++){var o=r[a];o===" "||o==="	"||o===`
`||(o==="+"?n++:o==="-"?s++:o==="i"||o==="I"?(n+s===0&&ui(),r[a+1]!==" "&&!isNaN(Number(r[a+1]))?(i.im+=parseFloat((s%2?"-":"")+r[a+1]),a++):i.im+=parseFloat((s%2?"-":"")+"1"),n=s=0):((n+s===0||isNaN(Number(o)))&&ui(),r[a+1]==="i"||r[a+1]==="I"?(i.im+=parseFloat((s%2?"-":"")+o),a++):i.re+=parseFloat((s%2?"-":"")+o),n=s=0))}n+s>0&&ui();break;case"number":i.im=0,i.re=e;break;default:ui()}return isNaN(i.re)||isNaN(i.im),i},W=class N{constructor(t,i){this.re=0,this.im=0;var r=ac(t,i);this.re=r.re,this.im=r.im}sign(){var t=this.abs();return new N(this.re/t,this.im/t)}add(t,i){var r=new N(t,i);return this.isInfinite()&&r.isInfinite()?N.NAN:this.isInfinite()||r.isInfinite()?N.INFINITY:new N(this.re+r.re,this.im+r.im)}sub(t,i){var r=new N(t,i);return this.isInfinite()&&r.isInfinite()?N.NAN:this.isInfinite()||r.isInfinite()?N.INFINITY:new N(this.re-r.re,this.im-r.im)}mul(t,i){var r=new N(t,i);return this.isInfinite()&&r.isZero()||this.isZero()&&r.isInfinite()?N.NAN:this.isInfinite()||r.isInfinite()?N.INFINITY:r.im===0&&this.im===0?new N(this.re*r.re,0):new N(this.re*r.re-this.im*r.im,this.re*r.im+this.im*r.re)}div(t,i){var r=new N(t,i);if(this.isZero()&&r.isZero()||this.isInfinite()&&r.isInfinite())return N.NAN;if(this.isInfinite()||r.isZero())return N.INFINITY;if(this.isZero()||r.isInfinite())return N.ZERO;t=this.re,i=this.im;var n=r.re,s=r.im,a,o;return s===0?new N(t/n,i/n):Math.abs(n)<Math.abs(s)?(o=n/s,a=n*o+s,new N((t*o+i)/a,(i*o-t)/a)):(o=s/n,a=s*o+n,new N((t+i*o)/a,(i-t*o)/a))}pow(t,i){var r=new N(t,i);if(t=this.re,i=this.im,r.isZero())return N.ONE;if(r.im===0){if(i===0&&t>0)return new N(Math.pow(t,r.re),0);if(t===0)switch((r.re%4+4)%4){case 0:return new N(Math.pow(i,r.re),0);case 1:return new N(0,Math.pow(i,r.re));case 2:return new N(-Math.pow(i,r.re),0);case 3:return new N(0,-Math.pow(i,r.re))}}if(t===0&&i===0&&r.re>0&&r.im>=0)return N.ZERO;var n=Math.atan2(i,t),s=Cn(t,i);return t=Math.exp(r.re*s-r.im*n),i=r.im*s+r.re*n,new N(t*Math.cos(i),t*Math.sin(i))}sqrt(){var t=this.re,i=this.im,r=this.abs(),n,s;if(t>=0){if(i===0)return new N(Math.sqrt(t),0);n=.5*Math.sqrt(2*(r+t))}else n=Math.abs(i)/Math.sqrt(2*(r-t));return t<=0?s=.5*Math.sqrt(2*(r-t)):s=Math.abs(i)/Math.sqrt(2*(r+t)),new N(n,i<0?-s:s)}exp(){var t=Math.exp(this.re);return this.im,new N(t*Math.cos(this.im),t*Math.sin(this.im))}expm1(){var t=this.re,i=this.im;return new N(Math.expm1(t)*Math.cos(i)+nc(i),Math.exp(t)*Math.sin(i))}log(){var t=this.re,i=this.im;return new N(Cn(t,i),Math.atan2(i,t))}abs(){return sc(this.re,this.im)}arg(){return Math.atan2(this.im,this.re)}sin(){var t=this.re,i=this.im;return new N(Math.sin(t)*Te(i),Math.cos(t)*Ze(i))}cos(){var t=this.re,i=this.im;return new N(Math.cos(t)*Te(i),-Math.sin(t)*Ze(i))}tan(){var t=2*this.re,i=2*this.im,r=Math.cos(t)+Te(i);return new N(Math.sin(t)/r,Ze(i)/r)}cot(){var t=2*this.re,i=2*this.im,r=Math.cos(t)-Te(i);return new N(-Math.sin(t)/r,Ze(i)/r)}sec(){var t=this.re,i=this.im,r=.5*Te(2*i)+.5*Math.cos(2*t);return new N(Math.cos(t)*Te(i)/r,Math.sin(t)*Ze(i)/r)}csc(){var t=this.re,i=this.im,r=.5*Te(2*i)-.5*Math.cos(2*t);return new N(Math.sin(t)*Te(i)/r,-Math.cos(t)*Ze(i)/r)}asin(){var t=this.re,i=this.im,r=new N(i*i-t*t+1,-2*t*i).sqrt(),n=new N(r.re-i,r.im+t).log();return new N(n.im,-n.re)}acos(){var t=this.re,i=this.im,r=new N(i*i-t*t+1,-2*t*i).sqrt(),n=new N(r.re-i,r.im+t).log();return new N(Math.PI/2-n.im,n.re)}atan(){var t=this.re,i=this.im;if(t===0){if(i===1)return new N(0,1/0);if(i===-1)return new N(0,-1/0)}var r=t*t+(1-i)*(1-i),n=new N((1-i*i-t*t)/r,-2*t/r).log();return new N(-.5*n.im,.5*n.re)}acot(){var t=this.re,i=this.im;if(i===0)return new N(Math.atan2(1,t),0);var r=t*t+i*i;return r!==0?new N(t/r,-i/r).atan():new N(t!==0?t/0:0,i!==0?-i/0:0).atan()}asec(){var t=this.re,i=this.im;if(t===0&&i===0)return new N(0,1/0);var r=t*t+i*i;return r!==0?new N(t/r,-i/r).acos():new N(t!==0?t/0:0,i!==0?-i/0:0).acos()}acsc(){var t=this.re,i=this.im;if(t===0&&i===0)return new N(Math.PI/2,1/0);var r=t*t+i*i;return r!==0?new N(t/r,-i/r).asin():new N(t!==0?t/0:0,i!==0?-i/0:0).asin()}sinh(){var t=this.re,i=this.im;return new N(Ze(t)*Math.cos(i),Te(t)*Math.sin(i))}cosh(){var t=this.re,i=this.im;return new N(Te(t)*Math.cos(i),Ze(t)*Math.sin(i))}tanh(){var t=2*this.re,i=2*this.im,r=Te(t)+Math.cos(i);return new N(Ze(t)/r,Math.sin(i)/r)}coth(){var t=2*this.re,i=2*this.im,r=Te(t)-Math.cos(i);return new N(Ze(t)/r,-Math.sin(i)/r)}csch(){var t=this.re,i=this.im,r=Math.cos(2*i)-Te(2*t);return new N(-2*Ze(t)*Math.cos(i)/r,2*Te(t)*Math.sin(i)/r)}sech(){var t=this.re,i=this.im,r=Math.cos(2*i)+Te(2*t);return new N(2*Te(t)*Math.cos(i)/r,-2*Ze(t)*Math.sin(i)/r)}asinh(){var t=this.im;this.im=-this.re,this.re=t;var i=this.asin();return this.re=-this.im,this.im=t,t=i.re,i.re=-i.im,i.im=t,i}acosh(){var t=this.acos();if(t.im<=0){var i=t.re;t.re=-t.im,t.im=i}else{var i=t.im;t.im=-t.re,t.re=i}return t}atanh(){var t=this.re,i=this.im,r=t>1&&i===0,n=1-t,s=1+t,a=n*n+i*i,o=a!==0?new N((s*n-i*i)/a,(i*n+s*i)/a):new N(t!==-1?t/0:0,i!==0?i/0:0),l=o.re;return o.re=Cn(o.re,o.im)/2,o.im=Math.atan2(o.im,l)/2,r&&(o.im=-o.im),o}acoth(){var t=this.re,i=this.im;if(t===0&&i===0)return new N(0,Math.PI/2);var r=t*t+i*i;return r!==0?new N(t/r,-i/r).atanh():new N(t!==0?t/0:0,i!==0?-i/0:0).atanh()}acsch(){var t=this.re,i=this.im;if(i===0)return new N(t!==0?Math.log(t+Math.sqrt(t*t+1)):1/0,0);var r=t*t+i*i;return r!==0?new N(t/r,-i/r).asinh():new N(t!==0?t/0:0,i!==0?-i/0:0).asinh()}asech(){var t=this.re,i=this.im;if(this.isZero())return N.INFINITY;var r=t*t+i*i;return r!==0?new N(t/r,-i/r).acosh():new N(t!==0?t/0:0,i!==0?-i/0:0).acosh()}inverse(){if(this.isZero())return N.INFINITY;if(this.isInfinite())return N.ZERO;var t=this.re,i=this.im,r=t*t+i*i;return new N(t/r,-i/r)}conjugate(){return new N(this.re,-this.im)}neg(){return new N(-this.re,-this.im)}ceil(t){return t=Math.pow(10,t||0),new N(Math.ceil(this.re*t)/t,Math.ceil(this.im*t)/t)}floor(t){return t=Math.pow(10,t||0),new N(Math.floor(this.re*t)/t,Math.floor(this.im*t)/t)}round(t){return t=Math.pow(10,t||0),new N(Math.round(this.re*t)/t,Math.round(this.im*t)/t)}equals(t,i){var r=new N(t,i);return Math.abs(r.re-this.re)<=N.EPSILON&&Math.abs(r.im-this.im)<=N.EPSILON}clone(){return new N(this.re,this.im)}toString(){var t=this.re,i=this.im,r="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(t)<N.EPSILON&&(t=0),Math.abs(i)<N.EPSILON&&(i=0),i===0?r+t:(t!==0?(r+=t,r+=" ",i<0?(i=-i,r+="-"):r+="+",r+=" "):i<0&&(i=-i,r+="-"),i!==1&&(r+=i),r+"i"))}toVector(){return[this.re,this.im]}valueOf(){return this.im===0?this.re:null}isNaN(){return isNaN(this.re)||isNaN(this.im)}isZero(){return this.im===0&&this.re===0}isFinite(){return isFinite(this.re)&&isFinite(this.im)}isInfinite(){return!(this.isNaN()||this.isFinite())}};W.ZERO=new W(0,0),W.ONE=new W(1,0),W.I=new W(0,1),W.PI=new W(Math.PI,0),W.E=new W(Math.E,0),W.INFINITY=new W(1/0,1/0),W.NAN=new W(NaN,NaN),W.EPSILON=1e-15;var ci=9e15,qt=1e9,qn="0123456789abcdef",mr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",gr="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Dn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ci,maxE:ci,crypto:!1},ya,yt,P=!0,dr="[DecimalError] ",Dt=dr+"Invalid argument: ",ba=dr+"Precision limit exceeded",va=dr+"crypto unavailable",xa="[object Decimal]",Ee=Math.floor,ue=Math.pow,oc=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,lc=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,uc=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Na=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ye=1e7,D=7,cc=9007199254740991,fc=mr.length-1,Pn=gr.length-1,b={toStringTag:xa};b.absoluteValue=b.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),A(e)},b.ceil=function(){return A(new this.constructor(this),this.e+1,2)},b.clampedTo=b.clamp=function(e,t){var i,r=this,n=r.constructor;if(e=new n(e),t=new n(t),!e.s||!t.s)return new n(NaN);if(e.gt(t))throw Error(Dt+t);return i=r.cmp(e),i<0?e:r.cmp(t)>0?t:new n(r)},b.comparedTo=b.cmp=function(e){var t,i,r,n,s=this,a=s.d,o=(e=new s.constructor(e)).d,l=s.s,u=e.s;if(!a||!o)return!l||!u?NaN:l!==u?l:a===o?0:!a^l<0?1:-1;if(!a[0]||!o[0])return a[0]?l:o[0]?-u:0;if(l!==u)return l;if(s.e!==e.e)return s.e>e.e^l<0?1:-1;for(r=a.length,n=o.length,t=0,i=r<n?r:n;t<i;++t)if(a[t]!==o[t])return a[t]>o[t]^l<0?1:-1;return r===n?0:r>n^l<0?1:-1},b.cosine=b.cos=function(){var e,t,i=this,r=i.constructor;return i.d?i.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(i.e,i.sd())+D,r.rounding=1,i=pc(r,Ea(r,i)),r.precision=e,r.rounding=t,A(yt==2||yt==3?i.neg():i,e,t,!0)):new r(1):new r(NaN)},b.cubeRoot=b.cbrt=function(){var e,t,i,r,n,s,a,o,l,u,c=this,f=c.constructor;if(!c.isFinite()||c.isZero())return new f(c);for(P=!1,s=c.s*ue(c.s*c,.3333333333333333),!s||Math.abs(s)==1/0?(i=Ne(c.d),e=c.e,(s=(e-i.length+1)%3)&&(i+=s==1||s==-2?"0":"00"),s=ue(i,.3333333333333333),e=Ee((e+1)/3)-(e%3==(e<0?-1:2)),s==1/0?i="5e"+e:(i=s.toExponential(),i=i.slice(0,i.indexOf("e")+1)+e),r=new f(i),r.s=c.s):r=new f(s.toString()),a=(e=f.precision)+3;;)if(o=r,l=o.times(o).times(o),u=l.plus(c),r=H(u.plus(c).times(o),u.plus(l),a+2,1),Ne(o.d).slice(0,a)===(i=Ne(r.d)).slice(0,a))if(i=i.slice(a-3,a+1),i=="9999"||!n&&i=="4999"){if(!n&&(A(o,e+1,0),o.times(o).times(o).eq(c))){r=o;break}a+=4,n=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(A(r,e+1,1),t=!r.times(r).times(r).eq(c));break}return P=!0,A(r,e,f.rounding,t)},b.decimalPlaces=b.dp=function(){var e,t=this.d,i=NaN;if(t){if(e=t.length-1,i=(e-Ee(this.e/D))*D,e=t[e],e)for(;e%10==0;e/=10)i--;i<0&&(i=0)}return i},b.dividedBy=b.div=function(e){return H(this,new this.constructor(e))},b.dividedToIntegerBy=b.divToInt=function(e){var t=this,i=t.constructor;return A(H(t,new i(e),0,1,1),i.precision,i.rounding)},b.equals=b.eq=function(e){return this.cmp(e)===0},b.floor=function(){return A(new this.constructor(this),this.e+1,3)},b.greaterThan=b.gt=function(e){return this.cmp(e)>0},b.greaterThanOrEqualTo=b.gte=function(e){var t=this.cmp(e);return t==1||t===0},b.hyperbolicCosine=b.cosh=function(){var e,t,i,r,n,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;i=a.precision,r=a.rounding,a.precision=i+Math.max(s.e,s.sd())+4,a.rounding=1,n=s.d.length,n<32?(e=Math.ceil(n/3),t=(1/Nr(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),s=fi(a,1,s.times(t),new a(1),!0);for(var l,u=e,c=new a(8);u--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return A(s,a.precision=i,a.rounding=r,!0)},b.hyperbolicSine=b.sinh=function(){var e,t,i,r,n=this,s=n.constructor;if(!n.isFinite()||n.isZero())return new s(n);if(t=s.precision,i=s.rounding,s.precision=t+Math.max(n.e,n.sd())+4,s.rounding=1,r=n.d.length,r<3)n=fi(s,2,n,n,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,n=n.times(1/Nr(5,e)),n=fi(s,2,n,n,!0);for(var a,o=new s(5),l=new s(16),u=new s(20);e--;)a=n.times(n),n=n.times(o.plus(a.times(l.times(a).plus(u))))}return s.precision=t,s.rounding=i,A(n,t,i,!0)},b.hyperbolicTangent=b.tanh=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,H(i.sinh(),i.cosh(),r.precision=e,r.rounding=t)):new r(i.s)},b.inverseCosine=b.acos=function(){var e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,n=t.rounding;return i!==-1?i===0?e.isNeg()?ut(t,r,n):new t(0):new t(NaN):e.isZero()?ut(t,r+4,n).times(.5):(t.precision=r+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=r,t.rounding=n,e.times(2))},b.inverseHyperbolicCosine=b.acosh=function(){var e,t,i=this,r=i.constructor;return i.lte(1)?new r(i.eq(1)?0:NaN):i.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(i.e),i.sd())+4,r.rounding=1,P=!1,i=i.times(i).minus(1).sqrt().plus(i),P=!0,r.precision=e,r.rounding=t,i.ln()):new r(i)},b.inverseHyperbolicSine=b.asinh=function(){var e,t,i=this,r=i.constructor;return!i.isFinite()||i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(i.e),i.sd())+6,r.rounding=1,P=!1,i=i.times(i).plus(1).sqrt().plus(i),P=!0,r.precision=e,r.rounding=t,i.ln())},b.inverseHyperbolicTangent=b.atanh=function(){var e,t,i,r,n=this,s=n.constructor;return n.isFinite()?n.e>=0?new s(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(e=s.precision,t=s.rounding,r=n.sd(),Math.max(r,e)<2*-n.e-1?A(new s(n),e,t,!0):(s.precision=i=r-n.e,n=H(n.plus(1),new s(1).minus(n),i+e,1),s.precision=e+4,s.rounding=1,n=n.ln(),s.precision=e,s.rounding=t,n.times(.5))):new s(NaN)},b.inverseSine=b.asin=function(){var e,t,i,r,n=this,s=n.constructor;return n.isZero()?new s(n):(t=n.abs().cmp(1),i=s.precision,r=s.rounding,t!==-1?t===0?(e=ut(s,i+4,r).times(.5),e.s=n.s,e):new s(NaN):(s.precision=i+6,s.rounding=1,n=n.div(new s(1).minus(n.times(n)).sqrt().plus(1)).atan(),s.precision=i,s.rounding=r,n.times(2)))},b.inverseTangent=b.atan=function(){var e,t,i,r,n,s,a,o,l,u=this,c=u.constructor,f=c.precision,p=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&f+4<=Pn)return a=ut(c,f+4,p).times(.25),a.s=u.s,a}else{if(!u.s)return new c(NaN);if(f+4<=Pn)return a=ut(c,f+4,p).times(.5),a.s=u.s,a}for(c.precision=o=f+10,c.rounding=1,i=Math.min(28,o/D+2|0),e=i;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(P=!1,t=Math.ceil(o/D),r=1,l=u.times(u),a=new c(u),n=u;e!==-1;)if(n=n.times(l),s=a.minus(n.div(r+=2)),n=n.times(l),a=s.plus(n.div(r+=2)),a.d[t]!==void 0)for(e=t;a.d[e]===s.d[e]&&e--;);return i&&(a=a.times(2<<i-1)),P=!0,A(a,c.precision=f,c.rounding=p,!0)},b.isFinite=function(){return!!this.d},b.isInteger=b.isInt=function(){return!!this.d&&Ee(this.e/D)>this.d.length-2},b.isNaN=function(){return!this.s},b.isNegative=b.isNeg=function(){return this.s<0},b.isPositive=b.isPos=function(){return this.s>0},b.isZero=function(){return!!this.d&&this.d[0]===0},b.lessThan=b.lt=function(e){return this.cmp(e)<0},b.lessThanOrEqualTo=b.lte=function(e){return this.cmp(e)<1},b.logarithm=b.log=function(e){var t,i,r,n,s,a,o,l,u=this,c=u.constructor,f=c.precision,p=c.rounding,h=5;if(e==null)e=new c(10),t=!0;else{if(e=new c(e),i=e.d,e.s<0||!i||!i[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(i=u.d,u.s<0||!i||!i[0]||u.eq(1))return new c(i&&!i[0]?-1/0:u.s!=1?NaN:i?0:1/0);if(t)if(i.length>1)s=!0;else{for(n=i[0];n%10===0;)n/=10;s=n!==1}if(P=!1,o=f+h,a=Ft(u,o),r=t?vr(c,o+10):Ft(e,o),l=H(a,r,o,1),Fi(l.d,n=f,p))do if(o+=10,a=Ft(u,o),r=t?vr(c,o+10):Ft(e,o),l=H(a,r,o,1),!s){+Ne(l.d).slice(n+1,n+15)+1==1e14&&(l=A(l,f+1,0));break}while(Fi(l.d,n+=10,p));return P=!0,A(l,f,p)},b.minus=b.sub=function(e){var t,i,r,n,s,a,o,l,u,c,f,p,h=this,d=h.constructor;if(e=new d(e),!h.d||!e.d)return!h.s||!e.s?e=new d(NaN):h.d?e.s=-e.s:e=new d(e.d||h.s!==e.s?h:NaN),e;if(h.s!=e.s)return e.s=-e.s,h.plus(e);if(u=h.d,p=e.d,o=d.precision,l=d.rounding,!u[0]||!p[0]){if(p[0])e.s=-e.s;else if(u[0])e=new d(h);else return new d(l===3?-0:0);return P?A(e,o,l):e}if(i=Ee(e.e/D),c=Ee(h.e/D),u=u.slice(),s=c-i,s){for(f=s<0,f?(t=u,s=-s,a=p.length):(t=p,i=c,a=u.length),r=Math.max(Math.ceil(o/D),a)+2,s>r&&(s=r,t.length=1),t.reverse(),r=s;r--;)t.push(0);t.reverse()}else{for(r=u.length,a=p.length,f=r<a,f&&(a=r),r=0;r<a;r++)if(u[r]!=p[r]){f=u[r]<p[r];break}s=0}for(f&&(t=u,u=p,p=t,e.s=-e.s),a=u.length,r=p.length-a;r>0;--r)u[a++]=0;for(r=p.length;r>s;){if(u[--r]<p[r]){for(n=r;n&&u[--n]===0;)u[n]=Ye-1;--u[n],u[r]+=Ye}u[r]-=p[r]}for(;u[--a]===0;)u.pop();for(;u[0]===0;u.shift())--i;return u[0]?(e.d=u,e.e=br(u,i),P?A(e,o,l):e):new d(l===3?-0:0)},b.modulo=b.mod=function(e){var t,i=this,r=i.constructor;return e=new r(e),!i.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||i.d&&!i.d[0]?A(new r(i),r.precision,r.rounding):(P=!1,r.modulo==9?(t=H(i,e.abs(),0,3,1),t.s*=e.s):t=H(i,e,0,r.modulo,1),t=t.times(e),P=!0,i.minus(t))},b.naturalExponential=b.exp=function(){return Fn(this)},b.naturalLogarithm=b.ln=function(){return Ft(this)},b.negated=b.neg=function(){var e=new this.constructor(this);return e.s=-e.s,A(e)},b.plus=b.add=function(e){var t,i,r,n,s,a,o,l,u,c,f=this,p=f.constructor;if(e=new p(e),!f.d||!e.d)return!f.s||!e.s?e=new p(NaN):f.d||(e=new p(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,c=e.d,o=p.precision,l=p.rounding,!u[0]||!c[0])return c[0]||(e=new p(f)),P?A(e,o,l):e;if(s=Ee(f.e/D),r=Ee(e.e/D),u=u.slice(),n=s-r,n){for(n<0?(i=u,n=-n,a=c.length):(i=c,r=s,a=u.length),s=Math.ceil(o/D),a=s>a?s+1:a+1,n>a&&(n=a,i.length=1),i.reverse();n--;)i.push(0);i.reverse()}for(a=u.length,n=c.length,a-n<0&&(n=a,i=c,c=u,u=i),t=0;n;)t=(u[--n]=u[n]+c[n]+t)/Ye|0,u[n]%=Ye;for(t&&(u.unshift(t),++r),a=u.length;u[--a]==0;)u.pop();return e.d=u,e.e=br(u,r),P?A(e,o,l):e},b.precision=b.sd=function(e){var t,i=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Dt+e);return i.d?(t=_a(i.d),e&&i.e+1>t&&(t=i.e+1)):t=NaN,t},b.round=function(){var e=this,t=e.constructor;return A(new t(e),e.e+1,t.rounding)},b.sine=b.sin=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+Math.max(i.e,i.sd())+D,r.rounding=1,i=mc(r,Ea(r,i)),r.precision=e,r.rounding=t,A(yt>2?i.neg():i,e,t,!0)):new r(NaN)},b.squareRoot=b.sqrt=function(){var e,t,i,r,n,s,a=this,o=a.d,l=a.e,u=a.s,c=a.constructor;if(u!==1||!o||!o[0])return new c(!u||u<0&&(!o||o[0])?NaN:o?a:1/0);for(P=!1,u=Math.sqrt(+a),u==0||u==1/0?(t=Ne(o),(t.length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=Ee((l+1)/2)-(l<0||l%2),u==1/0?t="5e"+l:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),r=new c(t)):r=new c(u.toString()),i=(l=c.precision)+3;;)if(s=r,r=s.plus(H(a,s,i+2,1)).times(.5),Ne(s.d).slice(0,i)===(t=Ne(r.d)).slice(0,i))if(t=t.slice(i-3,i+1),t=="9999"||!n&&t=="4999"){if(!n&&(A(s,l+1,0),s.times(s).eq(a))){r=s;break}i+=4,n=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(r,l+1,1),e=!r.times(r).eq(a));break}return P=!0,A(r,l,c.rounding,e)},b.tangent=b.tan=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,i=i.sin(),i.s=1,i=H(i,new r(1).minus(i.times(i)).sqrt(),e+10,0),r.precision=e,r.rounding=t,A(yt==2||yt==4?i.neg():i,e,t,!0)):new r(NaN)},b.times=b.mul=function(e){var t,i,r,n,s,a,o,l,u,c=this,f=c.constructor,p=c.d,h=(e=new f(e)).d;if(e.s*=c.s,!p||!p[0]||!h||!h[0])return new f(!e.s||p&&!p[0]&&!h||h&&!h[0]&&!p?NaN:!p||!h?e.s/0:e.s*0);for(i=Ee(c.e/D)+Ee(e.e/D),l=p.length,u=h.length,l<u&&(s=p,p=h,h=s,a=l,l=u,u=a),s=[],a=l+u,r=a;r--;)s.push(0);for(r=u;--r>=0;){for(t=0,n=l+r;n>r;)o=s[n]+h[r]*p[n-r-1]+t,s[n--]=o%Ye|0,t=o/Ye|0;s[n]=(s[n]+t)%Ye|0}for(;!s[--a];)s.pop();return t?++i:s.shift(),e.d=s,e.e=br(s,i),P?A(e,f.precision,f.rounding):e},b.toBinary=function(e,t){return On(this,2,e,t)},b.toDecimalPlaces=b.toDP=function(e,t){var i=this,r=i.constructor;return i=new r(i),e===void 0?i:(Pe(e,0,qt),t===void 0?t=r.rounding:Pe(t,0,8),A(i,e+i.e+1,t))},b.toExponential=function(e,t){var i,r=this,n=r.constructor;return e===void 0?i=lt(r,!0):(Pe(e,0,qt),t===void 0?t=n.rounding:Pe(t,0,8),r=A(new n(r),e+1,t),i=lt(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+i:i},b.toFixed=function(e,t){var i,r,n=this,s=n.constructor;return e===void 0?i=lt(n):(Pe(e,0,qt),t===void 0?t=s.rounding:Pe(t,0,8),r=A(new s(n),e+n.e+1,t),i=lt(r,!1,e+r.e+1)),n.isNeg()&&!n.isZero()?"-"+i:i},b.toFraction=function(e){var t,i,r,n,s,a,o,l,u,c,f,p,h=this,d=h.d,y=h.constructor;if(!d)return new y(h);if(u=i=new y(1),r=l=new y(0),t=new y(r),s=t.e=_a(d)-h.e-1,a=s%D,t.d[0]=ue(10,a<0?D+a:a),e==null)e=s>0?t:u;else{if(o=new y(e),!o.isInt()||o.lt(u))throw Error(Dt+o);e=o.gt(t)?s>0?t:u:o}for(P=!1,o=new y(Ne(d)),c=y.precision,y.precision=s=d.length*D*2;f=H(o,t,0,1,1),n=i.plus(f.times(r)),n.cmp(e)!=1;)i=r,r=n,n=u,u=l.plus(f.times(n)),l=n,n=t,t=o.minus(f.times(n)),o=n;return n=H(e.minus(i),r,0,1,1),l=l.plus(n.times(u)),i=i.plus(n.times(r)),l.s=u.s=h.s,p=H(u,r,s,1).minus(h).abs().cmp(H(l,i,s,1).minus(h).abs())<1?[u,r]:[l,i],y.precision=c,P=!0,p},b.toHexadecimal=b.toHex=function(e,t){return On(this,16,e,t)},b.toNearest=function(e,t){var i=this,r=i.constructor;if(i=new r(i),e==null){if(!i.d)return i;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:Pe(t,0,8),!i.d)return e.s?i:e;if(!e.d)return e.s&&(e.s=i.s),e}return e.d[0]?(P=!1,i=H(i,e,0,t,1).times(e),P=!0,A(i)):(e.s=i.s,i=e),i},b.toNumber=function(){return+this},b.toOctal=function(e,t){return On(this,8,e,t)},b.toPower=b.pow=function(e){var t,i,r,n,s,a,o=this,l=o.constructor,u=+(e=new l(e));if(!o.d||!e.d||!o.d[0]||!e.d[0])return new l(ue(+o,u));if(o=new l(o),o.eq(1))return o;if(r=l.precision,s=l.rounding,e.eq(1))return A(o,r,s);if(t=Ee(e.e/D),t>=e.d.length-1&&(i=u<0?-u:u)<=cc)return n=wa(l,o,i,r),e.s<0?new l(1).div(n):A(n,r,s);if(a=o.s,a<0){if(t<e.d.length-1)return new l(NaN);if((e.d[t]&1)==0&&(a=1),o.e==0&&o.d[0]==1&&o.d.length==1)return o.s=a,o}return i=ue(+o,u),t=i==0||!isFinite(i)?Ee(u*(Math.log("0."+Ne(o.d))/Math.LN10+o.e+1)):new l(i+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?a/0:0):(P=!1,l.rounding=o.s=1,i=Math.min(12,(t+"").length),n=Fn(e.times(Ft(o,r+i)),r),n.d&&(n=A(n,r+5,1),Fi(n.d,r,s)&&(t=r+10,n=A(Fn(e.times(Ft(o,t+i)),t),t+5,1),+Ne(n.d).slice(r+1,r+15)+1==1e14&&(n=A(n,r+1,0)))),n.s=a,P=!0,l.rounding=s,A(n,r,s))},b.toPrecision=function(e,t){var i,r=this,n=r.constructor;return e===void 0?i=lt(r,r.e<=n.toExpNeg||r.e>=n.toExpPos):(Pe(e,1,qt),t===void 0?t=n.rounding:Pe(t,0,8),r=A(new n(r),e,t),i=lt(r,e<=r.e||r.e<=n.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+i:i},b.toSignificantDigits=b.toSD=function(e,t){var i=this,r=i.constructor;return e===void 0?(e=r.precision,t=r.rounding):(Pe(e,1,qt),t===void 0?t=r.rounding:Pe(t,0,8)),A(new r(i),e,t)},b.toString=function(){var e=this,t=e.constructor,i=lt(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+i:i},b.truncated=b.trunc=function(){return A(new this.constructor(this),this.e+1,1)},b.valueOf=b.toJSON=function(){var e=this,t=e.constructor,i=lt(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+i:i};function Ne(e){var t,i,r,n=e.length-1,s="",a=e[0];if(n>0){for(s+=a,t=1;t<n;t++)r=e[t]+"",i=D-r.length,i&&(s+=Pt(i)),s+=r;a=e[t],r=a+"",i=D-r.length,i&&(s+=Pt(i))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}function Pe(e,t,i){if(e!==~~e||e<t||e>i)throw Error(Dt+e)}function Fi(e,t,i,r){var n,s,a,o;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=D,n=0):(n=Math.ceil((t+1)/D),t%=D),s=ue(10,D-t),o=e[n]%s|0,r==null?t<3?(t==0?o=o/100|0:t==1&&(o=o/10|0),a=i<4&&o==99999||i>3&&o==49999||o==5e4||o==0):a=(i<4&&o+1==s||i>3&&o+1==s/2)&&(e[n+1]/s/100|0)==ue(10,t-2)-1||(o==s/2||o==0)&&(e[n+1]/s/100|0)==0:t<4?(t==0?o=o/1e3|0:t==1?o=o/100|0:t==2&&(o=o/10|0),a=(r||i<4)&&o==9999||!r&&i>3&&o==4999):a=((r||i<4)&&o+1==s||!r&&i>3&&o+1==s/2)&&(e[n+1]/s/1e3|0)==ue(10,t-3)-1,a}function yr(e,t,i){for(var r,n=[0],s,a=0,o=e.length;a<o;){for(s=n.length;s--;)n[s]*=t;for(n[0]+=qn.indexOf(e.charAt(a++)),r=0;r<n.length;r++)n[r]>i-1&&(n[r+1]===void 0&&(n[r+1]=0),n[r+1]+=n[r]/i|0,n[r]%=i)}return n.reverse()}function pc(e,t){var i,r,n;if(t.isZero())return t;r=t.d.length,r<32?(i=Math.ceil(r/3),n=(1/Nr(4,i)).toString()):(i=16,n="2.3283064365386962890625e-10"),e.precision+=i,t=fi(e,1,t.times(n),new e(1));for(var s=i;s--;){var a=t.times(t);t=a.times(a).minus(a).times(8).plus(1)}return e.precision-=i,t}var H=(function(){function e(r,n,s){var a,o=0,l=r.length;for(r=r.slice();l--;)a=r[l]*n+o,r[l]=a%s|0,o=a/s|0;return o&&r.unshift(o),r}function t(r,n,s,a){var o,l;if(s!=a)l=s>a?1:-1;else for(o=l=0;o<s;o++)if(r[o]!=n[o]){l=r[o]>n[o]?1:-1;break}return l}function i(r,n,s,a){for(var o=0;s--;)r[s]-=o,o=r[s]<n[s]?1:0,r[s]=o*a+r[s]-n[s];for(;!r[0]&&r.length>1;)r.shift()}return function(r,n,s,a,o,l){var u,c,f,p,h,d,y,x,T,C,I,E,w,Se,at,Tn,pr,ha,ot,En,In=r.constructor,ma=r.s==n.s?1:-1,Ae=r.d,Y=n.d;if(!Ae||!Ae[0]||!Y||!Y[0])return new In(!r.s||!n.s||(Ae?Y&&Ae[0]==Y[0]:!Y)?NaN:Ae&&Ae[0]==0||!Y?ma*0:ma/0);for(l?(h=1,c=r.e-n.e):(l=Ye,h=D,c=Ee(r.e/h)-Ee(n.e/h)),ot=Y.length,pr=Ae.length,T=new In(ma),C=T.d=[],f=0;Y[f]==(Ae[f]||0);f++);if(Y[f]>(Ae[f]||0)&&c--,s==null?(Se=s=In.precision,a=In.rounding):o?Se=s+(r.e-n.e)+1:Se=s,Se<0)C.push(1),d=!0;else{if(Se=Se/h+2|0,f=0,ot==1){for(p=0,Y=Y[0],Se++;(f<pr||p)&&Se--;f++)at=p*l+(Ae[f]||0),C[f]=at/Y|0,p=at%Y|0;d=p||f<pr}else{for(p=l/(Y[0]+1)|0,p>1&&(Y=e(Y,p,l),Ae=e(Ae,p,l),ot=Y.length,pr=Ae.length),Tn=ot,I=Ae.slice(0,ot),E=I.length;E<ot;)I[E++]=0;En=Y.slice(),En.unshift(0),ha=Y[0],Y[1]>=l/2&&++ha;do p=0,u=t(Y,I,ot,E),u<0?(w=I[0],ot!=E&&(w=w*l+(I[1]||0)),p=w/ha|0,p>1?(p>=l&&(p=l-1),y=e(Y,p,l),x=y.length,E=I.length,u=t(y,I,x,E),u==1&&(p--,i(y,ot<x?En:Y,x,l))):(p==0&&(u=p=1),y=Y.slice()),x=y.length,x<E&&y.unshift(0),i(I,y,E,l),u==-1&&(E=I.length,u=t(Y,I,ot,E),u<1&&(p++,i(I,ot<E?En:Y,E,l))),E=I.length):u===0&&(p++,I=[0]),C[f++]=p,u&&I[0]?I[E++]=Ae[Tn]||0:(I=[Ae[Tn]],E=1);while((Tn++<pr||I[0]!==void 0)&&Se--);d=I[0]!==void 0}C[0]||C.shift()}if(h==1)T.e=c,ya=d;else{for(f=1,p=C[0];p>=10;p/=10)f++;T.e=f+c*h-1,A(T,o?s+T.e+1:s,a,d)}return T}})();function A(e,t,i,r){var n,s,a,o,l,u,c,f,p,h=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(n=1,o=f[0];o>=10;o/=10)n++;if(s=t-n,s<0)s+=D,a=t,c=f[p=0],l=c/ue(10,n-a-1)%10|0;else if(p=Math.ceil((s+1)/D),o=f.length,p>=o)if(r){for(;o++<=p;)f.push(0);c=l=0,n=1,s%=D,a=s-D+1}else break e;else{for(c=o=f[p],n=1;o>=10;o/=10)n++;s%=D,a=s-D+n,l=a<0?0:c/ue(10,n-a-1)%10|0}if(r=r||t<0||f[p+1]!==void 0||(a<0?c:c%ue(10,n-a-1)),u=i<4?(l||r)&&(i==0||i==(e.s<0?3:2)):l>5||l==5&&(i==4||r||i==6&&(s>0?a>0?c/ue(10,n-a):0:f[p-1])%10&1||i==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=ue(10,(D-t%D)%D),e.e=-t||0):f[0]=e.e=0,e;if(s==0?(f.length=p,o=1,p--):(f.length=p+1,o=ue(10,D-s),f[p]=a>0?(c/ue(10,n-a)%ue(10,a)|0)*o:0),u)for(;;)if(p==0){for(s=1,a=f[0];a>=10;a/=10)s++;for(a=f[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(e.e++,f[0]==Ye&&(f[0]=1));break}else{if(f[p]+=o,f[p]!=Ye)break;f[p--]=0,o=1}for(s=f.length;f[--s]===0;)f.pop()}return P&&(e.e>h.maxE?(e.d=null,e.e=NaN):e.e<h.minE&&(e.e=0,e.d=[0])),e}function lt(e,t,i){if(!e.isFinite())return Ta(e);var r,n=e.e,s=Ne(e.d),a=s.length;return t?(i&&(r=i-a)>0?s=s.charAt(0)+"."+s.slice(1)+Pt(r):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):n<0?(s="0."+Pt(-n-1)+s,i&&(r=i-a)>0&&(s+=Pt(r))):n>=a?(s+=Pt(n+1-a),i&&(r=i-n-1)>0&&(s=s+"."+Pt(r))):((r=n+1)<a&&(s=s.slice(0,r)+"."+s.slice(r)),i&&(r=i-a)>0&&(n+1===a&&(s+="."),s+=Pt(r))),s}function br(e,t){var i=e[0];for(t*=D;i>=10;i/=10)t++;return t}function vr(e,t,i){if(t>fc)throw P=!0,i&&(e.precision=i),Error(ba);return A(new e(mr),t,1,!0)}function ut(e,t,i){if(t>Pn)throw Error(ba);return A(new e(gr),t,i,!0)}function _a(e){var t=e.length-1,i=t*D+1;if(t=e[t],t){for(;t%10==0;t/=10)i--;for(t=e[0];t>=10;t/=10)i++}return i}function Pt(e){for(var t="";e--;)t+="0";return t}function wa(e,t,i,r){var n,s=new e(1),a=Math.ceil(r/D+4);for(P=!1;;){if(i%2&&(s=s.times(t),Ia(s.d,a)&&(n=!0)),i=Ee(i/2),i===0){i=s.d.length-1,n&&s.d[i]===0&&++s.d[i];break}t=t.times(t),Ia(t.d,a)}return P=!0,s}function ka(e){return e.d[e.d.length-1]&1}function Sa(e,t,i){for(var r,n,s=new e(t[0]),a=0;++a<t.length;){if(n=new e(t[a]),!n.s){s=n;break}r=s.cmp(n),(r===i||r===0&&s.s===i)&&(s=n)}return s}function Fn(e,t){var i,r,n,s,a,o,l,u=0,c=0,f=0,p=e.constructor,h=p.rounding,d=p.precision;if(!e.d||!e.d[0]||e.e>17)return new p(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(t==null?(P=!1,l=d):l=t,o=new p(.03125);e.e>-2;)e=e.times(o),f+=5;for(r=Math.log(ue(2,f))/Math.LN10*2+5|0,l+=r,i=s=a=new p(1),p.precision=l;;){if(s=A(s.times(e),l,1),i=i.times(++c),o=a.plus(H(s,i,l,1)),Ne(o.d).slice(0,l)===Ne(a.d).slice(0,l)){for(n=f;n--;)a=A(a.times(a),l,1);if(t==null)if(u<3&&Fi(a.d,l-r,h,u))p.precision=l+=10,i=s=o=new p(1),c=0,u++;else return A(a,p.precision=d,h,P=!0);else return p.precision=d,a}a=o}}function Ft(e,t){var i,r,n,s,a,o,l,u,c,f,p,h=1,d=10,y=e,x=y.d,T=y.constructor,C=T.rounding,I=T.precision;if(y.s<0||!x||!x[0]||!y.e&&x[0]==1&&x.length==1)return new T(x&&!x[0]?-1/0:y.s!=1?NaN:x?0:y);if(t==null?(P=!1,c=I):c=t,T.precision=c+=d,i=Ne(x),r=i.charAt(0),Math.abs(s=y.e)<15e14){for(;r<7&&r!=1||r==1&&i.charAt(1)>3;)y=y.times(e),i=Ne(y.d),r=i.charAt(0),h++;s=y.e,r>1?(y=new T("0."+i),s++):y=new T(r+"."+i.slice(1))}else return u=vr(T,c+2,I).times(s+""),y=Ft(new T(r+"."+i.slice(1)),c-d).plus(u),T.precision=I,t==null?A(y,I,C,P=!0):y;for(f=y,l=a=y=H(y.minus(1),y.plus(1),c,1),p=A(y.times(y),c,1),n=3;;){if(a=A(a.times(p),c,1),u=l.plus(H(a,new T(n),c,1)),Ne(u.d).slice(0,c)===Ne(l.d).slice(0,c))if(l=l.times(2),s!==0&&(l=l.plus(vr(T,c+2,I).times(s+""))),l=H(l,new T(h),c,1),t==null)if(Fi(l.d,c-d,C,o))T.precision=c+=d,u=a=y=H(f.minus(1),f.plus(1),c,1),p=A(y.times(y),c,1),n=o=1;else return A(l,T.precision=I,C,P=!0);else return T.precision=I,l;l=u,n+=2}}function Ta(e){return String(e.s*e.s/0)}function xr(e,t){var i,r,n;for((i=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(i<0&&(i=r),i+=+t.slice(r+1),t=t.substring(0,r)):i<0&&(i=t.length),r=0;t.charCodeAt(r)===48;r++);for(n=t.length;t.charCodeAt(n-1)===48;--n);if(t=t.slice(r,n),t){if(n-=r,e.e=i=i-r-1,e.d=[],r=(i+1)%D,i<0&&(r+=D),r<n){for(r&&e.d.push(+t.slice(0,r)),n-=D;r<n;)e.d.push(+t.slice(r,r+=D));t=t.slice(r),r=D-t.length}else r-=n;for(;r--;)t+="0";e.d.push(+t),P&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function hc(e,t){var i,r,n,s,a,o,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Na.test(t))return xr(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(lc.test(t))i=16,t=t.toLowerCase();else if(oc.test(t))i=2;else if(uc.test(t))i=8;else throw Error(Dt+t);for(s=t.search(/p/i),s>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),s=t.indexOf("."),a=s>=0,r=e.constructor,a&&(t=t.replace(".",""),o=t.length,s=o-s,n=wa(r,new r(i),s,s*2)),u=yr(t,i,Ye),c=u.length-1,s=c;u[s]===0;--s)u.pop();return s<0?new r(e.s*0):(e.e=br(u,c),e.d=u,P=!1,a&&(e=H(e,n,o*4)),l&&(e=e.times(Math.abs(l)<54?ue(2,l):Z.pow(2,l))),P=!0,e)}function mc(e,t){var i,r=t.d.length;if(r<3)return t.isZero()?t:fi(e,2,t,t);i=1.4*Math.sqrt(r),i=i>16?16:i|0,t=t.times(1/Nr(5,i)),t=fi(e,2,t,t);for(var n,s=new e(5),a=new e(16),o=new e(20);i--;)n=t.times(t),t=t.times(s.plus(n.times(a.times(n).minus(o))));return t}function fi(e,t,i,r,n){var s,a,o,l,u=e.precision,c=Math.ceil(u/D);for(P=!1,l=i.times(i),o=new e(r);;){if(a=H(o.times(l),new e(t++*t++),u,1),o=n?r.plus(a):r.minus(a),r=H(a.times(l),new e(t++*t++),u,1),a=o.plus(r),a.d[c]!==void 0){for(s=c;a.d[s]===o.d[s]&&s--;);if(s==-1)break}s=o,o=r,r=a,a=s}return P=!0,a.d.length=c+1,a}function Nr(e,t){for(var i=e;--t;)i*=e;return i}function Ea(e,t){var i,r=t.s<0,n=ut(e,e.precision,1),s=n.times(.5);if(t=t.abs(),t.lte(s))return yt=r?4:1,t;if(i=t.divToInt(n),i.isZero())yt=r?3:2;else{if(t=t.minus(i.times(n)),t.lte(s))return yt=ka(i)?r?2:3:r?4:1,t;yt=ka(i)?r?1:4:r?3:2}return t.minus(n).abs()}function On(e,t,i,r){var n,s,a,o,l,u,c,f,p,h=e.constructor,d=i!==void 0;if(d?(Pe(i,1,qt),r===void 0?r=h.rounding:Pe(r,0,8)):(i=h.precision,r=h.rounding),!e.isFinite())c=Ta(e);else{for(c=lt(e),a=c.indexOf("."),d?(n=2,t==16?i=i*4-3:t==8&&(i=i*3-2)):n=t,a>=0&&(c=c.replace(".",""),p=new h(1),p.e=c.length-a,p.d=yr(lt(p),10,n),p.e=p.d.length),f=yr(c,10,n),s=l=f.length;f[--l]==0;)f.pop();if(!f[0])c=d?"0p+0":"0";else{if(a<0?s--:(e=new h(e),e.d=f,e.e=s,e=H(e,p,i,r,0,n),f=e.d,s=e.e,u=ya),a=f[i],o=n/2,u=u||f[i+1]!==void 0,u=r<4?(a!==void 0||u)&&(r===0||r===(e.s<0?3:2)):a>o||a===o&&(r===4||u||r===6&&f[i-1]&1||r===(e.s<0?8:7)),f.length=i,u)for(;++f[--i]>n-1;)f[i]=0,i||(++s,f.unshift(1));for(l=f.length;!f[l-1];--l);for(a=0,c="";a<l;a++)c+=qn.charAt(f[a]);if(d){if(l>1)if(t==16||t==8){for(a=t==16?4:3,--l;l%a;l++)c+="0";for(f=yr(c,n,t),l=f.length;!f[l-1];--l);for(a=1,c="1.";a<l;a++)c+=qn.charAt(f[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}c=(t==16?"0x":t==2?"0b":t==8?"0o":"")+c}return e.s<0?"-"+c:c}function Ia(e,t){if(e.length>t)return e.length=t,!0}function gc(e){return new this(e).abs()}function dc(e){return new this(e).acos()}function yc(e){return new this(e).acosh()}function bc(e,t){return new this(e).plus(t)}function vc(e){return new this(e).asin()}function xc(e){return new this(e).asinh()}function Nc(e){return new this(e).atan()}function _c(e){return new this(e).atanh()}function wc(e,t){e=new this(e),t=new this(t);var i,r=this.precision,n=this.rounding,s=r+4;return!e.s||!t.s?i=new this(NaN):!e.d&&!t.d?(i=ut(this,s,1).times(t.s>0?.25:.75),i.s=e.s):!t.d||e.isZero()?(i=t.s<0?ut(this,r,n):new this(0),i.s=e.s):!e.d||t.isZero()?(i=ut(this,s,1).times(.5),i.s=e.s):t.s<0?(this.precision=s,this.rounding=1,i=this.atan(H(e,t,s,1)),t=ut(this,s,1),this.precision=r,this.rounding=n,i=e.s<0?i.minus(t):i.plus(t)):i=this.atan(H(e,t,s,1)),i}function kc(e){return new this(e).cbrt()}function Sc(e){return A(e=new this(e),e.e+1,2)}function Tc(e,t,i){return new this(e).clamp(t,i)}function Ec(e){if(!e||typeof e!="object")throw Error(dr+"Object expected");var t,i,r,n=e.defaults===!0,s=["precision",1,qt,"rounding",0,8,"toExpNeg",-ci,0,"toExpPos",0,ci,"maxE",0,ci,"minE",-ci,0,"modulo",0,9];for(t=0;t<s.length;t+=3)if(i=s[t],n&&(this[i]=Dn[i]),(r=e[i])!==void 0)if(Ee(r)===r&&r>=s[t+1]&&r<=s[t+2])this[i]=r;else throw Error(Dt+i+": "+r);if(i="crypto",n&&(this[i]=Dn[i]),(r=e[i])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[i]=!0;else throw Error(va);else this[i]=!1;else throw Error(Dt+i+": "+r);return this}function Ic(e){return new this(e).cos()}function Mc(e){return new this(e).cosh()}function Ma(e){var t,i,r;function n(s){var a,o,l,u=this;if(!(u instanceof n))return new n(s);if(u.constructor=n,Aa(s)){u.s=s.s,P?!s.d||s.e>n.maxE?(u.e=NaN,u.d=null):s.e<n.minE?(u.e=0,u.d=[0]):(u.e=s.e,u.d=s.d.slice()):(u.e=s.e,u.d=s.d?s.d.slice():s.d);return}if(l=typeof s,l==="number"){if(s===0){u.s=1/s<0?-1:1,u.e=0,u.d=[0];return}if(s<0?(s=-s,u.s=-1):u.s=1,s===~~s&&s<1e7){for(a=0,o=s;o>=10;o/=10)a++;P?a>n.maxE?(u.e=NaN,u.d=null):a<n.minE?(u.e=0,u.d=[0]):(u.e=a,u.d=[s]):(u.e=a,u.d=[s]);return}if(s*0!==0){s||(u.s=NaN),u.e=NaN,u.d=null;return}return xr(u,s.toString())}if(l==="string")return(o=s.charCodeAt(0))===45?(s=s.slice(1),u.s=-1):(o===43&&(s=s.slice(1)),u.s=1),Na.test(s)?xr(u,s):hc(u,s);if(l==="bigint")return s<0?(s=-s,u.s=-1):u.s=1,xr(u,s.toString());throw Error(Dt+s)}if(n.prototype=b,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=Ec,n.clone=Ma,n.isDecimal=Aa,n.abs=gc,n.acos=dc,n.acosh=yc,n.add=bc,n.asin=vc,n.asinh=xc,n.atan=Nc,n.atanh=_c,n.atan2=wc,n.cbrt=kc,n.ceil=Sc,n.clamp=Tc,n.cos=Ic,n.cosh=Mc,n.div=Ac,n.exp=$c,n.floor=Cc,n.hypot=qc,n.ln=Dc,n.log=Pc,n.log10=Oc,n.log2=Fc,n.max=zc,n.min=Lc,n.mod=Rc,n.mul=Vc,n.pow=Bc,n.random=Zc,n.round=Uc,n.sign=Gc,n.sin=jc,n.sinh=Wc,n.sqrt=Hc,n.sub=Qc,n.sum=Yc,n.tan=Jc,n.tanh=Kc,n.trunc=Xc,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(i=r[t++])||(e[i]=this[i]);return n.config(e),n}function Ac(e,t){return new this(e).div(t)}function $c(e){return new this(e).exp()}function Cc(e){return A(e=new this(e),e.e+1,3)}function qc(){var e,t,i=new this(0);for(P=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)i.d&&(i=i.plus(t.times(t)));else{if(t.s)return P=!0,new this(1/0);i=t}return P=!0,i.sqrt()}function Aa(e){return e instanceof Z||e&&e.toStringTag===xa||!1}function Dc(e){return new this(e).ln()}function Pc(e,t){return new this(e).log(t)}function Fc(e){return new this(e).log(2)}function Oc(e){return new this(e).log(10)}function zc(){return Sa(this,arguments,-1)}function Lc(){return Sa(this,arguments,1)}function Rc(e,t){return new this(e).mod(t)}function Vc(e,t){return new this(e).mul(t)}function Bc(e,t){return new this(e).pow(t)}function Zc(e){var t,i,r,n,s=0,a=new this(1),o=[];if(e===void 0?e=this.precision:Pe(e,1,qt),r=Math.ceil(e/D),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));s<r;)n=t[s],n>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=n%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);s<r;)n=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((t[s+3]&127)<<24),n>=214e7?crypto.randomBytes(4).copy(t,s):(o.push(n%1e7),s+=4);s=r/4}else throw Error(va);else for(;s<r;)o[s++]=Math.random()*1e7|0;for(r=o[--s],e%=D,r&&e&&(n=ue(10,D-e),o[s]=(r/n|0)*n);o[s]===0;s--)o.pop();if(s<0)i=0,o=[0];else{for(i=-1;o[0]===0;i-=D)o.shift();for(r=1,n=o[0];n>=10;n/=10)r++;r<D&&(i-=D-r)}return a.e=i,a.d=o,a}function Uc(e){return A(e=new this(e),e.e+1,this.rounding)}function Gc(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function jc(e){return new this(e).sin()}function Wc(e){return new this(e).sinh()}function Hc(e){return new this(e).sqrt()}function Qc(e,t){return new this(e).sub(t)}function Yc(){var e=0,t=arguments,i=new this(t[e]);for(P=!1;i.s&&++e<t.length;)i=i.plus(t[e]);return P=!0,A(i,this.precision,this.rounding)}function Jc(e){return new this(e).tan()}function Kc(e){return new this(e).tanh()}function Xc(e){return A(e=new this(e),e.e+1,1)}b[Symbol.for("nodejs.util.inspect.custom")]=b.toString,b[Symbol.toStringTag]="Decimal";var Z=b.constructor=Ma(Dn);mr=new Z(mr),gr=new Z(gr);var _r=Z,Fe="\x1B[0m",Oi="\x1B[30;1m",ef="\x1B[33m",$a="\x1B[34;1m",wr="\x1B[36;1m",tf="\x1B[101;97m",zn="\x1B[1m",Ln;function Ca(e){if(!Ln){let t=`^[${["Zyyy","Zinh","Arab","Armn","Beng","Bopo","Cyrl","Deva","Ethi","Geor","Grek","Gujr","Guru","Hang","Hani","Hebr","Hira","Kana","Knda","Khmr","Laoo","Latn","Mlym","Mymr","Orya","Sinh","Taml","Telu","Thaa","Thai","Tibt"].map(i=>`\\p{Script=${i}}`).join("")}]*$`;Ln=new RegExp(t,"u")}return Ln.test(e)}function Le(e){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)||kr.test(e)?!0:Ca(e)?new RegExp("^[\\p{XIDS}_]\\p{XIDC}*$","u").test(e):!1}var rf="\\u{FE0F}",nf="\\u{20E3}",sf="\\u{200D}",af="\\p{RI}\\p{RI}",of="(?:[\\u{E0020}-\\u{E007E}]+\\u{E007F})",qa=`(?:\\p{EMod}|${rf}${nf}?|${of})`,lf="(?:(?=\\P{XIDC})\\p{Emoji})",Da=`(?:${lf}${qa}*|\\p{Emoji}${qa}+|${af})`,Pa=`(?:${Da})(${sf}${Da})*`,uf=new RegExp(`(?:${Pa})+`,"u"),kr=new RegExp(`^(?:${Pa})+$`,"u");function Yt(e){return typeof e!="string"?"not-a-string":e===""?"empty-string":e.normalize()!==e?"expected-nfc":/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/.test(e)?"unexpected-bidi-marker":kr.test(e)?"valid":new RegExp("\\p{XIDC}","u").test(e)&&uf.test(e)?"unexpected-mixed-emoji":Ca(e)?Le(e)?"valid":Le(e[0])?"invalid-char":"invalid-first-char":"unexpected-script"}var Rn=["number","finite_number","complex","finite_complex","imaginary","real","finite_real","rational","finite_rational","integer","finite_integer","non_finite_number"],Fa=["indexed_collection","list","tuple"],Vn=[...Fa,"collection","set","record","dictionary"],Bn=["scalar",...Rn,"boolean","string"],Oa=["value",...Vn,...Bn],za=["expression","symbol","function",...Oa],Sr=["any","unknown","nothing","never","error",...za],cf={number:Rn,non_finite_number:[],finite_number:["finite_complex","finite_real","finite_integer","finite_rational"],complex:["finite_complex","imaginary","finite_real","finite_rational","finite_integer","non_finite_number"],finite_complex:["imaginary","finite_real","finite_rational","finite_integer"],imaginary:[],real:["rational","integer","finite_real","finite_rational","finite_integer","non_finite_number"],finite_real:["finite_rational","finite_integer"],rational:["finite_rational","finite_integer","integer","non_finite_number"],finite_rational:["finite_integer"],integer:["finite_integer","non_finite_number"],finite_integer:[],any:Sr,unknown:[],nothing:[],never:[],error:[],value:Oa,scalar:Bn,collection:Vn,indexed_collection:Fa,list:[],set:[],tuple:[],record:[],dictionary:[],function:[],symbol:[],boolean:[],string:[],expression:za};function zi(e,t){return t==="any"||e==="never"?!0:e==="unknown"||t==="unknown"?!1:e===t?!0:cf[t].includes(e)}function _(e,t){if(typeof e=="string"&&(e=R(e)),typeof t=="string"&&(t=R(t)),t==="any")return!0;if(t==="never")return!1;if(t==="error")return e==="error";if(t==="nothing")return e==="nothing";if(e==="nothing")return!1;if(t==="unknown")return!0;if(e==="unknown")return!1;if(typeof t=="string")return typeof e=="string"?zi(e,t):e.kind==="value"?typeof e.value=="boolean"?t==="boolean":typeof e.value=="number"?Number.isInteger(e.value)?zi("integer",t):zi("number",t):typeof e.value=="boolean"?zi("boolean",t):typeof e.value=="string"?zi("string",t):!1:e.kind==="union"?e.types.every(i=>_(i,t)):e.kind==="intersection"?e.types.some(i=>_(i,t)):e.kind==="negation"?!_(e.type,t):e.kind==="numeric"?!!_(e.type,t):t==="number"?La(e):t==="symbol"?Zn(e):t==="expression"?ff(e):t==="function"?Ua(e):t==="scalar"?Ra(e):t==="value"?Za(e):t==="indexed_collection"?Ba(e):t==="collection"?Va(e):t==="tuple"?e.kind==="tuple":t==="list"?e.kind==="list":t==="set"?e.kind==="set":t==="record"?e.kind==="record":t==="dictionary"?e.kind==="dictionary":!1;if(t.kind==="union")return typeof e!="string"&&e.kind==="union"?e.types.every(i=>t.types.some(r=>_(i,r))):t.types.some(i=>_(e,i));if(t.kind==="expression"){if(e==="symbol")return!0;if(typeof e=="string")return!1;if(e.kind==="expression")return t.operator==="Symbol"?Zn(e):e.operator===t.operator;if(e.kind==="symbol")return!0}if(typeof e=="string")return!1;if(t.kind==="reference"){if(e.kind==="reference")return e.name===t.name;if(t.alias===!0&&t.def)return _(e,t.def)}if(e.kind==="union")return e.types.some(i=>_(i,t));if(e.kind==="intersection"&&t.kind==="intersection")return t.types.every(i=>e.types.some(r=>_(r,i)));if(e.kind==="intersection")return e.types.every(i=>_(i,t));if(t.kind==="intersection")return t.types.every(i=>_(e,i));if(e.kind==="signature"&&t.kind==="signature"){if(!_(e.result,t.result))return!1;if(e.optArgs||e.variadicArg){if(t.args){if(!e.args||e.args.length!==t.args.length)return!1;for(let i=0;i<t.args.length;i++)if(!_(t.args[i].type,e.args[i].type))return!1}else if(e.args)return!1;if(t.optArgs){if(!e.optArgs||e.optArgs.length!==t.optArgs.length)return!1;for(let i=0;i<e.optArgs.length;i++)if(!_(t.optArgs[i].type,e.optArgs[i].type))return!1}else if(e.optArgs)return!1;if(t.variadicArg){if(!e.variadicArg||e.variadicMin!=t.variadicMin||!_(t.variadicArg.type,e.variadicArg.type))return!1}else if(e.variadicArg)return!1}else{if(t.args&&!e.args)return!1;let i=0;if(t.args){if(e.args.length<t.args.length)return!1;for(;i<t.args.length;){if(!_(t.args[i].type,e.args[i].type))return!1;i+=1}}if(t.optArgs){if(i>=e.args.length)return!0;for(let r=0;r<t.optArgs.length;r++){if(!_(t.optArgs[r].type,e.args[i].type))return!1;if(i+=1,i>=e.args.length)return!0}}if(t.variadicArg){if(i>=e.args.length&&t.variadicMin===0)return!0;if(t.variadicMin>0&&i+t.variadicMin>e.args.length)return!1;for(;i<e.args.length;){if(!_(t.variadicArg.type,e.args[i].type))return!1;i+=1}}}return!0}if(e.kind==="record"&&t.kind==="record"){for(let i of Object.keys(t.elements))if(!(i in e.elements)||!_(e.elements[i],t.elements[i]))return!1;return!0}if(e.kind==="dictionary"&&t.kind==="dictionary")return _(e.values,t.values);if(t.kind==="indexed_collection")return e.kind==="indexed_collection"||e.kind==="list"?_(e.elements,t.elements):e.kind==="tuple"?e.elements.every(i=>_(i.type,t.elements)):!1;if(t.kind==="collection"){if(e.kind==="collection"||e.kind==="indexed_collection"||e.kind==="list")return _(e.elements,t.elements);if(e.kind==="tuple")return e.elements.every(i=>_(i.type,t.elements));if(e.kind==="set")return _(e.elements,t.elements);if(e.kind==="dictionary")return _(R(`tuple<string, ${Q(e.values)}>`),t.elements);if(e.kind==="record")return _(R(`tuple<$string, ${Q($e(...Object.values(e.elements)))}>`),t.elements)}if(e.kind==="tuple"&&t.kind==="tuple"){if(e.elements.length!==t.elements.length)return!1;for(let i=0;i<e.elements.length;i++){let r=e.elements[i],n=t.elements[i];if(!_(r.type,n.type)||r.name!==n.name)return!1}return!0}if(t.kind==="list"&&e.kind==="list"){if(!_(e.elements,t.elements))return!1;if(t.dimensions){if(!e.dimensions||e.dimensions.length!==t.dimensions.length)return!1;for(let i=0;i<e.dimensions.length;i++)if(t.dimensions[i]!==-1&&e.dimensions[i]!==t.dimensions[i])return!1}return!0}if(e.kind==="symbol"&&t.kind==="symbol")return e.name===t.name;if(e.kind==="numeric"&&t.kind==="numeric")return!(!_(e.type,t.type)||(e.lower??-1/0)<(t.lower??-1/0)||(e.upper??1/0)>(t.upper??1/0));if(t.kind==="set"&&e.kind==="set")return!!_(e.elements,t.elements);if(e.kind==="negation"&&t.kind==="negation")return _(e.type,t.type);if(t.kind==="negation")return!_(e,t.type);if(t.kind==="value"&&e.kind==="value")return t.value===e.value;if(e.kind==="value"){if(typeof e.value=="boolean")return _("boolean",t);if(typeof e.value=="number")return Number.isInteger(e.value)?_("integer",t):_("real",t);if(typeof e.value=="string")return _("string",t)}return!1}function La(e){return typeof e=="string"?Rn.includes(e):e.kind==="value"?typeof e.value=="number":e.kind==="numeric"}function Ra(e){return La(e)?!0:typeof e=="string"?Bn.includes(e):e.kind==="value"?["string","boolean","number"].includes(typeof e.value):!1}function Va(e){return Ba(e)?!0:typeof e=="string"?Vn.includes(e):["collection","set","record","dictionary"].includes(e.kind)}function Ba(e){return typeof e=="string"?!1:["indexed_collection","list","tuple"].includes(e.kind)}function Za(e){return Ra(e)||Va(e)}function Ua(e){return e==="function"||typeof e!="string"&&e.kind==="signature"}function ff(e){return typeof e=="string"&&["expression","symbol","function"].includes(e)||Za(e)||Ua(e)||Zn(e)?!0:typeof e=="string"?!1:e.kind==="expression"}function Zn(e){return e==="symbol"?!0:typeof e=="string"?!1:e.kind==="symbol"?!0:e.kind==="expression"?e.operator==="Symbol":!1}var Ga=3,ja=1,Wa=2,pf=4,hf=5,mf=6,gf=7,df=8,yf=9,bf=10,vf=11;function Q(e,t=0){if(typeof e=="string")return e;let i="";switch(e.kind){case"value":typeof e.value=="string"?i=`"${e.value}"`:typeof e.value=="boolean"?i=e.value?"true":"false":i=e.value.toString();break;case"reference":i=e.name;break;case"negation":i=`!${Q(e.type,Ga)}`;break;case"union":i=e.types.map(a=>Q(a,ja)).join(" | ");break;case"intersection":i=e.types.map(a=>Q(a,Wa)).join(" & ");break;case"expression":i=`expression<${Ha(e.operator)}>`;break;case"symbol":i=`symbol<${Ha(e.name)}>`;break;case"numeric":Number.isFinite(e.lower)&&Number.isFinite(e.upper)?i=`${e.type}<${e.lower}..${e.upper}>`:Number.isFinite(e.lower)?i=`${e.type}<${e.lower}..>`:Number.isFinite(e.upper)?i=`${e.type}<..${e.upper}>`:i=`${e.type}`;break;case"list":if(e.dimensions&&_(e.elements,"number")){if(e.dimensions===void 0)e.elements==="number"&&(i="tensor");else if(e.dimensions.length===1)e.elements==="number"?e.dimensions[0]<0?i="vector":i=`vector<${e.dimensions[0]}>`:e.dimensions[0]<0?i=`vector<${Q(e.elements)}>`:i=`vector<${Q(e.elements)}^${e.dimensions[0]}>`;else if(e.dimensions.length===2){let a=e.dimensions;e.elements==="number"?a[0]<0&&a[1]<0?i="matrix":i=`matrix<${a[0]}x${a[1]}>`:a[0]<0&&a[1]<0?i=`matrix<${Q(e.elements)}>`:i=`matrix<${Q(e.elements)}^(${a[0]}x${a[1]})>`}}if(!i){let a=e.dimensions?e.dimensions.length===1?`^${e.dimensions[0].toString()}`:`^(${e.dimensions.join("x")})`:"";i=`list<${Q(e.elements)}${a}>`}break;case"record":i=`record<${Object.entries(e.elements).map(([a,o])=>`${a}: ${Q(o)}`).join(", ")}>`;break;case"dictionary":i=`dictionary<${Q(e.values)}>`;break;case"set":i=`set<${Q(e.elements)}>`;break;case"collection":i=`collection<${Q(e.elements)}>`;break;case"indexed_collection":i=`indexed_collection<${Q(e.elements)}>`;break;case"tuple":if(e.elements.length===0)i="tuple";else if(e.elements.length===1){let[a]=e.elements;i=`tuple<${pi(a)}>`}else i="tuple<"+e.elements.map(a=>pi(a)).join(", ")+">";break;case"signature":let r=e.args?e.args.map(a=>pi(a)).join(", "):"",n=e.optArgs?e.optArgs.map(a=>pi(a)+"?").join(", "):"",s=e.variadicArg?e.variadicMin===0?`${pi(e.variadicArg)}*`:`${pi(e.variadicArg)}+`:"";i=`(${[r,n,s].filter(a=>a).join(", ")}) -> ${Q(e.result)}`;break;default:i="error"}return t>0&&t>xf(e.kind)?`(${i})`:i}function pi(e){return e.name?`${e.name}: ${Q(e.type)}`:Q(e.type)}function Ha(e){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)?e:`\`${e}\``}function xf(e){switch(e){case"negation":return Ga;case"union":return ja;case"intersection":return Wa;case"list":return pf;case"record":return hf;case"dictionary":return mf;case"set":return gf;case"collection":case"indexed_collection":return df;case"tuple":return yf;case"signature":return bf;case"value":return vf;default:return 0}}function Nf(e,t){if(e===t)return 0;if(e.length===0)return t.length;if(t.length===0)return e.length;let i=Array.from({length:e.length+1},(n,s)=>s),r=new Array(e.length+1);for(let n=1;n<=t.length;n++){r[0]=n;for(let s=1;s<=e.length;s++){let a=e[s-1]===t[n-1]?0:1;r[s]=Math.min(i[s]+1,r[s-1]+1,i[s-1]+a)}[i,r]=[r,i]}return i[e.length]}function Un(e,t){let i=null,r=1/0,n=e.length;for(let s of t){if(Math.abs(n-s.length)>7)continue;let a=Nf(e,s);if(a===0)return s;a<=7&&a<r&&(r=a,i=s)}return i}var _f=class{constructor(e,t){m(this,"buffer");m(this,"pos");m(this,"_valueParser");m(this,"_typeResolver");this.buffer=e,this.pos=0,this._valueParser=(t==null?void 0:t.valueParser)??(()=>null),this._typeResolver=(t==null?void 0:t.typeResolver)??{forward:()=>{},resolve:()=>{},get names(){return[]}}}error(...e){throw new Error(`
Invalid type
|   ${this.buffer}
|   ${" ".repeat(this.pos)}^
|   
|   ${e.filter(t=>t!==void 0).join(`
|   `)}
`)}peek(){return this.buffer[this.pos]}consume(){return this.buffer[this.pos++]}match(e){if(e.length===1&&this.buffer[this.pos]===e)return this.pos++,!0;let t=this.pos;return this.buffer.slice(t,t+e.length)===e?(this.pos+=e.length,!0):!1}expectClosingBracket(){this.skipWhitespace(),this.match(">")||this.error('Expected ">".')}skipWhitespace(){for(;this.pos<this.buffer.length&&/\s/.test(this.buffer[this.pos]);)this.pos++}isEOF(){return this.pos>=this.buffer.length}parseValue(){let e=this.pos;this.skipWhitespace();let t=this._valueParser(this);return t!==null?{kind:"value",value:t}:(this.pos=e,null)}parseTypeReference(){let e=this.pos;this.skipWhitespace();let t=this.match("type");this.skipWhitespace();let i=this.parseIdentifier();if(i!==null){let r=this._typeResolver.resolve(i);if(r)return r;if(t){let n=this._typeResolver.forward(i);if(n)return n}}return this.pos=e,null}parsePrimitiveType(){this.skipWhitespace(),this.isEOF()&&this.error("Unexpected end of input");for(let e of Sr)if(this.match(e))return e;return null}parseArguments(){let e=[],t=[],i,r,n=this.pos;for(;;){let a=this.parseNamedElement();if(a===null){if(this.skipWhitespace(),this.peek()===")")break;this.pos=n,this.skipWhitespace(),this.match(",")&&this.error('Expected a valid argument after ","');break}if(this.match("?")?(i!==void 0&&this.error("Optional arguments cannot be used with variadic arguments"),t.push(a)):this.match("*")?(t.length>0&&this.error("Variadic arguments cannot be used with optional arguments"),i!==void 0&&this.error("There can be only one variadic argument"),i=0,r=a):this.match("+")?(t.length>0&&this.error("Variadic arguments cannot be used with optional arguments"),i!==void 0&&this.error("There can be only one variadic argument"),i=1,r=a):(t.length>0&&this.error("Optional arguments must come after required arguments"),i!==void 0&&this.error("Variadic arguments must come last"),e.push(a)),this.skipWhitespace(),n=this.pos,!this.match(","))break}let s=wf([...e,...t,...r?[r]:[]]);return s&&this.error(`Duplicate argument name "${s}"`),[e,t,r,i]}parseFunctionSignature(){let e=[],t=[],i,r;this.skipWhitespace();let n=this.pos;if(this.match("()")||this.match("(")&&([e,t,i,r]=this.parseArguments(),this.skipWhitespace(),this.match(")")||this.error("Expected a closing parenthesis `)` after arguments.")),this.skipWhitespace(),!this.match("->"))return this.pos=n,null;this.skipWhitespace(),this.isEOF()&&this.error("Expected a return type after `->`.","Use `any` for any type or `nothing` for no return value, or `never` for a function that never returns");let s=this.parseType();return s===null&&this.error("Expected a return type after `->`.","Use `any` for any type or `nothing` for no return value, or `never` for a function that never returns",this.parseUnexpectedToken()),e.length===0&&(e=void 0),t.length===0&&(t=void 0),!t&&!i?{kind:"signature",args:e,result:s}:!t&&i?{kind:"signature",args:e,variadicArg:i,variadicMin:r,result:s}:{kind:"signature",args:e,optArgs:t,variadicArg:i,variadicMin:r,result:s}}parsePositiveIntegerLiteral(){let e=0;for(this.skipWhitespace();/[0-9]/.test(this.peek());)e=e*10+parseInt(this.consume());return e===0?null:e}parseOptionalDimension(){let e=this.parsePositiveIntegerLiteral();return e===null&&this.match("?")&&(e=-1),e}parseDimensions(){let e=this.pos,t=this.match("("),i=[],r=this.parseOptionalDimension();if(r===null){this.pos=e;return}do{if(i.push(r),this.skipWhitespace(),!this.match("x"))break;this.skipWhitespace(),r=this.parseOptionalDimension(),r===null&&this.error("Expected a positive integer literal or `?`.","For example : `matrix<integer^2x3>` or `matrix<integer^?x?>`")}while(!0);return this.skipWhitespace(),t&&!this.match(")")&&this.error('Expected ")".',"For example `matrix<integer^(2x3)>`"),i}parseList(){if(this.skipWhitespace(),this.match("list<")){let i=this.parseDimensions();if(i!==void 0)return this.expectClosingBracket(),{kind:"list",elements:"any",dimensions:i};let r=this.parseTypeMaybe();return r&&this.match("^")&&(i=this.parseDimensions(),i===void 0&&this.error("Expected dimensions after `^`.","For example `list<number^2x3>`")),r||this.error("Expected a type after `list<`.","Use `list<any>` for a list of any type","For example `list<number>` or `list<string>`"),this.expectClosingBracket(),{kind:"list",elements:r??"any",dimensions:i}}if(this.match("list(")&&this.error("Use `list<type>` instead of `list(type)`.","For example `list<number>`"),this.match("vector<")){let i=this.parseType(),r;if(i&&this.match("^")){let n=this.parsePositiveIntegerLiteral();n===null&&this.error("Expected a positive integer literal.","For example `vector<3>`","Use `vector` for a vector of unknown size"),r=[n]}else i||(i="number",r=this.parseDimensions());return this.expectClosingBracket(),{kind:"list",elements:i,dimensions:r}}if(this.match("vector(")&&this.error("Use `vector<...>` instead of `vector(...)`.","For example `vector<3>` or `vector<integer^3>`"),this.match("vector"))return{kind:"list",elements:"number"};if(this.match("matrix<")){let i=this.parseType(),r;return i&&this.match("^")?(r=this.parseDimensions(),r===void 0&&this.error("Expected dimensions","For example `matrix<number^2x3>`","Use `matrix` for a matrix of unknown size")):i||(i="number",r=this.parseDimensions()),this.expectClosingBracket(),{kind:"list",elements:i,dimensions:r}}if(this.match("matrix(")&&this.error("Use `matrix<...>` instead of `matrix(...)`.","For example `matrix<3x2>` or `matrix<integer^3x2>`"),this.match("matrix"))return{kind:"list",elements:"number",dimensions:[-1,-1]};if(this.match("tensor<")){let i=this.parseType()??"number";return this.expectClosingBracket(),{kind:"list",elements:i,dimensions:void 0}}if(this.match("tensor"))return{kind:"list",elements:"number",dimensions:void 0};if(!this.match("list<"))return null;let e=this.parseTypeMaybe();e===null&&this.error('Expected a type. Use "[any]" for a collection of any type');let t=this.match("^")?this.parseDimensions():void 0;return this.expectClosingBracket(),{kind:"list",elements:e,dimensions:t}}parseName(){let e=this.pos;if(this.skipWhitespace(),this.isEOF())return null;let t=this.parseVerbatimString();if(t===null){if(!/[a-zA-Z_]/.test(this.peek()))return null;for(t="";!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)t+=this.consume()}if(this.skipWhitespace(),!this.match(":")){if(this.match("?:")){let i=this.parseTypeMaybe();this.error("Optional qualifier must come after the type",`Use "${t}: ${i?Q(i):"number"}?"`)}return this.pos=e,null}return t}parseVerbatimString(){if(this.skipWhitespace(),this.isEOF())return null;let e="";if(this.match("`")){for(;!this.match("`");)this.isEOF()&&this.error("Expected closing backtick"),this.match("\\`")?e+="`":this.match("\\\\")?e+="\\":e+=this.consume();return e}return null}parseIdentifier(){let e=this.parseVerbatimString();if(e!==null)return e;if(/[0-9_]/.test(this.peek()))return null;for(e="";!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)e+=this.consume();return e.length===0?null:e}parseNamedElement(){let e=this.pos,t=this.parseName();if(t!==null){let r=this.parseType();return r===null&&this.error(`Expected a valid type after "${t}:"`,this.parseUnexpectedToken()),this.skipWhitespace(),{name:t,type:r}}let i=this.parseType();return i===null?(this.pos=e,null):{type:i}}parseTupleElements(){let e=[],t=this.pos,i=this.parseNamedElement();if(i===null)return[];let r=i.name!==void 0;for(;e.push(i),this.skipWhitespace(),!!this.match(",");)t=this.pos,i=this.parseNamedElement(),i===null&&(this.pos=t,this.error("Expected a type or unexpected comma")),r&&!i.name&&(this.pos=t,this.error("All tuple elements should be named, or none.","Previous elements were named, but this one isn't.")),!r&&i.name&&(this.pos=t,this.error("All tuple elements should be named, or none.","Previous elements were not named, but this one is."));return e}parseTuple(){if(this.skipWhitespace(),!this.match("tuple<"))return this.match("tuple(")&&this.error("Use `tuple<type>` instead of `tuple(type)`.","For example `tuple<number, boolean>` or `tuple<x: integer, y: integer>`"),null;let e=this.parseTupleElements();return this.expectClosingBracket(),{kind:"tuple",elements:e}}parseGroup(){let e=this.pos;if(this.skipWhitespace(),!this.match("("))return null;let t=this.parseType();return t===null?(this.pos=e,null):(this.skipWhitespace(),this.match(")")&&(this.skipWhitespace(),!this.match("->"))?t:(this.pos=e,null))}parseSet(){if(this.skipWhitespace(),!this.match("set<")){if(this.match("set(")){let t=this.parseTypeMaybe()??"number";this.error(`Use \`set<${t}>\` instead of \`set(${t})\`.`)}return this.match("set")?"set":null}let e=this.parseTypeMaybe();return e===null&&this.error("Expected a type.","Use `set<number>` for a set of numbers"),this.expectClosingBracket(),{kind:"set",elements:e}}parseRecordKeyValue(){var t;let e=[];for(;;){let i=this.parseIdentifier();i===null&&this.error("Expected a name for the key.","For example `record<key: string>`.","Use backticks for special characters.","For example `record<`duracin`: number>`"),this.skipWhitespace(),this.match(":")||this.error("Expected a type separated by a `:` after the key.",`For example \`record<${Er(i)}: string>\``,"Use backticks for special characters.","For example `record<`duracin`: string>`");let r=this.parseTypeMaybe();if(r===null&&this.error("Expected a type for the value. Use `any` for any type.",`For example \`record<${Er(i)}: any>.\``),e.push([i,r]),this.skipWhitespace(),!this.match(","))break}if(new Set(e.map(([i])=>i)).size!==e.length){let i=(t=e.find(([r],n)=>e.slice(n+1).some(([s])=>s===r)))==null?void 0:t[0];this.error(`Duplicate record key "${i}"`,"Keys in a record must be unique.")}return e}parseRecord(){if(this.skipWhitespace(),this.match("record<")){let e=this.parseRecordKeyValue();if(this.skipWhitespace(),!this.match(">")){let t=e[e.length-1]??["key","number"];this.match("?")&&this.error('Unexpected token "?".',`To indicate an optional key, use a specific type, for example \`record<${Er(t[0])}: ${t[1]} | nothing>\``),this.error("Expected a closing `>`.",`For example \`record<${Er(t[0])}: ${t[1]}>\``)}return{kind:"record",elements:Object.fromEntries(e)}}return this.match("record")?"record":null}parseDictionary(){if(this.match("dictionary<")){this.skipWhitespace();let e=this.parseType();return e===null&&this.error("Expected a type."),this.skipWhitespace(),this.match(",")&&this.error("Dictionary types cannot have keys, only values.","For example `dictionary<string>`"),this.expectClosingBracket(),{kind:"dictionary",values:e}}return this.match("dictionary")?"dictionary":null}parseCollection(){if(this.skipWhitespace(),this.match("indexed_collection<")){let t=this.parseType();return t===null&&this.error("Expected a type.","Use `indexed_collection<number>` for an indexed collection of numbers"),this.expectClosingBracket(),{kind:"indexed_collection",elements:t}}if(this.match("indexed_collection"))return"indexed_collection";if(!this.match("collection<"))return this.match("collection(")&&this.error("Use `collection<type>` instead of `collection(type)`.","For example `collection<number>`"),this.match("collection")?"collection":null;let e=this.parseType();return e===null&&this.error("Expected a type.","Use `collection<number>` for a collection of numbers"),this.expectClosingBracket(),{kind:"collection",elements:e}}parseExpression(){if(!this.match("expression<"))return null;let e=this.parseIdentifier();return e===null&&this.error("Expected the name of the operator for the expression.","For example `expression<Multiply>`.","Use backticks for special characters.","For example `expression<``>`"),this.expectClosingBracket(),{kind:"expression",operator:e}}parseSymbol(){if(!this.match("symbol<"))return null;let e=this.parseIdentifier();return e===null&&this.error("Expected a name for the symbol.","For example `symbol<True>`.","Use backticks for special characters.","For example `symbol<``>`"),this.expectClosingBracket(),{kind:"symbol",name:e}}parseNumericType(){let e=i=>{if(i.skipWhitespace(),i.match(".."))return-1/0;let r=Tr(i);if(typeof r!="number"&&i.error("Expected a number"),i.skipWhitespace(),i.match(".."))return r;i.error('Expected ".." after lower bound',"For example `integer<-oo..10>` or `integer<0..10>`")},t=i=>{if(i.skipWhitespace(),i.match(">"))return;let r=Tr(i);return typeof r!="number"&&i.error("Expected a number"),i.expectClosingBracket(),r};for(let i of["real","finite_real","rational","finite_rational","integer","finite_integer"]){if(!this.match(i+"<"))continue;let r=e(this)??-1/0,n=t(this)??1/0;return(Number.isNaN(r)||Number.isNaN(n))&&this.error("Invalid numeric type","Lower and upper bounds must be valid numbers"),r===-1/0&&n===1/0?i:(r>n&&this.error(`Invalid range: ${r}..${n}`,"The lower bound must be less than the upper bound"),{kind:"numeric",type:i,lower:r,upper:n})}return null}parseStringType(){return this.match("string")?"string":null}parsePrimary(){let e=this.parseMaybePrimary();if(e===null){let t=this.pos;this.parseNamedElement()!==null&&(this.match("?"),this.match("*"),this.match("+"),this.skipWhitespace(),(this.match("->")||this.match(","))&&this.error("Function arguments must be enclosed in parentheses","For example `(x: number) -> number`"),this.match(")")&&this.error("An opening parenthesis seems to be missing")),this.pos=t,Tr(this)!==null&&this.error("Unexpected value"),this.pos=t,this.error('Unexpected token"',this.parseUnexpectedToken())}return e}parseUnexpectedToken(){let e=this.pos,t,i="";for(;!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)i+=this.consume();if(!i)return;let r=null;return i==="map"&&(r="dictionary"),r??(r=Un(i,[...this._typeResolver.names,...Sr,"vector","matrix"])),r&&(t=`Did you mean "${r}"?`),this.pos=e,t}parseMaybePrimary(){return this.parseGroup()??this.parseNegationType()??this.parseCollection()??this.parseList()??this.parseSet()??this.parseDictionary()??this.parseRecord()??this.parseTuple()??this.parseExpression()??this.parseSymbol()??this.parseNumericType()??this.parseStringType()??this.parsePrimitiveType()??this.parseValue()??this.parseTypeReference()}parseNegationType(){return this.match("!")?{kind:"negation",type:this.parsePrimary()}:null}parseIntersectionType(){let e=this.parseFunctionSignature()??this.parseMaybePrimary();if(e===null)return null;let t=[e];for(this.skipWhitespace();this.match("&");)this.skipWhitespace(),t.push(this.parsePrimary());return t.length===1?t[0]:{kind:"intersection",types:t}}parseUnionType(){let e=this.parseIntersectionType();if(e===null)return null;let t=[e];for(this.skipWhitespace();this.match("|");)e=this.parseIntersectionType(),e===null&&this.error("Expected type"),t.push(e);return t.length===1?t[0]:{kind:"union",types:t}}parseType(){if(this.skipWhitespace(),this.isEOF())return null;if(this.peek()==="("){let e=this.parseFunctionSignature();if(e)return e}return this.parseUnionType()}parseTypeMaybe(){try{return this.parseType()}catch{}return null}parse(){let e=this.parseType();return e===null&&(this.parseIdentifier()!==null&&(this.skipWhitespace(),this.match(":")&&this.error("Function signatures must be enclosed in parentheses","For example `(x: number) -> number`")),this.error("Syntax error. The type was not recognized.")),this.skipWhitespace(),(this.match("->")||this.match("?")||this.match("*")||this.match("+"))&&this.error("Function signatures must be enclosed in parentheses","For example `(x: number) -> number`"),this.isEOF()||this.error("Unexpected character. Could be some mismatched parentheses."),e}};function Tr(e){let t=e.pos;if(e.skipWhitespace(),/["]/.test(e.peek())){let i=e.consume(),r="";for(;e.peek()!==i;)e.isEOF()&&e.error("Expected closing quote"),e.match("\\"+i)?r+=i:r+=e.consume();return e.consume(),r}if(e.match("0x")){let i=0;for(;/[0-9a-fA-F]/.test(e.peek());)i=i*16+parseInt(e.consume(),16);return i}if(e.match("0b")){let i=0;for(;/[01]/.test(e.peek());)i=i*2+parseInt(e.consume());return i}if(/[-0-9\.]/.test(e.peek())){let i=0,r=1;if(e.match("-")&&(r=-1),e.match("+")&&(r=1),!/[0-9]/.test(e.peek()))return e.pos=t,null;for(;/[0-9]/.test(e.peek());)i=i*10+parseInt(e.consume());if(e.peek()==="."){let n=e.pos;if(e.consume(),!/[0-9]/.test(e.peek()))return e.pos=n,r*i;let s=0,a=1;for(;/[0-9]/.test(e.peek());)s=s*10+parseInt(e.consume()),a*=10;i+=s/a}if(e.match("e")||e.match("E")){let n=0,s=1;for(e.match("+")&&(s=1),e.match("-")&&(s=-1);/[0-9]/.test(e.peek());)n=n*10+parseInt(e.consume());i*=Math.pow(10,s*n)}return r*i}return e.match("true")?!0:e.match("false")?!1:e.match("nan")?NaN:e.match("infinity")||e.match("+infinity")||e.match("oo")||e.match("")||e.match("+oo")||e.match("+")?1/0:e.match("-infinity")||e.match("-oo")||e.match("-")?-1/0:e.match("nan")?NaN:(e.pos=t,null)}function R(e,t){return e===void 0?void 0:Mr(e)?e:typeof e!="string"?void 0:new _f(e,{valueParser:Tr,typeResolver:t}).parse()}function wf(e){let t=new Set;for(let{name:i}of e)if(i){if(t.has(i))return i;t.add(i)}return""}function Er(e){return/[^a-zA-Z0-9_]/.test(e)?"`"+e.replace(/`/g,"\\`")+"`":e}function kf(e,t){return e===t?e:e==="nothing"||t==="nothing"?"nothing":e==="any"?t:t==="any"?e:e==="never"?t:t==="never"?e:e==="unknown"?t:t==="unknown"||_(e,t)?e:_(t,e)?t:Ya(e,t)}function Sf(e,t){return e===t?e:e==="any"||t==="any"?"any":e==="never"?t:t==="never"?e:e==="unknown"?t:t==="unknown"?e:e==="nothing"?t:t==="nothing"?e:_(e,t)?t:_(t,e)?e:Ya(e,t)}function Ir(...e){return e.length===0?"nothing":e.length===1?e[0]:e.reduce((t,i)=>kf(t,i))}function $e(...e){return e.length===0?"nothing":e.length===1?e[0]:e.reduce((t,i)=>Sf(t,i))}function Qa(e){return e=typeof e=="string"?R(e):e,typeof e!="string"&&e.kind==="signature"}function Ot(e){if(e){if(e==="function")return"any";if(typeof e!="string"&&e.kind==="signature")return e.result}}function bt(e){if(e==="collection"||e==="indexed_collection"||e==="list"||e==="set"||e==="tuple"||e==="dictionary"||e==="record")return"any";if(typeof e!="string"){if(e.kind==="collection"||e.kind==="indexed_collection"||e.kind==="list"||e.kind==="set")return e.elements;if(e.kind==="tuple")return $e(...e.elements.map(t=>t.type));if(e.kind==="dictionary")return R(`tuple<string, ${e.values}>`);if(e.kind==="record")return R(`tuple<string, ${Q($e(...Object.values(e.elements)))}>`)}}function Tf(e){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)}function Mr(e){return typeof e=="string"?Sr.includes(e):typeof e!="object"||!("kind"in e)?!1:e.kind==="signature"||e.kind==="union"||e.kind==="intersection"||e.kind==="negation"||e.kind==="tuple"||e.kind==="list"||e.kind==="record"||e.kind==="dictionary"||e.kind==="set"||e.kind==="function"||e.kind==="collection"||e.kind==="indexed_collection"||e.kind==="reference"}function Ya(e,t){return e===t?e:e==="any"||t==="any"?"any":e==="never"?t:t==="never"?e:e==="unknown"?t:t==="unknown"?e:e==="nothing"?t:t==="nothing"?e:J(e,t,"non_finite_number")?"non_finite_number":J(e,t,"finite_integer")?"finite_integer":J(e,t,"integer")?"integer":J(e,t,"finite_rational")?"finite_rational":J(e,t,"rational")?"rational":J(e,t,"finite_real")?"finite_real":J(e,t,"real")?"real":J(e,t,"imaginary")?"imaginary":J(e,t,"finite_complex")?"finite_complex":J(e,t,"complex")?"complex":J(e,t,"finite_number")?"finite_number":J(e,t,"number")?"number":J(e,t,"list")?"list":J(e,t,"record")?"record":J(e,t,"dictionary")?"dictionary":J(e,t,"set")?"set":J(e,t,"tuple")?"tuple":J(e,t,"indexed_collection")?"indexed_collection":J(e,t,"collection")?"collection":J(e,t,"scalar")?"scalar":J(e,t,"value")?"value":J(e,t,"function")?"function":J(e,t,"expression")?"expression":"any"}function J(e,t,i){return!!(_(e,i)&&_(t,i))}var $=(O=class{constructor(t,i){m(this,"type");typeof t=="string"?this.type=R(t,i):this.type=t}static widen(...t){return new O($e(...t.map(i=>i instanceof O?i.type:i)))}static narrow(...t){return new O(Ir(...t.map(i=>i instanceof O?i.type:i)))}matches(t){return t instanceof O?_(this.type,t.type):_(this.type,t)}is(t){return _(this.type,t)&&_(t,this.type)}get isUnknown(){return this.type==="unknown"}toString(){return Q(this.type)}toJSON(){return Q(this.type)}[Symbol.toPrimitive](t){return t==="string"?this.toString():null}valueOf(){return Q(this.type)}},m(O,"unknown",new O("unknown")),m(O,"number",new O("number")),m(O,"non_finite_number",new O("non_finite_number")),m(O,"finite_number",new O("finite_number")),m(O,"finite_integer",new O("finite_integer")),m(O,"finite_real",new O("finite_real")),m(O,"string",new O("string")),m(O,"dictionary",new O("dictionary")),m(O,"setNumber",new O("set<number>")),m(O,"setComplex",new O("set<complex>")),m(O,"setImaginary",new O("set<imaginary>")),m(O,"setReal",new O("set<real>")),m(O,"setRational",new O("set<rational>")),m(O,"setFiniteInteger",new O("set<finite_integer>")),m(O,"setInteger",new O("set<integer>")),O);function Ef(e){let t=[],i=(r,n=[])=>{if(r.length===0)t.push(n);else for(let s=0;s<r.length;s++){let a=r.slice(),o=a.splice(s,1);i(a.slice(),n.concat(o))}};return i(e),t}function If(e){for(let t in e)t.startsWith("_")&&e.hasOwnProperty(t)&&Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:e[t]})}var Mf=class{constructor(){m(this,"_listeners",new Array(300));m(this,"_pending",!1);m(this,"_version",0)}listen(e){for(let i of this._listeners)if(i.deref()===e)return()=>this._unsubscribe(e);let t=new WeakRef(e);return this._listeners.push(t),()=>this._unsubscribe(e)}_unsubscribe(e){this._listeners=this._listeners.filter(t=>{let i=t.deref();return i!==void 0&&i!==e})}notify(){if(this._pending)return;this._pending=!0;let e=this._version+1;queueMicrotask(()=>{if(e!==this._version+1){this._pending=!1;return}this.notifyNow()})}notifyNow(){this._version++,this._listeners=this._listeners.filter(e=>{var i;let t=e.deref();try{(i=t==null?void 0:t.onConfigurationChange)==null||i.call(t)}catch(r){console.error("Listener error:",r)}return t!==void 0}),this._pending=!1}};function Ja(e,t,i={}){let{contract:r=.125,step:n=1,power:s=2,atol:a=1e-16,rtol:o=a>0?0:Math.sqrt(Number.EPSILON),maxeval:l=1e6,breaktol:u=2}=i;if(!isFinite(t))return Ja(x=>e(1/x),1/t,{rtol:o,atol:a,maxeval:l,contract:Math.abs(r)>1?1/r:r,step:1/n,power:s});let c=n,f=Math.pow(1/r,s),p=e(t+c),h=[p],d=1/0,y=1;for(;y<l;){y+=1,c*=r,h.push(e(t+c));let x=f,T=1/0;for(let C=h.length-2;C>=0;C--){let I=h[C];h[C]=h[C+1]+(h[C+1]-h[C])/(x-1);let E=Math.abs(h[C]-I);T=Math.min(T,E),E<d&&(p=h[C],d=E),x*=f}if(T>u*d||!isFinite(T)||d<=Math.max(o*Math.abs(p),a))break}return[p,d]}function de(e){if(typeof e=="bigint")return e;if(typeof e=="number")return Number.isInteger(e)?e>=Number.MAX_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER?BigInt(e):de(e.toString()):null;if(e instanceof Z)return e.isInteger()?de(e.toString()):null;let t=e.toLowerCase(),i=t.match(/([+-]?[0-9]*)(?:\.([0-9]+))?e([+-]?[0-9]+)$/);if(i){let r=parseInt(i[3])-(i[2]?i[2].length:0);if(r<0)return null;t=(i[1]??"")+(i[2]??"")+"0".repeat(r)}if(t.indexOf(".")>=0||!/^[+-]?[0-9]+$/.test(t))return null;try{return BigInt(t)}catch(r){return console.error(r.message),null}}var Af=0x3ffffffffffe5,Gn=new Set([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999,5003,5009,5011,5021,5023,5039,5051,5059,5077,5081,5087,5099,5101,5107,5113,5119,5147,5153,5167,5171,5179,5189,5197,5209,5227,5231,5233,5237,5261,5273,5279,5281,5297,5303,5309,5323,5333,5347,5351,5381,5387,5393,5399,5407,5413,5417,5419,5431,5437,5441,5443,5449,5471,5477,5479,5483,5501,5503,5507,5519,5521,5527,5531,5557,5563,5569,5573,5581,5591,5623,5639,5641,5647,5651,5653,5657,5659,5669,5683,5689,5693,5701,5711,5717,5737,5741,5743,5749,5779,5783,5791,5801,5807,5813,5821,5827,5839,5843,5849,5851,5857,5861,5867,5869,5879,5881,5897,5903,5923,5927,5939,5953,5981,5987,6007,6011,6029,6037,6043,6047,6053,6067,6073,6079,6089,6091,6101,6113,6121,6131,6133,6143,6151,6163,6173,6197,6199,6203,6211,6217,6221,6229,6247,6257,6263,6269,6271,6277,6287,6299,6301,6311,6317,6323,6329,6337,6343,6353,6359,6361,6367,6373,6379,6389,6397,6421,6427,6449,6451,6469,6473,6481,6491,6521,6529,6547,6551,6553,6563,6569,6571,6577,6581,6599,6607,6619,6637,6653,6659,6661,6673,6679,6689,6691,6701,6703,6709,6719,6733,6737,6761,6763,6779,6781,6791,6793,6803,6823,6827,6829,6833,6841,6857,6863,6869,6871,6883,6899,6907,6911,6917,6947,6949,6959,6961,6967,6971,6977,6983,6991,6997,7001,7013,7019,7027,7039,7043,7057,7069,7079,7103,7109,7121,7127,7129,7151,7159,7177,7187,7193,7207,7211,7213,7219,7229,7237,7243,7247,7253,7283,7297,7307,7309,7321,7331,7333,7349,7351,7369,7393,7411,7417,7433,7451,7457,7459,7477,7481,7487,7489,7499,7507,7517,7523,7529,7537,7541,7547,7549,7559,7561,7573,7577,7583,7589,7591,7603,7607,7621,7639,7643,7649,7669,7673,7681,7687,7691,7699,7703,7717,7723,7727,7741,7753,7757,7759,7789,7793,7817,7823,7829,7841,7853,7867,7873,7877,7879,7883,7901,7907,7919]),Ka=7919;function $f(e){if(e<=3)return{[e]:1};let t={},i=0;for(;e%2===0;)i+=1,e/=2;for(i>0&&(t[2]=i),i=0;e%3===0;)i+=1,e/=3;i>0&&(t[3]=i);let r=!1;for(;!r;){if(e===1)return t;let n=Math.sqrt(e);r=!0;for(let s=6;s<=n+6;s+=6){if(e%(s-1)===0){t[s-1]=(t[s-1]??0)+1,e/=s-1,r=!1;break}if(e%(s+1)===0){t[s+1]=(t[s+1]??0)+1,e/=s+1,r=!1;break}}}return t[e]!==void 0?t[e]+=1:t[e]=1,t}function Xa(e){if(!Number.isInteger(e)||!Number.isFinite(e)||Number.isNaN(e)||e<=1)return!1;if(e<=Ka)return Gn.has(e);for(let t of Gn)if(e%t===0)return!1;return Df(e,30)?void 0:!1}function Cf(e){if(e<=1)return!1;if(e<=Ka)return Xa(Number(e));for(let t of Gn)if(e%BigInt(t)===BigInt(0))return!1;return e<Af&&(e=qf(e)),Pf(e,30)?void 0:!1}function qf(e){if(e===BigInt(1))return BigInt(1);if(e%BigInt(2)===BigInt(0))return BigInt(2);if(e%BigInt(3)===BigInt(0))return BigInt(3);if(e%BigInt(5)===BigInt(0))return BigInt(5);let t=BigInt(Math.floor(Math.sqrt(Number(e)))),i=BigInt(7);for(;i<=t;){if(e%i===BigInt(0))return i;if(e%(i+BigInt(4))===BigInt(0))return i+BigInt(4);if(e%(i+BigInt(6))===BigInt(0))return i+BigInt(6);if(e%(i+BigInt(10))===BigInt(0))return i+BigInt(10);if(e%(i+BigInt(12))===BigInt(0))return i+BigInt(12);if(e%(i+BigInt(16))===BigInt(0))return i+BigInt(16);if(e%(i+BigInt(22))===BigInt(0))return i+BigInt(22);if(e%(i+BigInt(24))===BigInt(0))return i+BigInt(24);i+=BigInt(30)}return e}function Df(e,t){let i=0,r=e-1;for(;r%2===0;)r/=2,++i;e:do{let n=Math.pow(2+Math.floor(Math.random()*(e-3)),r)%e;if(!(n===1||n===e-1)){for(let s=i-1;s--;){if(n=n*n%e,n===1)return!1;if(n===e-1)continue e}return!1}}while(--t);return!0}function Pf(e,t){let i=0,r=e-BigInt(1);for(;r%BigInt(2)===BigInt(0);)r=r/BigInt(2),++i;e:do{let n=BigInt(2+Math.floor(Math.random()*(Number(e)-3)))**r%e;if(!(n===BigInt(1)||n===e-BigInt(1))){for(let s=i-1;s--;){if(n=n*n%e,n===BigInt(1))return!1;if(n===e-BigInt(1))continue e}return!1}}while(--t);return!0}BigInt(4),BigInt(2),BigInt(4),BigInt(2),BigInt(4),BigInt(6),BigInt(2),BigInt(6);var eo=21,Ff=53,Jt=Math.floor(Math.log10(Math.pow(2,Ff))),to=1e-10,U=1e6,Of=1024,Ar=1e6;function jn(e,t){if(e>=Number.MAX_SAFE_INTEGER)return[1,e];if(e===0)return[0,0];if(e===1)return[1,1];if(t===2){let s=[[0,0],[1,1],[1,2],[1,3],[2,1],[1,5],[1,6],[1,7],[1,8],[3,1],[1,10],[1,11],[2,3],[1,13],[1,14],[1,15],[4,1],[1,17],[3,2],[1,19],[1,20]][e];if(s)return s}let i=$f(e),r=1,n=1;for(let s of Object.keys(i)){let a=parseInt(s);r=r*Math.pow(a,Math.floor(i[s]/t)),n=n*Math.pow(a,i[s]%t)}return[r,n]}function Je(e,t){if(e===0)return t;if(t===0||e===t)return e;if(!Number.isInteger(e)||!Number.isInteger(t))return NaN;for(;t!==0;)[e,t]=[t,e%t];return e<0?-e:e}function Wn(e,t){return e*t/Je(e,t)}function io(e){if(!Number.isInteger(e)||e<0)return NaN;if(e>=170)return 1/0;let t=1;for(let i=2;i<=e;i++)t=t*i;return t}function zf(e){if(!Number.isInteger(e)||e<0)return NaN;if(e<0)return NaN;if(e<=1)return 1;let t=e;for(;e>2;)e-=2,t*=e;return t}function ro(e,t=to){return typeof e=="number"&&Math.abs(e)<=t?0:e}function Lf(e,t,i=.1){return(e(t-4*i)/280-4*e(t-3*i)/105+e(t-2*i)/5-4*e(t-i)/5+4*e(t+i)/5-e(t+2*i)/5+4*e(t+3*i)/105-e(t+4*i)/280)/i}function hi(e,t,i=1){if(i===0){let s=hi(e,t,-1),a=hi(e,t,1);return s===void 0||a===void 0?NaN:Math.abs(s-a)>1e-5?NaN:(s+a)/2}let[r,n]=Ja(e,t,{step:i>0?1:-1});return r}function*no(){yield[0,1];for(let e=1;;e++)for(let t=0;t<=e;t++){let i=e-t;i!==0&&Je(t,i)===1&&(yield[t,i],yield[-t,i])}}function*Rf(){yield[0,1];for(let e=1;;e++)for(let t=0;t<=e;t++){let i=e-t;i!==0&&Je(t,i)===1&&(yield[t,i])}}function*Vf(){yield[0,0];for(let e=1;;e++)for(let t=0;t<=e;t++){let i=e-t;if(i===0||Je(t,i)!==1)continue;let r=t/i;for(let n=0;n<=e;n++){let s=e-n;if(s===0||Je(n,s)!==1)continue;let a=n/s;yield[r,a],yield[-r,a],yield[r,-a],yield[-r,-a]}}}function*Bf(){yield 0;for(let e=1;;e++)yield e,yield-e}var $r=["Error","'missing'"];function mi(e){return!!(typeof e=="number"||Cr(e)||typeof e=="string"&&zt(e))}function Cr(e){return e!==null&&typeof e=="object"&&"num"in e}function so(e){return e!==null&&typeof e=="object"&&"sym"in e}function Zf(e){return e!==null&&typeof e=="object"&&"str"in e}function Uf(e){return e!==null&&typeof e=="object"&&"dict"in e&&typeof e.dict=="object"&&!Array.isArray(e.dict)&&e.dict!==null}function Li(e){return e!==null&&typeof e=="object"&&"fn"in e&&Array.isArray(e.fn)&&e.fn.length>0&&typeof e.fn[0]=="string"}function j(e){return e==null?null:typeof e=="object"&&"str"in e?e.str:typeof e!="string"?null:e.length>=2&&e.at(0)==="'"&&e.at(-1)==="'"?e.substring(1,e.length-1):zt(e)||vt(e)?null:e}function ao(e){if(e==null||j(e)!==null)return null;let t=v(e);return t?[t,...S(e).map(i=>ao(i)).filter(i=>i!==null)]:e}function v(e){return Array.isArray(e)?e[0]:e==null?"":Li(e)?e.fn[0]:""}function S(e){return Array.isArray(e)?e.slice(1):e!==void 0&&Li(e)?e.fn.slice(1):[]}function g(e,t){return Array.isArray(e)?e[t]??null:e===null||!Li(e)?null:e.fn[t]??null}function K(e){return e==null?0:Array.isArray(e)?Math.max(0,e.length-1):Li(e)?Math.max(0,e.fn.length-1):0}function oo(e){return e==null?null:v(e)==="Hold"?g(e,1):e}function q(e){return typeof e=="string"&&vt(e)?e.length>=2&&e.at(0)==="`"&&e.at(-1)==="`"?e.slice(1,-1):e:e==null?null:so(e)?e.sym:null}function lo(e){let t=v(e);if(t==="KeyValuePair"||t==="Tuple"||t==="Pair"){let[i,r]=S(e),n=j(i);return n?[n,r??"Nothing"]:null}return null}function uo(e){if(e===null)return null;if(Uf(e))return e;let t=lo(e);if(t)return{[t[0]]:t[1]};if(v(e)==="Dictionary"){let i={},r=S(e);for(let n=1;n<K(e);n++){let s=lo(r[n]);s&&(i[s[0]]=s[1])}return i}return null}function co(e){return{dict:e}}function Gf(e){if(e=e.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,""),e==="nan")return NaN;if(/^(infinity|\+infinity|oo|\+oo)$/i.test(e))return 1/0;if(/^(-infinity|-oo)$/.test(e))return-1/0;if(/\([0-9]+\)/.test(e)){let[t,i,r,n]=e.match(/(.+)\(([0-9]+)\)(.*)$/)??[];e=i+r.repeat(Math.ceil(16/r.length))+(n??"")}return parseFloat(e)}function z(e){return typeof e=="number"?e:typeof e=="string"&&zt(e)?Gf(e):e!==void 0&&Cr(e)?z(e.num):null}function Ri(e){if(e==null)return null;if(q(e)==="Half")return[1,2];let t=v(e);if(!t)return null;let i=null,r=null;if(t==="Negate"){let n=Ri(S(e)[0]);if(n)return[-n[0],n[1]]}if(t==="Rational"||t==="Divide"){let[n,s]=S(e);i=z(n)??NaN,r=z(s)??NaN}if(t==="Power"){let[n,s]=S(e),a=z(s);a===1?(i=z(n),r=1):a===-1&&(i=1,r=z(n))}if(t==="Multiply"){let[n,s]=S(e);if(v(s)==="Power"){let[a,o]=S(s);z(o)===-1&&(i=z(n),r=z(a))}}return i===null||r===null?null:Number.isInteger(i)&&Number.isInteger(r)?[i,r]:null}function Hn(e,t){let i=null;if(Array.isArray(e)&&(i=e),Li(e)&&(i=e.fn),i===null)return[];let r=1,n=[];for(;r<i.length;)n.push(t(i[r])),r+=1;return n}function qr(e,t,i){let r=v(t),n=v(i);return r===e&&n===e?[e,...S(t),...S(i)]:r===e?[e,...S(t),i]:n===e?[e,t,...S(i)]:[e,t,i]}function Vi(e){if(e==null)return null;let t=v(e);if(t==="Delimiter"){if(e=g(e,1),e===null)return[];if(t=v(e),t!=="Sequence")return[e]}return t!=="Sequence"?null:S(e)}function ie(e){return e==null||e==="Nothing"?!0:v(e)==="Sequence"&&K(e)===0}function G(e){return ie(e)?$r:e}function Qn(e){return e[0]==="Square"?Qn(e.slice(1))+2:e.reduce((t,i)=>t+Dr(i),0)}function Dr(e){if(e===null)return 0;if(typeof e=="number"||typeof e=="string"||mi(e)||so(e)||Zf(e))return 1;if(Array.isArray(e))return Qn(e);if("fn"in e)return Qn(e.fn);let t=uo(e);if(t){let i=Object.keys(t);return 1+i.length+i.reduce((r,n)=>r+Dr(t[n]),0)}return 0}function zt(e){return/^(nan|oo|\+oo|-oo|infinity|\+infinity|-infinity)$/i.test(e)||/^[+-]?(0|[1-9][0-9]*)(\.[0-9]+)?(\([0-9]+\))?([eE][+-]?[0-9]+)?$/.test(e)}function vt(e){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)||e.length>=2&&e[0]==="`"&&e[e.length-1]==="`"}function fo(e){return e.length>=2&&e[0]==="'"&&e[e.length-1]==="'"?!0:!zt(e)&&!vt(e)}function jf(e){let t=[];for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let n=e.charCodeAt(i+1);if(n>=56320&&n<=57343){let s=r-55296,a=n-56320;r=65536+s*1024+a,i++}}t.push(r)}return t}var Pr=8205,po=[127462,127487];function ho(e){return e===Pr||e===65038||e===65039||e>=127995&&e<=128e3||e>=129456&&e<=129460||e>=917536&&e<=917632}function Wf(e){return e>=po[0]&&e<=po[1]}function Hf(e){if(/^[\u0020-\u00FF]*$/.test(e))return e;let t=[],i=jf(e),r=0;for(;r<i.length;){let n=i[r++],s=i[r];if(s===Pr){let a=r-1;for(r+=2;i[r]===Pr;)r+=2;t.push(String.fromCodePoint(...i.slice(a,2*r-a+1)))}else if(ho(s)){let a=r-1;for(;ho(i[r]);)r+=i[r]===Pr?2:1;t.push(String.fromCodePoint(...i.slice(a,2*r-a-1)))}else Wf(n)?(r+=1,t.push(String.fromCodePoint(...i.slice(r-2,2)))):t.push(String.fromCodePoint(n))}return t}var Qf=class{constructor(e){m(this,"s");m(this,"pos");m(this,"obeyspaces",!1);e=e.replace(/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/g,""),e=e.replace(/\u2212/g,"-"),this.s=Hf(e),this.pos=0}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(e){let t;return typeof this.s=="string"?t=e.exec(this.s.slice(this.pos)):t=e.exec(this.s.slice(this.pos).join("")),t!=null&&t[0]?(this.pos+=t[0].length,t[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/)||this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return"<space>";let e=this.get();if(e==="\\"){if(!this.end()){let t=this.match(/^[a-zA-Z]+/);if(t)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(t=this.get(),t===" ")return"<space>";return"\\"+t}}else{if(e==="{")return"<{>";if(e==="}")return"<}>";if(e==="^"){if(this.peek()==="^"){this.get();let t=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(t)return String.fromCodePoint(parseInt(t.slice(t.lastIndexOf("^")+1),16))}return e}else if(e==="#"){if(!this.end()){let t=!1;if(/[0-9?]/.test(this.peek())&&(t=!0,this.pos+1<this.s.length)){let i=this.s[this.pos+1];t=/[^0-9A-Za-z]/.test(i)}return t?"#"+this.get():"#"}}else if(e==="$")return this.peek()==="$"?(this.get(),"<$$>"):"<$>"}return e}};function Yf(e,t){let i=e.next();if(!i)return[];let r=[];if(i!=="\\relax"){if(i==="\\noexpand")i=e.next(),i&&r.push(i);else if(i==="\\obeyspaces")e.obeyspaces=!0;else if(i==="\\space"||i==="~")r.push("<space>");else if(i==="\\bgroup")r.push("<{>");else if(i==="\\egroup")r.push("<}>");else if(i==="\\string")i=e.next(),i&&(i[0]==="\\"?Array.from(i).forEach(n=>r.push(n==="\\"?"\\backslash":n)):i==="<{>"?r.push("\\{"):i==="<space>"?r.push("~"):i==="<}>"&&r.push("\\}"));else if(i==="\\csname"){for(;e.peek()==="<space>";)e.next();let n="",s=!1,a=[];do{if(a.length===0)if(/^#[0-9?]$/.test(e.peek())){let o=e.get().slice(1);a=ye((t==null?void 0:t[o])??(t==null?void 0:t["?"])??"\\placeholder{}",t),i=a[0]}else i=e.next(),a=i?[i]:[];s=a.length===0,!s&&i==="\\endcsname"&&(s=!0,a.shift()),s||(s=i==="<$>"||i==="<$$>"||i==="<{>"||i==="<}>"||!!i&&i.length>1&&i[0]==="\\"),s||(n+=a.shift())}while(!s);n&&r.push("\\"+n),r=r.concat(a)}else if(i!=="\\endcsname")if(i.length>1&&i[0]==="#"){let n=i.slice(1);r=r.concat(ye((t==null?void 0:t[n])??(t==null?void 0:t["?"])??"\\placeholder{}",t))}else r.push(i)}return r}function ye(e,t=[]){let i=e.toString().split(/\r?\n/),r="",n="";for(let o of i){r+=n,n=" ";let l=o.match(/((?:\\%)|[^%])*/);l!==null&&(r+=l[0])}let s=new Qf(r),a=[];do a.push(...Yf(s,t));while(!s.end());return a}function mo(e){return ye(e).length}function k(e){let t="",i="";for(let r of e)r!=null&&(typeof r=="string"&&(/[a-zA-Z]/.test(r[0])&&(i+=t),/\\[a-zA-Z]+\*?$/.test(r)?t=" ":t=""),i+=r.toString());return i}function Fr(e,t,i){return t.includes(e)&&(t=`{${t}}`),/^[0-9]$/.test(i)?`${t}${e}${i}`:`${t}${e}{${i}}`}function xt(e){let t=[];if(Array.isArray(e))for(let i of e)Array.isArray(i)?t=[...t,...i]:t.push(i);else t=[e];return k(t.map(i=>({"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"})[i]??i))}var V=245,Or=260,Kt=270,ce=275,Ke=390,Lt=600,go=650,yo=700,bo=810;function Jf(e){return!("kind"in e)||e.kind==="expression"}function Kf(e){return"kind"in e&&e.kind==="symbol"}function zr(e){return"kind"in e&&e.kind==="matchfix"}function vo(e){return"kind"in e&&e.kind==="infix"}function Yn(e){return"kind"in e&&e.kind==="prefix"}function xo(e){return"kind"in e&&e.kind==="postfix"}function Xf(e){return"kind"in e&&e.kind==="environment"}var ep=[{name:"To",latexTrigger:["\\to"],kind:"infix",precedence:270},{latexTrigger:["\\rightarrow"],kind:"infix",precedence:270,parse:"To"}];function tp(e,t){return"normal"}function ip(e,t){return"normal"}function rp(e,t){return t>2?"solidus":"radical"}function np(e,t){if(t>3)return"inline-solidus";if(v(e)==="Divide"){let[i,r]=S(e),[n,s]=[Dr(i),Dr(r)];if(s<=2&&n>5)return"factor";if(n<=2&&s>5)return"reciprocal"}return"quotient"}function sp(e,t){return"boolean"}function ap(e,t){return"solidus"}function op(e,t){return"compact"}function Bi(e,t,i){e.indexOf("#1")<0&&e.indexOf("#2")<0&&(e=`#1 ${e} #2`);let r=e.split(/(#\d+)/).filter(n=>n.trim()!=="").map(n=>n.trim());return k(r.map(n=>{switch(n){case"#1":return t;case"#2":return i;default:return n}}))}function lp(e){if(v(e)!=="Multiply")return[[],[]];let t=[],i=[];for(let r of S(e))if(v(r)==="Power"){let n=g(r,1),s=g(r,2);if(v(s)==="Negate"){let a=g(s,1);n&&a&&i.push(["Power",n,a])}else{let a=z(s)??NaN;a===-1?n&&i.push(n):a<0?n&&i.push(["Power",n,-a]):t.push(r)}}else if(v(r)==="Rational"&&K(r)===2||v(r)==="Divide"){let n=g(r,1),s=g(r,2);z(n)!==1&&t.push(n),z(s)!==1&&i.push(s)}else{let n=Ri(r);n!==null?(n[0]!==1&&t.push(n[0]),i.push(n[1])):t.push(r)}return[t,i]}function up(e){let t=e.parseOptionalGroup(),i=e.parseGroup()??e.parseToken();return ie(i)?t!==null?["Root",$r,G(t)]:["Sqrt",$r]:t!==null?["Root",i,t]:["Sqrt",i]}function Zi(e,t,i,r){return i==null?"\\sqrt{}":(r=r??2,t==="solidus"?e.wrapShort(i)+"^{1/"+e.serialize(r)+"}":t==="quotient"?e.wrapShort(i)+"^{\\frac{1}{"+e.serialize(r)+"}}":z(r)===2?"\\sqrt{"+e.serialize(i)+"}":"\\sqrt["+e.serialize(r)+"]{"+e.serialize(i)+"}")}function cp(e,t){e.level-=1;let i=v(t),r="",n=g(t,1);if(i==="Negate")r="-"+e.wrap(n,ce+1);else if(i==="Subtract"){r=e.wrap(n,ce);let s=g(t,2);if(s!==null){let a=e.wrap(s,ce);a[0]==="-"?r+="+"+a.slice(1):a[0]==="+"?r+="-"+a.slice(1):r=r+"-"+a}}else if(i==="Add"){if(e.options.prettify&&K(t)===2&&e.options.invisiblePlus!=="+"){let[o,l]=[g(t,1),g(t,2)],[u,c]=[o,l],f=z(u),p=Ri(c);if((f===null||p===null)&&([u,c]=[l,o],f=z(u),p=Ri(c)),f!==null&&p!==null&&isFinite(f)&&Number.isInteger(f)&&f>=0&&f<=1e3&&isFinite(p[0])&&isFinite(p[1])&&p[0]>0&&p[0]<=100&&p[1]<=100)return r=Bi(e.options.invisiblePlus,e.serialize(u),e.serialize(c)),e.level+=1,r}if(e.options.prettify&&K(t)===2){let[o,l]=Ui(n),[u,c]=Ui(g(t,2));if(l<0&&c>0)return r=e.wrap(u,ce)+"-"+e.wrap(o,ce),e.level+=1,r}r=e.serialize(n);let s=K(t)+1,a=S(t);for(let o=2;o<s;o++)if(n=a[o-1],e.options.prettify){let[l,u]=Ui(n),c=e.wrap(l,ce);u>0?c.startsWith("+")||c.startsWith("-")?r+=c:r+="+"+c:c.startsWith("+")?r+="-"+c.slice(1):c.startsWith("-")?r+="+"+c.slice(1):r+="-"+c}else{let l=e.wrap(n,ce);l[0]==="-"||l[0]==="+"?r+=l:r+="+"+l}}return e.level+=1,r}function No(e,t){if(t===null)return"";e.level-=1;let i="";if(e.options.prettify===!0){let[l,u]=lp(t);u.length>0&&(u.length===1&&u[0]===1?l.length===0?i="1":l.length===1?i=e.serialize(l[0]):i=No(e,["Multiply",...l]):i=e.serialize(["Divide",l.length===1?l[0]:["Multiply",...l],u.length===1?u[0]:["Multiply",...u]]))}if(i)return e.level+=1,i;let r=!1,n=null,s=K(t)+1,a=S(t);e.options.prettify===!0&&a.length===2&&mi(a[1])&&!mi(a[0])&&(a=[a[1],a[0]]);let o=!1;for(let l=1;l<s;l++){if(n=a[l-1],n===null)continue;let u;if(mi(n)){u=e.serialize(n),u==="-1"&&!i?(i="",r=!r):(u[0]==="-"&&(u=u.slice(1),r=!r),i?i=Bi(e.options.multiply,i,u):i=u),o=!0;continue}if(v(n)==="Power"){let c=Ri(g(n,2));if(c!=null){let[f,p]=c;if(f===1&&p!==null){i+=Zi(e,e.rootStyle(n,e.level),g(n,1),p),o=!1;continue}}}if(v(n)==="Power"&&!isNaN(z(g(n,1))??NaN)){u=e.serialize(n),i?i=Bi(e.options.multiply,i,u):i=u,o=!0;continue}if(v(n)==="Negate"&&(n=g(n,1),r=!r),u=e.wrap(n,Ke),!i)i=u;else{let c=v(n);o&&(c==="Divide"||c==="Rational")?i=Bi(e.options.multiply,i,u):e.options.invisibleMultiply?i=Bi(e.options.invisibleMultiply,i,u):i=k([i,u])}o=!1}return e.level+=1,r?"-"+i:i}function fp(e){let t=e.parseGroup(),i=null;if(t===null?(t=e.parseToken(),i=e.parseToken()):i=e.parseGroup(),t=G(t),i=G(i),v(t)==="PartialDerivative"&&(v(i)==="PartialDerivative"||v(i)==="Multiply"&&v(g(i,1))==="PartialDerivative")){let r=g(t,3)??null,n=g(t,1);n==null&&(n=G(e.parseExpression()));let s=[];if(v(i)==="Multiply"){for(let a of S(i))if(v(a)==="PartialDerivative"){let o=g(a,2);o&&s.push(o)}}else{let a=g(i,2);a&&s.push(a)}return s.length>1&&(s=["List",...s]),["PartialDerivative",n,...s,r===null?1:r]}return["Divide",t,i]}function _o(e,t){if(t===null)return"";let i=G(g(t,1)),r=G(g(t,2)),n=e.options.prettify?e.fractionStyle(t,e.level):"quotient";if(n==="inline-solidus"||n==="nice-solidus"){let l=e.wrapShort(i),u=e.wrapShort(r);return n==="inline-solidus"?`${l}/${u}`:`{}^{${l}}\\!\\!/\\!{}_{${u}}`}else{if(n==="reciprocal")return z(i)===1?e.wrap(r)+"^{-1}":e.wrap(i)+e.wrap(r)+"^{-1}";if(n==="factor")return z(r)===1?e.wrap(i):"\\frac{1}{"+e.serialize(r)+"}"+e.wrapString(e.serialize(i),e.groupStyle(t,1))}let s="\\frac";n==="block-quotient"?s="\\dfrac":n==="inline-quotient"&&(s="\\tfrac");let a=e.serialize(i),o=e.serialize(r);return`${s}{${a}}{${o}}`}function Jn(e,t){if(!t)return"";let i=v(t),r=G(g(t,1));if(i==="Sqrt")return Zi(e,e.rootStyle(t,e.level-1),r,2);let n=G(g(t,2));if(i==="Root")return Zi(e,e.rootStyle(t,e.level-1),r,n);if(e.options.prettify){let s=z(n)??1;if(s===-1)return e.serialize(["Divide","1",r]);if(s<0)return e.serialize(["Divide","1",["Power",r,-s]]);if(v(n)==="Divide"||v(n)==="Rational"){if(z(g(n,1))===1){let a=e.rootStyle(t,e.level);return Zi(e,a,r,g(n,2))}if(z(g(n,2))===2)return`${e.serialize(["Sqrt",r])}^{${e.serialize(g(n,1))}}`}else if(v(n)==="Power"&&z(g(n,2))===-1){let a=e.rootStyle(t,e.level);return Zi(e,a,r,g(n,1))}}if(v(r)==="Power"){let s=g(r,1),a=g(r,2);return`
      ${e.wrapShort(s)}^{${Fr("^",e.wrapShort(a),e.serialize(n))}}`}return Fr("^",e.wrapShort(r),e.serialize(n))}var pp=[{name:"CatalanConstant",symbolTrigger:"G"},{name:"GoldenRatio",latexTrigger:"\\varphi"},{name:"EulerGamma",latexTrigger:"\\gamma"},{name:"Degrees",latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(e,t)=>["Degrees",t],serialize:(e,t)=>k([e.serialize(g(t,1)),"\\degree"])},{latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(e,t)=>["Degrees",t]},{latexTrigger:["^","<{>","\\circ","<}>"],kind:"postfix",parse:(e,t)=>["Degrees",t]},{latexTrigger:["^","\\circ"],kind:"postfix",parse:(e,t)=>["Degrees",t]},{latexTrigger:[""],kind:"postfix",precedence:880,parse:(e,t)=>["Degrees",t]},{latexTrigger:["\\ang"],parse:e=>{let t=e.parseGroup();return t===null?["Degrees"]:["Degrees",t]}},{latexTrigger:["\\infty"],parse:"PositiveInfinity"},{name:"PositiveInfinity",serialize:e=>e.options.positiveInfinity},{name:"NegativeInfinity",serialize:e=>e.options.negativeInfinity},{name:"ComplexInfinity",latexTrigger:["\\tilde","\\infty"],serialize:"\\tilde\\infty"},{latexTrigger:["\\tilde","<{>","\\infty","<}>"],parse:"ComplexInfinity"},{name:"Pi",kind:"symbol",latexTrigger:["\\pi"]},{latexTrigger:[""],parse:"Pi"},{name:"ExponentialE",latexTrigger:["\\exponentialE"],parse:"ExponentialE",serialize:"\\exponentialE"},{latexTrigger:"\\operatorname{e}",parse:"ExponentialE"},{latexTrigger:"\\mathrm{e}",parse:"ExponentialE"},{kind:"function",symbolTrigger:"exp",parse:"Exp"},{latexTrigger:"\\exp",parse:"Exp"},{name:"ImaginaryUnit",latexTrigger:["\\imaginaryI"]},{latexTrigger:"\\operatorname{i}",parse:"ImaginaryUnit"},{latexTrigger:"\\mathrm{i}",parse:"ImaginaryUnit"},{name:"Abs",kind:"matchfix",openTrigger:"|",closeTrigger:"|",parse:(e,t)=>ie(t)?null:["Abs",t]},{kind:"matchfix",openTrigger:["\\vert"],closeTrigger:["\\vert"],parse:(e,t)=>ie(t)?null:["Abs",t]},{symbolTrigger:"abs",kind:"function",parse:"Abs"},{name:"Add",latexTrigger:["+"],kind:"infix",associativity:"any",precedence:ce,parse:(e,t,i)=>{let r=e.parseExpression({...i,minPrec:ce});return r===null?null:qr("Add",t,r)},serialize:cp},{kind:"prefix",latexTrigger:["+"],precedence:ce,parse:(e,t)=>e.parseExpression({...t,minPrec:400})},{name:"Ceil",kind:"matchfix",openTrigger:"\\lceil",closeTrigger:"\\rceil",parse:(e,t)=>ie(t)?null:["Ceil",t]},{kind:"matchfix",openTrigger:[""],closeTrigger:[""],parse:(e,t)=>ie(t)?null:["Ceil",t]},{symbolTrigger:"ceil",kind:"function",parse:"Ceil"},{name:"Chop",symbolTrigger:"chop",kind:"function",parse:"Chop"},{name:"Complex",precedence:ce-1,serialize:(e,t)=>{let i=e.serialize(g(t,1)),r=z(g(t,2));if(r===0)return i;let n=r===1?"\\imaginaryI":r===-1?"-\\imaginaryI":k([e.serialize(g(t,2)),"\\imaginaryI"]);return z(g(t,1))===0?n:r!==null&&r<0?k([i,n]):k([i,"+",n])}},{name:"Divide",latexTrigger:"\\frac",precedence:Lt,parse:fp,serialize:_o},{kind:"infix",latexTrigger:"\\over",associativity:"none",precedence:Lt,parse:"Divide"},{latexTrigger:["\\/"],kind:"infix",associativity:"left",precedence:Lt,parse:"Divide"},{latexTrigger:["/"],kind:"infix",associativity:"left",precedence:Lt,parse:"Divide"},{latexTrigger:["\\div"],kind:"infix",associativity:"left",precedence:Lt,parse:"Divide"},{name:"Exp",serialize:(e,t)=>{let i=g(t,1);return q(i)||z(i)!==null?k(["\\exponentialE^{",e.serialize(i),"}"]):k(["\\exp",e.wrap(G(i))])}},{name:"Factorial",latexTrigger:["!"],kind:"postfix",precedence:bo},{name:"Factorial2",latexTrigger:["!","!"],kind:"postfix",precedence:bo},{name:"Floor",kind:"matchfix",openTrigger:"\\lfloor",closeTrigger:"\\rfloor",parse:(e,t)=>ie(t)?null:["Floor",t]},{kind:"matchfix",openTrigger:[""],closeTrigger:[""],parse:(e,t)=>ie(t)?null:["Floor",t]},{symbolTrigger:"floor",kind:"function",parse:"Floor"},{latexTrigger:["\\Gamma"],parse:"Gamma"},{name:"GCD",latexTrigger:["\\gcd"]},{symbolTrigger:"gcd",kind:"function",parse:"GCD"},{symbolTrigger:"GCD",kind:"function",parse:"GCD"},{name:"Half",serialize:"\\frac12"},{name:"Lg",latexTrigger:["\\lg"],serialize:(e,t)=>"\\log_{10}"+e.wrapArguments(t),parse:e=>{let t=e.parseArguments("implicit");return t===null?"Lg":["Log",...t,10]}},{name:"Lb",latexTrigger:"\\lb",parse:e=>{let t=e.parseArguments("implicit");return t===null?"Log":["Log",t[0],2]}},{name:"Ln",latexTrigger:["\\ln"],parse:e=>So("Ln",e),serialize:(e,t)=>"\\ln"+e.wrapArguments(t)},{name:"Log",latexTrigger:["\\log"],parse:e=>So("Log",e),serialize:(e,t)=>{let[i,r]=S(t);return r?k(["\\log_{",e.serialize(r),"}",e.wrap(i)]):"\\log"+e.wrapArguments(t)}},{name:"LCM",symbolTrigger:"lcm",kind:"function"},{symbolTrigger:"LCM",kind:"function",parse:"LCM"},{symbolTrigger:"max",kind:"function",parse:"Max"},{symbolTrigger:"min",kind:"function",parse:"Min"},{name:"Max",latexTrigger:"\\max",kind:"function"},{name:"Min",latexTrigger:"\\min",kind:"function"},{name:"Supremum",latexTrigger:"\\sup",kind:"function"},{name:"Infimum",latexTrigger:"\\inf",kind:"function"},{name:"Limit",latexTrigger:"\\lim",kind:"expression",parse:e=>{if(!e.match("_"))return null;let t=e.parseGroup();if(v(t)!=="To")return null;let i=e.parseArguments("implicit");return i?["Limit",["Function",i[0],g(t,1)],g(t,2)]:null},serialize:(e,t)=>{let i=g(t,1),r=g(i,2),n=g(t,2);return k(["\\lim_{",e.serialize(r),"\\to",e.serialize(n),"}",e.serialize(g(i,1))])}},{name:"MinusPlus",latexTrigger:["\\mp"],kind:"infix",associativity:"any",precedence:Kt},{name:"Multiply",latexTrigger:["\\times"],kind:"infix",associativity:"any",precedence:Ke,serialize:No},{latexTrigger:["\\cdot"],kind:"infix",associativity:"any",precedence:Ke,parse:(e,t,i)=>{let r=e.parseExpression({...i,minPrec:Ke+2});return r===null?null:qr("Multiply",t,r)}},{latexTrigger:["*"],kind:"infix",associativity:"any",precedence:Ke,parse:(e,t,i)=>{let r=e.parseExpression({...i,minPrec:Ke+2});return r===null?["Multiply",t,$r]:qr("Multiply",t,r)}},{name:"Mod",latexTrigger:"\\bmod",kind:"infix",precedence:Lt,serialize:(e,t)=>{if(K(t)!==2)return"";let i=e.serialize(g(t,1)),r=e.serialize(g(t,2));return k([i,"\\bmod",r])}},{latexTrigger:"\\mod",kind:"infix",precedence:Lt,parse:"Mod"},{latexTrigger:"\\pmod",kind:"prefix",precedence:V,parse:e=>{let t=e.parseGroup()??e.parseToken();return["Mod",G(t)]}},{name:"Congruent",serialize:(e,t)=>{let i=e.serialize(g(t,1)),r=e.serialize(g(t,2));if(g(t,3)===null)return k([i,"\\equiv",r]);let n=e.serialize(g(t,3));return k([i,"\\equiv",r,"\\pmod{",n,"}"])}},{name:"Negate",latexTrigger:["-"],kind:"prefix",precedence:yo+1,parse:(e,t)=>{e.skipSpace();let i=e.parseExpression({...t,minPrec:yo+3});return i===null?null:["Negate",i]}},{kind:"matchfix",openTrigger:"||",closeTrigger:"||",parse:(e,t)=>ie(t)?null:["Norm",t]},{name:"Norm",kind:"matchfix",openTrigger:["\\left","\\Vert"],closeTrigger:["\\right","\\Vert"],parse:(e,t)=>ie(t)?null:["Norm",t]},{name:"PlusMinus",latexTrigger:["\\pm"],kind:"infix",associativity:"any",precedence:Kt,serialize:(e,t)=>{let i=g(t,1);if(i===null)return"\\pm";if(K(t)===1)return k(["\\pm",e.serialize(i)]);let r=g(t,2);return k([e.serialize(i),"\\pm",e.serialize(r)])}},{latexTrigger:["\\pm"],kind:"prefix",precedence:Kt,parse:(e,t)=>{let i=e.parseExpression({...t,minPrec:400});return["PlusMinus",0,G(i)]}},{latexTrigger:["\\plusmn"],kind:"infix",associativity:"any",precedence:Kt,parse:(e,t,i)=>{let r=e.parseExpression({...i,minPrec:400});return["PlusMinus",t,G(r)]}},{latexTrigger:["\\plusmn"],kind:"prefix",precedence:Kt,parse:(e,t)=>{let i=e.parseExpression({...t,minPrec:400});return["PlusMinus",G(i)]}},{name:"Power",latexTrigger:["^"],kind:"infix",serialize:Jn},{latexTrigger:"\\prod",precedence:Ke,name:"Product",parse:wo("Product","Multiply",Ke),serialize:ko("\\prod")},{name:"Rational",precedence:Lt,serialize:(e,t)=>t&&K(t)===1?"\\operatorname{Rational}"+e.wrapArguments(t):_o(e,t)},{name:"Reduce",serialize:(e,t)=>{let i=g(t,1);if(!i)return"";let r=g(t,2);return q(r)==="Add"?`\\sum ${e.serialize(i)}`:q(r)==="Multiply"?`\\prod ${e.serialize(i)}`:`\\operatorname{Reduce}\\left(${e.serialize(i)}, ${e.serialize(g(t,2))}\\right)`}},{name:"Root",serialize:Jn},{name:"Round",symbolTrigger:"round",kind:"function"},{name:"Square",precedence:720,serialize:(e,t)=>e.wrapShort(g(t,1))+"^2"},{latexTrigger:["\\sum"],precedence:ce,name:"Sum",parse:wo("Sum","Add",Ke),serialize:ko("\\sum")},{name:"Sign",symbolTrigger:"sgn",kind:"function"},{name:"Sqrt",latexTrigger:["\\sqrt"],parse:up,serialize:Jn},{name:"Subtract",latexTrigger:["-"],kind:"infix",associativity:"left",precedence:ce+2,parse:(e,t,i)=>{e.index-=1;let r=e.parseExpression({...i,minPrec:ce+3});return r===null?null:["Add",t,r]},serialize:(e,t)=>{let i=e.wrap(g(t,1),ce+2),r=e.wrap(g(t,2),ce+3);return k([i,"-",r])}}];function hp(e,t){if(e!==null){if(q(e))return{index:q(e)??"Nothing",upper:t};if(v(e)==="GreaterEqual"){let i=q(g(e,1))??"Nothing",r=g(e,2)??1;return{index:i,lower:r,upper:t}}if(v(e)==="Equal"){let i=q(g(e,1))??"Nothing",r=g(e,2);if(v(r)==="Range"){let n=g(r,1)??1,s=g(r,2)??void 0;return{index:i,lower:n,upper:s}}return{index:i,lower:r??1,upper:t}}}}function mp(e,t){ie(e)&&(e=null),ie(t)&&(t=null);let i=e===null?[]:Vi(e)??[e],r=t===null?[]:Vi(t)??[t];return i.map((n,s)=>hp(n,r[s])).filter(n=>n!==void 0)}function wo(e,t,i){return r=>{r.skipSpace();let n=null,s=null;for(;!(s&&n)&&(r.peek==="_"||r.peek==="^");)r.match("_")?s=r.parseGroup()??r.parseToken():r.match("^")&&(n=r.parseGroup()??r.parseToken()),r.skipSpace();if(!n&&!s){let u=r.parseExpression({minPrec:i});if(u)return["Reduce",u,t]}let a=mp(s,n);r.pushSymbolTable();for(let u of a)r.addSymbol(u.index,"symbol");let o=r.parseExpression({minPrec:i});if(r.popSymbolTable(),o===null)return[e];let l=[];for(let u of a){let c=u.lower,f=u.upper,p=u.index??"Nothing";f!=null?l.push(["Tuple",p,c??1,f]):c!=null?l.push(["Tuple",p,c]):l.push(["Tuple",p])}return[e,o,...l]}}function ko(e){return(t,i)=>{if(!g(i,1))return e;let r=g(i,2),n=v(r);n!=="Tuple"&&n!=="Triple"&&n!=="Pair"&&n!=="Single"&&(r=null);let s=g(r,1);s!==null&&v(s)==="Hold"&&(s=g(s,1));let a=g(i,1);if(r!=null)return g(i,2)!==null?k([e,t.serialize(a)]):k([e,"_{",t.serialize(g(i,2)),"}",t.serialize(a)]);let o=g(r,2),l=[];s&&q(s)!=="Nothing"&&o?l=[t.serialize(s),"=",t.serialize(o)]:s&&q(s)!=="Nothing"?l=[t.serialize(s)]:o!==null&&(l=[t.serialize(o)]),l.length>0&&(l=["_{",...l,"}"]);let u=[];return g(r,3)!==null&&(u=["^{",t.serialize(g(r,3)),"}"]),k([e,...u,...l,t.serialize(a)])}}function So(e,t){let i=null;t.match("_")&&(i=t.parseGroup()??t.parseToken());let r=t.parseArguments("implicit");return r===null&&i===null?[e]:r===null?[e,i]:i===null?[e,...r]:i===10?["Log",r[0]]:i===2?["Lb",...r]:["Log",r[0],i]}function Ui(e){let t=1,i=e;do{e=i;let r=v(e);if(r==="Negate")t*=-1,i=g(e,1);else if(r==="Multiply"){let[n,s]=Ui(g(e,1));s<0&&(t*=-1,n===1?i=["Multiply",...S(e).slice(1)]:i=["Multiply",n,...S(e).slice(1)])}else if(r==="Divide"||r==="Rational"){let[n,s]=Ui(g(e,1));s<0&&(t*=-1,i=[r,n,g(e,2)])}else{let n=z(e);n!==null&&n<0&&(t*=-1,i=-n)}}while(i!==e);return[e,t]}var Lr=[{latexTrigger:["\\not","<"],kind:"infix",associativity:"any",precedence:246,parse:"NotLess"},{name:"NotLess",latexTrigger:["\\nless"],kind:"infix",associativity:"any",precedence:246},{latexTrigger:["<"],kind:"infix",associativity:"any",precedence:245,parse:"Less"},{name:"Less",latexTrigger:["\\lt"],kind:"infix",associativity:"any",precedence:245},{latexTrigger:["<","="],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{name:"LessEqual",latexTrigger:["\\le"],kind:"infix",associativity:"any",precedence:241},{latexTrigger:["\\leq"],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{latexTrigger:["\\leqslant"],kind:"infix",associativity:"any",precedence:V+5,parse:"LessEqual"},{name:"LessNotEqual",latexTrigger:["\\lneqq"],kind:"infix",associativity:"any",precedence:V},{name:"NotLessNotEqual",latexTrigger:["\\nleqq"],kind:"infix",associativity:"any",precedence:V},{name:"LessOverEqual",latexTrigger:["\\leqq"],kind:"infix",associativity:"any",precedence:V+5},{name:"GreaterOverEqual",latexTrigger:["\\geqq"],kind:"infix",associativity:"any",precedence:V+5,parse:"GreaterEqual"},{name:"Equal",latexTrigger:["="],kind:"infix",associativity:"right",precedence:V},{latexTrigger:["*","="],kind:"infix",associativity:"right",precedence:V,parse:"StarEqual"},{name:"StarEqual",latexTrigger:["\\star","="],kind:"infix",associativity:"right",precedence:V},{name:"PlusEqual",latexTrigger:["+","="],kind:"infix",associativity:"right",precedence:V},{name:"MinusEqual",latexTrigger:["-","="],kind:"infix",associativity:"right",precedence:V},{name:"SlashEqual",latexTrigger:["/","="],kind:"infix",associativity:"right",precedence:V},{name:"EqualEqual",latexTrigger:["=","="],kind:"infix",associativity:"right",precedence:V},{name:"EqualEqualEqual",latexTrigger:["=","=","="],kind:"infix",associativity:"right",precedence:V+5},{name:"TildeFullEqual",latexTrigger:["\\cong"],kind:"infix",associativity:"right",precedence:V},{name:"NotTildeFullEqual",latexTrigger:["\\ncong"],kind:"infix",associativity:"right",precedence:V},{name:"Approx",latexTrigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"NotApprox",latexTrigger:["\\not","\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"ApproxEqual",latexTrigger:["\\approxeq"],kind:"infix",associativity:"right",precedence:V},{name:"NotApproxEqual",latexTrigger:["\\not","\\approxeq"],kind:"infix",associativity:"right",precedence:250},{name:"NotEqual",latexTrigger:["\\ne"],kind:"infix",associativity:"right",precedence:255},{name:"Unequal",latexTrigger:["!","="],kind:"infix",associativity:"right",precedence:V},{name:"GreaterEqual",latexTrigger:["\\ge"],kind:"infix",associativity:"right",precedence:242},{latexTrigger:["\\geq"],kind:"infix",associativity:"right",precedence:242,parse:"GreaterEqual"},{latexTrigger:[">","="],kind:"infix",associativity:"right",precedence:243,parse:"GreaterEqual"},{latexTrigger:["\\geqslant"],kind:"infix",associativity:"right",precedence:V+5,parse:"GreaterEqual"},{name:"GreaterNotEqual",latexTrigger:["\\gneqq"],kind:"infix",associativity:"right",precedence:V},{name:"NotGreaterNotEqual",latexTrigger:["\\ngeqq"],kind:"infix",associativity:"right",precedence:V},{latexTrigger:[">"],kind:"infix",associativity:"right",precedence:245,parse:"Greater"},{name:"Greater",latexTrigger:["\\gt"],kind:"infix",associativity:"right",precedence:245},{name:"NotGreater",latexTrigger:["\\ngtr"],kind:"infix",associativity:"right",precedence:244},{latexTrigger:["\\not",">"],kind:"infix",associativity:"right",precedence:244,parse:"NotGreater"},{name:"RingEqual",latexTrigger:["\\circeq"],kind:"infix",associativity:"right",precedence:V},{name:"TriangleEqual",latexTrigger:["\\triangleq"],kind:"infix",associativity:"right",precedence:V},{name:"DotEqual",latexTrigger:["\\doteq"],kind:"infix",associativity:"right",precedence:V+5},{name:"DotEqualDot",latexTrigger:["\\doteqdot"],kind:"infix",associativity:"right",precedence:V+5},{name:"FallingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:V+5},{name:"RisingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:V+5},{name:"QuestionEqual",latexTrigger:["\\questeq"],kind:"infix",associativity:"right",precedence:V},{name:"MuchLess",latexTrigger:["\\ll"],kind:"infix",associativity:"right",precedence:V},{name:"MuchGreater",latexTrigger:["\\gg"],kind:"infix",associativity:"right",precedence:V},{name:"Precedes",latexTrigger:["\\prec"],kind:"infix",associativity:"right",precedence:V},{name:"Succeeds",latexTrigger:["\\succ"],kind:"infix",associativity:"right",precedence:V},{name:"PrecedesEqual",latexTrigger:["\\preccurlyeq"],kind:"infix",associativity:"right",precedence:V},{name:"SucceedsEqual",latexTrigger:["\\curlyeqprec"],kind:"infix",associativity:"right",precedence:V},{name:"NotPrecedes",latexTrigger:["\\nprec"],kind:"infix",associativity:"right",precedence:V},{name:"NotSucceeds",latexTrigger:["\\nsucc"],kind:"infix",associativity:"right",precedence:V},{name:"Between",latexTrigger:["\\between"],kind:"infix",associativity:"right",precedence:V+5}];function Kn(e){return typeof e=="string"?e.startsWith("$")&&e.endsWith("$"):!1}function Gi(e){if(typeof e=="number")return e.toString();if(typeof e=="string"){let t=e.trim();if(t.startsWith("$$")&&t.endsWith("$$"))return t.slice(2,-2);if(t.startsWith("$")&&t.endsWith("$"))return t.slice(1,-1)}return Array.isArray(e)?Gi(k(e)):null}function Xt(e){return typeof e!="string"?!1:Lr.some(t=>t.name===e)}function gi(e){return typeof e!="string"?!1:["Less","LessEqual","Greater","GreaterEqual"].includes(e)}function Rr(e){return typeof e!="string"?!1:["Equal","NotEqual"].includes(e)}function Xn(e,t,i,r,n){if(t&&t.minPrec>=r)return null;let s=i?[i]:["Nothing"],a=!1;for(;!a;){for(a=!0,e.skipSpace();e.match(n);)s.push("Nothing"),e.skipSpace();if(e.atTerminator(t))s.push("Nothing");else{let o=e.parseExpression({...t,minPrec:r});s.push(o??"Nothing"),a=o===null}a||(e.skipSpace(),a=!e.match(n))}return s}function ct(e=""){return(t,i)=>{if(!i)return"";let r=S(i);if(r.length===0)return"";if(r.length===1)return t.serialize(r[0]);e={"&":"\\&",":":"\\colon","|":"\\mvert","-":"-","":"\\cdot","":"-","":"--","":"---","":"-","":"\\bullet","":"\\ldots"}[e]??e;let n=r.reduce((s,a)=>(s.push(t.serialize(a),e),s),[]);return n.pop(),k(n)}}var gp=[{latexTrigger:["\\placeholder"],kind:"symbol",parse:e=>{for(;e.match("<space>"););if(e.match("["))for(;!e.match("]")&&!e.atBoundary;)e.nextToken();for(;e.match("<space>"););if(e.match("<{>"))for(;!e.match("<}>")&&!e.atBoundary;)e.nextToken();return"Nothing"}},{name:"ContinuationPlaceholder",latexTrigger:["\\dots"]},{latexTrigger:["\\ldots"],parse:"ContinuationPlaceholder"},{latexTrigger:[".",".","."],parse:"ContinuationPlaceholder"},{name:"Function",latexTrigger:["\\mapsto"],kind:"infix",precedence:Kt,parse:(e,t)=>{let i=[];if(v(t)==="Delimiter"&&(t=g(t,1)??"Nothing"),v(t)==="Sequence")for(let n of S(t)){if(!q(n))return null;i.push(q(n))}else{if(!q(t))return null;i=[q(t)]}let r=e.parseExpression({minPrec:Kt})??"Nothing";return v(r)==="Delimiter"&&(r=g(r,1)??"Nothing"),v(r)==="Sequence"&&(r=["Block",...S(r)]),["Function",r,...i]},serialize:(e,t)=>{var r;let i=S(t);return i.length<1?"()\\mapsto()":i.length===1?k(["()","\\mapsto",e.serialize(g(t,1))]):i.length===2?k([e.serialize(g(t,2)),"\\mapsto",e.serialize(g(t,1))]):k([e.wrapString((r=S(t))==null?void 0:r.slice(1).map(n=>e.serialize(n)).join(", "),"normal"),"\\mapsto",e.serialize(g(t,1))])}},{name:"Apply",kind:"function",symbolTrigger:"apply",serialize:(e,t)=>{let i=g(t,1),r=v(i);if(r==="InverseFunction"||r==="Derivative"){let a=e.options.applyFunctionStyle(t,e.level),o=S(t).slice(1);return e.serializeFunction(i,e.dictionary.ids.get(r))+e.wrapString(o.map(l=>e.serialize(l)).join(", "),a)}let n=g(t,2);if(typeof i=="string"||!n){let a=S(t).slice(1);return e.serialize(a)}if(K(t)===2)return k([e.wrap(i,20),"\\lhd",e.wrap(n,20)]);let s=e.options.applyFunctionStyle(t,e.level);return k(["\\operatorname{apply}",e.wrapString(e.serialize(r)+", "+e.serialize(["List",...S(t)]),s)])}},{latexTrigger:"\\lhd",kind:"infix",precedence:20,parse:"Apply"},{latexTrigger:"\\rhd",kind:"infix",precedence:20,parse:(e,t)=>["Apply",e.parseExpression({minPrec:21})??"Nothing",t]},{name:"EvaluateAt",openTrigger:".",closeTrigger:"|",kind:"matchfix",serialize:(e,t)=>{let i=g(t,1);if(!i)return"";let r=S(t).slice(1);if(v(i)==="Function"){let n=S(i).slice(1),s=g(i,1);if(v(s)==="Block"&&K(s)===1&&(s=g(s,1)),n.length>0)return`\\left.\\left(${e.serialize(s)}\\right)\\right|_{${n.map((a,o)=>`${e.serialize(a)}=${e.serialize(r[o])}`).join(", ")}}`}return`\\left.\\left(${e.serialize(i)}\\right)\\right|_{${r.map(n=>e.serialize(n)).join(", ")}}`}},{name:"Assign",latexTrigger:"\\coloneq",kind:"infix",associativity:"right",precedence:Or,serialize:(e,t)=>{let i=oo(g(t,1));if(v(g(t,2))==="Function"){let r=g(t,2),n=oo(g(r,1)),s=S(r).slice(1);return k([e.serialize(i),e.wrapString(s.map(a=>e.serialize(a)).join(", "),e.options.applyFunctionStyle(t,e.level)),"\\coloneq",e.serialize(n)])}return k([e.serialize(i),"\\coloneq",e.serialize(g(t,2))])},parse:Br},{latexTrigger:"\\coloneqq",kind:"infix",associativity:"right",precedence:Or,parse:Br},{latexTrigger:"\\colonequals",kind:"infix",associativity:"right",precedence:Or,parse:Br},{latexTrigger:[":","="],kind:"infix",associativity:"right",precedence:Or,parse:Br},{name:"BaseForm",serialize:(e,t)=>{let i=z(g(t,2))??NaN;if(isFinite(i)&&i>=2&&i<=36){let r=z(g(t,1))??NaN;if(isFinite(r)&&Number.isInteger(r)){let n=Number(r).toString(i),s=0;if(i===2||i===10?s=4:i===16?s=2:i>16&&(s=4),s>0){let a=n;n="";for(let o=0;o<a.length;o++)o>0&&o%s===0&&(n="\\, "+n),n=a[a.length-o-1]+n}return`(\\text{${n}}_{${i}}`}}return"\\operatorname{BaseForm}("+e.serialize(g(t,1))+", "+e.serialize(g(t,2))+")"}},{name:"Sequence",serialize:ct(" ")},{name:"InvisibleOperator",serialize:ct("")},{name:"Delimiter",serialize:(e,t)=>{let i=e.options.groupStyle(t,e.level+1),r=g(t,1),n={Set:"{,}",List:"[,]",Tuple:"(,)",Single:"(,)",Pair:"(,)",Triple:"(,)",Sequence:"(,)",String:'""'}[v(r)],s=n?r:["Sequence",r];if(n??(n="(,)"),K(t)>1){let c=j(g(t,2));typeof c=="string"&&c.length<=3&&(n=c)}let[a,o,l]=["","",""];n.length===3?[a,o,l]=n:n.length===2?[a,l]=n:n.length===1&&(o=n);let u=r?s?ct(o)(e,s):e.serialize(r):"";return e.wrapString(u,i,a+l)}},{name:"Tuple",serialize:(e,t)=>k(["(",ct(",")(e,t),")"])},{name:"Pair",serialize:(e,t)=>k(["(",ct(",")(e,t),")"])},{name:"Triple",serialize:(e,t)=>k(["(",ct(",")(e,t),")"])},{name:"Single",serialize:(e,t)=>k(["(",ct(",")(e,t),")"])},{name:"Domain",serialize:(e,t)=>v(t)==="Error"?e.serialize(t):`\\mathbf{${e.serialize(g(t,1))}}`},{latexTrigger:["\\mathtip"],parse:e=>{let t=e.parseGroup();return e.parseGroup(),t}},{latexTrigger:["\\texttip"],parse:e=>{let t=e.parseGroup();return e.parseGroup(),t}},{latexTrigger:["\\error"],parse:e=>["Error",e.parseGroup()]},{name:"Error",serialize:(e,t)=>{let i=g(t,1);if(j(i)==="missing")return`\\error{${e.options.missingSymbol??"\\placeholder{}"}}`;let r=bp(e,t)||"\\blacksquare",n=v(i)==="ErrorCode"?j(g(i,1)):j(i);return n==="incompatible-type"?q(g(i,3))==="Undefined"?`\\mathtip{\\error{${r}}}{\\notin ${e.serialize(g(i,2))}}`:`\\mathtip{\\error{${r}}}{\\in ${e.serialize(g(i,3))}\\notin ${e.serialize(g(i,2))}}`:typeof n=="string"?`\\error{${r}}`:`\\error{${r}}`}},{name:"ErrorCode",serialize:(e,t)=>{let i=j(g(t,1));return i==="missing"?e.options.missingSymbol??"\\placeholder{}":i==="unexpected-command"||i==="unexpected-operator"||i==="unexpected-token"||i==="invalid-symbol"||i==="unknown-environment"||i==="unexpected-base"||i==="incompatible-type"?"":`\\texttip{\\error{\\blacksquare}}{\\mathtt{${i}}}`}},{name:"FromLatex",serialize:(e,t)=>`\\texttt{${yp(j(g(t,1)))}}`},{name:"Latex",serialize:(e,t)=>t===null?"":k(Hn(t,i=>j(i)??e.serialize(i)))},{name:"LatexString",serialize:(e,t)=>t===null?"":k(Hn(t,i=>e.serialize(i)))},{name:"LatexTokens",serialize:dp},{name:"At",kind:"postfix",precedence:810,latexTrigger:["["],parse:ts("]"),serialize:(e,t)=>k(["\\lbrack",ct(", ")(e,t),"\\rbrack"])},{kind:"postfix",precedence:810,latexTrigger:["\\lbrack"],parse:ts("\\rbrack")},{kind:"postfix",precedence:810,latexTrigger:["\\left","\\lbrack"],parse:ts("\\right","\\rbrack")},{kind:"postfix",latexTrigger:["_"],parse:(e,t,i)=>{let r=e.parseGroup()??e.parseToken();return["Subscript",t,r]}},{name:"List",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:To,serialize:xp},{kind:"matchfix",openTrigger:"(",closeTrigger:")",parse:vp},{latexTrigger:[","],kind:"infix",precedence:20,parse:(e,t,i)=>{let r=Xn(e,i,t,20,",");return r===null?null:["Delimiter",["Sequence",...r],{str:","}]}},{latexTrigger:[","],kind:"prefix",precedence:20,parse:(e,t)=>{let i=Xn(e,t,null,20,",");return i===null?null:["Delimiter",["Sequence",...i],{str:","}]}},{name:"Range",latexTrigger:[".","."],kind:"infix",precedence:800,parse:Np,serialize:(e,t)=>{let i=S(t);if(i.length===0)return"";if(i.length===1)return"1.."+e.serialize(g(t,1));if(i.length===2)return e.wrap(g(t,1),10)+".."+e.wrap(g(t,2),10);if(i.length===3){let r=z(g(t,3)),n=z(g(t,1));return r!==null&&n!==null?e.wrap(g(t,1),10)+".."+e.wrap(n+r,10)+".."+e.wrap(g(t,2),10):e.wrap(g(t,1),10)+"..("+(e.wrap(g(t,1),ce)+"+"+e.wrap(g(t,3),ce))+").."+e.wrap(g(t,2),10)}return""}},{latexTrigger:[";"],kind:"infix",precedence:19,parse:(e,t,i)=>{let r=Xn(e,i,t,19,";");return r===null?null:["Delimiter",["Sequence",...r],"';'"]}},{name:"String",latexTrigger:["\\text"],parse:e=>Nt(e),serialize:(e,t)=>{let i=S(t);return i.length===0?"\\text{}":k(["\\text{",i.map(r=>e.serialize(r)).join(""),"}"])}},{name:"Subscript",latexTrigger:["_"],kind:"infix",serialize:(e,t)=>K(t)===2?e.serialize(g(t,1))+"_{"+e.serialize(g(t,2))+"}":"_{"+e.serialize(g(t,1))+"}"},{name:"Superplus",latexTrigger:["^","+"],kind:"postfix"},{name:"Subplus",latexTrigger:["_","+"],kind:"postfix"},{name:"Superminus",latexTrigger:["^","-"],kind:"postfix"},{name:"Subminus",latexTrigger:["_","-"],kind:"postfix"},{latexTrigger:["^","*"],kind:"postfix",parse:(e,t)=>["Superstar",t]},{latexTrigger:["_","*"],kind:"postfix",parse:(e,t)=>["Substar",t]},{name:"Substar",latexTrigger:["_","\\star"],kind:"postfix"},{name:"Superdagger",latexTrigger:["^","\\dagger"],kind:"postfix"},{latexTrigger:["^","\\dag"],kind:"postfix",parse:(e,t)=>["Superdagger",t]},{name:"Prime",latexTrigger:["^","\\prime"],kind:"postfix",parse:(e,t)=>_t(e,t,1),serialize:(e,t)=>{let i=z(g(t,2))??1,r=e.serialize(g(t,1));return i===1?r+"^\\prime":i===2?r+"^\\doubleprime":i===3?r+"^\\tripleprime":r+"^{("+e.serialize(g(t,2))+")}"}},{latexTrigger:"^{\\prime\\prime}",kind:"postfix",parse:(e,t)=>_t(e,t,2)},{latexTrigger:"^{\\prime\\prime\\prime}",kind:"postfix",parse:(e,t)=>_t(e,t,3)},{latexTrigger:["^","\\doubleprime"],kind:"postfix",parse:(e,t)=>_t(e,t,2)},{latexTrigger:["^","\\tripleprime"],kind:"postfix",parse:(e,t)=>_t(e,t,3)},{latexTrigger:"'",kind:"postfix",precedence:810,parse:(e,t)=>_t(e,t,1)},{latexTrigger:"\\prime",kind:"postfix",precedence:810,parse:(e,t)=>_t(e,t,1)},{latexTrigger:"\\doubleprime",kind:"postfix",precedence:810,parse:(e,t)=>_t(e,t,2)},{latexTrigger:"\\tripleprime",kind:"postfix",precedence:810,parse:(e,t)=>_t(e,t,3)},{latexTrigger:["^","<{>","("],kind:"postfix",parse:(e,t,i)=>{let r=q(t);if(!r||!e.getSymbolType(r).matches("function"))return null;e.addBoundary([")"]);let n=e.parseExpression(i);return!e.matchBoundary()||!e.match("<}>")?null:["Derivative",t,n]}},{name:"InverseFunction",latexTrigger:"^{-1",kind:"postfix",parse:(e,t)=>{let i=q(t);if(!i||!e.getSymbolType(i).matches("function"))return null;let r=0;for(;!e.atEnd&&!e.match("<}>");)if(e.match("'"))r++;else if(e.match("\\prime"))r++;else if(e.match("\\doubleprime"))r+=2;else if(e.match("\\tripleprime"))r+=3;else return null;return r===1?["Derivative",["InverseFunction",t]]:r>0?["Derivative",["InverseFunction",t],r]:["InverseFunction",t]},serialize:(e,t)=>e.serialize(g(t,1))+"^{-1}"},{name:"Derivative",serialize:(e,t)=>{let i=z(g(t,2))??1,r=e.serialize(g(t,1));return i===1?r+"^{\\prime}":i===2?r+"^{\\doubleprime}":i===3?r+"^{\\tripleprime}":r+"^{("+e.serialize(g(t,2))+")}"}},{kind:"environment",name:"Which",symbolTrigger:"cases",parse:es,serialize:(e,t)=>{let i=[],r=S(t);if(r.length>0)for(let n=0;n<=r.length-2;n+=2){let s=[];s.push(e.serialize(r[n+1])),s.push(e.serialize(r[n])),i.push(s.join("&"))}return k(["\\begin{cases}",i.join("\\\\"),"\\end{cases}"])}},{kind:"environment",symbolTrigger:"dcases",parse:es},{kind:"environment",symbolTrigger:"rcases",parse:es}];function Nt(e,t){if(!e.match("<{>"))return"''";let i=[],r="",n=null,s=()=>{n!==null&&r?i.push(["Annotated",`'${r}'`,co(n)]):r&&i.push(`'${r}'`),r="",n=null};for(;!e.atEnd&&!e.match("<}>");)if(e.peek==="<{>")s(),i.push(Nt(e));else if(e.match("\\textbf"))s(),i.push(Nt(e,{fontWeight:"bold"}));else if(e.match("\\textmd"))s(),i.push(Nt(e,{fontStyle:"normal"}));else if(e.match("\\textup"))s(),i.push(Nt(e,{fontStyle:"normal"}));else if(e.match("\\textsl"))s(),i.push(Nt(e,{fontStyle:"italic"}));else if(e.match("\\textit"))s(),i.push(Nt(e,{fontStyle:"italic"}));else if(e.match("\\texttt"))s(),i.push(Nt(e,{fontFamily:"monospace"}));else if(e.match("\\textsf"))s(),i.push(Nt(e,{fontFamily:"sans-serif"}));else if(e.match("\\textcolor")){let o=e.index,l=e.parseStringGroup(),u=e.parseExpression();l!==null&&u!==null?i.push(["Annotated",u,{dict:{color:l}}]):(e.index=o,r+="\\textcolor")}else if(e.match("\\color")){let o=e.parseStringGroup();o!==null&&(s(),n={color:o})}else if(e.match("<space>"))r+=" ";else if(e.match("<$>")){let o=e.index,l=e.parseExpression()??"Nothing";e.skipSpace(),e.match("<$>")?i.push(l):(r+="$",e.index=o)}else if(e.match("<$$>")){let o=e.index,l=e.parseExpression()??"Nothing";e.skipSpace(),e.match("<$$>")?i.push(l):(r+="$$",e.index=o)}else{let o=e.parseChar()??e.nextToken();r+={"\\enskip":"","\\enspace":"","\\quad":"","\\qquad":"","\\space":"","\\ ":"","\\;":"","\\,":"","\\:":"","\\!":"","\\{":"{","\\}":"}","\\$":"$","\\&":"&","\\#":"#","\\%":"%","\\_":"_","\\textbackslash":"\\","\\textasciitilde":"~","\\textasciicircum":"^","\\textless":"<","\\textgreater":">","\\textbar":"|","\\textunderscore":"_","\\textbraceleft":"{","\\textbraceright":"}","\\textasciigrave":"`","\\textquotesingle":"'","\\textquotedblleft":"","\\textquotedblright":"","\\textquotedbl":'"',"\\textquoteleft":"","\\textquoteright":"","\\textbullet":"","\\textdagger":"","\\textdaggerdbl":"","\\textsection":"","\\textparagraph":"","\\textperiodcentered":"","\\textellipsis":"","\\textemdash":"","\\textendash":"","\\textregistered":"","\\texttrademark":"","\\textdegree":""}[o]??o}s();let a;return i.length===1?a=i[0]:i.every(o=>j(o)!==null)?a="'"+i.map(o=>j(o)).join()+"'":a=["Text",...i],t?["Annotated",a,co(t)]:a}function dp(e,t){return t===null?"":k(Hn(t,i=>{let r=j(i);return r===null?e.serialize(i):r==="<{>"?"{":r==="<}>"?"}":r==="<$>"?"$":r==="<$$>"?"$$":r==="<space>"?" ":r}))}function yp(e){return e===null?"":e.replace(/[{}\[\]\\:\-\$%]/g,t=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash "})[t]??"\\"+t)}function bp(e,t){let i=g(t,2);return i?v(i)==="LatexString"?j(g(i,1))??"":v(i)==="Hold"?e.serialize(g(i,1)):e.serialize(i):""}function _t(e,t,i){let r=v(t);if(r==="Derivative"||r==="Prime"){let s=z(g(t,2))??1;return[r,G(g(t,1)),s+i]}let n=q(t);return n&&e.getSymbolType(n).matches("function")||v(t)?i===1?["Derivative",t]:["Derivative",t,i]:i===1?["Prime",G(t)]:["Prime",G(t),i]}function vp(e,t){if(ie(t))return["Delimiter"];let i=v(t);if(i==="Delimiter"&&g(t,2)!==null){let r=j(g(t,2));if((r==null?void 0:r.length)===1)return["Delimiter",g(t,1)??"Nothing",{str:`(${r})`}]}return i==="Matrix"&&(j(g(t,2))??"..")===".."?["Matrix",g(t,1)]:["Delimiter",t]}function To(e,t){if(ie(t))return["List"];let i=v(t);if(i==="Range"||i==="Linspace")return t;if(i==="Sequence")return["List",...S(t)];if(i==="Delimiter"){let r=j(g(t,2))??"...";if(r===";"||r===".;.")return["List",...(S(g(t,1))??[]).map(n=>To(e,n))];if(r===","||r===".,.")return t=g(t,1),v(t)==="Sequence"?["List",...S(t)]:["List",t??"Nothing"]}return["List",t]}function xp(e,t){return K(t)>1&&S(t).every(i=>{let r=v(i);return Rr(r)||gi(r)})?k(["\\begin{cases}",ct("\\\\")(e,t),"\\end{cases}"]):k(["\\bigl\\lbrack",ct(", ")(e,t),"\\bigr\\rbrack"])}function Np(e,t){if(t===null)return null;let i=e.parseExpression({minPrec:270});if(i===null)return null;if(v(i)==="Range"){let r=g(i,1),n=g(i,2);return r&&n?["Range",t,n,["Subtract",r,t]]:null}return["Range",t,i]}var Vr={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","":"\\llbrack","":"\\rrbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","":"\\Vert","\\":"\\backslash","":"\\lceil","":"\\rceil","":"\\lfloor","":"\\rfloor","":"\\ulcorner","":"\\urcorner","":"\\llcorner","":"\\lrcorner","":"\\lmoustache","":"\\rmoustache"};function Br(e,t){if(v(t)==="InvisibleOperator"&&K(t)===2&&v(g(t,2))==="Delimiter"){let n=q(g(t,1));if(!n)return null;let s=e.parseExpression({minPrec:0});if(s===null)return null;let a=g(g(t,2),1),o=[];return v(a)==="Sequence"?o=[...S(a)]:a&&(o=[a]),["Assign",n,["Function",s,...o??[]]]}if(v(t)==="Subscript"&&q(g(t,1))){let n=q(g(t,1));if(!n)return null;let s=e.parseExpression({minPrec:0});if(s===null)return null;let a=g(t,2);return j(a)!==null?["Assign",t,s]:q(a)?["Assign",n,["Function",s,a]]:["Assign",t,s]}let i=v(t);if(i){let n=S(t),s=e.parseExpression({minPrec:0});return s===null?null:["Assign",i,["Function",s,...n]]}if(!q(t))return null;let r=e.parseExpression({minPrec:0});return r===null?null:["Assign",t,r]}function es(e){let t=e.parseTabular();if(!t)return["List"];if(t.every(r=>{if(r.length!==1)return!1;let n=v(r[0]);return gi(n)||Rr(n)}))return["List",...t.map(r=>r[0])];let i=[];for(let r of t)if(r.length===1)i.push("True"),i.push(r[0]);else if(r.length===2){let n=j(r[1]);i.push(n?"True":ao(r[1])??"True"),i.push(r[0])}return["Which",...i]}function ts(...e){return(t,i)=>{if(!q(i)&&v(i)!=="List")return null;let r=null;return e.length===0&&(r=t.parseGroup()),r??(r=t.parseExpression({minPrec:0})),r===null||e.length>0&&!t.matchAll(e)||j(r)!==null?null:(v(r)==="Delimiter"&&(r=g(r,1)??"Nothing"),v(r)==="Sequence"?["At",i,...S(r)]:["At",i,r])}}var _p=[{name:"Matrix",serialize:(e,t)=>{let i=S(g(t,1));return Eo(e,i,j(g(t,2)),j(g(t,3)))}},{name:"Vector",serialize:(e,t)=>{let i=S(t);return Eo(e,i.map(r=>["List",r]),j(g(t,2)),j(g(t,3)))}},{kind:"environment",symbolTrigger:"pmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:"()"},{str:t}]:[i,r]}},{kind:"environment",symbolTrigger:"bmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:"[]"},{str:t}]:[i,r,{str:"[]"}]}},{kind:"environment",symbolTrigger:"Bmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:"{}"},{str:t}]:[i,r,{str:"{}"}]}},{kind:"environment",symbolTrigger:"vmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:"||"},{str:t}]:[i,r,{str:"||"}]}},{kind:"environment",symbolTrigger:"Vmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:""},{str:t}]:[i,r,{str:""}]}},{kind:"environment",symbolTrigger:"smallmatrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:"()"},{str:t}]:[i,r]}},{kind:"environment",symbolTrigger:"array",parse:e=>{let t=kt(e,!1),[i,r]=wt(e);return t?[i,r,{str:".."},{str:t}]:[i,r,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:".."},{str:t}]:[i,r,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix*",parse:e=>{let t=kt(e),[i,r]=wt(e);return t?[i,r,{str:".."},{str:t}]:[i,r,{str:".."}]}},{name:"ConjugateTranspose",kind:"postfix",latexTrigger:["^","\\star"]},{kind:"postfix",latexTrigger:["^","\\H"],parse:"ConjugateTranspose"},{kind:"postfix",latexTrigger:["^","\\dagger"],parse:(e,t)=>["ConjugateTranspose",t]},{kind:"postfix",latexTrigger:["^","\\ast"],parse:(e,t)=>["ConjugateTranspose",t]},{kind:"postfix",latexTrigger:["^","\\top"],parse:(e,t)=>["Transpose",t]},{kind:"postfix",latexTrigger:["^","\\intercal"],parse:(e,t)=>["Transpose",t]},{name:"Transpose",kind:"postfix",latexTrigger:["^","T"]},{name:"PseudoInverse",kind:"postfix",latexTrigger:["^","+"]},{name:"Trace",kind:"function",symbolTrigger:"tr"},{name:"Determinant",kind:"function",symbolTrigger:"det"}];function wt(e){let t=e.parseTabular();return t?["Matrix",["List",...t.map(i=>["List",...i])]]:["",null]}function kt(e,t=!0){var n;let i=(n=e.parseStringGroup(t))==null?void 0:n.trim();if(!i)return"";let r="";for(let s of i)s==="c"&&(r+="="),s==="l"&&(r+="<"),s==="r"&&(r+=">"),s==="|"&&(r+="|"),s===":"&&(r+=":");return r}function Eo(e,t,i,r){i??(i="()");let[n,s]=["",""];typeof i=="string"&&i.length===2&&([n,s]=i);let a="";if(r)for(let c of r)c==="<"?a+="l":c===">"?a+="r":c==="="?a+="c":c==="|"?a+="|":c===":"&&(a+=":");let o=[];for(let c of t??[]){let f=[];for(let p of S(c))f.push(e.serialize(p));o.push(f.join(" & "))}let l=o.join(`\\\\
`),u=a.length>0?`[${a}]`:"";return k(n==="("&&s===")"?["\\begin{pmatrix}",u,l,"\\end{pmatrix}"]:n==="["&&s==="]"?["\\begin{bmatrix}",u,l,"\\end{bmatrix}"]:n==="{"&&s==="}"?["\\begin{Bmatrix}",u,l,"\\end{Bmatrix}"]:n==="|"&&s==="|"?["\\begin{vmatrix}",u,l,"\\end{vmatrix}"]:n===""&&s===""?["\\begin{Vmatrix}",u,l,"\\end{Vmatrix}"]:n==="{"&&s==="."?["\\begin{dcases}",u,l,"\\end{dcases}"]:n==="."&&s==="}"?["\\begin{rcases}",u,l,"\\end{rcases}"]:a||n!=="."||s!=="."?["\\left",Vr[n]??n,"\\begin{array}",`{${a}}`,l,"\\end{array}","\\right",Vr[s]??s]:["\\begin{matrix}",l,"\\end{matrix}"])}var wp=[{name:"True",kind:"symbol",latexTrigger:["\\top"]},{kind:"symbol",latexTrigger:"\\mathrm{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\operatorname{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\mathsf{T}",parse:"True"},{name:"False",kind:"symbol",latexTrigger:["\\bot"]},{kind:"symbol",latexTrigger:"\\operatorname{False}",parse:"False"},{kind:"symbol",latexTrigger:"\\mathsf{F}",parse:"False"},{name:"And",kind:"infix",latexTrigger:["\\land"],precedence:317},{kind:"infix",latexTrigger:["\\wedge"],parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\&",parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\operatorname{and}",parse:"And",precedence:317},{name:"Or",kind:"infix",latexTrigger:["\\lor"],precedence:310},{kind:"infix",latexTrigger:["\\vee"],parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\parallel",parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\operatorname{or}",parse:"Or",precedence:310},{name:"Xor",kind:"infix",latexTrigger:["\\veebar"],precedence:315},{name:"Not",kind:"prefix",latexTrigger:["\\lnot"],precedence:880},{kind:"prefix",latexTrigger:["\\neg"],parse:"Not",precedence:880},{name:"Nand",kind:"infix",latexTrigger:["\\barwedge"],precedence:315},{name:"Nor",kind:"infix",latexTrigger:[""],precedence:315},{kind:"function",symbolTrigger:"and",parse:"And"},{kind:"function",symbolTrigger:"or",parse:"Or"},{kind:"function",symbolTrigger:"not",parse:"Not"},{name:"Implies",kind:"infix",precedence:220,associativity:"right",latexTrigger:["\\implies"],serialize:"\\implies"},{latexTrigger:["\\Rightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{name:"Equivalent",latexTrigger:["\\iff"],kind:"infix",associativity:"right",precedence:219},{latexTrigger:["\\Leftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\equiv"],kind:"infix",associativity:"right",precedence:219,parse:(e,t,i)=>{let r=e.parseExpression({...i,minPrec:219}),n=e.index,s=e.parseExpression({...i,minPrec:219});return s!==null&&v(s)==="Mod"?["Congruent",t,r,G(g(s,1))]:(e.index=n,["Equivalent",t,G(r)])}},{name:"Proves",kind:"infix",latexTrigger:["\\vdash"],precedence:220,associativity:"right",serialize:"\\vdash"},{name:"Entails",kind:"infix",latexTrigger:["\\vDash"],precedence:220,associativity:"right",serialize:"\\vDash"},{name:"Satisfies",kind:"infix",latexTrigger:["\\models"],precedence:220,associativity:"right",serialize:"\\models"},{name:"ForAll",kind:"prefix",latexTrigger:["\\forall"],precedence:200,serialize:"\\forall",parse:ji("ForAll")},{name:"Exists",kind:"prefix",latexTrigger:["\\exists"],precedence:200,serialize:"\\exists",parse:ji("Exists")},{name:"ExistsUnique",kind:"prefix",latexTrigger:["\\exists","!"],precedence:200,serialize:"\\exists!",parse:ji("ExistsUnique")},{name:"NotForAll",kind:"prefix",latexTrigger:["\\lnot","\\forall"],precedence:200,serialize:"\\lnot\\forall",parse:ji("NotForAll")},{name:"NotExists",kind:"prefix",latexTrigger:["\\lnot","\\exists"],precedence:200,serialize:"\\lnot\\exists",parse:ji("NotExists")},{name:"KroneckerDelta",kind:"prefix",latexTrigger:["\\delta","_"],precedence:200,serialize:(e,t)=>{let i=S(t);return i.length===0?"\\delta":i.every(r=>q(r))?`\\delta_{${i.map(r=>e.serialize(r)).join("")}}`:`\\delta_{${i.map(r=>e.serialize(r)).join(", ")}}`},parse:e=>{let t=e.parseGroup();if(t===null){let r=e.parseToken();return r?["KroneckerDelta",r]:null}let i=Vi(t);return i&&i.length<=2?["KroneckerDelta",...i]:v(t)==="InvisibleOperator"?["KroneckerDelta",...S(t)]:t!==null?["KroneckerDelta",t]:null}},{name:"Boole",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:(e,t)=>{let i=v(t);return!i||!Lr.some(r=>r.name===i)?null:["Boole",t]}},{kind:"matchfix",openTrigger:"\\llbracket",closeTrigger:"\\rrbracket",parse:(e,t)=>{let i=v(t);return!i||!Lr.some(r=>r.name===i)?null:["Boole",t]}}];function ji(e){return(t,i)=>{let r=t.index,n=t.parseSymbol(i);if(n){if(t.skipSpace(),t.match(",")||t.match("\\mid")||t.match(".")||t.match(":")||t.match("\\colon")){let o=t.parseExpression(i);return[e,n,G(o)]}let a=t.parseEnclosure();if(a)return[e,n,G(a)]}t.index=r;let s=t.parseExpression(i);if(s===null)return null;if(t.skipSpace(),t.matchAny([",","\\mid",":","\\colon"])){let a=t.parseExpression(i);return[e,s,G(a)]}if(t.match("(")){let a=t.parseExpression(i);return t.match(")")?[e,s,G(a)]:null}return null}}function Oe(e){return t=>{let i=t.parseGroup();return i===null?[e]:[e,i]}}var kp=[{name:"Overscript",latexTrigger:["\\overset"],kind:"infix",precedence:700},{name:"Underscript",latexTrigger:["\\underset"],kind:"infix",precedence:700},{name:"Increment",latexTrigger:["+","+"],kind:"postfix",precedence:880,parse:(e,t)=>q(t)===null?null:["Decrement",t]},{name:"Decrement",latexTrigger:["-","-"],kind:"postfix",precedence:880,parse:(e,t)=>q(t)===null?null:["Decrement",t]},{name:"PreIncrement",latexTrigger:["+","+"],kind:"prefix",precedence:880,parse:(e,t)=>{let i=e.parseExpression(t);return q(i)===null?null:["PreIncrement",i]}},{name:"PreDecrement",latexTrigger:["-","-"],kind:"prefix",precedence:880,parse:(e,t)=>{let i=e.parseExpression(t);return q(i)===null?null:["PreDecrement",i]}},{name:"Ring",latexTrigger:["\\circ"],kind:"infix",precedence:265},{name:"StringJoin",latexTrigger:["\\lt","\\gt"],kind:"infix",precedence:780},{name:"Starstar",latexTrigger:["\\star","\\star"],kind:"infix",precedence:780},{name:"PartialDerivative",latexTrigger:["\\partial"],kind:"prefix",parse:e=>{let t=!1,i="Nothing",r="Nothing";for(;!t;)e.skipSpace(),e.match("_")?r=e.parseGroup()??e.parseToken():e.match("^")?i=e.parseGroup()??e.parseToken():t=!0;let n=Vi(r);if(n&&(r=["List",...n]),r===null||i===null)return null;let s=e.parseGroup()??"Nothing";if(!ie(s)){let a=e.parseArguments()??["Nothing"];s=[s,...a]}return["PartialDerivative",s,r,i]},serialize:(e,t)=>{let i="\\partial",r=g(t,1),n=g(t,2),s=g(t,3);return n!==null&&n!=="Nothing"&&(v(n)==="List"?i+="_{"+e.serialize(["Sequence",...S(n)])+"}":i+="_{"+e.serialize(n)+"}"),s!==null&&s!=="Nothing"&&(i+="^{"+e.serialize(s)+"}"),r!==null&&r!=="Nothing"&&(i+=e.serialize(r)),i},precedence:740},{name:"OverBar",latexTrigger:["\\overline"],parse:Oe("OverBar")},{name:"UnderBar",latexTrigger:["\\underline"],parse:Oe("UnderBar")},{name:"OverVector",latexTrigger:["\\vec"],parse:Oe("OverVector")},{name:"OverTilde",latexTrigger:["\\tilde"],parse:Oe("OverTilde")},{name:"OverHat",latexTrigger:["\\hat"],parse:Oe("OverHat")},{name:"OverRightArrow",latexTrigger:["\\overrightarrow"],parse:Oe("OverRightArrow")},{name:"OverLeftArrow",latexTrigger:["\\overleftarrow"],parse:Oe("OverLeftArrow")},{name:"OverRightDoubleArrow",latexTrigger:["\\Overrightarrow"],parse:Oe("OverRightDoubleArrow")},{name:"OverLeftHarpoon",latexTrigger:["\\overleftharpoon"],parse:Oe("OverLeftHarpoon")},{name:"OverRightHarpoon",latexTrigger:["\\overrightharpoon"],parse:Oe("OverRightHarpoon")},{name:"OverLeftRightArrow",latexTrigger:["\\overleftrightarrow"],parse:Oe("OverLeftRightArrow")},{name:"OverBrace",latexTrigger:["\\overbrace"],parse:Oe("OverBrace")},{name:"OverLineSegment",latexTrigger:["\\overlinesegment"],parse:Oe("OverLineSegment")},{name:"OverGroup",latexTrigger:["\\overgroup"],parse:Oe("OverGroup")},{latexTrigger:["\\textcolor"],parse:e=>{let t=e.index,i=e.parseStringGroup(),r=e.parseGroup();return i!==null?r!==null?["Annotated",r,{dict:{color:i}}]:"Nothing":(e.index=t,"Nothing")}},{latexTrigger:["\\displaystyle"],parse:()=>"Nothing"},{latexTrigger:["\\textstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptscriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\tiny"],parse:()=>"Nothing"},{latexTrigger:["\\scriptsize"],parse:()=>"Nothing"},{latexTrigger:["\\footnotesize"],parse:()=>"Nothing"},{latexTrigger:["\\small"],parse:()=>"Nothing"},{latexTrigger:["\\normalsize"],parse:()=>"Nothing"},{latexTrigger:["\\large"],parse:()=>"Nothing"},{latexTrigger:["\\Large"],parse:()=>"Nothing"},{latexTrigger:["\\LARGE"],parse:()=>"Nothing"},{latexTrigger:["\\huge"],parse:()=>"Nothing"},{latexTrigger:["\\Huge"],parse:()=>"Nothing"},{name:"Annotated",serialize:(e,t)=>{let i=e.serialize(g(t,1)),r=uo(g(t,2));if(r===null)return i;j(r.dict.mathStyle)==="normal"?i=k(["{\\displaystyle",i,"}"]):j(r.dict.mathStyle)==="compact"&&(i=k(["{\\textstyle",i,"}"]));let n=z(r.dict.size);return n!==null&&n>=1&&n<=10&&(i=k(["{",{1:"\\tiny",2:"\\scriptsize",3:"\\footnotesize",4:"\\small",5:"\\normalsize",6:"\\large",7:"\\Large",8:"\\LARGE",9:"\\huge",10:"\\Huge"}[n],i,"}"])),i}},{latexTrigger:["\\!"],parse:()=>["HorizontalSpacing",-3]},{latexTrigger:["\\ "],parse:()=>["HorizontalSpacing",6]},{latexTrigger:["\\:"],parse:()=>["HorizontalSpacing",4]},{latexTrigger:["\\enskip"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\quad"],parse:()=>["HorizontalSpacing",18]},{latexTrigger:["\\qquad"],parse:()=>["HorizontalSpacing",36]},{latexTrigger:["\\,"],parse:()=>["HorizontalSpacing",3]},{latexTrigger:["\\;"],parse:()=>["HorizontalSpacing",5]},{latexTrigger:["\\enspace"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\phantom"],parse:e=>(e.parseGroup(),"Nothing")},{latexTrigger:["\\vphantom"],parse:e=>(e.parseGroup(),"Nothing")},{latexTrigger:["\\hphantom"],parse:e=>(e.parseGroup(),"Nothing")},{latexTrigger:["\\placeholder"],parse:e=>(e.parseOptionalGroup(),e.parseGroup()??"Nothing")},{latexTrigger:["\\smash"],parse:e=>(e.parseGroup(),"Nothing")},{latexTrigger:["\\strut"],parse:e=>"Nothing"},{latexTrigger:["\\mathstrut"],parse:e=>"Nothing"},{name:"HorizontalSpacing",serialize:(e,t)=>{if(g(t,2)!==null)return e.serialize(g(t,1));let i=z(g(t,1));return i===null?"":{"-3":"\\!",6:"\\ ",3:"\\,",4:"\\:",5:"\\;",9:"\\enspace",18:"\\quad",36:"\\qquad"}[i]??""}}];function M(e){return(t,i)=>{let r={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arccot","\\arcsec":"Arcsec","\\arccsc":"Arccsc","\\arsinh":"Arsinh","\\arcosh":"Arccosh","\\arccosh":"Arccosh","\\artanh":"Arctanh","\\arctanh":"Arctanh","\\arsech":"Arcsech","\\arcsech":"Arcsech","\\arcsch":"Arccsch","\\arccsch":"Arccsch","\\ch":"Cosh","\\cos":"Cos","\\cosh":"Csch","\\cosec":"Csc","\\cot":"Cot","\\cotg":"Cot","\\ctg":"Cot","\\csc":"Csc","\\csch":"Csch","\\coth":"Coth","\\cth":"Coth","\\sec":"Sec","\\sech":"Sech","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tg":"Tan","\\tanh":"Tanh","\\th":"Tanh"},n=r[e??""]??e??"";if(t.atTerminator(i))return n;let s=n;do{let u=t.parsePostfixOperator(s,i);if(u===null)break;s=u}while(!0);t.skipSpace();let a=null;t.match("^")&&(a=t.parseGroup()??t.parseToken()),t.skipSpace();let o=t.parseArguments("implicit",{minPrec:Ke,condition:u=>{var c;return r[u.peek]||(((c=i==null?void 0:i.condition)==null?void 0:c.call(i,u))??!1)}}),l=o===null?s:typeof s=="string"?[s,...o]:["Apply",s,...o];return a===null?l:["Power",l,a]}}var Sp=[{name:"Arcsin",latexTrigger:["\\arcsin"],parse:M("Arcsin")},{name:"Arccos",latexTrigger:["\\arccos"],parse:M("Arccos")},{name:"Arctan",latexTrigger:["\\arctan"],parse:M("Arctan")},{latexTrigger:["\\arctg"],parse:M("Arctan")},{symbolTrigger:"arctg",parse:M("Arctan")},{name:"Arccot",symbolTrigger:"arcctg",parse:M("Arccot")},{latexTrigger:["\\arcctg"],parse:M("Arccot")},{name:"Arccoth",symbolTrigger:"arccoth",parse:M("Arccoth")},{symbolTrigger:"arcoth",parse:M("Arccoth")},{symbolTrigger:"arccoth",parse:M("Arccoth")},{latexTrigger:["\\arccoth"],parse:M("Arccoth")},{name:"Arcsec",symbolTrigger:"arcsec",parse:M("Arcsec")},{latexTrigger:["\\arcsec"],parse:M("Arcsec")},{name:"Arccsc",symbolTrigger:"arccsc",parse:M("Arccsc")},{latexTrigger:["\\arccsc"],parse:M("Arccsc")},{name:"Arcsinh",symbolTrigger:"arcsinh",parse:M("Arcsinh")},{latexTrigger:["\\arsinh"],parse:M("Arcsinh")},{latexTrigger:["\\arcsinh"],parse:M("Arcsinh")},{name:"Arccosh",symbolTrigger:"arccosh",parse:M("Arccosh")},{latexTrigger:"\\arccosh",parse:M("Arccosh")},{latexTrigger:"\\arcosh",parse:M("Arccosh")},{symbolTrigger:"arcosh",parse:M("Arccosh")},{name:"Arctanh",symbolTrigger:"arctanh",parse:M("Arctanh")},{symbolTrigger:"artanh",parse:M("Arctanh")},{latexTrigger:"\\artanh",parse:M("Arctanh")},{latexTrigger:["\\arctanh"],parse:M("Arctanh")},{symbolTrigger:"artanh",parse:M("Arctanh")},{name:"Arcsech",symbolTrigger:"arcsech",parse:M("Arcsech")},{latexTrigger:["\\arcsech"],parse:M("Arcsech")},{latexTrigger:["\\arsech"],parse:M("Arcsech")},{name:"Arccsch",symbolTrigger:"arccsch",parse:M("Arccsch")},{latexTrigger:["\\arccsch"],parse:M("Arccsch")},{latexTrigger:["\\arcsch"],parse:M("Arccsch")},{name:"Cosec",symbolTrigger:"cosec",parse:M("Cosec")},{latexTrigger:["\\cosec"],parse:M("Cosec")},{name:"Cosh",latexTrigger:["\\cosh"],parse:M("Cosh")},{latexTrigger:["\\ch"],parse:M("Cosh")},{name:"Cot",latexTrigger:["\\cot"],parse:M("Cot")},{latexTrigger:["\\cotg"],parse:M("Cot")},{latexTrigger:["\\ctg"],parse:M("Cot")},{name:"Csc",latexTrigger:["\\csc"],parse:M("Csc")},{name:"Csch",latexTrigger:["\\csch"],parse:M("Csch")},{name:"Coth",latexTrigger:["\\coth"],parse:M("Coth")},{latexTrigger:["\\cth"],parse:M("Coth")},{symbolTrigger:"cth",parse:M("Coth")},{latexTrigger:["\\coth"],parse:M("Coth")},{name:"Sec",latexTrigger:["\\sec"],parse:M("Sec")},{name:"Sech",symbolTrigger:"sech",parse:M("Sech")},{latexTrigger:["\\sech"],parse:M("Sech")},{name:"Sinh",latexTrigger:["\\sinh"],parse:M("Sinh")},{latexTrigger:["\\sh"],parse:M("Sinh")},{name:"Tan",latexTrigger:["\\tan"],parse:M("Tan")},{latexTrigger:["\\tg"],parse:M("Tan")},{name:"Tanh",latexTrigger:["\\tanh"],parse:M("Tanh")},{latexTrigger:["\\th"],parse:M("Tanh")},{name:"Cos",latexTrigger:["\\cos"],parse:M("Cos")},{name:"Sin",latexTrigger:["\\sin"],parse:M("Sin")}],Tp=[{name:"AlgebraicNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"AlgebraicNumbers"},{name:"ComplexNumbers",latexTrigger:["\\C"]},{latexTrigger:"\\mathbb{C}",parse:"ComplexNumbers"},{name:"ImaginaryNumbers",latexTrigger:["\\imaginaryI","\\R"]},{name:"EmptySet",latexTrigger:["\\emptyset"]},{latexTrigger:["\\varnothing"],parse:"EmptySet"},{name:"Integers",latexTrigger:["\\Z"]},{latexTrigger:"\\mathbb{Z}",parse:"Integers"},{name:"RationalNumbers",latexTrigger:["\\Q"]},{latexTrigger:"\\mathbb{Q}",parse:"RationalNumbers"},{name:"RealNumbers",latexTrigger:["\\R"]},{latexTrigger:"\\mathbb{R}",parse:"RealNumbers"},{name:"TranscendentalNumbers",latexTrigger:"\\R-\\bar\\Q"},{latexTrigger:"\\R\\backslash\\bar\\Q",parse:"TranscendentalNumbers"},{name:"NegativeNumbers",latexTrigger:"\\R_{<0}"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R^{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R_-",parse:"NegativeNumbers"},{latexTrigger:"\\R_{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt0}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<0}",parse:"NegativeNumbers"},{name:"NonPositiveNumbers",latexTrigger:"\\R_{\\le0}"},{latexTrigger:"\\R^{\\leq0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{-0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{\\leq}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{0-}",parse:"NonPositiveNumbers"},{name:"PositiveNumbers",latexTrigger:"\\R_{>0}"},{latexTrigger:"\\R^+",parse:"PositiveNumbers"},{latexTrigger:"\\R^{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R_+",parse:"PositiveNumbers"},{latexTrigger:"\\R_{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt 0}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>0}",parse:"PositiveNumbers"},{name:"NonNegativeNumbers",latexTrigger:"\\R_{\\geq0}"},{latexTrigger:"\\R^{0+}",parse:"NonNegativeNumbers"},{latexTrigger:"\\R^{\\geq}",parse:"NonNegativeNumbers"},{name:"ExtendedRealNumbers",latexTrigger:"\\overline\\R"},{latexTrigger:"\\bar\\R",parse:"ExtendedRealNumbers"},{name:"NegativeIntegers",latexTrigger:"\\Z_{<0}"},{latexTrigger:"\\Z_{\\lt0}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^-",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z_-",parse:"NegativeIntegers"},{latexTrigger:"\\Z_{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{\\lt}",parse:"NegativeIntegers"},{name:"NonPositiveIntegers",latexTrigger:"\\Z_{\\le0}"},{latexTrigger:"\\Z_{\\leq0}",parse:"NonPositiveIntegers"},{latexTrigger:"\\Z_{<0}",parse:"NonPositiveIntegers"},{name:"PositiveIntegers",latexTrigger:"\\N^*"},{latexTrigger:"\\Z_{>0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_+",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\N^+",parse:"PositiveIntegers"},{latexTrigger:"\\N^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\N^*",parse:"PositiveIntegers"},{latexTrigger:"\\N^{*}",parse:"PositiveIntegers"},{latexTrigger:"\\N^\\star",parse:"PositiveIntegers"},{latexTrigger:"\\N^{\\star}",parse:"PositiveIntegers"},{latexTrigger:"\\N_1",parse:"PositiveIntegers"},{latexTrigger:"\\N_{1}",parse:"PositiveIntegers"},{name:"NonNegativeIntegers",latexTrigger:["\\N"]},{latexTrigger:"\\Z^{+0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{0+}",parse:"NonNegativeIntegers"},{latexTrigger:"\\mathbb{N}",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_0",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_{0}",parse:"NonNegativeIntegers"},{name:"ExtendedIntegers",latexTrigger:"\\overline\\Z"},{latexTrigger:"\\bar\\Z",parse:"ExtendedIntegers"},{name:"ExtendedRationalNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"ExtendedRationalNumbers"},{name:"ExtendedComplexNumbers",latexTrigger:"\\overline\\C"},{latexTrigger:"\\bar\\C",parse:"ExtendedComplexNumbers"},{latexTrigger:["^","\\complement"],kind:"postfix",parse:(e,t)=>["Complement",t]},{name:"Complement",latexTrigger:["^","<{>","\\complement","<}>"],kind:"postfix"},{name:"Intersection",latexTrigger:["\\cap"],kind:"infix",precedence:350},{name:"Interval",serialize:Io},{name:"Multiple",serialize:Io},{name:"Union",latexTrigger:["\\cup"],kind:"infix",precedence:350},{name:"Set",kind:"matchfix",openTrigger:"{",closeTrigger:"}",parse:(e,t)=>ie(t)?"EmptySet":(v(t)=="Delimiter"&&j(g(t,2))===","&&(t=g(t,1)),v(t)!=="Sequence"?["Set",t]:["Set",...S(t)]),serialize:(e,t)=>k(["\\lbrace",S(t).map(i=>e.serialize(i)).join(", "),"\\rbrace"])},{name:"SetMinus",latexTrigger:["\\setminus"],kind:"infix",precedence:650},{name:"SymmetricDifference",latexTrigger:["\\triangle"],kind:"infix",precedence:V},{latexTrigger:["\\ni"],kind:"infix",associativity:"none",precedence:160,parse:(e,t,i)=>{let r=e.parseExpression(i);return r===null?null:["Element",r,t]}},{name:"Element",latexTrigger:["\\in"],kind:"infix",precedence:240},{name:"NotElement",latexTrigger:["\\notin"],kind:"infix",precedence:240},{name:"NotSubset",latexTrigger:["\\nsubset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSuperset",latexTrigger:["\\nsupset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSubsetNotEqual",latexTrigger:["\\nsubseteq"],kind:"infix",associativity:"none",precedence:240},{name:"NotSupersetNotEqual",latexTrigger:["\\nsupseteq"],kind:"infix",associativity:"none",precedence:240},{name:"SquareSubset",latexTrigger:["\\sqsubset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSubsetEqual",latexTrigger:["\\sqsubseteq"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSuperset",latexTrigger:["\\sqsupset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSupersetEqual",latexTrigger:["\\sqsupseteq"],kind:"infix",associativity:"none",precedence:265},{name:"Subset",latexTrigger:["\\subset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\subsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{latexTrigger:["\\varsubsetneqq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{name:"SubsetEqual",latexTrigger:["\\subseteq"],kind:"infix",associativity:"none",precedence:240},{name:"Superset",latexTrigger:["\\supset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\supsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{latexTrigger:["\\varsupsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{name:"SupersetEqual",latexTrigger:["\\supseteq"],kind:"infix",associativity:"none",precedence:240}];function Io(e,t){if(t===null)return"";let i=v(t);if(!i)return"";if(i==="Set")return K(t)===0?"\\emptyset":K(t)===2&&v(g(t,2))==="Condition"?k(["\\left\\lbrace",e.serialize(g(t,1)),"\\middle\\mid",e.serialize(g(t,2)),"\\right\\rbrace"]):k(["\\left\\lbrace",...S(t).map(r=>e.serialize(r)+" ,"),"\\right\\rbrace"]);if(i==="Range")return k(["\\mathopen\\lbrack",e.serialize(g(t,1)),", ",e.serialize(g(t,2)),"\\mathclose\\rbrack"]);if(i==="Interval"){let r=g(t,1),n=g(t,2),s=!1,a=!1;return v(r)==="Open"&&(r=g(r,1),s=!0),v(n)==="Open"&&(n=g(n,1),a=!0),k([`\\mathopen${s?"\\rbrack":"\\lbrack"}`,e.serialize(r),", ",e.serialize(n),`\\mathclose${a?"\\lbrack":"\\rbrack"}`])}return e.numericSetStyle(t,e.level),""}function di(e){return t=>{let i=!1,r=[],n=[];for(;!i;){t.skipVisualSpace(),t.match("\\limits"),t.skipSpace();let o=null,l=null;for(;!(l!==null&&o!==null)&&(t.peek==="_"||t.peek==="^");)t.match("_")?l=t.parseGroup()??t.parseToken():t.match("^")&&(o=t.parseGroup()??t.parseToken()),t.skipSpace();ie(l)&&(l=null),ie(o)&&(o=null),r.push(l??"Nothing"),n.push(o??"Nothing"),t.skipVisualSpace(),i=!t.match(e)}let[s,a]=Ep(t);if(s&&a.length===0){if(v(s)==="Add"||v(s)==="Subtract"){let o=[],l=[];for(let u of S(s))if(a)l.push(u);else{let c;[c,a]=St(u),o.push(c??u)}if(a!==null&&l.length>0)return["Add",Mo(e,["Add",...o],{indexes:a,subs:r,sups:n})??"Nothing",...l]}else if(v(s)==="Divide"){let o;[o,a]=St(g(s,1)),o!==null&&a!==null&&(s=["Divide",o,g(s,2)])}}return Mo(e,s,{indexes:a,subs:r,sups:n})}}function Mo(e,t,i){if(!t)return null;if(i.sups.length===0&&i.subs.length===0)return[e,t,...i.indexes];let r=i.indexes.length===0?v(t)==="Function"?S(t).slice(1):[]:i.indexes,n=Math.max(i.sups.length,i.subs.length,r.length);if(r.length===0)for(let a=0;a<n;a++)r.push("Nothing");else if(r.length!==n)for(let a=r.length;a<n;a++)r.push(["Error","'missing'"]);if(i.subs.length!==n)for(let a=i.subs.length;a<n;a++)i.subs.push("Nothing");if(i.sups.length!==n)for(let a=i.sups.length;a<n;a++)i.sups.push("Nothing");let s=r.map((a,o)=>{let l=i.sups[o],u=i.subs[o];return u==="Nothing"&&l==="Nothing"?a:["Tuple",a,u,l]});return[e,t,...s]}function Ep(e){let t=!1,i=e.parseExpression({minPrec:266,condition:()=>{let r=e.index;return t=$o(e),e.index=r,t}});return i!==null&&!t?St(i):[i,Ip(e)]}function Ip(e){let t=[];for(;$o(e);){e.skipVisualSpace();let i=q(e.parseSymbol());if(i===null)return t;t.push(i)}return t}function St(e){let t=v(e),i=g(e,1);if(!i)return[e,[]];if(t==="Sequence"&&K(e)===1)return St(i);if(t==="Multiply"||t==="InvisibleOperator"){let r=S(e);if(r){let[n,s]=Ap(r);return n.length>0?[[t,...n],s]:[null,s]}}else if(t==="Delimiter"){let[r,n]=St(i);if(n)return r?[["Delimiter",["Sequence",r],...S(e).slice(1)],n]:[null,n]}else if(t==="Add"){let r=S(e);if(r.length>0){let[n,s]=St(r[r.length-1]);if(s.length>0){if(n)return[["Add",...r.slice(0,-1),n],s];if(r.length>2)return[["Add",...r.slice(0,-1)],s];if(r.length>2)return[r[0],s]}}}else if(t==="Negate"){let[r,n]=St(i);if(n.length>0)return[r?["Negate",r]:null,n]}else if(t==="Divide"){let[r,n]=St(i);if(n.length>0)return[["Divide",r??1,g(e,2)],n]}else{let r=S(e);if(r.length===1){let[n,s]=St(r[0]);if(s.length>0)return[[v(e),n],s]}}return[e,[]]}function Ao(e){return(t,i)=>{if(!g(i,1))return e;let r=g(i,1),n=[];v(r)==="BuiltInFunction"?(n=["x"],r=[g(r,1),"x"]):v(r)==="Function"?(n=S(r).slice(1),r=g(r,1)):q(r)?n=[]:n=[];let s=S(i).slice(1),a=[],o=s.map((u,c)=>{if(q(u)==="Nothing")return a.push(q(n[c])??"Nothing"),"";if(q(u))return a.push(q(u)??"Nothing"),"";let f=v(u);if(f==="Tuple"||f==="Pair"||f==="Limits"||f==="Range"){if(K(u)===3){let p=g(u,1);a.push(q(p)??"Nothing");let h=g(u,2),d=g(u,3);return q(h)==="Nothing"&&(h=null),q(d)==="Nothing"&&(d=null),h!==null&&d!==null?`_{${t.serialize(h)}}^{${t.serialize(d)}}`:h!==null?`_{${t.serialize(h)}}`:d!==null?`^{${t.serialize(d)}}`:""}return`_{${t.serialize(u)}}`}if(K(u)===2){if(q(g(u,1))){a.push(q(g(u,1))??"Nothing");let d=g(u,2);return q(d)==="Nothing"?"":`_{${t.serialize(d)}}`}a.push(q(n[c])??"Nothing");let p=g(u,1),h=g(u,2);if(q(p)==="Nothing"&&(p=null),q(h)==="Nothing"&&(h=null),p!==null&&h!==null)return`_{${t.serialize(p)}}^{${t.serialize(h)}}`;if(p!==null)return`_{${t.serialize(p)}}`;if(h!==null)return`^{${t.serialize(h)}}`}else a.push(q(n[c])??"Nothing")}),l=a.filter(u=>q(u)!=="Nothing").map(u=>`\\mathrm{d}${t.serialize(q(u)??"x")}`);return l.length>0&&(l=["\\,",...l]),o.length===0?`${e}\\,${t.serialize(r)}\\!${l.join(" ")}`:o.reverse().map(u=>`${e}${u}`).join("")+"\\!"+t.serialize(r)+l.join(" ")}}var Mp=[{kind:"expression",name:"Integrate",latexTrigger:["\\int"],parse:di("Integrate"),serialize:Ao("\\int")},{kind:"expression",latexTrigger:["\\iint"],parse:di("Integrate")},{kind:"expression",latexTrigger:["\\iiint"],parse:di("Integrate")},{kind:"expression",name:"CircularIntegrate",latexTrigger:["\\oint"],parse:di("CircularIntegrate"),serialize:Ao("\\oint")},{kind:"expression",latexTrigger:["\\oiint"],parse:di("CircularIntegrate")},{kind:"expression",latexTrigger:["\\oiiint"],parse:di("CircularIntegrate")}];function $o(e){let t=e.index;for(;e.match("\\cdot")||e.skipVisualSpace(););return e.matchAll(["\\mathrm","<{>","d","<}>"])||e.matchAll(["\\operatorname","<{>","d","<}>"])||e.match("d")||e.match("\\differentialD")?!0:(e.index=t,!1)}function Ap(e){let t=[...e],i=[];for(;t.length>0;){let r;if([t,r]=$p(t),!r)break;i.push(r)}return[t,i]}function $p(e){if(e.length<2)return[e,""];let t=e[e.length-2];if(t==="d"||t==="d_upright"){let i=q(e[e.length-1]);if(i)return[e.slice(0,-2),i]}return[e,""]}var Tt=[["alpha","\\alpha",945],["beta","\\beta",946],["gamma","\\gamma",947],["delta","\\delta",948],["epsilon","\\epsilon",949],["epsilonSymbol","\\varepsilon",1013],["zeta","\\zeta",950],["eta","\\eta",951],["theta","\\theta",952],["thetaSymbol","\\vartheta",977],["iota","\\iota",953],["kappa","\\kappa",954],["kappaSymbol","\\varkappa",1008],["lambda","\\lambda",955],["mu","\\mu",956],["nu","\\nu",957],["xi","\\xi",958],["omicron","\\omicron",959],["pi","\\pi",960],["piSymbol","\\varpi",982],["rho","\\rho",961],["rhoSymbol","\\varrho",1009],["sigma","\\sigma",963],["finalSigma","\\varsigma",962],["tau","\\tau",964],["phi","\\phi",981],["phiLetter","\\varphi",966],["upsilon","\\upsilon",965],["chi","\\chi",967],["psi","\\psi",968],["omega","\\omega",969],["Alpha","\\Alpha",913],["Beta","\\Beta",914],["Gamma","\\Gamma",915],["Delta","\\Delta",916],["Epsilon","\\Epsilon",917],["Zeta","\\Zeta",918],["Eta","\\Eta",919],["Theta","\\Theta",920],["Iota","\\Iota",921],["Kappa","\\Kappa",922],["Lambda","\\Lambda",923],["Mu","\\Mu",924],["Nu","\\Nu",925],["Xi","\\Xi",926],["Omicron","\\Omicron",927],["Rho","\\Rho",929],["Sigma","\\Sigma",931],["Tau","\\Tau",932],["Phi","\\Phi",934],["Upsilon","\\Upsilon",933],["Chi","\\Chi",935],["Psi","\\Psi",936],["Omega","\\Omega",937],["digamma","\\digamma",989],["aleph","\\aleph",8501],["bet","\\beth",8502],["gimel","\\gimel",8503],["dalet","\\daleth",8504],["ell","\\ell",8499],["turnedCapitalF","\\Finv",8498],["turnedCapitalG","\\Game",8513],["weierstrass","\\wp",8472],["eth","\\eth",240],["invertedOhm","\\mho",8487],["hBar","\\hbar",295],["hSlash","\\hslash",8463],["blackClubSuit","\\clubsuit",9827],["whiteHeartSuit","\\heartsuit",9825],["blackSpadeSuit","\\spadesuit",9824],["whiteDiamondSuit","\\diamondsuit",9826],["sharp","\\sharp",9839],["flat","\\flat",9837],["natural","\\natural",9838]],Cp=[...Tt.map(([e,t,i])=>({kind:"symbol",name:e,latexTrigger:[t],parse:e})),...Tt.map(([e,t,i])=>({kind:"symbol",latexTrigger:[String.fromCodePoint(i)],parse:e}))],qp=[{name:"Real",kind:"function",latexTrigger:["\\Re"]},{name:"Imaginary",kind:"function",latexTrigger:["\\Im"]},{name:"Argument",kind:"function",latexTrigger:["\\arg"]},{name:"Conjugate",latexTrigger:["^","\\star"],kind:"postfix"}],Dp=[{name:"Mean",kind:"function",symbolTrigger:"mean"},{name:"Median",kind:"function",symbolTrigger:"median"},{name:"StandarDeviation",kind:"function",symbolTrigger:"stddev"},{latexTrigger:["\\bar"],kind:"expression",parse:(e,t)=>{let i=e.parseGroup()??e.parseToken();return!i||!q(i)?null:["Mean",i]}}],Co={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","|":"\\vert","||":"\\Vert","\\lceil":"\\lceil","\\lfloor":"\\lfloor","\\rceil":"\\rceil","\\rfloor":"\\rfloor"};function qo(e,t,i){let r=Pp(t,i);if(r===null)return;let n="kind"in t?t.kind:"expression",s=r.latexTrigger;typeof s=="string"&&(e.lookahead=Math.max(e.lookahead,mo(s)));let a=ye(s??"");if(a.length===2&&/[_^]/.test(a[0])&&a[1]!=="<{>"&&n!=="function"&&n!=="environment"&&n!=="matchfix"){let o=t.parse;!o&&t.name&&(n==="postfix"||n==="prefix"?o=(l,u)=>[t.name,u]:o=t.name),qo(e,{...t,kind:n,name:void 0,serialize:void 0,parse:o,latexTrigger:[a[0],"<{>",a[1],"<}>"]},i)}e.defs.push(r),r.name!==void 0&&(e.ids.has(r.name)&&i({severity:"warning",message:["invalid-dictionary-entry",r.name,"Duplicate definition. The name (MathJSON symbol) must be unique, but triggers can be shared by multiple definitions."]}),e.ids.set(r.name,r))}function Do(e,t){let i={lookahead:1,ids:new Map,defs:[]};for(let r of e)qo(i,r,t);return i}function Pp(e,t){if(!zp(e,t))return null;let i={kind:"kind"in e?e.kind:"expression"},r=null;"latexTrigger"in e&&(typeof e.latexTrigger=="string"?r=ye(e.latexTrigger):r=e.latexTrigger);let n=null;"symbolTrigger"in e&&(n=e.symbolTrigger),r!==null&&(i.latexTrigger=xt(r)),n!==null&&(i.symbolTrigger=n),e.name&&(i.name=e.name,i.serialize=Fp(e,r,n)),i.kind==="matchfix"&&zr(e)&&(i.openTrigger=e.openTrigger,i.closeTrigger=e.closeTrigger),i.kind==="symbol"&&Kf(e)&&(i.precedence=e.precedence??1e4),i.kind==="expression"&&Jf(e)&&(i.precedence=e.precedence??1e4),(i.kind==="prefix"||i.kind==="postfix")&&(Yn(e)||xo(e))&&(r&&(r[0]==="^"||r[0]==="_")?(i.precedence=720,e.precedence):i.precedence=e.precedence??1e4),i.kind==="infix"&&vo(e)&&(!r||r[0]!=="^"&&r[0]!=="_"||!e.associativity||e.associativity,i.associativity=e.associativity??"none",i.precedence=e.precedence??1e4);let s=Op(e,r,n);return s&&(i.parse=s),i}function Fp(e,t,i){if(typeof e.serialize=="function")return e.serialize;let r=e.kind??"expression";if(r==="environment"){let a=e.symbolTrigger??e.name??"unknown";return(o,l)=>k([`\\begin{${a}}`,o.serialize(g(l,1)),`\\end{${a}}`])}if(zr(e)){let a=typeof e.openTrigger=="string"?Co[e.openTrigger]:xt(e.openTrigger),o=typeof e.closeTrigger=="string"?Co[e.closeTrigger]:xt(e.closeTrigger);return(l,u)=>k([a,l.serialize(g(u,1)),o])}let n=e.serialize;if(n===void 0&&t&&(n=xt(t)),n)return r==="postfix"?(a,o)=>k([a.serialize(g(o,1)),n]):r==="prefix"?(a,o)=>k([n,a.serialize(g(o,1))]):r==="infix"?(a,o)=>{let l=K(o);if(l===0)return"";let u=e.precedence??1e4;return k(S(o).flatMap((c,f)=>{let p=a.wrap(c,u+1);return f<l-1?[p,n]:[p]}))}:(a,o)=>v(o)?k([n,a.wrapArguments(o)]):n;let s=i??e.name??"unknown";return r==="postfix"?(a,o)=>k([a.serialize(g(o,1)),a.serializeSymbol(s)]):r==="prefix"?(a,o)=>k([a.serializeSymbol(s),a.serialize(g(o,1))]):r==="infix"?(a,o)=>k([a.serialize(g(o,1)),a.serializeSymbol(s),a.serialize(g(o,2))]):(a,o)=>v(o)?k([a.serializeSymbol(s),a.wrapArguments(o)]):a.serializeSymbol(s)}function Op(e,t,i){if("parse"in e&&typeof e.parse=="function")return e.parse;let r=("kind"in e?e.kind:"expression")??"expression";if(r==="environment"){let n=e.parse??e.name??i;if(n)return(s,a)=>{let o=s.parseTabular();return o===null?null:[n,["List",o.map(l=>["List",...l])]]}}if(r==="function"){let n=e.parse??e.name??i;if(n)return(s,a)=>{let o=s.parseArguments("enclosure",a);return o===null?n:[n,...o]}}if(r==="symbol"){let n=e.parse??e.name??i;if(n)return(s,a)=>n}if(r==="prefix"){let n=e.parse??e.name??i;if(n){let s=e.precedence??1e4;return(a,o)=>{let l=a.parseExpression({...o??[],minPrec:s});return l===null?null:[n,l]}}}if(r==="postfix"){let n=e.parse??e.name;if(n)return(s,a)=>a===null?null:[n,a]}if(r==="infix"){if(/[_^]/.test((t==null?void 0:t[0])??"")){let s=e.name??e.parse;return(a,o)=>[s,G(g(o,1)),G(g(o,2))]}let n=e.parse??e.name??i;if(n){let s=e.precedence??1e4,a=e.associativity??"none";return a==="none"?(o,l,u)=>{if(l===null)return null;let c=G(o.parseExpression({...u,minPrec:s}));return[n,l,c]}:a==="left"?(o,l,u)=>{if(l===null)return null;let c=G(o.parseExpression({...u,minPrec:s+1}));return typeof n!="string"?[n,l,c]:[n,l,c]}:a==="right"?(o,l,u)=>{if(l===null)return null;let c=G(o.parseExpression({...u,minPrec:s}));return typeof n!="string"?[n,l,c]:[n,l,c]}:(o,l,u)=>{if(l===null)return null;let c=G(o.parseExpression({...u,minPrec:s}));return typeof n!="string"?[n,l,c]:qr(n,l,c)}}}if(r==="matchfix"){let n=e.parse??e.name;if(n)return(s,a)=>ie(a)?null:[n,a]}if(r==="expression"){let n=e.parse??e.name??i;if(n)return()=>n}if("parse"in e){let n=e.parse;return()=>n}}function zp(e,t){let i=e.name??e.latexTrigger??e.symbolTrigger??e.openTrigger;if(!i)try{i=JSON.stringify(e)}catch{i="???"}if(Array.isArray(i)&&(i=xt(i)),"trigger"in e&&t({severity:"warning",message:["invalid-dictionary-entry",i,"The 'trigger' property is deprecated. Use 'latexTrigger' or 'symbolTrigger' instead"]}),"kind"in e&&!["expression","symbol","function","infix","postfix","prefix","matchfix","environment"].includes(e.kind)&&t({severity:"warning",message:["invalid-dictionary-entry",i,"The 'kind' property must be one of 'expression', 'symbol', 'function', 'infix', 'postfix', 'prefix', 'matchfix', 'environment'"]}),e.serialize!==void 0&&!e.name)return t({severity:"warning",message:["invalid-dictionary-entry",i,"A 'name' property must be provided if a 'serialize' handler is provided"]}),!1;if("symbolTrigger"in e&&(!("kind"in e)||e.kind!=="environment")&&(typeof e.symbolTrigger!="string"||!Le(e.symbolTrigger))&&t({severity:"warning",message:["invalid-dictionary-entry",i,"The 'symbolTrigger' property must be a valid symbol"]}),"name"in e&&(typeof e.name!="string"?e.name!==void 0&&t({severity:"warning",message:["invalid-dictionary-entry",i,"The 'name' property must be a string"]}):Le(e.name)||t({severity:"warning",message:["invalid-dictionary-entry",e.name,"The 'name' property must be a valid symbol"]})),zr(e)){if("latexTrigger"in e||"symbolTrigger"in Yn)return t({severity:"warning",message:["invalid-dictionary-entry",i,"'matchfix' operators use a 'openTrigger' and 'closeTrigger' instead of a 'latexTrigger' or 'symbolTrigger'. "]}),!1;if(!e.openTrigger||!e.closeTrigger)return t({severity:"warning",message:["invalid-dictionary-entry",i,"Expected `openTrigger` and a `closeTrigger` for matchfix operator"]}),!1;if(typeof e.openTrigger!=typeof e.closeTrigger)return t({severity:"warning",message:["invalid-dictionary-entry",i,"Expected `openTrigger` and `closeTrigger` to both be strings or array of LatexToken"]}),!1}if(vo(e)||xo(e)||Yn(e)){if(Array.isArray(e.latexTrigger)&&(e.latexTrigger[0]==="_"||e.latexTrigger[0]==="^")||typeof e.latexTrigger=="string"&&(e.latexTrigger.startsWith("^")||e.latexTrigger.startsWith("_"))){if(e.precedence!==void 0||e.associativity!==void 0)return t({severity:"warning",message:["invalid-dictionary-entry",i,'Unexpected "precedence" or "associativity" for superscript/subscript operator']}),!1}else if(e.precedence===void 0)return t({severity:"warning",message:["invalid-dictionary-entry",i,`Expected a "precedence" for ${e.kind} operator`]}),!1}else if(e.associativity!==void 0)return t({severity:"warning",message:["invalid-dictionary-entry",i,'Unexpected "associativity" operator']}),!1;return!zr(e)&&!Xf(e)&&!e.latexTrigger&&!e.symbolTrigger&&!e.name?(t({severity:"warning",message:["invalid-dictionary-entry",i,"Expected a 'name', a 'latexTrigger' or a 'symbolTrigger'"]}),!1):e.parse===void 0&&e.name===void 0?(t({severity:"warning",message:["invalid-dictionary-entry",i,"Expected a 'parse' or 'name'"]}),!1):!0}var Wi={symbols:Cp,algebra:ep,arithmetic:pp,calculus:Mp,complex:qp,core:gp,"linear-algebra":_p,logic:wp,relop:Lr,other:kp,physics:[{name:"mu0",kind:"symbol",latexTrigger:"\\mu_0"}],sets:Tp,statistics:Dp,trigonometry:Sp};function Lp(e="all"){if(e==="all"){let t=[];for(let i of Object.keys(Wi))Wi[i]&&t.push(...Wi[i]);return t}return Wi[e]?Object.freeze([...Wi[e]]):[]}var Rp={"\\mathord":"","\\mathop":"","\\mathbin":"","\\mathrel":"","\\mathopen":"","\\mathclose":"","\\mathpunct":"","\\mathinner":"","\\operatorname":"","\\mathrm":"_upright","\\mathit":"_italic","\\mathbf":"_bold","\\mathscr":"_script","\\mathcal":"_calligraphic","\\mathfrak":"_fraktur","\\mathsf":"_sansserif","\\mathtt":"_monospace","\\mathbb":"_doublestruck"},Vp={"\\mathring":"_ring","\\hat":"_hat","\\tilde":"_tilde","\\vec":"_vec","\\overline":"_bar","\\underline":"_underbar","\\dot":"_dot","\\ddot":"_ddot","\\dddot":"_dddot","\\ddddot":"_ddddot","\\acute":"_acute","\\grave":"_grave","\\breve":"_breve","\\check":"_check"};function Po(e,t){if(e.atEnd)return null;let i=e.peek,r={"\\_":"_","\\#":"hash"}[i];if(!r&&!t.toplevel&&(r={"+":"plus","-":"minus","\\plusmn":"pm","\\pm":"pm","\\ast":"ast","\\dag":"dag","\\ddag":"ddag","\\bot":"bottom","\\top":"top","\\bullet":"bullet","\\cir":"circle","\\diamond":"diamond","\\times":"times","\\square":"square","\\star":"star"}[i]),r)return e.nextToken(),r;let n=Tt.findIndex(s=>s[1]===i);return n>=0?(e.nextToken(),Tt[n][0]):e.parseChar()??e.nextToken()}function Zr(e){let t=is(e),i=Vp[e.peek]??null;if(i){if(e.nextToken(),!e.match("<{>"))return null;let s=Zr(e);if(s===null||!e.match("<}>"))return null;t=`${s}${i}`}if(t===null){for(t="";!e.atEnd;){let s=e.peek;if(s==="<}>"||s==="_"||s==="^")break;let a=Po(e,{toplevel:!1});if(a===null)return null;t+=a}for(;!e.atEnd&&/\d/.test(e.peek);)t+=e.nextToken()}for(;!e.atEnd;)if(e.match("\\degree"))t+="_deg";else if(e.matchAll(["^","\\circ"]))t+="_deg";else if(e.matchAll(["^","\\prime"]))t+="_prime";else if(e.matchAll(["^","<{>","\\prime","<}>"]))t+="_prime";else if(e.matchAll(["^","<{>","\\doubleprime","<}>"]))t+="_dprime";else if(e.matchAll(["^","<{>","\\prime","\\prime","<}>"]))t+="_dprime";else break;let r=[],n=[];for(;!e.atEnd;)if(e.match("_")){let s=e.match("<{>"),a=Zr(e);if(s&&!e.match("<}>")||a===null)return null;n.push(a)}else if(e.match("^")){let s=e.match("<{>"),a=Zr(e);if(s&&!e.match("<}>")||a===null)return null;r.push(a)}else break;return r.length>0&&(t+="__"+r.join("")),n.length>0&&(t+="_"+n.join("")),t}function is(e){let t=Rp[e.peek]??null;if(t===null)return null;if(e.nextToken(),e.match("<{>")){let i="",r={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[e.peek]??"";return r&&(i=r,e.nextToken()),i+=Zr(e),i===null||!e.match("<}>")?null:t==="_upright"&&i.length>1?i:i+t}return null}function Fo(e){let t=e.index,i=is(e);return i===null||Le(i)?null:e.error(["invalid-symbol",{str:Yt(i)}],t)}function Ur(e){if(/^[a-zA-Z]$/.test(e.peek)||new RegExp("^\\p{XIDS}$","u").test(e.peek))return e.nextToken();let t=is(e);if(!t){for(t="";!e.atEnd&&kr.test(t+e.peek);)t+=e.nextToken();t||(t=null)}let i=e.index;return t??(t=Po(e,{toplevel:!0})),t&&(t=t.normalize(),Le(t))?t:(e.index=i,null)}var Bp={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack","\\[","["],"]":["\\rbrack","\\]","]"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"]},rs={"\\left":"\\right","\\bigl":"\\bigr","\\Bigl":"\\Bigr","\\biggl":"\\biggr","\\Biggl":"\\Biggr","\\big":"\\big","\\Big":"\\Big","\\bigg":"\\bigg","\\Bigg":"\\Bigg"},ns={"(":")","[":"]","|":"|","\\{":"\\}","\\[":"\\]","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache","\\llbracket":"\\rrbracket"},Zp=class{constructor(e,t,i){m(this,"options");m(this,"_index",0);m(this,"symbolTable",{parent:null,ids:{}});m(this,"_tokens");m(this,"_positiveInfinityTokens");m(this,"_negativeInfinityTokens");m(this,"_notANumberTokens");m(this,"_decimalSeparatorTokens");m(this,"_wholeDigitGroupSeparatorTokens");m(this,"_fractionalDigitGroupSeparatorTokens");m(this,"_exponentProductTokens");m(this,"_beginExponentMarkerTokens");m(this,"_endExponentMarkerTokens");m(this,"_truncationMarkerTokens");m(this,"_imaginaryUnitTokens");m(this,"_dictionary");m(this,"_boundaries",[]);m(this,"_lastPeek","");m(this,"_peekCounter",0);this._tokens=e,this.options=i,this._dictionary=t,this._positiveInfinityTokens=ye(this.options.positiveInfinity),this._negativeInfinityTokens=ye(this.options.negativeInfinity),this._notANumberTokens=ye(this.options.notANumber),this._decimalSeparatorTokens=ye(this.options.decimalSeparator),this._wholeDigitGroupSeparatorTokens=[],this._fractionalDigitGroupSeparatorTokens=[],this.options.digitGroupSeparator&&(typeof this.options.digitGroupSeparator=="string"?(this._wholeDigitGroupSeparatorTokens=ye(this.options.digitGroupSeparator),this._fractionalDigitGroupSeparatorTokens=this._wholeDigitGroupSeparatorTokens):Array.isArray(this.options.digitGroupSeparator)&&(this._wholeDigitGroupSeparatorTokens=ye(this.options.digitGroupSeparator[0]),this._fractionalDigitGroupSeparatorTokens=ye(this.options.digitGroupSeparator[1]))),this._exponentProductTokens=ye(this.options.exponentProduct),this._beginExponentMarkerTokens=ye(this.options.beginExponentMarker),this._endExponentMarkerTokens=ye(this.options.endExponentMarker),this._truncationMarkerTokens=ye(this.options.truncationMarker),this._imaginaryUnitTokens=ye(this.options.imaginaryUnit)}pushSymbolTable(){this.symbolTable={parent:this.symbolTable,ids:{}}}popSymbolTable(){this.symbolTable=this.symbolTable.parent??this.symbolTable}addSymbol(e,t){if(typeof t=="string"&&(t=new $(t)),e in this.symbolTable.ids&&this.symbolTable.ids[e].is(t.type))throw new Error(`Symbol ${e} already declared as a different type`);this.symbolTable.ids[e]=t}get index(){return this._index}set index(e){this._index=e,this._lastPeek="",this._peekCounter=0}getSymbolType(e){let t=this.symbolTable;for(;t;){if(e in t.ids)return t.ids[e];t=t.parent}return this.options.getSymbolType?this.options.getSymbolType(e):$.unknown}get peek(){let e=this._tokens[this.index];if(e===this._lastPeek?this._peekCounter+=1:this._peekCounter=0,this._peekCounter>=1024){let t=`Infinite loop detected while parsing "${this.latex(0)}" at "${this._lastPeek}" (index ${this.index})`;throw console.error(t),new Error(t)}return this._lastPeek=e,e}nextToken(){return this._tokens[this.index++]}get atEnd(){return this.index>=this._tokens.length}atTerminator(e){return this.atBoundary||(((e==null?void 0:e.condition)&&e.condition(this))??!1)}get atBoundary(){if(this.atEnd)return!0;let e=this.index;for(let t of this._boundaries)if(this.matchAll(t.tokens))return this.index=e,!0;return!1}addBoundary(e){this._boundaries.push({index:this.index,tokens:e})}removeBoundary(){this._boundaries.pop()}matchBoundary(){let e=this._boundaries[this._boundaries.length-1],t=e&&this.matchAll(e.tokens);return t&&this._boundaries.pop(),t}boundaryError(e){let t=this._boundaries[this._boundaries.length-1];return this._boundaries.pop(),this.error(e,t.index)}latex(e,t){return xt(this._tokens.slice(e,t))}latexAhead(e){return this.latex(this.index,this.index+e)}lookAhead(){let e=Math.min(this._dictionary.lookahead,this._tokens.length-this.index);if(e<=0)return[];let t=[];for(;e>0;)t.push([e,this.latexAhead(e--)]);return t}peekDefinitions(e){if(this.atEnd)return[];let t=[],i=[...this.getDefs(e)];for(let r of i)r.latexTrigger===""&&t.push([r,0]);for(let[r,n]of this.lookAhead())for(let s of i)s.latexTrigger===n&&t.push([s,r]);for(let r of i)if(r.symbolTrigger){let n=Up(this,r.symbolTrigger);n>0&&t.push([r,n])}return t}skipSpaceTokens(){for(;this.match("<space>"););}skipSpace(){if(!this.atEnd&&this.peek==="<{>"){let t=this.index;for(this.nextToken();this.match("<space>"););if(this.nextToken()==="<}>")return this.skipSpace(),!0;this.index=t}if(!this.options.skipSpace)return!1;let e=!1;for(;this.match("<space>");)e=!0;return e&&this.skipSpace(),e}skipVisualSpace(){this.options.skipSpace&&(this.skipSpace(),["\\!","\\,","\\:","\\;","\\enskip","\\enspace","\\space","\\quad","\\qquad"].includes(this.peek)&&(this.nextToken(),this.skipVisualSpace()),this.skipSpace())}match(e){return this._tokens[this.index]!==e?!1:(this.index++,!0)}matchAll(e){if(e.length===0)return!1;let t,i=0;do t=this._tokens[this.index+i]===e[i++];while(t&&i<e.length);return t&&(this.index+=i),t}matchAny(e){return e.includes(this._tokens[this.index])?this._tokens[this.index++]:""}parseLatexNumber(e=!0){let t=!1,i=this.peek;for(;i==="<space>"||i==="+"||i==="-";)i==="-"&&(t=!t),this.nextToken(),i=this.peek;let r=10,n=["0","1","2","3","4","5","6","7","8","9"];if(this.match("'"))r=8,n=["0","1","2","3","4","5","6","7"],e=!0;else if(this.match('"')||this.match("x"))r=16,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],e=!0;else if(this.match("`"))return i=this.nextToken(),i?i.startsWith("\\")&&i.length===2?(t?-1:1)*(i.codePointAt(1)??0):(t?-1:1)*(i.codePointAt(0)??0):null;let s="";for(;n.includes(this.peek);)s+=this.nextToken();if(!e&&this.match("."))for(s+=".";n.includes(this.peek);)s+=this.nextToken();let a=e?Number.parseInt(s,r):Number.parseFloat(s);return Number.isNaN(a)?null:t?-a:a}parseChar(){let e=this.index,t=0;for(;this.match("^");)t+=1;if(t<2&&(this.index=e),t>=2){let i="",r=0;for(;r!=t;){let n=this.matchAny(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);if(!n)break;i+=n,r+=1}if(i.length===t)return String.fromCodePoint(Number.parseInt(i,16))}else if(this.match("\\char")){let i=Math.floor(this.parseLatexNumber()??Number.NaN);return(!Number.isFinite(i)||i<0||i>1114111)&&(i=10067),String.fromCodePoint(i)}else if(this.match("\\unicode"))if(this.skipSpaceTokens(),this.match("<{>")){let i=this.parseLatexNumber();if(this.match("<}>")&&i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}else{let i=this.parseLatexNumber();if(i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}return this.index=e,null}matchDelimiter(e,t){if(Array.isArray(e))return this.matchAll(e)?(this.addBoundary(t),!0):!1;let i=this.index,r=rs[this.peek];return r&&this.nextToken(),e==="||"&&this.matchAll(["|","|"])?(this.addBoundary(["|","|"]),!0):(Bp[e]??[e]).includes(this.peek)?(e=this.nextToken(),t=ns[e]??t,this.addBoundary(r?[r,t]:[t]),!0):(this.index=i,!1)}parseGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("<{>")){this.addBoundary(["<}>"]);let t=this.parseExpression();if(this.skipSpace(),this.matchBoundary())return t??"Nothing";for(;!this.matchBoundary()&&!this.atEnd;)this.nextToken();if(v(t)==="Error")return t;let i=this.error("expected-closing-delimiter",e);return t!==null?["InvisibleOperator",t,i]:i}return this.index=e,null}parseOptionalGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("[")){this.addBoundary(["]"]);let t=this.parseExpression();return this.skipSpace(),this.matchBoundary()?t:this.boundaryError("expected-closing-delimiter")}return this.index=e,null}parseToken(){return this.skipSpace(),[...'!"#$%&(),/;:?@[]\\`|~'.split(""),"\\left","\\bigl"].includes(this.peek)?null:/^[0-9]$/.test(this.peek)?parseInt(this.nextToken(),10):this.parseGenericExpression()??this.parseSymbol()}parseTabular(){let e=[],t=[],i=null;for(;!this.atBoundary;)if(this.skipSpace(),this.match("&"))t.push(i??"Nothing"),i=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.parseOptionalGroup(),i!==null&&t.push(i),e.push(t),t=[],i=null;else{let r=[],n=this.peek;for(;n!=="&"&&n!=="\\\\"&&n!=="\\cr"&&!this.atBoundary;)i=this.parseExpression({minPrec:0,condition:s=>{let a=s.peek;return a==="&"||a==="\\\\"||a==="\\cr"}}),i!==null?r.push(i):(r.push(["Error","'unexpected-token'",{str:xt(n)}]),this.nextToken()),this.skipSpace(),n=this.peek;r.length>1?i=["Sequence",...r]:i=r[0]??"Nothing"}return i!==null&&t.push(i),t.length>0&&e.push(t),e}parseStringGroupContent(){let e=this.index,t="",i=0;for(;!this.atBoundary||i>0;){let r=this.nextToken();if(r==="<$>"||r==="<$$>")return this.index=e,"";r==="<{>"?(i+=1,t+="\\{"):r==="<}>"?(i-=1,t+="\\}"):r==="<space>"?t+=" ":(r[0],t+=r)}return t}parseStringGroup(e){e===void 0&&(e=!1);let t=this.index;for(;this.match("<space>"););if(this.match(e?"[":"<{>")){this.addBoundary([e?"]":"<}>"]);let i=this.parseStringGroupContent();if(this.matchBoundary())return i;this.removeBoundary()}return this.index=t,null}parseEnvironment(e){var r;let t=this.index;if(!this.match("\\begin"))return null;let i=(r=this.parseStringGroup())==null?void 0:r.trim();if(!i)return this.error("expected-environment-name",t);this.addBoundary(["\\end","<{>",...i.split(""),"<}>"]);for(let n of this.getDefs("environment"))if(n.symbolTrigger===i){let s=n.parse(this,e);return this.skipSpace(),this.matchBoundary()?s!==null?this.decorate(s,t):(this.index=t,null):this.boundaryError("unbalanced-environment")}return this.parseTabular(),this.skipSpace(),this.matchBoundary()?this.error(["unknown-environment",{str:i}],t):this.boundaryError("unbalanced-environment")}parseOptionalSign(){let e=!!this.matchAny(["-",""]);for(;this.matchAny(["+",""])||this.skipSpace();)this.matchAny(["-",""])&&(e=!e);return e?"-":"+"}parseDecimalDigits(e="whole"){let t=[],i=!1;for(;!i;){for(;/^[0-9]$/.test(this.peek);)t.push(this.nextToken()),this.skipVisualSpace();i=!0;let r=e==="whole"?this._wholeDigitGroupSeparatorTokens:this._fractionalDigitGroupSeparatorTokens;if(e!=="none"&&r.length>0){let n=this.index;this.skipVisualSpace(),this.matchAll(r)&&(this.skipVisualSpace(),/^[0-9]$/.test(this.peek)?i=!1:this.index=n)}}return t.join("")}parseSignedInteger(e){let t=this.index,i=this.parseOptionalSign(),r=this.parseDecimalDigits(e);return r?i==="-"?"-"+r:r:(this.index=t,"")}parseExponent(){let e=this.index;if(this.skipVisualSpace(),this.matchAny(["e","E"])){let t=this.parseSignedInteger("none");if(t)return t}if(this.index=e,this.match("\\times")&&(this.skipVisualSpace(),this.matchAll(["1","0"])&&(this.skipVisualSpace(),this.match("^")))){if(this.skipVisualSpace(),/^[0-9]$/.test(this.peek))return this.nextToken();if(this.match("<{>")){this.skipVisualSpace();let t=this.parseSignedInteger("whole");if(this.skipVisualSpace(),t&&this.match("<}>"))return t}}if(this.index=e,this.skipVisualSpace(),this.match("\\%"))return"-2";if(this.index=e,this.matchAll(this._exponentProductTokens)&&(this.skipVisualSpace(),this.matchAll(this._beginExponentMarkerTokens))){this.skipVisualSpace();let t=this.parseSignedInteger("none");if(this.skipVisualSpace(),t&&this.matchAll(this._endExponentMarkerTokens))return t}return this.index=e,""}parseRepeatingDecimal(){let e=this.index,t=this.options.repeatingDecimal,i="";if((t==="auto"||t==="parentheses")&&this.match("("))return i=this.parseDecimalDigits("fraction"),i&&this.match(")")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="parentheses")&&this.matchAll(["\\left","("]))return i=this.parseDecimalDigits("fraction"),i&&this.matchAll(["\\right",")"])?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="vinculum")&&this.matchAll(["\\overline","<{>"]))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="arc")&&(this.matchAll(["\\wideparen","<{>"])||this.matchAll(["\\overarc","<{>"])))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,t==="auto"||t==="dots"){let r=Oo(this);if(r!==null){if(i=this.parseDecimalDigits("fraction"),!i)return`(${r})`;let n=Oo(this);if(n!==null)return`(${r}${i}${n})`}}return this.index=e,""}parseNumber(){if(this.options.parseNumbers===!1||this.options.parseNumbers==="never")return null;let e=this.index;this.skipVisualSpace();let t=1;for(;this.peek==="-"||this.peek==="+";)this.match("-")?t=-t:this.match("+"),this.skipVisualSpace();let i="",r="",n=!1;if(this.match(".")||this.matchAll(this._decimalSeparatorTokens)){let u=this.peek;(/^[\d]$/.test(u)||jp(this))&&(n=!0,i="0")}else i=this.parseDecimalDigits("whole");if(!i)return this.index=e,null;let s=this.index,a=!1;(n||this.match(".")||this.matchAll(this._decimalSeparatorTokens))&&(r=this.parseDecimalDigits("fraction"),a=!0);let o=!1;if(a){let u=this.parseRepeatingDecimal();u&&(r+=u,o=!0),this.match("\\ldots")||this.matchAll(this._truncationMarkerTokens)}if(a&&!r)return this.index=s,i.length<10?ss(t*parseInt(i,10)):{num:t<0?"-"+i:i};let l=this.parseExponent();if(!a&&!l&&i.length<10)return ss(t*parseInt(i,10));if(!o&&this.options.parseNumbers==="rational"){let u=parseInt(i,10);if(!r)return l?["Multiply",t*u,["Power",10,l]]:ss(t*u);let c=parseInt(r,10),f=r.length,p=u*10**f+c,h=10**f;return l?["Multiply",["Rational",t*p,h],["Power",10,l]]:["Rational",t*p,h]}return{num:(t<0?"-":"")+i+(a?"."+r:"")+(l?"e"+l:"")}}parsePrefixOperator(e){e||(e={minPrec:0}),e.minPrec||(e={...e,minPrec:0});let t=this.index;for(let[i,r]of this.peekDefinitions("prefix")){this.index=t+r;let n=i.parse(this,{...e,minPrec:i.precedence+1});if(n!==null)return n}return this.index=t,null}parseInfixOperator(e,t){t??(t={minPrec:0}),t.minPrec,t.minPrec===void 0&&(t={...t,minPrec:0});let i=this.index;for(let[r,n]of this.peekDefinitions("infix"))if(r.precedence>=t.minPrec){this.index=i+n;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseArguments(e="enclosure",t){if(this.atTerminator(t))return null;let i=this.index,r=this.parseEnclosure();if(e==="enclosure")return r===null?null:Vi(r)??[];if(e==="implicit"){if(v(r)==="Delimiter"){let s=g(r,1);return v(s)==="Sequence"?S(s):s===null?[]:[s]}if(r!==null)return[r];let n=this.parseExpression({...t,minPrec:Ke});return n===null?null:[n]}return this.index=i,null}parseEnclosure(){let e=this.getDefs("matchfix"),t=this.index;for(let i of e){if(this.index=t,!this.matchDelimiter(i.openTrigger,i.closeTrigger))continue;let r=this.index;this.skipSpace();let n=this.parseExpression();if(this.skipSpace(),!this.matchBoundary()){let a=this._boundaries[this._boundaries.length-1].tokens;if(this.removeBoundary(),this.index=r,this.skipSpace(),n=this.parseExpression(),this.skipSpace(),!this.matchAll(a)){if(this.index=t,!this.atEnd)continue;return null}}let s=i.parse(this,n??"Nothing");if(s!==null)return s}return this.index=t,null}parseGenericExpression(e){if(this.atTerminator(e))return null;let t=this.index,i=null,r=this.peekDefinitions("expression")??[];for(let[n,s]of r)if(this.index=t+s,typeof n.parse=="function"){if(i=n.parse(this,e),i!==null)return i}else return n.name;return this.index=t,null}parseFunction(e){if(this.atTerminator(e))return null;let t=this.index,i=null;for(let[n,s]of this.peekDefinitions("function"))if(this.index=t+s,typeof n.parse=="function"){if(i=n.parse(this,e),i!==null)return i}else{i=n.name;break}if(i===null&&(this.index=t,i=Ur(this),!this.isFunctionOperator(i)))return this.index=t,null;do{let n=this.parsePostfixOperator(i,e);if(n===null)break;i=n}while(!0);let r=this.parseArguments("enclosure",e);return r===null?i:typeof i=="string"?[i,...r]:["Apply",i,...r]}parseSymbol(e){if(this.atTerminator(e))return null;let t=this.index;for(let[r,n]of this.peekDefinitions("symbol"))if(this.index=t+n,typeof r.parse=="function"){let s=r.parse(this,e);if(s!==null)return s}else return r.name;this.index=t;let i=Ur(this);return i!==null&&!this.getSymbolType(i).matches("error")?i:(this.index=t,null)}parseSupsub(e){if(this.atEnd)return e;let t=this.index;this.skipSpace();let i=[],r=[],n=t;for(;this.peek==="_"||this.peek==="^";){if(this.match("_"))if(n=this.index,this.match("_")||this.match("^"))r.push(this.error("syntax-error",n));else{let a=this.parseGroup()??this.parseToken()??this.parseStringGroup();if(a===null)return this.error("missing",t);r.push(a)}else if(this.match("^"))if(n=this.index,this.match("_")||this.match("^"))i.push(this.error("syntax-error",n));else{let a=this.parseGroup()??this.parseToken();if(a===null)return this.error("missing",t);i.push(a)}n=this.index,this.skipSpace()}if(i.length===0&&r.length===0)return this.index=t,e;let s=e;if(r.length>0){let a=[...this.getDefs("infix")].filter(o=>o.latexTrigger==="_");if(a){let o=["Subscript",s,r.length===1?r[0]:["List",...r]];for(let l of a)if(typeof l.parse=="function"?s=l.parse(this,o,{minPrec:0}):s=o,s!==null)break}}if(i.length>0){let a=[...this.getDefs("infix")].filter(o=>o.latexTrigger==="^");if(a){let o=i.filter(l=>!ie(l));if(o.length!==0){let l=o.length===1?o[0]:["List",...o],u=["Superscript",s,l];for(let c of a)if(typeof c.parse=="function"?s=c.parse(this,u,{minPrec:0}):s=u,s!==null)break}}}return s===null&&(this.index=t),s}parsePostfixOperator(e,t){if(e===null||this.atEnd)return null;let i=this.index;for(let[r,n]of this.peekDefinitions("postfix")){this.index=i+n;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseSyntaxError(){let e=this.index;if(this.peek==="^")return this.index+=1,["Superscript",this.error("missing",e),G(this.parseGroup())];let t=this.peekDefinitions("operator");if(t.length>0){if(t=this.peekDefinitions("postfix"),t.length>0){let[a,o]=t[0];if(this.index+=o,typeof a.parse=="function"){let l=a.parse(this,this.error("missing",e));if(l!==null)return l}return this.error("unexpected-operator",e)}if(t=this.peekDefinitions("prefix"),t.length>0){let[a,o]=t[0];if(this.index+=o,typeof a.parse=="function"){let l=a.parse(this,{minPrec:0});if(l!==null)return l}return a.name?[a.name,this.parseExpression()??this.error("missing",e)]:this.error("unexpected-operator",e)}if(t=this.peekDefinitions("infix"),t.length>0){let[a,o]=t[0];this.index+=o;let l=a.parse(this,this.error("missing",e),{minPrec:0});return l!==null?l:this.error("unexpected-operator",e)}}let i=this.index,r=Fo(this);if(r!==null)return r;if(r=Ur(this),r!==null)return this.error(["unexpected-symbol",{str:r}],i);let n=this.peek;if(!n)return this.error("syntax-error",e);if(Gp(this))return this.error("unexpected-delimiter",e);if(n[0]!=="\\")return this.error(["unexpected-token",{str:xt(n)}],e);let s=this.nextToken();if(this.skipSpaceTokens(),s==="\\end"){let a=this.parseStringGroup();return a===null?this.error("expected-environment-name",e):this.error(["unbalanced-environment",{str:a}],e)}for(;this.match("[");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="]";)this.peek==="["&&(a+=1),this.peek==="]"&&(a-=1),this.nextToken();this.match("]")}for(;this.match("<{>");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="<}>";)this.peek==="<{>"&&(a+=1),this.peek==="<}>"&&(a-=1),this.nextToken();this.match("<}>")}return this.error(["unexpected-command",{str:xt(s)}],e)}parsePrimary(e){var r,n;if(this.atBoundary||this.atTerminator(e))return null;let t=null,i=this.index;if(this.match("<}>"))return this.error("unexpected-closing-delimiter",i);if(t??(t=this.parseGroup()),t??(t=this.parseNumber()),t??(t=this.parseEnclosure()),t??(t=this.parseEnvironment(e)),t===null&&this.matchAll(this._positiveInfinityTokens)&&(t="PositiveInfinity"),t===null&&this.matchAll(this._negativeInfinityTokens)&&(t="NegativeInfinity"),t===null&&this.matchAll(this._notANumberTokens)&&(t="NaN"),t===null&&this.matchAll(this._imaginaryUnitTokens)&&(t="ImaginaryUnit"),t??(t=this.parseGenericExpression(e)??this.parseFunction(e)??this.parseSymbol(e)??Fo(this)),t!==null&&ie(t))return this.parsePrimary(e);if(t!==null){t=this.decorate(t,i);let s=null,a=this.index;do{if(s=this.parsePostfixOperator(t,e),t=s??t,this.index===a&&s!==null){this.index;break}a=this.index}while(s!==null)}return t!==null&&(t=this.parseSupsub(t)),t===null&&(t=((n=(r=this.options).parseUnexpectedToken)==null?void 0:n.call(r,null,this))??null,t===null&&this.peek.startsWith("\\")&&(this.nextToken(),t=this.error("unexpected-command",i))),this.decorate(t,i)}parseExpression(e){var r,n;this.skipSpace();let t=this.index;if(this.atBoundary)return this.index=t,null;e??(e={minPrec:0}),e.minPrec,e.minPrec===void 0&&(e={...e,minPrec:0});let i=this.parsePrefixOperator({...e,minPrec:0});if(i??(i=this.parsePrimary(e)),i!==null){let s=!1;for(;!s&&!this.atTerminator(e);){this.skipSpace();let a=this.parseInfixOperator(i,e);if(a===null&&e.minPrec<=go&&this.peekDefinitions("operator").length===0){let o=this.parseExpression({...e,minPrec:go+1});o!==null?v(i)==="InvisibleOperator"?v(o)==="InvisibleOperator"?a=["InvisibleOperator",...S(i),...S(o)]:a=["InvisibleOperator",...S(i),o]:v(o)==="InvisibleOperator"?a=["InvisibleOperator",i,...S(o)]:a=["InvisibleOperator",i,o]:a===null&&(a=((n=(r=this.options).parseUnexpectedToken)==null?void 0:n.call(r,i,this))??null)}a!==null?i=a:s=!0}}return this.decorate(i,t)}decorate(e,t){if(e===null)return null;if(!this.options.preserveLatex)return e;let i=this.latex(t,this.index);return Array.isArray(e)?e={latex:i,fn:e}:typeof e=="number"?e={latex:i,num:Number(e).toString()}:typeof e=="string"?e={latex:i,sym:e}:typeof e=="object"&&e!==null&&(e.latex=i),e}error(e,t){let i;typeof e=="string"?(e.startsWith("'"),i={str:e}):(e[0].startsWith("'"),i=["ErrorCode",{str:e[0]},...e.slice(1)]);let r=this.latex(t,this.index);return r?["Error",i,["LatexString",{str:r}]]:["Error",i]}isFunctionOperator(e){return e===null?!1:!!this.getSymbolType(e).matches("function")}*getDefs(e){if(e==="operator")for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];/^prefix|infix|postfix/.test(i.kind)&&(yield i)}else for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];i.kind===e&&(yield i)}}};function Up(e,t){var s;let i=e.index,r=(s=Ur(e))==null?void 0:s.trim();if(r===null)return 0;let n=r!==t?0:e.index-i;return e.index=i,n}function Gp(e){let t=e.peek;return Object.values(ns).includes(t)||ns[t]?(e.nextToken(),!0):rs[t]||Object.values(rs).includes(t)?(e.nextToken(),e.nextToken(),!0):!1}function Oo(e){let t=e.index;if(e.matchAll(["\\overset","<{>"])&&(e.match(".")||e.match("\\cdots"))&&e.matchAll(["<}>","<{>"])){let i=e.nextToken();if(i&&/^\d$/.test(i)&&e.match("<}>"))return i}return e.index=t,null}function jp(e){let t=e.peek;return t==="\\overline"||t==="\\overset"||t==="\\wideparent"||t==="\\overarc"||t==="("||t==="\\left"}function Wp(e,t,i){let r=new Zp(ye(e),t,i),n=r.parseExpression();if(!r.atEnd){let s=r.parseSyntaxError();n=n!==null?["Sequence",n,s]:s}if(n??(n="Nothing"),i.preserveLatex){if(Array.isArray(n))return{latex:e,fn:n};if(typeof n=="number")return{latex:e,num:Number(n).toString()};if(typeof n=="string"){if(fo(n))return{latex:e,str:j(n)};if(vt(n))return{latex:e,sym:n};if(zt(n))return{latex:e,num:n}}typeof n=="object"&&n!==null&&(n.latex=e)}return n}function ss(e){return e===0?{num:"0"}:Number.isInteger(e)&&Math.abs(e)<U?e:{num:e.toString()}}var Hp=100;function Ie(e){return(e.isFiniteCollection??!1)&&e.isIndexedCollection}function Qp(e,t){return typeof t=="number"?(t<0&&(t=0),{next(){return t===0?{done:!0,value:void 0}:(t--,{done:!1,value:e})}}):{next(){return{done:!1,value:e}}}}function zo(e){if(e.length===0)return{next(){return{done:!0,value:void 0}}};if(e.length===1){let n=e[0],s=n.each();if(!s){let a=!1;return{next(){return a?{done:a,value:void 0}:(a=!0,{done:!1,value:[n]})}}}return{next(){let a=s.next();return a.done?{done:!0,value:void 0}:{done:!1,value:[a.value]}}}}let t=Math.min(...e.map(n=>n.isCollection?n.xsize??1:1/0));if(t===0)return{next(){return{done:!0,value:void 0}}};let i=e.map(n=>n.isCollection?n.each():Qp(n)),r=0;return{next(){if(r>=t)return{done:!0,value:void 0};let n=i.map(s=>s.next());return r+=1,{done:!1,value:n.map(s=>s.value)}}}}function Lo(e,t,i){if(!(e.isFiniteCollection!==!0||t.isFiniteCollection!==!0)){for(let r of e.each())if(t.xcontains(r)!==!0)return!1;if(i){let r=e.xsize;if(r===void 0)return!1;let n=t.xsize;if(n===void 0||r===n)return!1}return!0}}function Yp(e,t){for(let i=0;i!==e.nops;i+=1)if(t(e.ops[i]))return i+1}function Jp(e,t){if(e.isIndexedCollection!==!0)return;let i=1,r=e.at(i);for(;r!==void 0;){if(t(r))return i;i+=1,r=e.at(i)}}function Kp(e,t){if(e.isFiniteCollection===!0){if(e.isIndexedCollection)return e.indexWhere(i=>i.isSame(t))!==void 0;for(let i of e.each())if(i.isSame(t))return!0;return!1}}function as(){return{isLazy:e=>!1,count:e=>e.nops,isEmpty:e=>e.nops===0,isFinite:e=>!0,contains:(e,t)=>e.ops.some(i=>i.isSame(t)),iterator:e=>{let t=1,i=e.nops;return{next:()=>t===i+1?{value:void 0,done:!0}:(t+=1,{value:e.ops[t-1-1],done:!1})}},subsetOf:Lo,at:(e,t)=>{if(typeof t=="number"&&(t<0&&(t=e.nops+t+1),!(t<1||t>e.nops)))return e.ops[t-1]},indexWhere:Yp,eltsgn:e=>{},elttype:e=>e.nops===0?"unknown":e.nops===1?e.ops[0].type.type:$e(...e.ops.map(t=>t.type.type))}}function Ro(e){if(!e)return;if(!e.count||!e.iterator)throw new Error('A collection must have at least an "iterator" and a "count" handler');if(e.indexWhere&&e.at===void 0)throw new Error('A collection with an "indexWhere" handler must also have an "at" handler');let t={iterator:e.iterator,count:e.count,contains:e.contains??Kp,isEmpty:e.isEmpty??(i=>{if(e.count(i)!==void 0)return e.count(i)===0}),isFinite:e.isFinite??(i=>{let r=e.count(i);if(r!==void 0)return Number.isFinite(r)}),subsetOf:e.subsetOf??Lo};return e.isLazy&&(t.isLazy=e.isLazy),e.eltsgn&&(t.eltsgn=e.eltsgn),e.elttype&&(t.elttype=e.elttype),e.at&&(t.at=e.at,t.indexWhere=e.indexWhere??Jp),t}function fe(e,t){let i=e.every(n=>n.isCanonical)?e:e.map(n=>n.canonical);if(t){let n=a=>a.symbol==="Nothing"||a.operator===t||a.operator==="Sequence";if(i.every(a=>!n(a)))return i;let s=[];for(let a of i)a.symbol!=="Nothing"&&(a.ops&&(a.operator===t||a.operator==="Sequence")?s.push(...fe(a.ops,t)):s.push(a));return s}if(i.every(n=>!(n.symbol==="Nothing"||n.operator==="Sequence")))return i;let r=[];for(let n of i)n.symbol!=="Nothing"&&(n.ops&&n.operator==="Sequence"?r.push(...fe(n.ops,t)):r.push(n));return r}function yi(e,t){if(!t||e.every(r=>!r.ops||r.operator!==t))return e;let i=[];for(let r of e)!r.ops||r.operator!==t?i.push(r):i.push(...yi(r.ops,t));return i.length,e.length,i.length===e.length?e:i}function Vo(e){if(e.every(i=>i.operator!=="Sequence"&&i.operator!=="Delimiter"))return e;let t=[];for(let i of e)if(!i.isValid)t.push(i);else if(i.operator==="Delimiter")if(i.op1.operator==="Sequence"){let r=i.op1.ops??[];r.length===0?t.push(i.engine.box(["Tuple"])):t.push(...Vo(r))}else t.push(i.op1);else i.operator==="Sequence"?i.ops&&t.push(...i.ops):t.push(i);return t}function Hi(e,t){if(e===t)return!0;if(e.ops)return e.operator!==t.operator||e.nops!==t.nops?!1:e.ops.every((i,r)=>Hi(i,t.ops[r]));if(e.isNumberLiteral){if(!t.isNumberLiteral)return!1;let i=e.numericValue,r=t.numericValue;return i===r?!0:typeof i=="number"?typeof r=="number"?i===r:r.eq(i):i.eq(r)}if(e.string||t.string)return e.string===t.string;if(e.symbol||t.symbol)return e.symbol===t.symbol;if(e.rank!==0){if(e.rank!==t.rank)return!1;for(let i=0;i<e.rank;i++)if(e.shape[i]!==t.shape[i])return!1;return e.tensor.equals(t.tensor)}return!1}function Bo(e,t){var n,s,a,o,l,u,c,f,p,h;if((n=e.operatorDefinition)!=null&&n.eq){let d=e.operatorDefinition.eq(e,e.engine.box(t));if(d!==void 0)return d}if(typeof t!="number"&&((s=t.operatorDefinition)!=null&&s.eq)){let d=t.operatorDefinition.eq(t,e);if(d!==void 0)return d}e=e.N();let i=typeof t!="number"?t.N():e.engine.box(t);if(e.ops||i.ops){let d=(o=(a=e.operatorDefinition)==null?void 0:a.eq)==null?void 0:o.call(a,e,i);return d!==void 0||(d=(u=(l=i.operatorDefinition)==null?void 0:l.eq)==null?void 0:u.call(l,i,e),d!==void 0)?d:e.isSame(i)?!0:e.unknowns.length===0&&i.unknowns.length===0?e.isFinite&&i.isFinite?Zo(e.sub(i).simplify().N()):e.isNaN||i.isNaN?!1:!!(e.isInfinity&&i.isInfinity&&e.sgn===i.sgn):(e=e.expand().simplify(),i=i.expand().simplify(),Xp(e,i)?Hi(e,i):void 0)}if(e.symbol){let d=(f=(c=e.valueDefinition)==null?void 0:c.eq)==null?void 0:f.call(c,i);if(d!==void 0)return d}if(i.symbol){let d=(h=(p=i.valueDefinition)==null?void 0:p.eq)==null?void 0:h.call(p,e);if(d!==void 0)return d}if(e.symbol&&i.symbol)return e.symbol===i.symbol;let r=e.engine;if(e.isNumberLiteral&&i.isNumberLiteral)return e.isFinite&&i.isFinite?Zo(e.sub(i)):e.isNaN||i.isNaN?!1:!!(e.isInfinity&&i.isInfinity&&e.sgn===i.sgn);if(r.ask(r.box(["Equal",e,i])).length>0)return!0;if(r.ask(r.box(["NotEqual",e,i])).length>0)return!1;if(!(e.unknowns.length>0||i.unknowns.length>0))return Hi(e,i)}function Gr(e,t){var i,r,n,s,a,o;if(e.isNumberLiteral){if(typeof t!="number"&&typeof t.numericValue=="number"&&(t=t.numericValue),typeof t=="number"){if(t===0){let c=e.sgn;return c===void 0?void 0:c==="zero"?"=":c==="positive"?">":c==="negative"?"<":c==="non-negative"?">=":c==="non-positive"?"<=":void 0}if(e.isNumberLiteral){let c=e.numericValue;return typeof c=="number"?Math.abs(c-t)<=e.engine.tolerance?"=":c<t?"<":">":c.eq(t)?"=":c.lt(t)?"<":">"}return}if(!t.isNumberLiteral)return;let l=e.numericValue,u=t.numericValue;return typeof l=="number"?u.eq(l)?"=":u.lt(l)?">":"<":l.eq(u)?"=":l.lt(u)?"<":">"}if(typeof t!="number"){if(e.ops||t.ops){if(((r=(i=e.operatorDefinition)==null?void 0:i.eq)==null?void 0:r.call(i,e,t))!==void 0)return"=";let l=e.sub(t).N();if(!l.isNumberLiteral)return;if(typeof l.numericValue=="number")return l.numericValue===0?"=":l.numericValue<0?"<":">";let u=e.engine.tolerance;return l.numericValue.isZeroWithTolerance(u)?"=":l.numericValue.lt(0)?"<":">"}if(e.symbol)return e.symbol===t.symbol?"=":((s=(n=e.valueDefinition)==null?void 0:n.cmp)==null?void 0:s.call(n,t))||(((o=(a=e.valueDefinition)==null?void 0:a.eq)==null?void 0:o.call(a,t))===!0?"=":void 0);if(e.string)return t.string?e.string===t.string?"=":e.string<t.string?"<":">":void 0;if(e.tensor)return t.tensor&&e.tensor.equals(t.tensor)?"=":void 0}}function Zo(e){if(!e.isNumberLiteral)return!1;let t=e.numericValue,i=e.engine;return typeof t=="number"?i.chop(t)===0:t.isZeroWithTolerance(i.tolerance)}function Xp(e,t){let i=e.unknowns,r=t.unknowns;if(i.length!==r.length)return!1;for(let n of i)if(!r.includes(n))return!1;return!0}function Me(e){if(e){if(e.operator==="Function"&&e.isCanonical||e.symbol)return e;if(e.operator==="BuiltinFunction")return e.op1;if(e.operator==="Delimiter"){if(e.op1.operator==="Sequence")if(e.op1.nops===1)e=e.op1;else return Me(e.engine._fn("Block",e.op1.ops,{canonical:!1}));return Me(e.op1)}if(e.operator==="Function")return jr(e.engine,e.ops);if(e.operator){e.operator;let t=e.engine,i=e.subs({_:"_1"}),r=1,n=[];for(;r<10;)i.has(`_${r}`)&&n.push(i.engine.symbol(`_${r}`,{canonical:!1})),r++;if(n.length===0){i.operator!=="Block"?i=t.function("Block",[i]):i=i.canonical;let s=i.unknowns;s.length>0&&(n=s.map(a=>t.symbol(a,{canonical:!1})))}return jr(t,[i,...n])}}}function jr(e,t){if(t.length===0)return;let i=t[0].operator==="Block"?t[0].canonical:e.function("Block",[t[0]]),r=t.slice(1).map(n=>n.symbol?n:e.error("expected-a-symbol",n.toString()));i.isScoped;for(let n of r)n.symbol&&!i.localScope.bindings.has(n.symbol)&&e.declare(n.symbol,{inferred:!0,type:"unknown"},i.localScope);return e._fn("Function",[i,...r])}function ei(e,t){var r;return((r=os(e))==null?void 0:r(t))||e.engine.function("Apply",[e,...t])}function os(e){let t=e.engine;if(e.symbol)return s=>t.function(e.symbol,s).evaluate();let i=Me(e);if(!i)throw new Error("Invalid function literal");if(e=i,e.operator,e.isCanonical,e.ops,e.ops.length===1)return e.ops[0],()=>e.ops[0].evaluate();let[r,...n]=e.ops;return r.isScoped,s=>{if(s.length>n.length)throw new Error(`Too many arguments for function "${e.toString()}": expected ${n.length}, got ${s.length}`);if(t.strict&&!s.every(o=>o.isValid))return;if(s.length<n.length){let o=new Set([...r.symbols,...n.map(f=>f.symbol)]),l=n.slice(s.length).map((f,p)=>{let h=`_${p+1}`,d=0;for(;o.has(h);)h=`_${p+1}_${d++}`;return o.add(h),t.symbol(h,{canonical:!1})}),u=Object.fromEntries(n.slice(s.length).map((f,p)=>[f.symbol,l[p]])),c=r.evaluate({withArguments:Object.fromEntries(n.slice(0,s.length).map((f,p)=>[f.symbol,s[p]]))}).subs(u);return t.function("Function",[c,...l])}let a=r.evaluate({withArguments:Object.fromEntries(n.map((o,l)=>[o.symbol,s[l].evaluate()]))});return a.isValid?a:void 0}}function ne(e){return os(e)??(t=>e.engine.function("Apply",[e,...t]).evaluate())}function eh(e){let t=os(e),i=e.engine;return t?r=>{var n;return((n=t([i.number(r)]))==null?void 0:n.re)??NaN}:r=>i.function("Apply",[e,i.number(r)]).evaluate().re}function Uo(e,t){typeof e=="string"&&e.length>0;let i=t;for(;i;){let r=i.bindings.get(e);if(r)return r;i=i.parent}}function Qi(e,t){for(;t!==BigInt(0);)[e,t]=[t,e%t];return e<0?-e:e}function th(e,t){return e*t/Qi(e,t)}function*ls(e){if(e<0)return BigInt(0);if(e<10)return BigInt([1,1,2,6,24,120,720,5040,40320,362880][Number(e)]);if(e%BigInt(2)===BigInt(1))return e*(yield*ls(e-BigInt(1)));let t=e,i=e,r=e,n=0;for(;t>2;)t-=BigInt(2),i+=t,r*=i,n+=1,(n%5e4===0||n>1e4&&n%500===0)&&(yield r);return r}function bi(e){return e!==null&&Array.isArray(e)}function re(e){return e!==null&&Array.isArray(e)&&typeof e[0]=="number"}function Go(e){return e!==null&&Array.isArray(e)&&typeof e[0]=="bigint"}function Rt(e){return e[0]==0}function jo(e){return e[0]>0}function Ue(e){return e[0]==e[1]}function us(e){return e[0]===-e[1]}function Yi(e){return e[1]==1}function ih(e){return Number(e[0])}function rh(e){return Number(e[1])}function nh(e){return Number(e[0])/Number(e[1])}function Ji(e,t){if(typeof e[0]=="number"&&!Number.isFinite(e[0]))return e;let i=t;if(i===null)return e;if(Go(i))return e=[BigInt(e[0]),BigInt(e[1])],[i[1]*e[0]+i[0]*e[1],i[1]*e[1]];if(!Number.isFinite(i[0]))return i;if(Go(e)){let r=[BigInt(i[0]),BigInt(i[1])];return[r[1]*e[0]+r[0]*e[1],r[1]*e[1]]}return[i[1]*e[0]+i[0]*e[1],i[1]*e[1]]}function vi(e,t){return re(e)&&re(t)?[e[0]*t[0],e[1]*t[1]]:re(e)?[BigInt(e[0])*t[0],BigInt(e[1])*t[1]]:re(t)?[BigInt(t[0])*e[0],BigInt(t[1])*e[1]]:[e[0]*t[0],e[1]*t[1]]}function Wr(e){return[-e[0],e[1]]}function sh(e){return e[0]<0?[-e[1],-e[0]]:[e[1],e[0]]}function ah(e){return[Number(e[0]),Number(e[1])]}function Wo(e,t){return re(e)&&re(t)?e[1]===1&&t[1]===1?[Je(e[0],t[0]),1]:[Je(e[0],t[0]),Wn(e[1],t[1])]:e[1]===1&&t[1]===1?[Qi(BigInt(e[0]),BigInt(t[0])),BigInt(1)]:[Qi(BigInt(e[0]),BigInt(t[0])),th(BigInt(e[1]),BigInt(t[1]))]}function cs(e){if(re(e)){if(e[0]===1||e[1]===1)return e;if(e[1]<0&&(e=[-e[0],-e[1]]),!Number.isFinite(e[1]))return[0,1];let n=Je(e[0],e[1]);return n<=1?e:[e[0]/n,e[1]/n]}e[1]<0&&(e=[-e[0],-e[1]]);let t=Qi(e[0],e[1]),[i,r]=t<=1?e:[e[0]/t,e[1]/t];return i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER&&r<=Number.MAX_SAFE_INTEGER?[Number(i),Number(r)]:[i,r]}function oh(e){if(!Number.isFinite(e)||e%1===0)return e;let t=1e-15,i=Math.floor(e),r=1,n=0,s=i,a=1;for(;e-i>t*a*a;){e=1/(e-i),i=Math.floor(e);let o=r;r=s;let l=n;n=a,s=o+i*r,a=l+i*n}return[s,a]}var pe=class{constructor(){m(this,"im")}get bignumRe(){}get bignumIm(){}isZeroWithTolerance(e){return this.isZero}valueOf(){return this.im===0?this.bignumRe?this.bignumRe.toNumber():this.re:this.toString()}[Symbol.toPrimitive](e){return e==="string"?this.toString():this.valueOf()}toJSON(){if(this.im===0){let e=this.re;if(Number.isFinite(e))return e}return this.N().toString()}print(){let e=console.log;e==null||e(this.toString())}};function lh(e){if(e==="N")return[0,""];let t={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},i=0,r=0;e=e.toUpperCase();for(let n=e.length-1;n>=0;n--){let s=t[e[n]];if(s===void 0)return[i,e.slice(n)];s<r?i-=s:i+=s,r=s}return[i,""]}function Hr(e,t){if(e=e.trim(),e.length===0)return[NaN,""];if(e.startsWith("+"))return Hr(e.slice(1),t);if(e.startsWith("-")){let[n,s]=Hr(e.slice(1),t);return[-n,s]}let i=10;if(typeof t=="string"&&(t=t.toLowerCase()),e.startsWith("0x"))i=16,e=e.slice(2);else if(e.startsWith("0b"))i=2,e=e.slice(2);else{if(t==="roman")return lh(e);if(t==="base64"||t==="base-64")try{return[parseInt(btoa(e)),""]}catch{return[NaN,""]}else typeof t=="number"?i=t:typeof t=="string"&&(i=parseInt(t))}let r=0;for(let n=0;n<e.length;n++){let s={" ":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,"":-1,_:-1,",":-1,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35}[e[n]];if(s!==-1){if(s===void 0)return[r,e.substring(n)];if(s>=i)return[r,e.substring(n)];r=r*i+s}}return[r,""]}function ze(e,t){if(typeof t=="number"&&typeof e=="number")return e.toFixed(t);let i=e.toString();if(typeof e=="number"&&Number.isInteger(e)&&i.includes("e")){let r=BigInt(e).toString(),n=r.match(/0+$/);if((n?n[0].length:0)<=5)return r}else if(typeof e=="bigint"){let r=i.match(/0+$/),n=r?r[0].length:0;if(n>5)return`${i.slice(0,-n)}e+${n}`}return i}function uh(e){if(typeof e=="number")return Number.isInteger(e)?BigInt(e):null;if(e==null||!mi(e))return null;let t=Cr(e)?e.num:e;if(typeof t=="number")return Number.isInteger(t)?BigInt(t):null;if(typeof t!="string")return null;let i=t.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"");return i==="nan"||/^(infinity|\+infinity|oo|\+oo|-infinity|-oo)$/.test(i)?null:de(i)}function Ge(e,t){if(typeof e=="number")return isNaN(e)?"NaN":Number.isFinite(e)?typeof t=="number"?{num:e.toFixed(t)}:e:e<0?"NegativeInfinity":"PositiveInfinity";if(e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER)return Number(e);let i=ze(e);return Number(e).toString()===i?Number(e):{num:i}}var _e=class Be extends pe{constructor(i,r,n){super();m(this,"__brand");m(this,"rational");m(this,"radical");m(this,"im",0);m(this,"factory");m(this,"bignum");if(this.factory=r,this.bignum=n,typeof i=="number"){this.rational=[i,1],this.radical=1;return}if(typeof i=="bigint"){this.rational=[i,BigInt(1)],this.radical=1;return}let s=i.rational?[...i.rational]:[1,1];this.rational=s,this.radical=i.radical??1,this.radical<=U&&this.radical>=1,this.normalize()}get type(){return this.isNaN?"number":this.isPositiveInfinity||this.isNegativeInfinity?"non_finite_number":this.radical!==1?(Rt(this.rational),"finite_real"):Yi(this.rational)?"finite_integer":"finite_rational"}get isExact(){return!0}get asExact(){return this}toJSON(){if(this.isNaN)return"NaN";if(this.isPositiveInfinity)return"PositiveInfinity";if(this.isNegativeInfinity)return"NegativeInfinity";if(this.isZero)return 0;if(this.isOne)return 1;if(this.isNegativeOne)return-1;let i=r=>Yi(r)?Ge(r[0]):["Rational",Ge(r[0]),Ge(r[1])];return this.radical===1?i(this.rational):Ue(this.rational)?["Sqrt",this.radical]:us(this.rational)?["Negate",["Sqrt",this.radical]]:this.rational[0]==1?["Divide",["Sqrt",this.radical],Ge(this.rational[1])]:this.rational[0]==-1?["Negate",["Divide",["Sqrt",this.radical],Ge(this.rational[1])]]:["Multiply",i(this.rational),["Sqrt",this.radical]]}clone(i){return new Be(i,this.factory,this.bignum)}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";let i=n=>Yi(n)?ze(n[0]):`${ze(n[0])}/${ze(n[1])}`;if(this.radical===1)return i(this.rational);let r=n=>`sqrt(${ze(n)})`;return Ue(this.rational)?r(this.radical):us(this.rational)?`-${r(this.radical)}`:this.rational[0]==1?`${r(this.radical)}/${ze(this.rational[1])}`:this.rational[0]==-1?`-${r(this.radical)}/${ze(this.rational[1])}`:`${i(this.rational)}${r(this.radical)}`}get sign(){return Rt(this.rational)?0:jo(this.rational)?1:-1}get re(){return nh(this.rational)*Math.sqrt(this.radical)}get bignumRe(){let i,r=this.rational;return re(r)?i=this.bignum(r[0]).div(r[1]):i=this.bignum(r[0].toString()).div(this.bignum(r[1].toString())),this.radical===1?i:i.mul(this.bignum(this.radical).sqrt())}get numerator(){return this.rational[1]==1?this:this.clone({rational:re(this.rational)?[this.rational[0],1]:[this.rational[0],BigInt(1)],radical:this.radical})}get denominator(){return re(this.rational)?this.clone(this.rational[1]):this.clone({rational:[this.rational[1],BigInt(1)]})}normalize(){if(Number.isInteger(this.radical)&&this.radical>0&&Number.isFinite(this.radical),isNaN(this.radical)){this.rational=[NaN,1],this.radical=1;return}let[i,r]=this.rational;if(r==0){this.rational=[NaN,1],this.radical=1;return}if(this.radical===0||i===0){this.rational=[0,1],this.radical=1;return}if(this.radical>=4){let[n,s]=jn(this.radical,2);typeof this.rational[0]=="number"?this.rational[0]*=n:this.rational=vi(this.rational,[n,1]),this.radical=s}this.rational=cs(this.rational)}get isNaN(){return Number.isNaN(this.rational[0])}get isPositiveInfinity(){return this.rational[0]==1/0}get isNegativeInfinity(){return this.rational[0]==-1/0}get isComplexInfinity(){return!1}get isZero(){return Rt(this.rational)}get isOne(){return!(this.rational[0]!==this.rational[1]||this.radical!==1)}get isNegativeOne(){return!(this.rational[0]!==-this.rational[1]||this.radical!==1)}sgn(){if(!Number.isNaN(this.rational[0]))return Rt(this.rational)?0:jo(this.rational)?1:-1}N(){return this.isZero||this.isOne||this.isNegativeOne?this:this.rational[1]==1&&this.radical===1?this:this.factory(this.bignumRe)}neg(){return this.isZero?this:this.clone({rational:Wr(this.rational),radical:this.radical})}inv(){return this.isOne?this:this.isNegativeOne?this:this.clone({rational:re(this.rational)?[this.rational[1],this.rational[0]*this.radical]:[this.rational[1],this.rational[0]*BigInt(this.radical)],radical:this.radical})}add(i){return typeof i=="number"?i===0?this:Number.isInteger(i)&&this.radical===1?this.clone({rational:re(this.rational)?[this.rational[0]+i*this.rational[1],this.rational[1]]:[this.rational[0]+BigInt(i)*this.rational[1],this.rational[1]]}):this.factory(this.bignumRe).add(i):i.isZero?this:this.isZero?i:i instanceof Be?this.radical===i.radical?this.clone({rational:Ji(this.rational,i.rational),radical:this.radical}):this.factory(this.bignumRe).add(i):i.add(this)}sub(i){return this.add(i.neg())}mul(i){return i===0?this.clone(0):i===1?this:i===-1?this.neg():typeof i=="number"?Number.isInteger(i)?this.clone({rational:re(this.rational)?[this.rational[0]*i,this.rational[1]]:[this.rational[0]*BigInt(i),this.rational[1]],radical:this.radical}):this.factory(this.bignumRe).mul(i):i instanceof Z?this.factory(i).mul(this):i.im!==0?i.mul(this):i.isZero?i:i.isOne?this:i.isNegativeOne?this.neg():i.isNaN?i:this.isZero?this:this.isOne?i:this.isNegativeOne?i.neg():i instanceof Be?this.clone({rational:vi(this.rational,i.rational),radical:this.radical*i.radical}):i.mul(this)}div(i){if(typeof i=="number")return i===1?this:i===-1?this.neg():i===0?this.clone(NaN):this.clone({rational:re(this.rational)?[this.rational[0],this.rational[1]*i]:[this.rational[0],this.rational[1]*BigInt(i)],radical:this.radical});if(i.isOne)return this;if(i.isNegativeOne)return this.neg();if(this.isZero)return i.isZero?this.clone(NaN):i.isNaN?i:this;if(i.isNaN)return i;if(i.isZero)return this.clone(this.sign*(1/0));if(!(i instanceof Be))return this.factory(this.bignumRe).div(i);if(i.im!==0)return this.factory(this.bignumRe).div(i);let r;if(re(this.rational)&&re(i.rational)){let[n,s]=this.rational,[a,o]=i.rational;r=[n*o,s*a*i.radical]}else r=vi(this.rational,[BigInt(i.rational[1]),BigInt(i.rational[0])*BigInt(i.radical)]);return this.clone({rational:r,radical:this.radical*i.radical})}pow(i){if(this.isNaN)return this;if(typeof i=="number"&&isNaN(i))return this.clone(NaN);if(i instanceof pe){if(i.isNaN)return this.clone(NaN);if(i.isZero)return this.clone(1);if(i.isOne)return this;if(i.im)i={re:i.re,im:i.im};else{if(i instanceof Be&&i.radical===1&&i.rational[0]==1)return this.root(i.rational[0]);i=i.re}}if(i===.5)return this.sqrt();if(typeof i=="object"&&("re"in i||"im"in i))return this.factory(this.bignumRe).pow(i);if(this.isPositiveInfinity){if(i===-1)return this.clone(0);if(i===1/0)return this.clone(1/0);if(i===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&i===1/0)return this.clone(NaN);if((i===1/0||i===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(i===1)return this;if(i===-1)return this.inv();if(i===0)return this.clone(1);if(this.isZero){if(i>0)return this;if(i<0)return this.factory({im:1/0})}if(i<0)return this.pow(-i).inv();if(i%1===.5)return this.pow(Math.floor(i)).mul(this.sqrt());if(this.radical>U||this.rational[0]>U||this.rational[0]<-U||this.rational[1]>U)return this.factory(this.bignumRe).pow(i);if(this.sign<0){if(Number.isInteger(i)){let r=i%2===0?1:-1;return this.clone({rational:re(this.rational)?[r*(-this.rational[0])**i,this.rational[1]**i]:[BigInt(r)*(-this.rational[0])**BigInt(i),this.rational[1]**BigInt(i)],radical:this.radical**i})}return this.factory({im:(-this.re)**i})}else if(Number.isInteger(i))return this.clone({rational:re(this.rational)?[this.rational[0]**i,this.rational[1]**i]:[BigInt(this.rational[0])**BigInt(i),this.rational[1]**BigInt(i)],radical:this.radical**i});return this.factory(this.bignumRe).pow(i)}root(i){if(i===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(i===1)return this;if(i===-1)return this.inv();if(i<0)return this.root(-i).inv();if(i%1===.5)return this.root(Math.floor(i)).sqrt();if(this.radical===1){if(this.sign>0){let r=this.re;if(Number.isInteger(r)){if(r>0){let n=Math.pow(r,1/i);if(Number.isInteger(n))return this.clone(n)}return this.factory(this.bignumRe).root(i)}}return this.factory(this.bignumRe).root(i)}if(this.sign<0)return this.factory({im:Math.pow(-this.re,1/i)});if(this.radical>U||this.rational[0]>U||this.rational[0]<-U||this.rational[1]>U)return this.factory(this.bignumRe).root(i);if(this.rational[1]==1){let r=Math.pow(this.rational[0],1/i);if(Number.isInteger(r))return this.clone(r)}return this.factory(this.bignumRe).root(i)}sqrt(){if(this.isZero||this.isOne)return this;if(this.radical===1)if(re(this.rational)){let[i,r]=this.rational;return i*r>U?this.factory(this.bignumRe).sqrt():i>0?this.clone({radical:i*r,rational:[1,r]}):this.factory({im:Math.sqrt(-i*r)/r})}else return this.factory(this.bignumRe).sqrt();if(this.sign>0){let i=Math.sqrt(this.re);if(Number.isInteger(i))return this.clone(i)}return this.factory(this.bignumRe).sqrt()}gcd(i){if(!(i instanceof Be))return i.gcd(this);if(this.isOne||i.im!==0||i.isOne)return this.clone(1);let r=Wo(this.rational,i.rational),n=Je(this.radical,i.radical);return this.clone({rational:r,radical:n})}abs(){return this.sign===-1?this.neg():this}ln(i){return this.isZero?this.clone(NaN):this.isPositiveInfinity?this.clone(1/0):this.sign<0?this.clone(NaN):this.isOne?this.clone(0):this.isNegativeOne?this.factory({im:Math.PI}):this.factory(this.bignumRe).ln(i)}exp(){return this.isNaN?this.clone(NaN):this.isZero?this.clone(1):this.isNegativeInfinity?this.clone(0):this.isPositiveInfinity?this.clone(1/0):this.factory(this.bignumRe).exp()}floor(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.floor(this.re))}ceil(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.ceil(this.re))}round(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.round(this.re))}eq(i){return typeof i=="number"?this.radical===1&&Yi(this.rational)&&this.rational[0]==i:i instanceof Be?this.radical===i.radical&&this.rational[0]==i.rational[0]&&this.rational[1]==i.rational[1]:i.im===0&&i.re===this.re}lt(i){return this.im,typeof i=="number"?this.re<i:this.re<i.re}lte(i){return this.im,typeof i=="number"?this.re<=i:this.re<=i.re}gt(i){return this.im,typeof i=="number"?this.re>i:this.re>i.re}gte(i){return this.im,typeof i=="number"?this.re>=i:this.re>=i.re}static sum(i,r,n){if(i.length===1)return i;if(i.some(u=>!u.isExact)){if(i.length===2)return[i[0].add(i[1])];let u=r(0);for(let c of i)u=u.add(c);return[u]}let s=0,a=[0,1],o=[];for(let u of i){if(u.isNaN)return[new Be(NaN,r,n)];if(!u.isZero)if(s+=u.im,u instanceof Be){let c=u.rational;if(u.radical===1)a=Ji(a,c);else{let f=o.findIndex(p=>p.radical===u.radical);f===-1?o.push({multiple:c,radical:u.radical}):o[f].multiple=Ji(o[f].multiple,c)}}else _(u.type,"integer"),a=Ji(a,[u.re,1])}if(Rt(a)&&o.length===0)return s===0?[new Be(0,r,n)]:[r({im:s})];let l=[];return s!==0&&l.push(r({im:s})),o.length===0?l.push(new Be({rational:a},r,n)):(o.push({multiple:a,radical:1}),l.push(...o.map(u=>new Be({rational:u.multiple,radical:u.radical},r,n)))),l}};function Vt(e){let t=e.numericValue;if(t===null||typeof t=="number"&&!Number.isFinite(t)||t instanceof pe&&(t.isNaN||t.isPositiveInfinity||t.isNegativeInfinity))return;if(typeof t=="number")return Number.isInteger(t)?[t,1]:void 0;let i=t.type;if(i!=="finite_integer"&&i!=="finite_rational"||t.im!==0)return;if(t instanceof _e)return t.radical!==1?void 0:t.rational;let r=t.bignumRe;if(r!==void 0&&Number.isInteger(r))return[de(r),BigInt(1)];let n=t.re;if(Number.isInteger(n))return[n,1]}function xi(e){if(e==null)return null;if(typeof e=="bigint")return e;if(typeof e=="number"&&Number.isInteger(e))return BigInt(e);if(Ii(e)){let t=e.numericValue;if(t===null)return null;if(typeof t=="number")return Number.isInteger(t)?BigInt(t):null;if(t.im!==0)return null;let i=t.bignumRe;return i!=null&&i.isInteger()?de(i):Number.isInteger(t.re)?BigInt(t.re):null}return e instanceof Z||typeof e=="string"?de(e):e instanceof W?e.im===0?de(e.re):null:uh(e)}function Ho(e){if(e==null)return null;let t=typeof e=="number"?e:e.numericValue;if(t===null)return null;if(typeof t=="number")return e.engine.bignum(t);if(t.im!==0)return null;let i=t.bignumRe??t.re;return typeof i=="number"&&isNaN(i)?null:e.engine.bignum(i)}function se(e){if(e==null)return null;if(typeof e=="number")return Number.isInteger(e)&&e>=-U&&e<=U?e:null;let t=e.numericValue;if(t===null)return null;if(typeof t=="number")return Number.isInteger(t)&&t>=-U&&t<=U?t:null;if(t.im!==0)return null;let i=t.re;return Number.isInteger(i)&&i>=-U&&i<=U?Number(i):null}function L(e){let t=(e==null?void 0:e.numericValue)??void 0;return t===void 0?null:Math.round(typeof t=="number"?t:t.re)}function he(e){if(e==null)return null;let t=e.numericValue;if(t===null)return null;if(typeof t=="number")return BigInt(Math.round(t));let i=t.bignumRe??t.re;return typeof i=="number"?BigInt(Math.round(i)):de(i.round())}function Re(e){if(e.symbol&&!e.isConstant)return 1;if(e.operator==="Power"&&e.op2.isNumberLiteral){if(Re(e.op1)===0)return 0;let t=se(e.op2);return t!==null&&t>0?t:0}if(e.operator==="Multiply"){let t=0;for(let i of e.ops){let r=Re(i);t=t+r}return t}if(e.operator==="Add"||e.operator==="Subtract"){let t=0;for(let i of e.ops)t=Math.max(t,Re(i));return t}return e.operator==="Negate"||e.operator==="Divide"?Re(e.op1):0}function ft(e){if(e.symbol&&!e.isConstant)return 1;if(e.operator==="Power"&&e.op2.isNumberLiteral){if(ft(e.op1)===0)return 0;let t=se(e.op2);return t!==null&&t>0?t:0}if(e.operator==="Multiply"||e.operator==="Add"||e.operator==="Subtract"){let t=0;for(let i of e.ops)t=Math.max(t,Re(i));return t}return e.operator==="Negate"||e.operator==="Divide"?ft(e.op1):0}function Qo(e){return e.symbol&&!e.isConstant?e.symbol:e.ops?e.ops.map(t=>Qo(t)).join(" ").trim():""}function Yo(e){return Qo(e).split(" ").reverse().join(" ").trim()}function X(e,t,i,r){if(((e==null?void 0:e.numericValue)??null)===null)return;let n=e.engine,s;if(e.im!==0)s=r==null?void 0:r(n.complex(e.re,e.im));else{let a=e.bignumRe;if(a!==void 0&&be(n)&&i)s=i(a);else{let o=e.re;be(n)&&i?s=i(n.bignum(o)):s=t(o)}}if(s!==void 0)return s instanceof W?n.number(n._numericValue({re:s.re,im:s.im})):n.number(s)}function ti(e,t,i,r,n){if(e.numericValue===null||t.numericValue===null)return;let s=e.engine,a;if((e.im!==0||t.im!==0)&&(a=n==null?void 0:n(s.complex(e.re,e.im),s.complex(t.re,t.im))),a===void 0&&r){let o=e.bignumRe,l=t.bignumRe;(o!==void 0||l!==void 0)&&(o??(o=s.bignum(e.re)),l??(l=s.bignum(t.re)),a=r(o,l))}if(a===void 0){let o=e.re,l=t.re;!isNaN(o)&&!isNaN(l)&&(be(s)&&r?a=r(s.bignum(e.bignumRe??o),s.bignum(t.bignumRe??l)):a=i(o,l))}if(a!==void 0)return a instanceof W?s.number(s._numericValue({re:s.chop(a.re),im:s.chop(a.im)})):s.number(s.chop(a))}function Jo(e){return e.operator==="Sqrt"||e.operator==="Power"&&e.op2.im===0&&e.op2.re===.5||e.operator==="Root"&&e.op2.im===0&&e.op2.re===2}function Ko(e){if(Jo(e))return Vt(e.op1)??null;if(e.operator==="Divide"&&e.op1.is(1)&&Jo(e.op2)){let t=e.op2.re;return Number.isInteger(t)?[1,t]:null}return null}function Ni(e,t){let i=e.engine,r=e.isCanonical&&t.isCanonical,n=()=>i._fn("Power",[e,t],{canonical:r});if(e.operator==="Power"){let[o,l]=e.ops;return i._fn("Power",[o,i.box(["Multiply",l,t],{canonical:r||"Power"})])}if(t.isFunctionExpression||t.symbol!==null||!t.type.matches("number"))return n();if(e.isNumberLiteral&&e.is(0))return t.type.matches("imaginary")||t.isNaN||t.is(0)?i.NaN:t.isInfinity?t.isPositive?i.Zero:t.isNegative?i.ComplexInfinity:i.NaN:t.isGreater(0)?i.Zero:t.isLess(0)?i.ComplexInfinity:n();let s=e.type.matches("number")&&(e.isFunctionExpression===!1||e.operator==="Negate");if(t.is(0))return s&&e.isFinite!==void 0?e.isFinite?i.One:i.NaN:n();if(s&&e.is(1))return t.isFinite?i.One:i.NaN;if(t.is(1)&&e.type.matches("number"))return e;if(t.is(-1)){if(s){if(e.isInfinity&&(e.isNegative||e.isPositive))return i.Zero;if(e.is(-1))return i.NegativeOne;if(e.is(1))return i.One}return e.isCanonical?e.inv():i._fn("Power",[e,i.number(-1)],{canonical:!1})}if(t.isInfinity&&s)return t.isPositive?e.is(-1)?i.NaN:e.isInfinity?i.ComplexInfinity:e.isNaN?i.NaN:e.isReal?e.isGreater(1)?i.PositiveInfinity:e.isLess(-1)?i.ComplexInfinity:i.Zero:n():t.isNegative?e.is(-1)?i.NaN:e.isInfinity?i.Zero:e.isNaN?i.NaN:e.isReal?e.isGreater(0)?e.isLess(1)?i.PositiveInfinity:i.Zero:e.isGreater(-1)?i.ComplexInfinity:i.Zero:n():i.NaN;if(e.isNumberLiteral&&e.isInfinity){if(t.type.matches("imaginary"))return i.NaN;if(t.type.matches("complex")&&!isNaN(t.re)){if(t.re>0)return i.ComplexInfinity;if(t.re<0)return i.Zero}}if(t.is(.5))return e.isCanonical?Ki(e,2):i._fn("Sqrt",[e],{canonical:!1});let a=Vt(t);return a!==void 0&&a[0]===1&&a[1]!==1?e.isCanonical?Ki(e,i.number(a[1])):i._fn("Root",[e,i.number(a[1])],{canonical:!1}):n()}function Ki(e,t){let i=e.engine,r;if(typeof t=="number"?r=t:t.isNumberLiteral&&t.im===0&&(r=t.re),r===1)return e;if(r===2){if(e.isNumberLiteral&&e.type.matches("rational")&&e.re<U){let n=e.sqrt();if(typeof n.numericValue=="number"||n.numericValue.isExact)return n}return i._fn("Sqrt",[e],{canonical:e.isCanonical})}return i._fn("Root",[e,typeof t=="number"?i.number(t):t],{canonical:e.isCanonical&&(typeof t=="number"||t.isCanonical)})}function Ce(e,t,{numericApproximation:i}){if(!e.isCanonical||typeof t!="number"&&!t.isCanonical)return e.engine._fn("Power",[e,e.engine.box(t)],{canonical:!1});if(i&&e.isNumberLiteral){if(typeof t=="number")return X(e,a=>Math.pow(a,t),a=>a.pow(t),a=>a.pow(t))??Ce(e,t,{numericApproximation:!1});if(t.isNumberLiteral)return ti(e,t,(a,o)=>Math.pow(a,o),(a,o)=>a.pow(o),(a,o)=>a.pow(o))??Ce(e,t,{numericApproximation:!1})}let r=e.engine;typeof t!="number"&&(t=t.canonical);let n=Ni(e,r.box(t));if(n.operator!=="Power")return n;let s=typeof t=="number"?t:t.im===0?t.re:void 0;if(e.symbol==="ComplexInfinity")return r.NaN;if(e.symbol==="ExponentialE"){let a=un(t);if(a!==void 0){if(a=Bl(a),a!==void 0)return r.function("Cos",[a]).add(r.function("Sin",[a]).mul(r.I)).simplify()}else{if(typeof t=="number")return r.number(r._numericValue(r.E.N().numericValue).pow(t));if(t.isNumberLiteral)return r.number(r._numericValue(r.E.N().numericValue).pow(t.numericValue))}}if(e.operator==="Power"){let[a,o]=e.ops;return Ce(a,o.mul(t),{numericApproximation:i})}if(e.operator==="Divide"){let[a,o]=e.ops;return Ce(a,t,{numericApproximation:i}).div(Ce(o,t,{numericApproximation:i}))}if(e.operator==="Negate"&&s!==void 0)return s%2===0?Ce(e.op1,t,{numericApproximation:i}):Ce(e.op1,t,{numericApproximation:i}).neg();if(e.operator==="Sqrt")return s===2?e.op1:s!==void 0&&s%2===0?e.op1.pow(s/2):Ce(e.op1,t,{numericApproximation:i}).sqrt();if(e.operator==="Exp")return Ce(r.E,e.op1.mul(t),{numericApproximation:i});if(e.operator==="Multiply"){let a=e.ops.map(o=>Ce(o,t,{numericApproximation:i}));return r._fn("Multiply",a)}if(typeof t!="number"&&t.isNumberLiteral){let a=Vt(t);if(a!==void 0&&a[0]===1)return fs(e,r.number(a[1]),{numericApproximation:i})}if(e.operator==="Root"){let[a,o]=e.ops;return Ce(a,r.box(t).div(o),{numericApproximation:i})}if(e.isNumberLiteral&&Number.isInteger(s)){let a=e.numericValue;return typeof a=="number"?X(e,o=>Math.pow(o,s),o=>o.pow(s),o=>o.pow(s))??r._fn("Power",[e,r.box(t)]):r.number(a.pow(s))}return r._fn("Power",[e,r.box(t)])}function fs(e,t,{numericApproximation:i}){var r,n;if(!e.isCanonical||!t.isCanonical)return e.engine._fn("Root",[e,t],{canonical:!1});if(i&&e.isNumberLiteral&&t.isNumberLiteral){let s=e.isNegative,a=t.isEven;return s&&(e=e.neg()),ti(e,t,(o,l)=>{let u=Math.pow(o,1/l);return s&&!a?-u:u},(o,l)=>{let u=o.pow(l.pow(-1));return s&&!a?u.neg():u},(o,l)=>{let u=o.pow(typeof l=="number"?1/l:l.inverse());return s&&!a?u.neg():u})??fs(e,t,{numericApproximation:!1})}if(e.isNumberLiteral&&t.isNumberLiteral&&t.isInteger){let s=typeof t=="number"?t:t.im===0?t.re:void 0;if(s!==void 0)if(typeof e.numericValue=="number"){let a=(r=e.engine._numericValue(e.numericValue))==null?void 0:r.root(s);if(a!=null&&a.isExact)return e.engine.number(a)}else{let a=(n=e.numericValue.asExact)==null?void 0:n.root(s);if(a!=null&&a.isExact)return e.engine.number(a)}}return e.engine._fn("Root",[e,t])}var _i=1e5,ch={Sin:!0,Cos:!0,Tan:!0,Cot:!0,Sec:!0,Csc:!0,Sinh:!0,Cosh:!0,Tanh:!0,Coth:!0,Sech:!0,Csch:!0,Arcsin:!0,Arccos:!0,Arctan:!0,Arccot:!0,Arcsec:!0,Arccsc:!0,Arcsinh:!0,Arccosh:!0,Arctanh:!0,Arccoth:!0,Arccsch:!0,Arcsech:!0};function fh(e){return!e||typeof e!="string"?!1:e in ch}function ps(e,t){let i=Re(e),r=Re(t);if(i!==r)return r-i;let n=ft(e),s=ft(t);if(n!==s)return s-n;let a=Yo(e),o=Yo(t);if(a||o){if(!a)return 1;if(!o||a<o)return-1;if(a>o)return 1}return we(e,t)}var Xo=["integer","rational","radical","real","complex","constant","symbol","multiply","divide","add","trig","fn","power","string","other"];function el(e){if(typeof e.numericValue=="number")return Number.isInteger(e.numericValue)?"integer":"real";if(e.numericValue){let t=e.numericValue.type;return t==="integer"||t==="finite_integer"?"integer":t==="rational"||t==="finite_rational"?"rational":t==="real"||t==="finite_real"?"real":t==="complex"||t==="finite_complex"||t==="imaginary"||t==="finite_number"?"complex":t==="non_finite_number"?"constant":t==="number"?"real":"other"}return e.symbol==="ImaginaryUnit"?"complex":Ko(e)?"radical":e.symbol&&e.isConstant?"constant":e.symbol?"symbol":fh(e.operator)?"trig":e.operator==="Add"?"add":e.operator==="Power"||e.operator==="Root"?"power":e.operator==="Multiply"||e.operator==="Negate"?"multiply":e.operator==="Divide"?"divide":e.operator==="Rational"?"rational":e.operator==="Complex"?e.im!==0?"complex":"real":e.operator==="Sqrt"?e.op1.isNumberLiteral&&(e.op1.isInteger||e.op1.isRational)?"radical":"power":e.ops?"fn":e.string?"string":"other"}function we(e,t){var n,s;if(e===t)return 0;let i=el(e),r=el(t);if(i!==r)return Xo.indexOf(i)-Xo.indexOf(r);if(i==="complex"){let[a,o]=il(e),[l,u]=il(t);return o!==u?o-u:a-l}if(i==="integer"||i==="rational"||i==="real"){let a=e.numericValue,o=t.numericValue;a===null&&e.operator==="Rational"&&(a=e.op1.re/e.op2.re),o===null&&t.operator==="Rational"&&(o=t.op1.re/t.op2.re);let l=typeof a=="number"?a:a.re,u=typeof o=="number"?o:o.re;return l-u}if(i==="radical")return we(e.op1,t.op1);if(i==="constant"||i==="symbol")return e.symbol===t.symbol?0:e.symbol>t.symbol?1:-1;if(i==="add"){let a=e.ops,o=t.ops;if(a.length!==o.length)return o.length-a.length;for(let l=0;l<a.length;l++){let u=we(a[l],o[l]);if(u!==0)return u}return 0}if(i==="power"){let a=Re(e),o=Re(t);if(a!==o)return o-a;let l=ft(e),u=ft(t);return l!==u?l-u:we(e.op1,t.op1)}if(i==="multiply"){let a=Re(e),o=Re(t);if(a!==o)return o-a;let l=ft(e),u=ft(t);if(l!==u)return l-u;let c=e.ops,f=t.ops;if(c.length!==f.length)return f.length-c.length;for(let p=0;p<c.length;p++){let h=we(c[p],f[p]);if(h!==0)return h}return 0}if(i==="divide"){let a=Re(e.op1),o=Re(t.op1);if(a!==o)return o-a;let l=ft(e.op1),u=ft(t.op1);if(l!==u)return l-u;let c=we(e.op1,t.op1);return c!==0?c:we(e.op2,t.op2)}if(i==="fn"||i==="trig"){if(e.operator==t.operator&&e.nops===1&&t.nops===1)return we(e.op1,t.op1);let a=((n=e.operatorDefinition)==null?void 0:n.complexity)??_i,o=((s=t.operatorDefinition)==null?void 0:s.complexity)??_i;return a===o?e.operator===t.operator?ms(e)-ms(t):e.operator<t.operator?1:-1:a-o}return i==="string"?e.string===t.string?0:t.string<e.string?-1:1:(e.complexity??_i)-(t.complexity??_i)}function tl(e,{recursive:t=!1}){if(e.isCanonical||!e.ops)return e;let i=e.ops;return t&&(i=i.map(r=>tl(r,{recursive:t}))),i=hs(e.operator,i),e.engine._fn(e.operator,i,{canonical:!1})}function hs(e,t){if(t.length===0)return t;let i=t[0].engine;if(e==="Add")return[...t].sort(ps);if(e==="Multiply")return[...t].sort(we);let r=i.lookupDefinition(e);return!r||!le(r)||!r.operator.commutative?t:r.operator.commutativeOrder?[...t].sort(r.operator.commutativeOrder):[...t].sort(we)}function ms(e){return e.ops?1+[...e.ops].reduce((t,i)=>t+ms(i),0):1}function il(e){if(e.symbol==="ImaginaryUnit")return[0,1];if(e.numericValue){if(typeof e.numericValue=="number")return[e.numericValue,0];let t=e.numericValue;return[t.re,t.im]}if(e.operator==="Complex"){let t=e.op1.numericValue;if(t===null)return[0,0];let i=typeof t=="number"?t:t.re,r=e.op2.numericValue;if(r===null)return[0,0];let n=typeof r=="number"?r:r.re;return[i,n]}return[0,0]}var ph=new Set(["engine","name","description","examples","wikidata","url","lazy","scoped","broadcastable","associative","commutative","commutativeOrder","idempotent","involution","pure","inferredSignature","signature","type","sgn","even","complexity","canonical","evaluate","evaluateAsync","evalDimension","compile","eq","neq","cmp","collection"]),gs=class{constructor(e,t,i){m(this,"engine");m(this,"name");m(this,"description");m(this,"url");m(this,"wikidata");m(this,"broadcastable",!1);m(this,"associative",!1);m(this,"commutative",!1);m(this,"commutativeOrder");m(this,"idempotent",!1);m(this,"involution",!1);m(this,"pure",!0);m(this,"complexity",_i);m(this,"lazy",!1);m(this,"scoped",!1);m(this,"signature");m(this,"inferredSignature",!0);m(this,"type");m(this,"sgn");m(this,"eq");m(this,"neq");m(this,"even");m(this,"canonical");m(this,"evaluate");m(this,"evaluateAsync");m(this,"evalDimension");m(this,"compile");m(this,"collection");this.name=t,this.engine=e,i.signature?(this.inferredSignature=!1,this.signature=i.signature instanceof $?i.signature:new $(i.signature,e._typeResolver)):this.signature=new $("(any*) -> unknown"),this.update(i),e.listenToConfigurationChange(this)}toJSON(){let e={name:this.name};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),e.broadcastable=this.broadcastable,e.associative=this.associative,e.commutative=this.commutative,e.idempotent=this.idempotent,e.involution=this.involution,e.pure=this.pure,e.lazy=this.lazy,e.complexity=this.complexity,e.scoped=this.scoped,e.signature=this.signature.toString(),e.inferredSignature=this.inferredSignature,this.collection&&(e.collection=this.collection),e}infer(e){let t=new $(e,this.engine._typeResolver);if(!t.matches(this.signature))throw new Error(`Operator Definition "${this.name}": inferred signature "${t}" does not match current signature "${this.signature}"`);this.inferredSignature&&(this.signature=t)}update(e){if(this.engine.strict){for(let n in e)if(!ph.has(n))throw new Error(`Operator Definition "${this.name}": unexpected key "${n}"`)}if("name"in e&&e.name!==this.name)throw new Error(`Operator Definition "${this.name}": cannot change name to "${e.name}"`);if("engine"in e&&e.engine!==this.engine)throw new Error(`Operator Definition "${this.name}": cannot change engine`);this.lazy=e.lazy??this.lazy,this.scoped=e.scoped??this.scoped;let t=e.idempotent??this.idempotent,i=e.involution??this.involution;if(t&&i)throw new Error(`Operator Definition "${this.name}": the 'idempotent' and 'involution' flags are mutually exclusive`);if(this.idempotent=t,this.involution=i,this.description=e.description??this.description,this.collection=e.collection??this.collection,this.url=e.url??this.url,this.wikidata=e.wikidata??this.wikidata,this.broadcastable=e.broadcastable??this.broadcastable,this.associative=e.associative??this.associative,this.commutative=e.commutative??this.commutative,this.commutativeOrder=e.commutativeOrder??this.commutativeOrder,this.commutativeOrder&&!this.commutative)throw new Error(`Operator Definition "${this.name}": the 'commutativeOrder' handler requires the 'commutative' flag`);if(e.canonical&&(e.associative||e.commutative||e.idempotent||e.involution))throw new Error(`Operator Definition "${this.name}": the 'canonical' handler is incompatible with the 'associative', 'commutative', 'idempotent', and 'involution' flags`);if(this.pure=e.pure??this.pure,this.complexity=e.complexity??this.complexity,e.signature){let n=e.signature,s=e.signature instanceof $?e.signature:this.engine.type(e.signature);if(n&&!s.matches(this.engine.type(n)))throw s.matches(this.engine.type(n)),new Error(`Operator Definition "${this.name}": signature "${s}" does not match "${n}"`);this.signature=s,"inferredSignature"in e&&(this.inferredSignature=e.inferredSignature)}if(this.type=e.type??this.type,this.evaluateAsync=e.evaluateAsync??this.evaluateAsync,this.canonical=e.canonical??this.canonical,this.evalDimension=e.evalDimension??this.evalDimension,this.sgn=e.sgn??this.sgn,this.even=e.even??this.even,this.compile=e.xcompile??this.compile,this.eq=e.eq??this.eq,this.neq=e.neq??this.neq,this.scoped=e.scoped??this.scoped,this.lazy=e.lazy??this.lazy,e.collection&&(this.collection=Ro(e.collection)),this.collection){let n=Ot(this.signature.type);if(!n)throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" does not have a result type`);if(!_(n,"collection"))throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" is not a collection type`);if(_(n,"indexed_collection")&&!this.collection.at)throw new Error(`Operator Definition "${this.name}" returns an indexed collection, but the 'at' handler is missing`)}let r;if(e.evaluate&&typeof e.evaluate!="function"){let n=this.scoped?{parent:this.engine.context.lexicalScope,bindings:new Map}:void 0,s=this.engine.box(e.evaluate,{canonical:!1,scope:n});if(!s.isValid)throw Error(`Invalid function ${s.toString()}`);let a=ne(s);r=o=>a(o),Object.defineProperty(r,"toString",{value:()=>s.toString()})}else r=e.evaluate??this.evaluate;this.evaluate=r}onConfigurationChange(){}};function ii(e){if(e.operator==="Interval"){let t=e.op1,i=e.op2,r=!1,n=!1;t.operator==="Open"?(r=!0,t=t.op1):t.operator==="Closed"&&(t=t.op1),i.operator==="Open"?(n=!0,i=i.op1):i.operator==="Closed"&&(i=i.op1);let s=t.N(),a=i.N();return!s.isNumberLiteral||!a.isNumberLiteral?void 0:{start:s.re,openStart:r,end:a.re,openEnd:n}}if(e.symbol==="EmptySet")return{start:0,openStart:!0,end:0,openEnd:!0};if(e.symbol==="RealNumbers")return{start:-1/0,openStart:!1,end:1/0,openEnd:!1};if(e.symbol==="NegativeNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!0};if(e.symbol==="NonPositiveNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!1};if(e.symbol==="PositiveNumbers")return{start:0,openStart:!0,end:1/0,openEnd:!1};if(e.symbol==="NonNegativeNumbers")return{start:0,openStart:!1,end:1/0,openEnd:!1}}var Bt=class extends Error{constructor({message:t,value:i,cause:r}={}){super(t??"Operation canceled");m(this,"cause");m(this,"value");i&&(this.value=i),this.cause=r,this.name="CancellationError"}};async function Qr(e,t,i){let r=performance.now();for(;;){let n=performance.now(),s=16;for(;performance.now()-n<s;){let{done:a,value:o}=e.next();if(a)return o;if(i!=null&&i.aborted)throw new Bt({value:o,cause:i.reason});if(performance.now()-r>=t)throw new Bt({value:o,cause:"timeout",message:`Timeout exceeded (${t}ms)`})}await new Promise(a=>setTimeout(a,0))}}function Yr(e,t){let i=Date.now();for(;;){let{done:r,value:n}=e.next();if(r)return n;if(Date.now()-i>=t)throw new Bt({value:n,cause:"timeout",message:`Timeout exceeded (${t}ms)`})}}function Et(e,t,i){return t.every(r=>r.isCanonical)?t:t.map(r=>e.box(r,{scope:i}))}var Xi=50,hh={List:{complexity:8200,signature:"(any*) -> list",type:(e,{engine:t})=>R(`list<${$.widen(...e.map(i=>i.type))}>`),canonical:gh,lazy:!0,evaluate:(e,{engine:t,materialization:i})=>{if(i)return t._fn("List",ds(e).map(r=>r.evaluate({materialization:i})))},eq:nl,collection:as()},Set:{complexity:8200,signature:"(any*) -> set",type:(e,{engine:t})=>R(`set<${$.widen(...e.map(i=>i.type))}>`),canonical:dh,eq:(e,t)=>{if(e.operator!==t.operator||e.nops!==t.nops)return!1;let i=r=>t.ops.some(n=>r.isSame(n));return e.ops.every(i)},collection:{...as(),at:void 0,indexWhere:void 0}},Tuple:{description:"A fixed number of heterogeneous elements",complexity:8200,signature:"(any*) -> tuple",type:e=>R(`tuple<${e.map(t=>t.type).join(", ")}>`),canonical:(e,{engine:t})=>t.tuple(...e),eq:nl,collection:{...as(),keys:e=>["first","second","last"]}},KeyValuePair:{description:"A key/value pair",complexity:8200,signature:"(key: string, value: any) -> tuple<string, unknown>",type:([e,t])=>R(`tuple<string, ${t.type}>`),canonical:(e,{engine:t})=>{let[i,r]=Bs(t,e,["string","any"]);return!i.isValid||!r.isValid?t._fn("KeyValuePair",[i,r]):t.tuple(i,r)}},Single:{description:"A tuple with a single element",complexity:8200,signature:"(value: any) -> tuple<any>",type:([e])=>R(`tuple<${e.type}>`),canonical:(e,{engine:t})=>t.tuple(...At(t,e,1))},Pair:{description:"A tuple of two elements",complexity:8200,signature:"(first: any, second: any) -> tuple<any, any>",type:([e,t])=>R(`tuple<${e.type}, ${t.type}>`),canonical:(e,{engine:t})=>t.tuple(...At(t,e,2))},Triple:{description:"A tuple of three elements",complexity:8200,signature:"(first: any, second: any, third: any) -> tuple<any, any, any>",type:([e,t,i])=>R(`tuple<${e.type}, ${t.type}, ${i.type}>`),canonical:(e,{engine:t})=>t.tuple(...At(t,e,3))},Range:{complexity:8200,signature:"(number, number?, step: number?) -> indexed_collection<integer>",canonical:(e,{engine:t})=>e.length===0?null:e.length===1?t._fn("Range",[t.One,e[0].canonical]):e.length===2?t._fn("Range",[e[0].canonical,e[1].canonical]):t._fn("Range",[e[0].canonical,e[1].canonical,e[2].canonical.evaluate()]),eq:(e,t)=>{if(e.operator!==t.operator)return!1;let[i,r,n]=Xe(e),[s,a,o]=Xe(t);return i===s&&r===a&&n===o},collection:{isLazy:e=>!0,count:e=>{let[t,i,r]=Xe(e);return r===0?0:!isFinite(t)||!isFinite(i)?1/0:1+Math.max(0,Math.floor((i-t)/r))},contains:(e,t)=>{if(!t.type.matches("integer"))return!1;let i=t.re,[r,n,s]=Xe(e);return s===0?!1:s>0?i>=r&&i<=n:i<=r&&i>=n},iterator:e=>{let[t,i,r]=Xe(e),n=r===0?0:Math.floor((i-t)/r)+1,s=1;return{next:()=>s===n+1?{value:void 0,done:!0}:(s+=1,{value:e.engine.number(t+r*(s-1-1)),done:!1})}},at:(e,t)=>{if(typeof t!="number")return;let[i,r,n]=Xe(e);if(!(t<1||t>1+(r-i)/n))return e.engine.number(i+n*(t-1))},indexWhere:void 0,subsetOf:(e,t)=>{var r;if(t.operator==="Range"){let[n,s,a]=Xe(e),[o,l,u]=Xe(t);return n>=o&&s<=l&&a%u===0}if(!t.isCollection)return!1;let i=1;for(let n of t.each()){if(!e.xcontains(n)||!((r=e.at(i))!=null&&r.isSame(n)))return!1;i++}return!0},eltsgn:e=>{let[t,i,r]=Xe(e);return r===0?"zero":r>0?t<=i?"positive":"negative":t>=i?"positive":"negative"},elttype:e=>"finite_integer"}},Interval:{description:"A set of real numbers between two endpoints. The endpoints may or may not be included.",complexity:8200,lazy:!0,signature:"(number, number) -> set<real>",canonical:([e,t],{engine:i})=>{if(!e||!t)return null;let[r,n]=Bs(i,[e.canonical,t.canonical],["number","number"]);return!r.isValid||!n.isValid?null:i._fn("Interval",[r,n])},eq:(e,t)=>{let i=ii(e),r=ii(t);return!i||!r?!1:i.start===r.start&&i.end===r.end&&i.openStart===r.openStart&&i.openEnd===r.openEnd},collection:{count:e=>1/0,iterator:e=>{let t=ii(e);if(!t)return{next:()=>({value:void 0,done:!0})};if(t.start>=t.end)return{next:()=>({value:void 0,done:!0})};let i=e.engine,r=0,n=0;return{next:()=>{let s=Math.pow(2,r);n>=s&&(r++,n=0);let a=(2*n+1)/Math.pow(2,r+1),o=t.start+a*(t.end-t.start);return n++,{value:i.number(o),done:!1}}}},isEmpty:e=>{let t=ii(e);return t?t.openStart&&t.start===t.end||t.openEnd&&t.start===t.end?!0:t.openStart&&t.openEnd?!1:t.start>=t.end:!1},isFinite:e=>!1,contains:(e,t)=>{let i=ii(e);return!i||i.openStart&&t.isLessEqual(i.start)||i.openEnd&&t.isGreaterEqual(i.end)?!1:t.isGreaterEqual(i.start)&&t.isLessEqual(i.end)},eltsgn:e=>{let t=ii(e);if(!t||t.start===t.end)return"unsigned";if(t.start>=0&&!t.openStart)return"non-negative";if(t.end<=0&&!t.openEnd)return"non-positive";if(t.start>0&&t.end>0)return"positive";if(t.start<0&&t.end<0)return"negative"},elttype:e=>{let t=ii(e);return t?isFinite(t.start)&&isFinite(t.end)?"finite_real":"real":"never"}}},Linspace:{complexity:8200,signature:"(start: number, end: number?, count: number?) -> indexed_collection",collection:{isLazy:e=>!0,count:e=>{let t=e.op3.re;return isFinite(t)||(t=Xi),Math.max(0,Math.floor(t))},at:(e,t)=>{if(typeof t!="number")return;let i=e.op1.re,r=e.op2.re,n=e.op3.re;if(isFinite(n)||(n=Xi),!(!isFinite(i)||!isFinite(r))&&!(t<1||t>n))return e.engine.number(i+(r-i)*(t-1)/n)},iterator:e=>{let t=e.op1.re,i=e.op2.re,r;isFinite(i)?r=Math.max(0,isFinite(e.op3.re)?e.op3.re:Xi):(i=t,t=1,r=Xi);let n=1;return{next:()=>n===r+1?{value:void 0,done:!0}:(n+=1,{value:e.engine.number(t+(i-t)*(n-1-1)/r),done:!1})}},contains:(e,t)=>{if(!t.type.matches("finite_real"))return!1;let i=t.re,r=e.op1.re,n=e.op2.re;if(i<r||i>n)return!1;let s=e.op3.re;if(isFinite(s)||(s=Xi),s===0)return!1;let a=(n-r)/s;return(i-r)%a===0}}},Contains:{description:"Return True if the collection contains the given value, False otherwise.",complexity:8200,signature:"(collection, any) -> boolean",evaluate:([e,t],{engine:i})=>e.xcontains(t)?i.True:i.False},Length:{complexity:8200,signature:"(collection) -> integer",evaluate:([e],{engine:t})=>e.isEmptyCollection?t.Zero:t.number(e.xsize),sgn:([e])=>e.isEmptyCollection?"zero":"positive"},IsEmpty:{complexity:8200,signature:"(collection) -> boolean",evaluate:([e],{engine:t})=>e.isEmptyCollection?t.True:t.False},Map:{description:["Return the collection where each element has been transformed by the mapping function.","Equivalent to `[f(x) for x in xs]`."],complexity:8200,lazy:!0,signature:"(collection, function) -> collection",type:e=>e[0].type,canonical:(e,{engine:t})=>{var n;let i=ke(t,(n=e[0])==null?void 0:n.canonical,"collection"),r=Me(e[1]);return!i.isValid||!r?null:t._fn("Map",[i,r])},collection:{isLazy:e=>!0,count:e=>e.op1.xsize,isEmpty:e=>e.op1.isEmptyCollection,isFinite:e=>e.op1.isFiniteCollection,iterator:e=>{let t=ne(e.op2);if(!t)return{next:()=>({value:void 0,done:!0})};let i=e.op1.each();return{next:()=>{for(;;){let{value:r,done:n}=i.next();return n?{value:void 0,done:!0}:{value:t([r])??e.engine.Nothing,done:!1}}}}},at:(e,t)=>{var r;if(!e.isIndexedCollection||typeof t!="number"||!Number.isFinite(t)||t===0)return;let i=e.op1.at(t);if(i)return(r=ne(e.op2))==null?void 0:r([i])}}},Filter:{description:["Return the elements of the collection for which the predicate function returns True.","Equivalent to `[x for x in xs if p(x)]`."],complexity:8200,lazy:!0,signature:"(collection, predicate: function) -> collection",type:e=>e[0].type,canonical:(e,{engine:t})=>{var n;let i=ke(t,(n=e[0])==null?void 0:n.canonical,"collection"),r=Me(e[1]);return!i.isValid||!r?null:t._fn("Filter",[i,r])},collection:{isLazy:e=>!0,count:e=>1/0,contains:(e,t)=>{var i;return e.xcontains(t)?((i=ne(e.op2)([t]))==null?void 0:i.symbol)==="True":!1},iterator:e=>{let t=ne(e.op2);if(!t)return{next:()=>({value:void 0,done:!0})};let i=e.op1.each(),r=0,n=e.engine.iterationLimit;return{next:()=>{for(;;){let{value:s,done:a}=i.next();if(r+=1,r>n)throw new Bt({cause:"iteration-limit-exceeded",message:`Iteration limit of ${n} exceeded while evaluating Filter()`});if(a)return{value:void 0,done:!0};let o=t([s]);if(!o)throw new Error(`Invalid filter predicate. ${mt(e.op2)}`);if(o.symbol==="True")return{value:s,done:!1};if(o.symbol!=="False")throw new Error(`Filter predicate must return "True" or "False". ${mt(e.op2)}`)}}}},at:(e,t)=>{var n;if(typeof t!="number"||!Number.isFinite(t)||t===0)return;let i=ne(e.op2);if(!i)return;if(t<0){if(!e.op1.isFiniteCollection)return;let s=Array.from(e.each()),a=s.length+t+1;return a<1||a>s.length?void 0:s[a-1]}let r=0;for(let s of e.op1.each()){let a=(n=i([s]))==null?void 0:n.symbol;if(a==="True"){if(r+=1,r===t)return s}else if(a!=="False")throw new Error(`Filter predicate must return "True" or "False". ${mt(e.op2)}`)}}}},Reduce:{complexity:8200,lazy:!0,signature:"(collection, function, initial:value?) -> value",canonical:(e,{engine:t})=>{var s;let i=ke(t,e[0],"collection"),r=Me(e[1]);if(!i.isValid||!r)return null;let n=(s=e[2])==null?void 0:s.canonical;return n!=null&&n.isValid?t._fn("Reduce",[i,r,n]):t._fn("Reduce",[i,r])},type:e=>R(Ot(e[1].type.type)??"unknown"),evaluate:([e,t,i],{engine:r})=>{if(!e.isFiniteCollection)return;if(i??(i=r.Nothing),i.type.matches("real")&&e.type.matches(r.type("collection<real>"))){let o=t.compile();if(!o)return;let l=i.re,u=!0;for(let c of e.each())u?l=c.re:l=o(l,c.re),u=!1;return r.box(l)}let n=ne(t),s=i,a=!0;for(let o of e.each())a?s=o:s=n([s,o])??r.Nothing,a=!1;return s}},Join:{description:["Join the elements of some collections into a flat collection."],complexity:8200,signature:"(collection*) -> collection",type:bh,collection:{isLazy:e=>!0,count:e=>{let t=0;for(let i of e.ops){let r=i.xsize;if(r===void 0)return;if(!Number.isFinite(r))return 1/0;t+=r}return t},contains:(e,t)=>e.ops.some(i=>i.xcontains(t)),iterator:e=>{let t=e.ops.map(r=>r.each()),i=0;return{next:()=>{for(;;){let{value:r,done:n}=t[i].next();if(!n)return{value:r,done:!1};if(i+=1,i>=t.length)return{value:void 0,done:!0}}}}}}},At:{description:["Access an element of an indexed collection.","If the index is negative, it is counted from the end."],complexity:8200,signature:"(value: list|tuple|string, index: number | string) -> unknown",type:([e])=>{var t,i,r;return((r=(i=(t=e.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.elttype)==null?void 0:r.call(i,e))??"any"},evaluate:(e,{engine:t})=>{var n,s;let i=e[0],r=1;for(;e[r];){let a=(s=(n=i.baseDefinition)==null?void 0:n.collection)==null?void 0:s.at;if(!a)return;let o=e[r].string;if(o!==null)i=a(i,o)??t.Nothing;else{let l=e[r].re;if(!Number.isInteger(l))return;i=a(i,l)??t.Nothing}r+=1}return i}},Take:{description:["Return `n` elements from a collection."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([e])=>`list<${bt(e.type.type)}>`,evaluate:(e,{engine:t,materialization:i})=>{if(!i)return;let r=t._fn("Take",e),n=Array.from(r.each());return t._fn("List",n)},collection:{isLazy:e=>!0,count:ol,isEmpty:e=>{let[t,i]=e.ops;if(t.isEmptyCollection)return!0;if(t.isFiniteCollection===!1)return!1;let r=Math.max(0,L(i)??0),n=t.xsize;if(n!==void 0)return Number.isFinite(r)?Math.min(n,r)===0:!1},isFinite:e=>e.op1.isFiniteCollection,iterator:vh,at:(e,t)=>{if(typeof t!="number"||t===0)return;let i=Math.max(0,L(e.op2)??0);if(i===0)return;if(t>0)return t>i?void 0:e.op1.at(t);let r=ol(e);if(!(r===void 0||r===0)&&!(t<-r))return e.op1.at(r+t)}}},Drop:{description:["Return the collection without the first n elements."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([e])=>`list<${bt(e.type.type)}>`,collection:{isLazy:e=>!0,count:e=>{let[t,i]=e.ops,r=t.xsize;if(r===void 0)return;if(!Number.isFinite(r))return 1/0;if(t.isEmptyCollection)return 0;let n=L(i)??0;return n>=r?0:Math.max(0,r-n)},isFinite:e=>e.op1.isFiniteCollection,iterator:e=>{let[t,i]=e.ops,r=L(i)??0;if(r<=0)return t.each();let n=r+1;return{next:()=>{let s=e.op1.at(n++);return s===void 0?{value:void 0,done:!0}:{value:s,done:!1}}}},at:(e,t)=>{if(typeof t!="number")return;let[i,r]=e.ops,n=L(r)??0;if(!(n<=0))return i.at(t+n)}}},First:{complexity:8200,signature:"(collection) -> any",type:([e])=>{var t,i,r;return((r=(i=(t=e.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.elttype)==null?void 0:r.call(i,e))??"any"},evaluate:([e],{engine:t})=>e.at(1)??t.Nothing},Second:{complexity:8200,signature:"(collection) -> any",type:([e])=>{var t,i,r;return((r=(i=(t=e.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.elttype)==null?void 0:r.call(i,e))??"any"},evaluate:([e],{engine:t})=>e.at(2)??t.Nothing},Last:{complexity:8200,signature:"(collection) -> any",type:([e])=>{var t,i,r;return((r=(i=(t=e.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.elttype)==null?void 0:r.call(i,e))??"any"},evaluate:([e],{engine:t})=>e.at(-1)??t.Nothing},Rest:{description:["Return the collection without the first element.","If the collection has only one element, return an empty collection."],complexity:8200,signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:e=>!0,count:e=>{let t=e.op1.xsize;if(t!==void 0)return Math.max(0,t-1)},isEmpty:e=>{if(e.op1.isEmptyCollection)return!0;let t=e.op1.xsize;if(t!==void 0)return t<=1},isFinite:e=>e.op1.isFiniteCollection,iterator:e=>({next:()=>{let t=1,i=e.op1.at(t>0?t+1:t);return i?(t+=1,{value:i,done:!1}):{value:void 0,done:!0}}}),at:(e,t)=>{if(typeof t=="number")return e.op1.at(t>0?t+1:t)}}},Most:{complexity:8200,description:["Return the collection without the last element.","If the collection has only one element, return an empty collection."],signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:e=>!0,count:e=>{let t=e.op1.xsize;if(t!==void 0)return Math.max(0,t-1)},isFinite:e=>e.op1.isFiniteCollection,isEmpty:e=>{let t=e.op1.xsize;if(t!==void 0)return t<=1},iterator:e=>{let t=e.op1.xsize;if(t===void 0||t<=1)return{next:()=>({value:void 0,done:!0})};let i=1,r=t-1;return{next:()=>i>r?{value:void 0,done:!0}:{value:e.op1.at(i++),done:!1}}},at:(e,t)=>{if(typeof t!="number")return;let i=e.op1.xsize;if(i!==void 0&&(t<1&&(t=i+1+t),!(t<1||t>i-1)))return e.op1.at(t)}}},Slice:{description:["Return a range of elements from an indexed collection.","If the index is negative, it is counted from the end."],complexity:8200,signature:"(value: indexed_collection, start: number, end: number) -> list",type:([e])=>R(`list<${bt(e.type.type)}>`),collection:{isLazy:e=>!0,count:e=>{let t=L(e.op2)??1,i=e.op1.xsize;if(i===void 0)return;let r=L(e.op3)??i;return t<1?Math.max(0,r+t-1):Math.max(0,Math.min(r,i)-t+1)},isFinite:e=>!0,at:(e,t)=>{if(typeof t!="number")return;let i=e.op1.xsize;if(i===void 0)return;let r=L(e.op2)??1;r<1&&(r=i+1+r),r<1&&(r=1),!(r>i)&&L(e.op3)},iterator:e=>{let t=L(e.op2)??1,i=e.op1.xsize;if(i===void 0)return{next:()=>({value:void 0,done:!0})};if(t<1&&(t=i+1+t),t<1&&(t=1),t>i)return{next:()=>({value:void 0,done:!0})};let r=L(e.op3)??i;r<1&&(r=i+1+r),r<1&&(r=1),r>i&&(r=i);let n=t,s=r;return{next:()=>{if(n>s)return{value:void 0,done:!0};let a=e.op1.at(n);return n+=1,{value:a,done:!1}}}}}},Reverse:{complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:([e])=>e.type,collection:{isLazy:e=>!0,count:e=>e.op1.xsize,isEmpty:e=>e.op1.isEmptyCollection,isFinite:e=>e.op1.isFiniteCollection,contains:(e,t)=>e.op1.xcontains(t)??!1,iterator:e=>{let t=-1;return{next:()=>{if(t===0)return{value:void 0,done:!0};let i=e.op1.at(t);return t-=1,{value:i,done:!1}}}},at:(e,t)=>{if(typeof t=="number")return e.op1.at(-t)}}},RotateLeft:{description:"Rotate the elements of the collection to the left by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:e=>!0,count:e=>e.op1.xsize,isEmpty:e=>e.op1.isEmptyCollection,isFinite:e=>e.op1.isFiniteCollection,contains:(e,t)=>e.op1.xcontains(t)??!1,iterator:e=>{let t=e.op1.xsize;if(t===void 0||t<=0)return{next:()=>({value:void 0,done:!0})};let i=L(e.op2)??1;i=(i%t+t)%t;let r=1,n=t;return{next:()=>{if(r===n+1)return{value:void 0,done:!0};r+=1;let s=e.op1.at((r-1-1+i)%t+1);return s===void 0?{value:void 0,done:!0}:{value:s,done:!1}}}},at:(e,t)=>{if(typeof t!="number")return;let i=e.op1.xsize;if(i===void 0||i<=0||(t<1&&(t=i+1+t),t<1||t>i))return;let r=L(e.op2)??1;return r=(r%i+i)%i,e.op1.at((t-1+r)%i+1)}}},RotateRight:{description:"Rotate the elements of the collection to the right by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:e=>!0,count:e=>e.op1.xsize,contains:(e,t)=>e.op1.xcontains(t)??!1,iterator:e=>{let t=e.op1.xsize;if(t===void 0||t<=0)return{next:()=>({value:void 0,done:!0})};let i=L(e.op2)??1;i=(i%t+t)%t;let r=1;return{next:()=>{if(r===t+1)return{value:void 0,done:!0};r+=1;let n=(r-1-1+(t-i))%t+1,s=e.op1.at(n);return s===void 0?{value:void 0,done:!0}:{value:s,done:!1}}}},at:(e,t)=>{if(typeof t!="number")return;let i=e.op1.xsize;if(i===void 0||i<=0||(t<1&&(t=i+1+t),t<1||t>i))return;let r=L(e.op2)??1;r=(r%i+i)%i;let n=(t-1+(i-r))%i+1;return e.op1.at(n)}}},IndexOf:{description:"Return the 1-based index of the first occurrence of value in collection, or 0 if not found.",complexity:8200,signature:"(collection, any) -> integer",evaluate:([e,t],{engine:i})=>{let r=e.indexWhere(n=>n.isSame(t))??void 0;return i.number(r??0)}},IndexWhere:{description:"Return the 1-based index of the first element satisfying the predicate, or 0 if not found.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([e,t],{engine:i})=>{let r=ne(t);if(!r)return i.Zero;let n=e.indexWhere(s=>{var o;let a=(o=r([s]))==null?void 0:o.symbol;if(a==="True")return!0;if(a==="False")return!1;throw new Error(`Filter predicate must return "True" or "False". ${mt(t)}`)})??void 0;return i.number(n??0)}},Find:{description:"Return the first element of the collection satisfying the predicate, or Nothing if none found.",complexity:8200,signature:"(collection, function) -> any",type:e=>e[0].type,evaluate:([e,t],{engine:i})=>{var n;let r=ne(t);if(!r)return i.Nothing;for(let s of e.each()){let a=(n=r([s]))==null?void 0:n.symbol;if(a!=="False"){if(a==="True")return s;throw new Error(`Filter predicate must return "True" or "False". ${mt(t)}`)}}return i.Nothing}},CountIf:{description:"Return the number of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([e,t],{engine:i})=>{var s;let r=ne(t);if(!r)return i.Zero;let n=0;for(let a of e.each()){let o=(s=r([a]))==null?void 0:s.symbol;if(o!=="False")if(o==="True")n++;else throw new Error(`Filter predicate must return "True" or "False". ${mt(t)}`)}return i.number(n)}},Position:{description:"Return a list of indexes of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> list<integer>",type:()=>"list<integer>",evaluate:([e,t],{engine:i})=>{var a;let r=ne(t);if(!r)return i.function("List",[]);let n=[],s=1;for(let o of e.each()){let l=(a=r([o]))==null?void 0:a.symbol;if(l==="True"&&n.push(i.number(s)),l!=="False")throw new Error(`Filter predicate must return "True" or "False". ${mt(t)}`);s++}return i.function("List",n)}},Ordering:{description:"Return the indexes that would sort the collection.",complexity:8200,signature:"(indexed_collection, function?) -> list<integer>",evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return i.function("List",[]);let r=al(e,t);return r?i.function("List",r):i.function("List",[])}},Sort:{description:"Return the elements of the collection sorted according to the given comparison function.",complexity:8200,signature:"(indexed_collection, function?) -> indexed_collection",type:e=>e[0].type,evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return i.function(e.operator,[]);let r=al(e,t);if(r)return i.function(e.operator,r.map(n=>e.at(n)))}},Shuffle:{description:"Randomize the order of the elements in the collection.",complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:e=>e[0].type,evaluate:([e],{engine:t})=>{if(!e.isFiniteCollection)return;let i=Array.from(e.each());for(let r=i.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[i[r],i[n]]=[i[n],i[r]]}return t.function(e.operator,i)}},Tabulate:{description:"Create a collection by applying a function to each index in the specified dimensions.",complexity:8200,lazy:!0,signature:"(function, integer, integer?) -> collection",canonical:(e,{engine:t})=>{var r,n,s;let i=Me(e[0]);return i?e[2]?t._fn("Tabulate",[i,ke(t,(r=e[1])==null?void 0:r.canonical,"integer"),ke(t,(n=e[2])==null?void 0:n.canonical,"integer")]):t._fn("Tabulate",[i,ke(t,(s=e[1])==null?void 0:s.canonical,"integer")]):null},evaluate:(e,{engine:t})=>{let i=ne(e[0]);if(!i)return;if(e.length===1)return t._fn("List",[]);let r=e.slice(1).map(s=>L(s));if(r.some(s=>s===null||s<=0))return;if(r.length===1)return t._fn("List",Array.from({length:r[0]??0},(s,a)=>i([t.number(a+1)])??t.Nothing));let n=(s,a,o=0)=>{if(o===s.length){let u=a.map(c=>t.number(c));return i(u)}let l=["List"];for(let u=1;u<=s[o];u++)a[o]=u,l.push(n(s,a,o+1));return l};return t.box(n(r,Array(r.length).fill(0)))}},Tally:{description:"Return a tuple with the unique elements of the collection and their respective counts.",complexity:8200,signature:"(collection) -> tuple<list, list<integer>>",type:([e],{engine:t})=>{let i=e.type.type;return R(i==="string"?"tuple<list<string>, list<integer>>":`tuple<list<${bt(i)}>, list<integer>>`)},evaluate:(e,{engine:t})=>{if(!e[0].isFiniteCollection)return;let[i,r]=rl(e[0]);return t.tuple(t.function("List",i),t.function("List",r))}},Unique:{description:"Return a list of the unique elements of the collection.",complexity:8200,signature:"(collection) -> list",type:([e])=>`list<${bt(e.type.type)}>`,evaluate:(e,{engine:t})=>{if(!e[0].isFiniteCollection)return;let[i]=rl(e[0]);return t.function("List",i)}},Partition:{wikidata:"Q381060",complexity:8200,signature:"(collection, integer | function) -> list",type:([e])=>`list<${bt(e.type.type)}>`,evaluate:([e,t],{engine:i})=>{var o;if(!e.isFiniteCollection)return;let r=L(t);if(r!==null&&r>0){let l=Array.from(e.each()),u=[],c=Math.ceil(l.length/r);for(let f=0;f<r;f++){let p=l.slice(f*c,(f+1)*c);u.push(i.function("List",p))}return i.function("List",u)}let n=ne(t);if(!n)return;let s=[],a=[];for(let l of e.each()){let u=(o=n([l]))==null?void 0:o.symbol;if(u==="True")s.push(l);else if(u==="False")a.push(l);else throw new Error(`Partition predicate must return "True" or "False". ${mt(t)}`)}return i.function("List",[i.function("List",s),i.function("List",a)])}},Chunk:{description:"Split the collection into `k` nearly equal-sized chunks.",complexity:8200,signature:"(collection, integer) -> list<list>",evaluate:([e,t],{engine:i})=>{let r=L(t);if(!e.isFiniteCollection||r===null||r<=0)return;let n=Array.from(e.each()),s=[],a=Math.ceil(n.length/r);for(let o=0;o<r;o++){let l=n.slice(o*a,(o+1)*a);s.push(i.function("List",l))}return i.function("List",s)}},GroupBy:{description:["Partition the collection into a dictionary of lists based on the key returned by the function."],complexity:8200,signature:"(collection, function) -> dictionary<list>",evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=ne(t);if(!r)return;let n={};for(let s of e.each()){let a=r([s])??i.Nothing,o=a.symbol??a.string??a.toString();o in n||(n[o]=[]),n[o].push(s)}return i.function("Dictionary",Object.entries(n).map(([s,a])=>i._fn("Tuple",[i.string(s),i.function("List",a)])))}},Zip:{description:"Combine multiple collections element-wise into a list of tuples. The result has the length of the shortest input.",complexity:8200,signature:"(indexed_collection+) -> list",collection:{isLazy:e=>!0,count:ys,isFinite:e=>e.ops.every(t=>t.isFiniteCollection),isEmpty:e=>e.nops===0||e.ops.every(t=>t.isEmptyCollection),iterator:e=>{let t=ys(e);if(t===void 0||t<=0)return{next:()=>({value:void 0,done:!0})};let i=1;return{next:()=>{if(i===t+1)return{value:void 0,done:!0};i+=1;let r=e.ops.map(n=>n.at(i-1));return r.some(n=>n===void 0)?{value:void 0,done:!0}:{value:e.engine.tuple(...r),done:!1}}}},at:(e,t)=>{if(typeof t!="number"||t<1)return;let i=ys(e);if(i===void 0||t<1||t>i)return;let r=e.ops.map(n=>n.at(t));if(!r.some(n=>n===void 0))return e.engine.tuple(...r)}}},Iterate:{description:"Produce an infinite sequence by repeatedly applying a function to the previous value, starting with an initial value.",complexity:8200,signature:"((index: integer, acc:any) -> any, initial: any?) -> list",canonical:([e,t],{engine:i})=>{let r=Me(e);if(!r)return null;let n=t==null?void 0:t.canonical;return n?i._fn("Iterate",[r,n]):i._fn("Iterate",[r])},collection:{isLazy:e=>!0,count:()=>1/0,iterator:e=>{let t=ne(e.op1);if(!t)return{next:()=>({value:void 0,done:!0})};let i=e.op2??e.engine.Nothing,r=0;return{next:()=>(r+=1,i=t([e.engine.number(r),i])??e.engine.Nothing,{value:i,done:!1})}},at:(e,t)=>{if(typeof t!="number"||t<1)return;let i=ne(e.op1);if(!i)return;let r=e.op2??e.engine.Nothing;for(let n=1;n<t;n++)r=i([e.engine.number(n),r])??e.engine.Nothing;return r}}},Repeat:{description:"Produce an infinite sequence by repeating a single value.",complexity:8200,signature:"(value: any) -> list",collection:{isLazy:e=>!0,count:()=>1/0,isEmpty:e=>!1,isFinite:()=>!1,contains:(e,t)=>e.op1.isSame(t),iterator:e=>({next:()=>({value:e.op1,done:!1})}),at:(e,t)=>e.op1}},Cycle:{description:"Produce an infinite sequence by cycling through the elements of a finite collection.",complexity:8200,signature:"(list) -> list",collection:{isLazy:e=>!0,count:()=>1/0,isEmpty:e=>e.isEmptyCollection,isFinite:e=>!e.isEmptyCollection,contains:(e,t)=>e.op1.xcontains(t)??!1,iterator:e=>{let t=1,i=e.op1.xsize;return i===void 0||i===0?{next:()=>({value:void 0,done:!0})}:{next:()=>{let r=(t-1-1)%i+1,n=e.op1.at(r);return n===void 0?{value:void 0,done:!0}:(t+=1,{value:n,done:!1})}}},at:(e,t)=>{if(typeof t!="number"||t<1)return;let i=e.op1.xsize;if(i===void 0||i===0)return;let r=(t-1)%i+1;return e.op1.at(r)}}},Fill:{description:"Produce a 2D list (matrix) by applying a function to each pair of row and column indexes.",complexity:8200,signature:"(function, tuple) -> list",collection:{isLazy:e=>!0,count:e=>e.op2.ops.map(t=>L(t)??0)[0]??0,iterator:e=>{let t=ne(e.op1);if(!t)return{next:()=>({value:void 0,done:!0})};let i=e.op2.ops.map(o=>L(o)??0),r=i[0]??0,n=i[1]??0,s=r,a=1;return{next:()=>{if(a===s+1)return{value:void 0,done:!0};a+=1;let o=[];for(let l=1;l<=n;l++)o.push(t([e.engine.number(a-1),e.engine.number(l)])??e.engine.Nothing);return{value:e.engine.function("List",o),done:!1}}}},at:(e,t)=>{if(typeof t!="number"||t<1)return;let i=ne(e.op1);if(!i)return;let r=e.op2.ops.map(l=>L(l)??0),n=r[0]??0,s=r[1]??0;if(t>n*s)return;let a=Math.ceil(t/s),o=(t-1)%s+1;return i([e.engine.number(a),e.engine.number(o)])??e.engine.Nothing}}},ListFrom:{description:"Create a list from the elements of a collection.",complexity:8200,signature:"(value*) -> list",type:e=>{if(e.length===0)return"list";let t="unknown";for(let i of e){if(i.isCollection&&!i.isFiniteCollection)return"list";t=$e(t,bt(i.type.type)??t)}return R(`list<${Q(t)}>`)},evaluate:(e,{engine:t})=>{let i=[];for(let r of e)if(!r.isCollection)i.push(r);else{if(!r.isFiniteCollection)return;i.push(...Array.from(r.each()))}return t.function("List",i)}},SetFrom:{description:"Create a set from the elements of a collection.",complexity:8200,signature:"(value*) -> set",type:e=>{if(e.length===0)return"set";let t="unknown";for(let i of e){if(i.isCollection&&!i.isFiniteCollection)return"set";t=$e(t,bt(i.type.type)??t)}return R(`set<${Q(t)}>`)},evaluate:(e,{engine:t})=>{let i=[];for(let r of e)if(r.isCollection)i.push(r);else{if(!r.isFiniteCollection)return;i.push(...Array.from(r.each()))}return t.function("Set",i)}},TupleFrom:{description:"Create a tuple from the elements of a collection.",complexity:8200,signature:"(value*) -> tuple",evaluate:(e,{engine:t})=>{let i=[];for(let r of e)if(r.isCollection)i.push(r);else{if(!r.isFiniteCollection)return;i.push(...Array.from(r.each()))}return t.tuple(...i)}},DictionaryFrom:{description:"Create a dictionary from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> dictionary",evaluate:([e],{engine:t})=>{if(!e.isCollection)return;if(e.operator==="Record")return t.function("Dictionary",e.ops);let i=[];for(let r of e.each()){if(r.nops!==2)throw new Error(`Expected a collection of pairs, got ${r.type}`);let n=r.op1,s=r.op2;if(!n.string)throw new Error(`Expected a string key, got ${n.type}`);i.push(t.tuple(n,s))}return t.function("Dictionary",i)}},RecordFrom:{description:"Create a record from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> record",evaluate:([e],{engine:t})=>{if(!e.isCollection)return;if(e.operator==="Dictionary")return t.function("Record",e.ops);let i=[];for(let r of e.each()){if(r.nops!==2)throw new Error(`Expected a collection of pairs, got ${r.type}`);let n=r.op1,s=r.op2;if(!n.string)throw new Error(`Expected a string key, got ${n.type}`);i.push(t.tuple(n,s))}return t.function("Record",i)}}};function Xe(e){if(e.nops===0)return[1,0,0];let t=e.op1.re;if(isFinite(t)?t=Math.round(t):t=1,e.nops===1)return[1,t,1];let i=e.op2.re;if(!isFinite(i)&&!i?i=1:isFinite(i)&&(i=Math.round(i)),e.nops===2)return[t,i,i>t?1:-1];let r=e.op3.re;return isFinite(r)?r=Math.abs(Math.round(r)):r=1,[t,i,t<i?r:-r]}function mh(e){let[t,i,r]=e;return Number.isFinite(i)?r>0?i-(i-t)%r:i+(t-i)%r:r>0?1/0:-1/0}function gh(e,{engine:t}){let i=e[0];if(e.length===1&&i.operator==="Matrix"){let[r,n,s]=i.ops;if(!n||n.string==="..")return s?t._fn("Matrix",[r,t.string("[]"),s]):t._fn("Matrix",[r,n])}return e=e.map(r=>{var n;return r.operator==="Delimiter"?r.op1.operator==="Sequence"?t._fn("List",Et(t,r.op1.ops)):t._fn("List",[((n=r.op1)==null?void 0:n.canonical)??t.Nothing]):r.canonical}),t._fn("List",e)}function dh(e,{engine:t}){let i=[],r=n=>i.some(s=>s.isSame(n));for(let n of e)r(n)||i.push(n);return t._fn("Set",i)}function rl(e){let t=[],i=[],r=n=>{for(let s=0;s<t.length;s++)if(t[s].isSame(n))return s;return-1};for(let n of e.each()){let s=r(n);s>=0?i[s]++:(t.push(n),i.push(1))}return[t,i]}function*yh(e,t,i){let r=i,n=0;for(let s of e.each()){let a=t(r,s);if(a===null)return;n+=1,n%1e3===0&&(yield r),r=a}return r}function bh(e){return e.some(t=>t.type.matches("record"))?"record":e.some(t=>t.type.matches("dictionary"))?"dictionary":e.some(t=>t.type.matches("set"))?"set":"list"}function nl(e,t){return e.operator!==t.operator||e.nops!==t.nops?!1:e.ops.every((i,r)=>i.isSame(t.ops[r]))}function sl(e,t){return Array.from({length:t-e+1},(i,r)=>e+r)}function al(e,t=void 0){let i=t?ne(t):void 0,r=i?(a,o)=>{let l=i([a,o]);return l!=null&&l.isNegative?-1:l!=null&&l.is(0)?0:1}:(a,o)=>a.isLess(o)?-1:a.isEqual(o)?0:1,n=e.xsize;if(n===void 0||!Number.isFinite(n)||n<1)return;let s=Array.from({length:n},(a,o)=>o+1);return s.sort((a,o)=>{let l=e.at(a),u=e.at(o);return r(l,u)}),s}function ds(e){if(e.length===0)return[];let t=[];for(let i of e)i.symbol!=="Nothing"&&(i.operator==="Sequence"?t.push(...ds(i.ops)):i.string?t.push(i):i.isCollection?t.push(...ds([...i.each()])):t.push(i));return t}function vh(e){let t=Math.max(0,L(e.op2)??0);if(t===0)return{next:()=>({value:void 0,done:!0})};let i=1,r=0;return{next:()=>{if(r>=Math.abs(t))return{value:void 0,done:!0};let n=e.op1.at(i);return n?(i+=1,r+=1,{value:n,done:!1}):{value:void 0,done:!0}}}}function ol(e){let[t,i]=e.ops,r=t.xsize;if(r===void 0)return;let n=Math.max(0,L(i)??0);return Number.isFinite(n)?Math.min(r,n):1/0}function ys(e){let t=e.ops.map(i=>i.xsize);if(!t.some(i=>i===void 0))return t.some(i=>!Number.isFinite(i))?1/0:t.length===0?0:Math.min(...t)}function bs(e){e==null||e.operator;let t=1,i=t+Ar,r,n=!0;return r=e.op1.symbol,t=Math.floor(e.op2.re),isNaN(t)&&(t=1),Number.isFinite(t)||(n=!1),e.op3.symbol==="Nothing"||e.op3.isInfinity?n=!1:(isNaN(e.op3.re)||(i=Math.floor(e.op3.re??i)),Number.isFinite(i)||(n=!1)),!n&&Number.isFinite(t)&&(i=t+Ar),{index:r,lower:t,upper:i,isFinite:n}}function xh(e){return e.map(t=>bs(t))}function Nh(e){e.length>0;let{index:t,lower:i,upper:r,isFinite:n}=e[0];n||(r=i+Ar);let s=sl(i,r).map(a=>[a]);if(e.length===1)return s;for(let a=1;a<e.length;a++){let{index:o,lower:l,upper:u,isFinite:c}=e[a];c||(u=l+Ar),s=_h(s.map(f=>f[0]),sl(l,u))}return s}function _h(e,t){return e.flatMap(i=>t.map(r=>[i,r]))}function wh(e,t){var n,s;let i=t.engine,r=[];for(let a=0;a<e.length;a++){let o=e[a];o.operator==="Range"?r.push(ri([i.Nothing,o.op1,o.op2],t)??i.error("missing")):o.operator&&["Limits","Tuple","Triple","Pair","Single","Hold"].includes(o.operator)?r.push(ri(o.ops,t)??i.error("missing")):o.symbol&&((n=e[a+1])!=null&&n.isNumberLiteral?(s=e[a+2])!=null&&s.isNumberLiteral?(r.push(ri([o,e[a+1],e[a+2]],t)??i.error("missing")),a+=2):(r.push(ri([o,e[a+1]],t)??i.error("missing")),a+=1):r.push(ri([o],t)??i.error("missing")))}return r}function ri(e,{engine:t}){var i,r;if(e.length===1){let n=e[0];return n.symbol?t._fn("Limits",[n,t.Nothing,t.Nothing]):n.operator==="Hold"?ri(n.ops,{engine:t}):t._fn("Limits",[t.typeError("symbol",void 0,n)])}else if(e.length>1){let n=t.Nothing,s=t.Nothing,a=e[1].canonical;return e.length===2?e[0].operator==="Hold"?(n=e[0].op1,a=e[1].canonical):e[0].symbol?(n=e[0],a=e[1].canonical):(n=t.Nothing,s=e[0].canonical,a=e[1].canonical):e.length===3&&(n=e[0]??t.Nothing,s=((i=e[1])==null?void 0:i.canonical)??t.Nothing,a=((r=e[2])==null?void 0:r.canonical)??t.Nothing),n.operator==="Hold"&&(n=n.op1),n.symbol||(n=t.typeError("symbol",n.type,n)),s.symbol!=="Nothing"&&(s=ke(t,s,"number")),a.symbol!=="Nothing"&&(a=ke(t,a,"number")),t._fn("Limits",[n,s,a])}return null}function kh(e){var s,a;let t=e.engine,i,r=null,n=null;if(e.operator==="Tuple"||e.operator==="Triple"||e.operator==="Pair"||e.operator==="Single"?(i=e.op1,n=((s=e.ops[1])==null?void 0:s.canonical)??null,r=((a=e.ops[2])==null?void 0:a.canonical)??null):i=e,i.operator==="Hold"&&(i=i.op1),!!i.symbol)return i.symbol&&i.symbol!=="Nothing"&&t.declare(i.symbol,"integer"),r&&n?t.function("Limits",[i,n,r]):r?t.function("Limits",[i,t.One,r]):n?t.function("Limits",[i,n]):t.function("Limits",[i])}function ll(e,t,i,r){let n=t.engine;n.pushScope(r);let s=i.map(a=>kh(a)).filter(a=>a??n.error("missing"));return t=(t==null?void 0:t.canonical)??n.error("missing"),n.popScope(),t.isCollection?e==="Sum"?n.box(["Reduce",t,"Add",0]):n.box(["Reduce",t,"Multiply",1]):n._fn(e,[t,...s],{scope:r})}function*Jr(e,t,i,r){if(e.isCollection)return yield*yh(e.evaluate(),i,r);if(t.length===0)return i(r,e)??void 0;let n=e.engine,s=xh(t),a=Nh(s),o=r,l=0;for(let u of a)if(s.forEach((c,f)=>n.assign(c.index,u[f])),o=i(o,e)??void 0,l+=1,l%1e3===0&&(yield o),o===void 0)break;return o??void 0}function Sh(e,t){if(t===0)return{estimate:e,error:t};let i=Math.abs(t),r=Math.floor(Math.log10(i)),n=2,s=Math.pow(10,r-(n-1)),a=Math.round(t/s)*s,o=Math.max(0,-(r-(n-1)));return{estimate:Number(e.toFixed(o)),error:a}}function Kr(e,t,i,r=1e5){let n=0,s=0;if(t===-1/0&&i===1/0)for(let p=0;p<r;p++){let h=Math.random(),d=Math.tan(Math.PI*(h-.5)),y=Math.PI*(1+d*d),x=e(d)/y;n+=x,s+=x*x}else if(t===-1/0)for(let p=0;p<r;p++){let h=Math.random(),d=i-Math.log(1-h),y=1/(1-h),x=e(d)/y;n+=x,s+=x*x}else if(i===1/0)for(let p=0;p<r;p++){let h=Math.random(),d=t+Math.log(h),y=1/h,x=e(d)/y;n+=x,s+=x*x}else for(let p=0;p<r;p++){let h=e(t+Math.random()*(i-t));n+=h,s+=h*h}let a=n/r,o=(s-r*a*a)/(r-1),l=Math.sqrt(o/r),u=i-t,c=a*u,f=l*u;return Sh(c,f)}var ul=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Xr(e){if(e<0)return NaN;let t=Math.PI,i=e*e*e;return e*Math.log(e)-e-.5*Math.log(e)+.5*Math.log(2*t)+1/(12*e)-1/(360*i)+1/(1260*i*e*e)}function wi(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*wi(1-e));if(e>100)return Math.exp(Xr(e));e-=1;let t=ul[0];for(let r=1;r<9;r++)t+=ul[r]/(e+r);let i=e+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*t}function Th(e){let t=Math.PI,i=t*t,r=i*t,n=e*e,s=e*n,a=s*n,o=a*n;return Math.sqrt(t)/2*(e+t/12*s+7*i/480*a+127*r/40320*o+4369*i*i/5806080*o*n+34807*r*i/182476800*o*n*n)}function cl(e){let t=.254829592,i=-.284496736,r=1.421413741,n=-1.453152027,s=1.061405429,a=.3275911,o=e<0?-1:1;e=Math.abs(e);let l=1/(1+a*e),u=((((s*l+n)*l+r)*l+i)*l+t)*l;return o*(1-u*Math.exp(-e*e))}function fl(e,t){if(t.isNegative())return e._BIGNUM_NAN;let i=e._cache("gamma-p-ln",()=>["0.99999999999999709182","57.156235665862923517","-59.597960355475491248","14.136097974741747174","-0.49191381609762019978","0.33994649984811888699e-4","0.46523628927048575665e-4","-0.98374475304879564677e-4","0.15808870322491248884e-3","-0.21026444172410488319e-3","0.2174396181152126432e-3","-0.16431810653676389022e-3","0.84418223983852743293e-4","-0.2619083840158140867e-4","0.36899182659531622704e-5"].map(a=>e.bignum(a))),r=i[0];for(let a=i.length-1;a>0;--a)r=r.add(i[a].div(t.add(a)));let n=e._cache("gamma-g-ln",()=>e.bignum(607).div(128)),s=t.add(n).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().mul(e._BIGNUM_TWO).log().mul(e._BIGNUM_HALF).add(s.log().mul(t.add(e._BIGNUM_HALF)).minus(s).add(r.log()).minus(t.log()))}function pl(e,t){if(t.lessThan(e._BIGNUM_HALF)){let s=e._BIGNUM_NEGATIVE_ONE.acos();return s.div(s.mul(t).sin().mul(pl(e,e._BIGNUM_ONE.sub(t))))}if(t.greaterThan(100))return fl(e,t).exp();t=t.sub(1);let i=e._cache("lanczos-7-c",()=>["0.99999999999980993227684700473478","676.520368121885098567009190444019","-1259.13921672240287047156078755283","771.3234287776530788486528258894","-176.61502916214059906584551354","12.507343278686904814458936853","-0.13857109526572011689554707","9.984369578019570859563e-6","1.50563273514931155834e-7"].map(s=>e.bignum(s))),r=i[0];for(let s=1;s<9;s++)r=r.add(i[s].div(t.add(s)));let n=t.add(7).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().times(e._BIGNUM_TWO).sqrt().mul(r.mul(n.neg().exp()).mul(n.pow(t.add(e._BIGNUM_HALF))))}function vs(e){let t=0,i=0;for(let r of e)t+=r,i++;return i===0?NaN:t/i}function Eh(e,t){let i=e(0),r=0;for(let n of t)i=i.add(n),r++;return r===0?e(NaN):i.div(r)}function Zt(e){let t=[...e].sort((r,n)=>r-n),i=Math.floor(t.length/2);return t.length%2===0?(t[i-1]+t[i])/2:t[i]}function ki(e){let t=[...e].sort((r,n)=>r.cmp(n)),i=Math.floor(t.length/2);return t.length%2===0?t[i-1].add(t[i]).div(2):t[i]}function er(e){let t=0,i=0,r=0;for(let n of e)t+=n,i+=n*n,r++;return r===0?NaN:(i-t*t/r)/(r-1)}function hl(e,t){let i=e(0),r=e(0),n=0;for(let s of t)i=i.add(s),r=r.add(s.mul(s)),n++;return n===0?e(NaN):r.sub(i.mul(i).div(n)).div(n-1)}function tr(e){let t=0,i=0,r=0;for(let n of e)t+=n,i+=n*n,r++;return r===0?NaN:(i-t*t/r)/r}function ml(e,t){let i=e(0),r=e(0),n=0;for(let s of t)i=i.add(s),r=r.add(s.mul(s)),n++;return n===0?e(NaN):r.sub(i.mul(i).div(n)).div(n)}function gl(e){return Math.sqrt(er(e))}function dl(e){return Math.sqrt(tr(e))}function xs(e){let t=0,i=0,r=0,n=0;for(let a of e){let o=a;if(!Number.isFinite(o))return NaN;t+=o,i+=o*o,r+=o*o*o*o,n++}if(n===0)return NaN;let s=(i-t*t/n)/(n-1);return(r-4*t*i/n+6*t*t*t/n/n-3*t*t*t*t/n/n/n)/(s*s)}function Ih(e,t){let i=e(0),r=e(0),n=e(0),s=0;for(let o of t){let l=o;if(!l.isFinite())return e(NaN);i=i.add(l),r=r.add(l.mul(l)),n=n.add(l.mul(l).mul(l).mul(l)),s++}if(s===0)return e(NaN);let a=r.sub(i.mul(i).div(s)).div(s-1);return n.sub(i.mul(r).mul(4).div(s)).add(i.mul(i).mul(i).mul(6).div(s).div(s)).sub(i.mul(i).mul(i).mul(i).div(s).div(s).div(s)).div(a.mul(a))}function Ns(e){let t=0,i=0,r=0,n=0;for(let a of e){let o=a;if(!Number.isFinite(o))return NaN;t+=o,i+=o*o,r+=o*o*o,n++}if(n===0)return NaN;let s=(i-t*t/n)/(n-1);return(r-i*t/n)/(n-1)/Math.pow(s,1.5)*Math.sqrt(n*1)}function Mh(e,t){let i=e(0),r=e(0),n=e(0),s=0;for(let o of t){let l=o;if(!l.isFinite())return e(NaN);i=i.add(l),r=r.add(l.mul(l)),n=n.add(l.mul(l).mul(l)),s++}if(s===0)return e(NaN);let a=r.sub(i.mul(i).div(s)).div(s-1);return n.sub(r.mul(i).div(s)).div(s-1).div(a.pow(1.5)).mul(s).sqrt()}function _s(e){let t={};for(let n of e)t[n]=(t[n]??0)+1;let i=0,r=NaN;for(let n in t){let s=t[n];s>i&&(i=s,r=+n)}return r}function Ah(e,t){let i={};for(let s of t)i[s.toString()]=(i[s.toString()]??0)+1;let r=0,n=e(NaN);for(let s in i){let a=i[s];a>r&&(r=a,n=e(s))}return n}function ws(e){let t=[...e].sort((a,o)=>a-o),i=Math.floor(t.length/2),r=Zt(t.slice(0,i)),n=Zt(t),s=Zt(t.slice(i));return[r,n,s]}function $h(e){let t=[...e].sort((a,o)=>a.cmp(o)),i=Math.floor(t.length/2),r=ki(t.slice(0,i)),n=ki(t),s=ki(t.slice(i));return[r,n,s]}function ks(e){let t=[...e].sort((s,a)=>s-a),i=Math.floor(t.length/2),r=t.slice(0,i),n=t.slice(i+1);return Zt(n)-Zt(r)}function Ch(e){let t=[...e].sort((s,a)=>s.cmp(a)),i=Math.floor(t.length/2),r=t.slice(0,i),n=t.slice(i+1);return ki(n).sub(ki(r))}var qh={Add:["+",11],Negate:["-",14],Subtract:["-",11],Multiply:["*",12],Divide:["/",13],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},Dh={Abs:"Math.abs",Add:(e,t)=>e.length===1?t(e[0]):`(${e.map(i=>t(i)).join(" + ")})`,Arccos:"Math.acos",Arccosh:"Math.acosh",Arccot:([e],t)=>{if(e===null)throw new Error("Arccot: no argument");return`Math.atan(1 / (${t(e)}))`},Arccoth:([e],t)=>{if(e===null)throw new Error("Arccoth: no argument");return`Math.atanh(1 / (${t(e)}))`},Arccsc:([e],t)=>{if(e===null)throw new Error("Arccsc: no argument");return`Math.asin(1 / (${t(e)}))`},Arccsch:([e],t)=>{if(e===null)throw new Error("Arccsch: no argument");return`Math.asinh(1 / (${t(e)}))`},Arcsec:([e],t)=>{if(e===null)throw new Error("Arcsec: no argument");return`Math.acos(1 / (${t(e)}))`},Arcsech:([e],t)=>{if(e===null)throw new Error("Arcsech: no argument");return`Math.acosh(1 / (${t(e)}))`},Arcsin:"Math.asin",Arcsinh:"Math.asinh",Arctan:"Math.atan",Arctanh:"Math.atanh",Ceiling:"Math.ceil",Chop:"_SYS.chop",Cos:"Math.cos",Cosh:"Math.cosh",Cot:([e],t)=>{if(e===null)throw new Error("Cot: no argument");return vl("Math.cos(${x}) / Math.sin(${x})",t(e))},Coth:([e],t)=>{if(e===null)throw new Error("Coth: no argument");return vl("(Math.cosh(${x}) / Math.sinh(${x}))",t(e))},Csc:([e],t)=>{if(e===null)throw new Error("Csc: no argument");return`1 / Math.sin(${t(e)})`},Csch:([e],t)=>{if(e===null)throw new Error("Csch: no argument");return`1 / Math.sinh(${t(e)})`},Exp:"Math.exp",Floor:"Math.floor",Gamma:"_SYS.gamma",GCD:"_SYS.gcd",Integrate:(e,t,i)=>Lh(e,t,i),LCM:"_SYS.lcm",Limit:(e,t)=>`_SYS.limit(${t(e[0])}, ${t(e[1])})`,Ln:"Math.log",List:(e,t)=>`[${e.map(i=>t(i)).join(", ")}]`,Log:(e,t)=>e.length===1?`Math.log10(${t(e[0])})`:`(Math.log(${t(e[0])}) / Math.log(${t(e[1])}))`,LogGamma:"_SYS.lngamma",Lb:"Math.log2",Max:"Math.max",Mean:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.mean(${t(e[0])})`:`_SYS.mean([${e.map(i=>t(i)).join(", ")}])`,Median:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.median(${t(e[0])})`:`_SYS.median([${e.map(i=>t(i)).join(", ")}])`,Variance:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.variance(${t(e[0])})`:`_SYS.variance([${e.map(i=>t(i)).join(", ")}])`,PopulationVariance:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.populationVariance(${t(e[0])})`:`_SYS.populationVariance([${e.map(i=>t(i)).join(", ")}])`,StandardDeviation:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.standardDeviation(${t(e[0])})`:`_SYS.standardDeviation([${e.map(i=>t(i)).join(", ")}])`,PopulationStandardDeviation:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.populationStandardDeviation(${t(e[0])})`:`_SYS.populationStandardDeviation([${e.map(i=>t(i)).join(", ")}])`,Kurtosis:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.kurtosis(${t(e[0])})`:`_SYS.kurtosis([${e.map(i=>t(i)).join(", ")}])`,Skewness:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.skewness(${t(e[0])})`:`_SYS.skewness([${e.map(i=>t(i)).join(", ")}])`,Mode:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.mode(${t(e[0])})`:`_SYS.mode([${e.map(i=>t(i)).join(", ")}])`,Quartiles:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.quartiles(${t(e[0])})`:`_SYS.quartiles([${e.map(i=>t(i)).join(", ")}])`,InterquartileRange:(e,t)=>e.length===0?"NaN":e.length===1?`_SYS.interquartileRange(${t(e[0])})`:`_SYS.interquartileRange([${e.map(i=>t(i)).join(", ")}])`,Min:"Math.min",Power:(e,t)=>{let i=e[0];if(i===null)throw new Error("Power: no argument");let r=e[1].re;return r===.5?`Math.sqrt(${t(i)})`:r===1/3?`Math.cbrt(${t(i)})`:r===1?t(i):r===-1?`(1 / (${t(i)}))`:r===-.5?`(1 / Math.sqrt(${t(i)}))`:`Math.pow(${t(i)}, ${t(e[1])})`},Range:(e,t)=>{if(e.length===0)return"[]";if(e.length===1)return`Array.from({length: ${t(e[0])}}, (_, i) => i)`;let i=t(e[0]),r=t(e[1]),n=e[2]?t(e[2]):"1";if(i===null)throw new Error("Range: no start");if(r===null&&(r=i,i="1"),n==="0")throw new Error("Range: step cannot be zero");if(parseFloat(n)===1){let s=parseFloat(r),a=parseFloat(i);return s!==null&&a!==null?s-a<50?`[${Array.from({length:s-a+1},(o,l)=>a+l).join(", ")}]`:`Array.from({length: ${s-a+1} 
        }, (_, i) => ${i} + i)`:`Array.from({length: ${r} - ${i} + 1
      }, (_, i) => ${i} + i)`}return`Array.from({length: Math.floor((${r} - ${i}) / ${n}) + 1}, (_, i) => ${i} + i * ${n})`},Root:([e,t],i)=>{if(e===null)throw new Error("Root: no argument");return t===null?`Math.sqrt(${i(e)})`:(t==null?void 0:t.re)===2?`Math.sqrt(${i(e)})`:(t==null?void 0:t.re)===3?`Math.cbrt(${i(e)})`:isNaN(t==null?void 0:t.re)?`Math.pow(${i(e)}, 1 / (${i(t)}))`:`Math.pow(${i(e)},  ${1/t.re})`},Random:"Math.random",Round:"Math.round",Square:(e,t)=>{let i=e[0];if(i===null)throw new Error("Square: no argument");return`Math.pow(${t(i)}, 2)`},Sec:(e,t)=>{let i=e[0];if(i===null)throw new Error("Sec: no argument");return`1 / Math.cos(${t(i)})`},Sech:(e,t)=>{let i=e[0];if(i===null)throw new Error("Sech: no argument");return`1 / Math.cosh(${t(i)})`},Sgn:"Math.sign",Sin:"Math.sin",Sinh:"Math.sinh",Sqrt:"Math.sqrt",Tan:"Math.tan",Tanh:"Math.tanh"},Ph=class extends Function{constructor(t,i=""){super("_SYS","_",i?`${i};return ${t}`:`return ${t}`);m(this,"SYS",{chop:ro,factorial:io,gamma:wi,gcd:Je,integrate:(t,i,r)=>Kr(t,i,r,1e7).estimate,lcm:Wn,lngamma:Xr,limit:hi,mean:vs,median:Zt,variance:er,populationVariance:tr,standardDeviation:gl,populationStandardDeviation:dl,kurtosis:xs,skewness:Ns,mode:_s,quartiles:ws,interquartileRange:ks});return new Proxy(this,{apply:(r,n,s)=>super.apply(n,[this.SYS,...s]),get:(r,n)=>n==="toString"?()=>t:n==="isCompiled"?!0:r[n]})}},yl=class extends Function{constructor(t,i){super("_SYS",...i,`return ${t}`);m(this,"SYS",{chop:ro,factorial:io,gamma:wi,gcd:Je,integrate:(t,i,r)=>Kr(t,i,r,1e7).estimate,lcm:Wn,lngamma:Xr,limit:hi,mean:vs,median:Zt,variance:er,populationVariance:tr,standardDeviation:gl,populationStandardDeviation:dl,kurtosis:xs,skewness:Ns,mode:_s,quartiles:ws,interquartileRange:ks});return new Proxy(this,{apply:(r,n,s)=>super.apply(n,[this.SYS,...s]),get:(r,n)=>n==="toString"?()=>`(${i.join(", ")}) => ${t}`:n==="isCompiled"?!0:r[n]})}};function Fh(e,t){var r;if(e.operator==="Function"){let n=e.ops,s=n.slice(1).map(o=>o.symbol??"_"),a=ae(n[0].canonical,{...t,var:o=>s.includes(o)?o:t.var(o)});return new yl(a,s)}if(e.symbol){let n=(r=t.operators)==null?void 0:r.call(t,e.symbol);if(n)return new yl(`a ${n[0]} b`,["a","b"])}let i=ae(e,t);return new Ph(i,t.preamble)}function Oh(e,t,i,r=[],n){let s=e.unknowns,a=r.map(l=>{if(typeof l=="function")return l.toString();throw new Error(`Unsupported import \`${l}\``)}).join(`
`),o=t?Object.fromEntries(Object.entries(t).filter((l,u)=>typeof u!="string")):{};if(t)for(let[l,u]of Object.entries(t))typeof u=="function"&&(Rh(u)?(a+=`${u.toString()};
`,o[l]=u.name):(a+=`const ${l} = ${u.toString()};
`,o[l]=l));return Fh(e,{operators:l=>qh[l],functions:l=>o!=null&&o[l]?o[l]:Dh[l],var:l=>{if(i&&l in i)return JSON.stringify(i[l]);let u={Pi:"Math.PI",ExponentialE:"Math.E",NaN:"Number.NaN",ImaginaryUnit:"Number.NaN",Half:"0.5",MachineEpsilon:"Number.EPSILON",GoldenRatio:"((1 + Math.sqrt(5)) / 2)",CatalanConstant:"0.91596559417721901",EulerGamma:"0.57721566490153286"}[l];if(u!==void 0)return u;if(s.includes(l))return`_.${l}`},string:l=>JSON.stringify(l),number:l=>l.toString(),indent:0,ws:l=>l??"",preamble:(n??"")+a})}function bl(e,t,i,r,n){var a,o;if(t==="Error")throw new Error("Error");if(t==="Sequence")return i.length===0?"":`(${i.map(l=>ae(l,n,r)).join(", ")})`;if(t==="Sum"||t==="Product")return zh(t,i,n);if(i.every(l=>!l.isCollection)){let l=(a=n.operators)==null?void 0:a.call(n,t);if(Xt(t)&&i.length>2&&l){let u=[];for(let c=0;c<i.length-1;c++)u.push(bl(e,t,[i[c],i[c+1]],l[1],n));return`(${u.join(") && (")})`}if(l!==void 0){if(i===null)return"";let u;return i.length===1?u=`${l[0]}${ae(i[0],n,l[1])}`:u=i.map(c=>ae(c,n,l[1])).join(` ${l[0]} `),l[1]<r?`(${u})`:u}}if(t==="Function"){let l=i.slice(1).map(u=>u.symbol);return`((${l.join(", ")}) => ${ae(i[0].canonical,{...n,var:u=>l.includes(u)?u:n.var(u)})})`}if(t==="Declare")return`let ${i[0].symbol}`;if(t==="Assign")return`${i[0].symbol} = ${ae(i[1],n)}`;if(t==="Return")return`return ${ae(i[0],n)}`;if(t==="If"){if(i.length!==3)throw new Error("If: wrong number of arguments");return`((${ae(i[0],n)}) ? (${ae(i[1],n)}) : (${ae(i[2],n)}))`}if(t==="Block"){let l=[];for(let c of i)c.operator==="Declare"&&l.push(c.ops[0].symbol);if(i.length===1&&l.length===0)return ae(i[0],n);let u=i.map(c=>ae(c,{...n,var:f=>l.includes(f)?f:n.var(f)}));return u[u.length-1]=`return ${u[u.length-1]}`,`(() => {${n.ws(`
`)}${u.join(`;${n.ws(`
`)}`)}${n.ws(`
`)}})()`}let s=(o=n.functions)==null?void 0:o.call(n,t);if(!s)throw new Error(`Unknown operator \`${t}\``);if(typeof s=="function"){let l=e.lookupDefinition(t);if(le(l)&&l.operator.broadcastable&&i.length===1&&Ie(i[0])){let u=ir();return`(${ae(i[0],n)}).map((${u}) => ${s([i[0].engine.box(u)],c=>ae(c,n),n)})`}return s(i,u=>ae(u,n),n)}return i===null?`${s}()`:`${s}(${i.map(l=>ae(l,n)).join(", ")})`}function ae(e,t,i=0){var n,s;if(e===void 0)return"";if(!e.isValid)throw new Error(`Cannot compile invalid expression: "${e.toString()}"`);let r=e.symbol;if(r!==null){let a=(n=t.operators)==null?void 0:n.call(t,r);return a!==void 0?`(a,b) => a ${a[0]} b`:((s=t.var)==null?void 0:s.call(t,r))??r}if(e.isNumberLiteral){if(e.im!==0)throw new Error("Complex numbers are not supported");return t.number(e.re)}return e.string!==null?t.string(r):bl(e.engine,e.operator,e.ops,i,t)}function zh(e,t,i){if(t===null)throw new Error("Sum/Product: no arguments");if(!t[0])throw new Error("Sum/Product: no body");let{index:r,lower:n,upper:s,isFinite:a}=bs(t[1]),o=e==="Sum"?"+":"*";if(!r){let c=ir(),f=ir();return`${ae(t[0],i)}.reduce((${f}, ${c}) => ${f} ${o} ${c}, ${o==="+"?"0":"1"})`}let l=ae(t[0],{...i,var:c=>c===r?r:i.var(c)}),u=ir();return`(() => {
  let ${u} = ${o==="+"?"0":"1"};
  let ${r} = ${n};
  while (${r} <= ${s}) {
    ${u} ${o}= ${l};
    ${r}++;
  }
  return ${u};
})()`}function vl(e,t){if(/^[\p{L}_][\p{L}\p{N}_]*$/u.test(t)||/^[0-9]+$/.test(t))return new Function("x",`return \`${e}\`;`)(t);{let i=ir();return new Function("x",`return \`(() => { const ${i} = \${x}; return ${e.replace(/\\\${x}/g,i)}; })()\`;`)(t)}}function ir(){return`_${Math.random().toString(36).substring(4)}`}function Lh(e,t,i){let{index:r,lower:n,upper:s}=bs(e[1]),a=ae(e[0],{...i,var:o=>o===r?o:i.var(o)});return`_SYS.integrate((${r}) => (${a}), ${n}, ${s})`}function Rh(e){let t=e.toString();return t.includes("=>")?!1:t.startsWith("function ")&&t.includes(e.name)}function xl(e,t,i){if(i.repeatingDecimal&&i.repeatingDecimal!=="none"){let s=e.slice(0,-1);for(let a=0;a<e.length-16;a++){let o=s.substring(0,a);for(let l=0;l<17;l++){let u=s.substring(a,a+l+1),c=Math.floor((s.length-o.length)/u.length);if(c<=3)break;if((o+u.repeat(c+1)).startsWith(s)){if(u==="0")return Ts(o,i);let f={vinculum:"\\overline{#}",parentheses:"(#)",dots:"\\overset{\\cdots}{#1}#2\\overset{\\cdots}{#3}",arc:"\\wideparen{#}"}[i.repeatingDecimal]??"\\overline{#}";return f=f.replace(/#1/g,u[0]).replace(/#2/g,u.slice(1)).replace(/#3/g,u.slice(-1)).replace(/#/,u),Ts(o,i)+f}}}}let r=typeof i.fractionalDigits=="number"?i.fractionalDigits:1/0;r<0&&(r=r-t),r<0&&(r=0);let n=e.length>r;return n&&(e=e.substring(0,r)),e=Ts(e,i),n&&(e+=i.truncationMarker),e}function Nl(e,t){return!e||e==="0"?"":t.beginExponentMarker?t.beginExponentMarker+e+(t.endExponentMarker??""):`10^{${e}}`}function Vh(e,t){if(e===null)return"";let i;if(typeof e=="number"||typeof e=="string")i=e;else if(typeof e=="object"&&"num"in e)i=e.num;else return"";if(typeof i=="number"){if(i===1/0)return t.positiveInfinity;if(i===-1/0)return t.negativeInfinity;if(Number.isNaN(i))return t.notANumber;let s;return t.notation==="engineering"?s=en(i.toExponential(),t,3):t.notation==="scientific"&&(s=en(i.toExponential(),t)),s??Ss(i.toString(),t)}if(i=i.toLowerCase().replace(/[\u0009-\u000d\u0020\u00a0]/g,""),i==="infinity"||i==="+infinity"||i==="oo"||i==="+oo")return t.positiveInfinity;if(i==="-infinity"||i==="-oo")return t.negativeInfinity;if(i==="nan")return t.notANumber;if(!/^[-+\.]?[0-9]/.test(i))return"";if(i=i.replace(/[nd]$/,""),/\([0-9]+\)/.test(i)){let[s,a,o,l]=i.match(/(.+)\(([0-9]+)\)(.*)$/)??[];i=a+o.repeat(6)+l}let r="";for(i[0]==="-"?(r="-",i=i.substring(1)):i[0]==="+"&&(i=i.substring(1));i[0]==="0";)i=i.substring(1);i.length===0?i="0":i[0]==="."&&(i="0"+i);let n;return t.notation==="engineering"?n=en(i,t,3):t.notation==="scientific"&&(n=en(i,t)),r+(n??Ss(i,t))}function en(e,t,i=1){let r=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/);if(!r){let c="";if(e[0]==="-"?(c="-",e=e.substring(1)):e[0]==="+"&&(e=e.substring(1)),e.indexOf(".")<0)e.length===1?e=c+e+"e+0":e=c+e[0]+"."+e.slice(1)+"e+"+(e.length-1).toString();else{let[f,p,h]=e.match(/^(.*)\.(.*)$/);for(h||(h="");p.startsWith("0");)p=p.substring(1);p?e=c+p[0]+"."+p.slice(1)+h+"e+"+(p.length-1).toString():e=c+"0."+h+"e+0"}r=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/)}if(!r)return Ss(e,t);let n=parseInt(r[2]),s=r[1];if(Math.abs(n)%i!==0){let c=n>0?n%i:-((i+n)%i);n=n>=0?n-c:n+c;let[f,p,h]=s.match(/^(.*)\.(.*)$/)??["",s,""];s=p+(h+"00000000000000000").slice(0,Math.abs(c))+"."+h.slice(Math.abs(c))}let a=t.avoidExponentsInRange;if(a&&n>=a[0]&&n<=a[1])return;let o="",l=s;r=l.match(/^(.*)\.(.*)$/),r&&(l=r[1],o=r[2]);let u=Nl(Number(n).toString(),t);if(o=xl(o,l.length,t),o&&(o=t.decimalSeparator+o),l=kl(l,t),!u)return l+o;if(!o){if(l==="1")return u;if(l==="-1")return"-"+u}return l+o+t.exponentProduct+u}function Ss(e,t){let i=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/i),r=0;i!=null&&i[1]&&i[2]&&(r=parseInt(i[2]),e=i[1]);let n=(i==null?void 0:i[1])??e,s="";i=e.match(/^(.*)\.(.*)$/),i!=null&&i[1]&&i[2]&&(n=i[1],s=i[2]),r!==0&&s&&(n+=s,r-=s.length,s="");let a=t.avoidExponentsInRange;r!==0&&a&&r>=a[0]&&r<=a[1]&&([n,s]=Uh(n,s,r),r=0);let o=Nl(r.toString(),t);if(s&&(s=t.decimalSeparator+xl(s,n.length,t)),n=kl(n,t),!o)return n+s;if(!s){if(n==="1")return o;if(n==="-1")return"-"+o}return n+s+t.exponentProduct+o}function _l(e,t,i){let r=new RegExp(`(\\d{${t}})(?=\\d)`,"g");return e.replace(r,`$1${i}`)}function Bh(e,t,i){let r=new RegExp(`(\\d{${t}})(?=\\d)`,"g"),n=i.split("").reverse().join("");return e.split("").reverse().join("").replace(r,`$1${n}`).split("").reverse().join("")}function Zh(e,t){let i=e.split("").reverse().join(""),r=t.split("").reverse().join(""),n=i.replace(/(\d{3})(?=\d)/,`$1${r}`);return n=n.replace(/(\d{2})(?=(\d{2})+,)/g,`$1${r}`),n.split("").reverse().join("")}function wl(e,t,i){let r=t.digitGroup;typeof r!="string"&&Array.isArray(r)&&(r=r[i]);let n=typeof t.digitGroupSeparator=="string"?t.digitGroupSeparator:t.digitGroupSeparator[i];return n?r==="lakh"?i===0?Zh(e,n):_l(e,3,n):r===!1||r<=0?e:i===1?_l(e,r,n):Bh(e,r,n):e}function Ts(e,t){return wl(e,t,1)}function kl(e,t){return wl(e,t,0)}function Uh(e,t,i){let r=e+t,n=e.length+i,s,a;return n>0?n>=r.length?(r=r+"0".repeat(n-r.length),s=r,a=""):(s=r.slice(0,n),a=r.slice(n)):(s="0",a="0".repeat(-n)+r),[s,a]}var Es={deg:e=>`${e}\\degree`,prime:e=>`${e}^{\\prime}`,dprime:e=>`${e}^{\\doubleprime}`,ring:e=>`\\mathring{${e}}`,hat:e=>`\\hat{${e}}`,tilde:e=>`\\tilde{${e}}`,vec:e=>`\\vec{${e}}`,bar:e=>`\\overline{${e}}`,underbar:e=>`\\underline{${e}}`,dot:e=>`\\dot{${e}}`,ddot:e=>`\\ddot{${e}}`,tdot:e=>`\\dddot{${e}}`,qdot:e=>`\\ddddot{${e}}`,acute:e=>`\\acute{${e}}`,grave:e=>`\\grave{${e}}`,breve:e=>`\\breve{${e}}`,check:e=>`\\check{${e}}`},Is={upright:e=>`\\mathrm{${e}}`,italic:e=>`\\mathit{${e}}`,bold:e=>`\\mathbf{${e}}`,script:e=>`\\mathscr{${e}}`,fraktur:e=>`\\mathfrak{${e}}`,doublestruck:e=>`\\mathbb{${e}}`,blackboard:e=>`\\mathbb{${e}}`,calligraphic:e=>`\\mathcal{${e}}`,gothic:e=>`\\mathfrak{${e}}`,sansserif:e=>`\\mathsf{${e}}`,monospace:e=>`\\mathtt{${e}}`},Gh=class{constructor(e,t){m(this,"options");m(this,"dictionary");m(this,"level",-1);this.dictionary=e,this.options=t}wrap(e,t){if(e==null)return"";if(t===void 0)return this.wrapString(this.serialize(e),this.options.groupStyle(e,this.level+1));if(typeof e=="number"||Cr(e)){let r=z(e);return r!==null&&r<0&&t>ce?this.wrap(e):this.serialize(e)}let i=v(e);if(i&&i!=="Delimiter"&&i!=="Subscript"){let r=this.dictionary.ids.get(i);if(r&&(r.kind==="symbol"||r.kind==="expression"||r.kind==="prefix"||r.kind==="infix"||r.kind==="postfix")&&r.precedence<t)return this.wrapString(this.serialize(e),this.options.applyFunctionStyle(e,this.level))}return this.serialize(e)}wrapShort(e){if(e==null)return"";let t=this.serialize(e);if(q(e)!==null||mi(e)&&!/^(-|\.)/.test(t))return t;let i=v(e);return i==="Delimiter"&&K(e)===1||i!=="Add"&&i!=="Negate"&&i!=="Subtract"&&i!=="PlusMinus"&&i!=="Multiply"?t:this.wrapString(t,this.options.groupStyle(e,this.level+1))}wrapString(e,t,i){if(t==="none")return e;i??(i="()");let r=(i==null?void 0:i[0])??".",n=(i==null?void 0:i[1])??".";return r==='"'?r="``":r==="|"?r="\\lvert":r=Vr[r]??r,n==='"'?n="''":n==="|"?n="\\rvert":n=Vr[n]??n,r==="."&&n==="."?e:((r==="."||n===".")&&t==="normal"&&(t="scaled"),t==="scaled"?`\\left${r}${e}\\right${n}}`:t==="big"?`${`\\Bigl${r}`}${e}${`\\Bigr${n}`})`:r+e+n)}wrapArguments(e){return this.wrapString(S(e).map(t=>this.serialize(t)).join(", "),this.options.applyFunctionStyle(e,this.level))}serializeSymbol(e,t){var i;return(t==null?void 0:t.kind)==="function"?Ms(q(e)??"")??"":((i=t==null?void 0:t.serialize)==null?void 0:i.call(t,this,e))??Ms(q(e))??""}serializeFunction(e,t){if(t!=null&&t.serialize)return t.serialize(this,e);let i=v(e);return Ms(i,"auto")+this.wrapArguments(e)}serialize(e){if(e==null)return"";this.level+=1;try{let t=(()=>{let i=Vh(e,this.options);if(i)return i;let r=j(e);if(r!==null)return`\\text{${r}}`;let n=q(e);if(n!==null)return this.serializeSymbol(e,this.dictionary.ids.get(n));let s=v(e);if(s){let a=this.dictionary.ids.get(s);return this.serializeFunction(e,a)}throw Error(`Syntax error ${e?JSON.stringify(e,void 0,4):""}`)})();return this.level-=1,t??""}catch{}return this.level-=1,""}applyFunctionStyle(e,t){return this.options.applyFunctionStyle(e,t)}groupStyle(e,t){return this.options.groupStyle(e,t)}rootStyle(e,t){return this.options.rootStyle(e,t)}fractionStyle(e,t){return this.options.fractionStyle(e,t)}logicStyle(e,t){return this.options.logicStyle(e,t)}powerStyle(e,t){return this.options.powerStyle(e,t)}numericSetStyle(e,t){return this.options.numericSetStyle(e,t)}};function jh(e){var a;let t=((a=e.match(/^([^_]+)/))==null?void 0:a[1])??"",i=Tt.findIndex(o=>t===o[0]);if(i>=0)return[Tt[i][1],e.substring(Tt[i][0].length)];let r={zero:"0",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};if(i=Object.keys(r).findIndex(o=>e.startsWith(o)),i>=0){let o=Object.keys(r)[i];return[r[o],e.substring(o.length)]}let n=e.codePointAt(0);if(i=Tt.findIndex(o=>o[2]===n),i>=0)return[Tt[i][1],e.substring(1)];let s={plus:"+",minus:"-",pm:"\\pm",ast:"\\ast",dag:"\\dag",ddag:"\\ddag",hash:"\\#",bottom:"\\bot",top:"\\top",bullet:"\\bullet",circle:"\\circ",diamond:"\\diamond",times:"\\times",square:"\\square",star:"\\star"};if(i=Object.keys(s).findIndex(o=>t===o),i>=0){let o=Object.keys(s)[i];return[s[o],e.substring(o.length)]}return[t,e.substring(t.length)]}function Wh(e){let[t,i]=jh(e),r=[];for(;i.length>0;){let s=i.match(/^_([a-zA-Z]+)(.*)/);if(!s||!Es[s[1]])break;r.push(s[1]),i=s[2]}let n=[];for(;i.length>0;){let s=i.match(/^_([a-zA-Z]+)(.*)/);if(!s||!Is[s[1]])break;n.push(s[1]),i=s[2]}return[t,r,n,i]}function tn(e,t=!0,i="auto"){let[r,n,s,a]=Wh(e);for(let o of n)Es[o]&&(r=Es[o](r));if(t){let o=[],l=[],u=r.match(/^([^\d].*?)(\d+)$/);for(u&&(l.push(u[2]),r=u[1]);a.length>0;)if(a.startsWith("__")){let[c,f]=tn(a.substring(2),!1,"none");o.push(c),a=f}else if(a.startsWith("_")){let[c,f]=tn(a.substring(1),!1,"none");l.push(c),a=f}else break;o.length>0&&(r=Fr("^",r,o.join(","))),l.length>0&&(r=Fr("_",r,l.join(",")))}for(let o of s)Is[o]&&(r=Is[o](r));if(s.length===0&&i!=="none")switch(i){case"auto":mo(r)>1&&(r=`\\mathrm{${r}}`);break;case"operator":r=`\\operatorname{${r}}`;break;case"italic":r=`\\mathit{${r}}`;break;case"upright":r=`\\mathrm{${r}}`;break}return[r,a]}function Ms(e,t="auto"){if(e===null)return null;if(kr.test(e))return e;let i=e.match(/^(_+)(.*)/);if(i){let[s,a]=tn(i[2],!0,"none");return`\\operatorname{${"\\_".repeat(i[1].length)+s+a}}`}let[r,n]=tn(e,!0,t);return n.length>0?`\\operatorname{${e}}`:r}function Hh(e,t,i){return new Gh(t,i).serialize(e)}var Sl={PositiveInfinity:"+oo",NegativeInfinity:"-oo",ComplexInfinity:"~oo",NaN:"NaN",Pi:"pi",ExponentialE:"e",ImaginaryUnit:"i",ContinuationPlaceholder:"...",alpha:"alpha",beta:"beta",gamma:"gamma",delta:"delta",epsilon:"epsilon",epsilonSymbol:"varepsilon",zeta:"zeta",eta:"eta",theta:"theta",thetaSymbol:"vartheta",iota:"iota",kappa:"kappa",lambda:"lambda",mu:"mu",nu:"nu",xi:"xi",omicron:"omicron",pi:"pi",rho:"rho",sigma:"sigma",tau:"tau",upsilon:"upsilon",phi:"phi",phiSymbol:"varphi",chi:"chi",psi:"psi",omega:"omega",Gamma:"Gamma",Delta:"Delta",Theta:"Theta",Lambda:"Lambda",Xi:"Xi",Sigma:"Sigma",Upsilon:"Upsilon",Phi:"Phi",Psi:"Psi",Omega:"Omega"},Tl={Add:[(e,t)=>{var i;return((i=e.ops)==null?void 0:i.reduce((r,n)=>{if(n.operator==="Negate"){let s=t(n.op1,10);return r===""?`-${s}`:s.startsWith("+")?`${r} - ${s.substring(1)}`:s.startsWith("-")?`${r} + ${s.substring(1)}`:`${r} - ${s}`}return El(r,t(n,10))},""))??""},11],Negate:[(e,t)=>{let i=t(e.op1,14);return i==="Power"?`-(${i})`:`-${i}`},14],Subtract:[(e,t)=>{var i;return((i=e.ops)==null?void 0:i.reduce((r,n)=>{let s=t(n,10);return r===""?s:s.startsWith("-")?`${r} - (${s})`:`${r} - ${s}`},""))??""},11],Multiply:[(e,t)=>{if(!e.ops)return"";if(e.nops===2){let i=e.op1.numericValue;if(i!==null){typeof i!="number"&&i.im!==0&&$s(t(e.op2,12),El(i.re.toString(),`${i.im}i`));let r=e.op2;if((r.symbol||r.operator==="Power"||r.operator==="Square"||typeof Si[r.operator]=="string")&&bi(i)&&i[0]===1){let n=i[1];return`${t(r,12)}/${n}`}return $s(t(e.op1,12),t(e.op2,12))}}return e.ops.reduce((i,r)=>$s(i,t(r,12)),"")},12],Divide:["/",13],Power:[(e,t)=>{let i=t(e.op2,14);if(i==="1")return t(e.op1);if(i==="(1/2)"||i==="1/2"||i==="0.5")return`sqrt(${t(e.op1)})`;if(i==="-0.5")return`(1/sqrt(${t(e.op1)}))`;let r=t(e.op1,14);return r.startsWith("-")&&(r=`(${r})`),i.length===1?`${r}^${i}`:`${r}^${qe(i)}`},15],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},Si={Abs:(e,t)=>`|${t(e.op1)}|`,Sin:"sin",Cos:"cos",Tan:"tan",Sec:"sec",Csc:"csc",Arcsin:"arcsin",Arccos:"arccos",Arctan:"arctan",Sinh:"sinh",Cosh:"cosh",Tanh:"tanh",Sech:"sech",Csch:"csch",Coth:"coth",Ceil:"ceil",Exp:"exp",Factorial:(e,t)=>`${t(e.op1,12)}!`,Floor:"floor",Log:"log",Ln:"ln",Log10:"log10",Sqrt:"sqrt",Root:(e,t)=>{let i=e.op1,r=e.op2;return r.is(2)?`sqrt${qe(t(i))}`:`root${qe(t(r))}${qe(t(i))}`},Square:(e,t)=>`${t(e.op1,12)}^2`,Det:"det",Dim:"dim",Mod:"mod",GCD:"gcd",LCM:"lcm",Lub:"lub",Glb:"glb",Max:"max",Min:"min",PlusMinus:(e,t)=>{let[i,r]=e.ops??[];if(!r)return t(i);if(i&&r){let n=t(i),s=t(r);return`${n}  ${s}`}return i?` ${t(i)}`:r?` ${t(r)}`:"0"},Sum:(e,t)=>As(e,"sum",t),Product:(e,t)=>As(e,"prod",t),Integrate:(e,t)=>As(e,"int",t),Limit:(e,t)=>{var n;let[i,r]=e.ops??[];if((i==null?void 0:i.operator)==="Function"){let s=((n=i.ops)==null?void 0:n.slice(2))??[],a=i.op1??i,o=null;return s.length===1&&(o=s[0]),o?`lim_(${t(o)} -> ${t(r)}) ${t(a)}`:`lim_(${t(r)}) ${t(a)}`}else if(i!=null&&i.symbol)return`lim_(x -> ${t(r)}) ${t(i)}(x)`;return"lim"},Delimiter:(e,t)=>{var i;return Qh(e.ops[0],(i=e.ops[1])==null?void 0:i.string,t)},Sequence:(e,t)=>e.nops===0?"":e.ops.map(i=>t(i)).join(" "),List:(e,t)=>{var i;return`[${((i=e.ops)==null?void 0:i.map(r=>t(r)))??""}]`},Single:(e,t)=>`(${e.ops.map(i=>t(i)).join(", ")})`,Pair:(e,t)=>`(${e.ops.map(i=>t(i)).join(", ")})`,Triple:(e,t)=>`(${e.ops.map(i=>t(i)).join(", ")})`,Tuple:(e,t)=>`(${e.ops.map(i=>t(i)).join(", ")})`,Block:(e,t)=>e.nops===0?"{}":e.nops===1?`{${t(e.op1)}}`:`{    ${e.ops.map(i=>t(i)).join(`;
     `)}
    }`,EvaluateAt:(e,t)=>{let i=e.op1,r=e.ops.slice(1);return r.length===0?t(i):r.length===1?`(${t(i)})|_(${t(r[0])})`:r.length===2?`(${t(i)})|_(${t(r[0])})^(${t(r[1])})`:`(${t(i)})|_(${r.map(n=>t(n)).join(", ")})`},Function:(e,t)=>{let i=e.ops.slice(1),r=()=>i.map(n=>t(n)).join(", ");return e.op1.operator==="Block"?e.op1.nops===0?`(${r()}) |-> {}`:e.op1.nops===1?i.length===1&&i[0].symbol==="_1"?`(_) |-> ${t(e.op1.op1.subs({_1:"_"}))}`:`(${r()}) |-> ${t(e.op1.op1)}`:`(${r()}) |-> {
    ${e.op1.ops.map(n=>t(n)).join(`;
     `)}
}`:`(${r()}) |-> ${t(e.op1)}`},Domain:e=>JSON.stringify(e.json),Error:(e,t)=>e.nops===1?`Error(${t(e.op1)})`:e.nops===2?e.op1.string?`Error("${e.op1.string}", ${t(e.op2)})`:`Error(${t(e.op1)}, ${t(e.op2)})`:`Error(${e.ops.map(i=>t(i)).join(", ")})`,LatexString:e=>`"${e.op1.string??""}"`};function As(e,t,i){let[r,...n]=e.ops??[],s=[],a,o=[];if((r==null?void 0:r.operator)==="Function"){o=r.ops.slice(1)??[];let u=r.op1??r;u.operator==="Block"?a=i(u.op1??u):a=i(u)}else if(r!=null&&r.symbol)o=[],a=i(r);else return"int()";let l=t;for(let u of n)if(["Range","Tuple","Pair","Single","Limits"].includes(u.operator)&&u.nops!==0){if(u.nops===2)u.op1.symbol?(u.op1.symbol!=="Nothing"&&s.push(u.op1),u.op2.symbol!=="Nothing"&&(t==="int"?l+=`_${qe(i(u.op2))}`:l+="_"+qe(`${u.op1.symbol}=${i(u.op2)}`))):(u.op1.symbol!=="Nothing"&&(l+=`_${qe(i(u.op1))}`),u.op2.symbol!=="Nothing"&&(l+=`^${qe(i(u.op2))}`));else if(u.nops===3){let c="";u.op1.symbol!=="Nothing"&&(s.push(u.op1),c=u.op1.symbol??"");let f=u.op2.symbol!=="Nothing"?u.op2:null,p=u.op3.symbol!=="Nothing"?u.op3:null;f?t==="int"||!c?l+=`_${qe(i(f))}`:l+="_"+qe(`${c}=${i(f)}`):t!=="int"&&(l+=`_${qe(i(u.op1))}`),p&&(l+=`^${qe(i(p))}`)}}return t==="int"?l+=qe(a+o.map(u=>` d${i(u)}`).join(" ")):l+=qe(a),l}function Qh(e,t,i){t||(t="(,)");let r="",n="",s="";if(t.length===1&&(r=t),t.length===2&&(n=t[0],s=t[1]),t.length===3&&(n=t[0],r=t[1],s=t[2]),!e)return`${n}${s}`;let a=[e];return e.operator==="Sequence"&&(a=e.ops),`${n}${a.map(o=>i(o)).join(r)}${s}`}function qe(e,t=0,i=-1){return t>i&&!/^\(.+\)$/.test(e)?`(${e})`:e}function rn(e,t={}){var i;return(i=t.symbols)!=null&&i[e]?t.symbols[e]:Sl[e]?Sl[e]:e.startsWith("_")?e:Si[e]&&typeof Si[e]=="string"?Si[e]:e.length===1?e:`"${e}"`}function nn(e,t={},i=0){var s,a,o;if(e===void 0)return"[undefined]";if(e===null)return"[null]";if(e.symbol)return rn(e.symbol,t);let r=(l,u=0)=>nn(l,t,u);if(e.string)return`"${e.string.replace(/"/g,'\\"')}"`;let n=e.numericValue;if(n!==null)return e.isNaN?rn("NaN",t):e.isFinite===!1?e.isNegative!==!0&&e.isPositive!==!0?rn("ComplexInfinity",t):rn(e.isNegative?"NegativeInfinity":"PositiveInfinity",t):n.toString();if(e.operator){let l=t.operators?{...Tl,...t.operators}:Tl,[u,c]=l[e.operator]??[];if(u){let p="";if(typeof u=="function")p=u(e,r);else{if(e.nops===1)return`${u}${r(e.op1,c+1)}`;p=((s=e.ops)==null?void 0:s.map(h=>r(h,c+1)).join(` ${u} `))??""}return qe(p,i,c)}let f=(t.functions?{...Si,...t.functions}:Si)[e.operator];return typeof f=="function"?f(e,r):typeof f=="string"?`${f}(${((a=e.ops)==null?void 0:a.map(p=>r(p)).join(", "))??""})`:`${e.operator}(${((o=e.ops)==null?void 0:o.map(p=>r(p)).join(", "))??""})`}return JSON.stringify(e.json)}function $s(e,t){return e?t?((t.startsWith("-")||t.startsWith("+"))&&(t=`(${t})`),e.match(/^[-+]?\d+$/)&&t.match(/^[a-zA-Z\(]/)?e+t:`${e} * ${t}`):e:t}function El(e,t){return e?t?t.startsWith("-")?`${e} - ${t.substring(1)}`:t.startsWith("+")?`${e} + ${t.substring(1)}`:`${e} + ${t}`:e:t}function Il(e,t){for(e.isInteger()&&t.isInteger();!t.isZero();)[e,t]=[t,e.modulo(t)];return e.abs()}function Yh(e,t){return e.mul(t).div(Il(e,t))}function Jh(e,t){if(!t.isInteger()||t.isNegative())return e._BIGNUM_NAN;if(t.lessThan(1))return e._BIGNUM_ONE;let i=t;for(;t.greaterThan(2);)t=t.minus(2),i=i.mul(t);return i}function sn(e){return e.isFinite()?e.d.length>3||e.d.length===3&&e.d[0]>=90?!1:(e.precision()<=16,e.e<308&&e.e>-306):!0}var Cs=class Wu extends pe{constructor(i,r){super();m(this,"__brand");m(this,"decimal");m(this,"bignum");if(this.bignum=r,typeof i=="number")this.decimal=r(i),this.im=0;else if(i instanceof Z)this.decimal=i,this.im=0;else{let n=r(i.re??0);this.decimal=n,this.im=i.im??0}this.decimal.isNaN()&&(this.im=NaN),this.decimal.isNaN(),isNaN(this.im)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal.isZero()?"imaginary":"finite_complex":this.decimal.isFinite()?this.decimal.isInteger()?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&this.decimal.isInteger()}get asExact(){if(this.isExact)return this._makeExact(de(this.decimal))}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.isComplexInfinity?"ComplexInfinity":this.im===0?sn(this.decimal)?this.decimal.toNumber():{num:an(this.decimal)}:sn(this.decimal)?["Complex",Ge(this.decimal.toNumber()),Ge(this.im)]:["Complex",{num:an(this.decimal)},Ge(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return an(this.decimal);if(this.decimal.isZero())return this.im===1?"i":this.im===-1?"-i":`${ze(this.im)}i`;if(this.isComplexInfinity)return"~oo";let i="";return this.im===1?i="+ i":this.im===-1?i="- i":this.im>0?i=`+ ${this.im}i`:i=`- ${-this.im}i`,`(${an(this.decimal)} ${i})`}clone(i){return new Wu(i,this.bignum)}_makeExact(i){return new _e(i,r=>this.clone(r),this.bignum)}get re(){return this.decimal.toNumber()}get bignumRe(){return this.decimal}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return this.decimal.isNaN()}get isPositiveInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isPositive()}get isNegativeInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isNegative()}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal.isZero()}isZeroWithTolerance(i){if(this.im!==0)return!1;let r=typeof i=="number"?this.bignum(i):i;return this.decimal.abs().lte(r)}get isOne(){return this.im===0&&this.decimal.eq(1)}get isNegativeOne(){return this.im===0&&this.decimal.eq(-1)}sgn(){if(this.im===0){if(this.decimal.isZero())return 0;if(this.decimal.isPositive())return 1;if(this.decimal.isNegative())return-1}}N(){return this}neg(){return this.isZero?this:this.clone({re:this.decimal.neg(),im:-this.im})}inv(){if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(this.decimal.pow(-1));let i=Math.hypot(this.re,this.im),r=this.decimal.mul(this.decimal).add(this.im*this.im).sqrt();return this.clone({re:this.decimal.div(r),im:-this.im/i})}add(i){return typeof i=="number"?i===0?this:this.clone({re:this.decimal.add(i),im:this.im}):i.isZero?this:this.isZero?this.clone(i):this.clone({re:this.decimal.add(i.bignumRe??i.re),im:this.im+i.im})}sub(i){return this.add(i.neg())}mul(i){if(this.isZero)return this;if(i===1)return this;if(i===-1)return this.neg();if(i===0)return this.clone(0);if(this.isOne)return typeof i=="number"||i instanceof Z?this.clone(i):this.clone({re:i.bignumRe??i.re,im:i.im});if(typeof i=="number")return this.im===0?this.clone(this.decimal.mul(i)):this.clone({re:this.decimal.mul(i),im:this.im*i});if(i instanceof Z)return this.im===0?this.clone(this.decimal.mul(i)):this.clone({re:this.decimal.mul(i),im:this.im*i.toNumber()});if(this.isNegativeOne){let r=i.neg();return this.clone({re:r.bignumRe??r.re,im:r.im})}return i.isOne?this:i.isNegativeOne?this.neg():i.isZero?this.clone(0):this.im===0&&i.im===0?this.clone(this.decimal.mul(i.bignumRe??i.re)):this.clone({re:this.decimal.mul(i.bignumRe??i.re).sub(this.im*i.im),im:this.re*i.im+this.im*i.re})}div(i){if(typeof i=="number")return i===1?this:i===-1?this.neg():i===0?this.clone(NaN):this.clone({re:this.decimal.div(i),im:this.im/i});if(i.isOne)return this;if(i.isNegativeOne)return this.neg();if(i.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&i.im===0)return this.clone(this.decimal.div(i.bignumRe??i.re));let[r,n]=[this.re,this.im],[s,a]=[i.re,i.im],o=s*s+a*a,l=i.bignumRe??this.bignum(i.re),u=l.mul(l).add(a*a);return this.clone({re:this.decimal.mul(l).add(n*a).div(u),im:(n*s-r*a)/o})}pow(i){if(this.isNaN)return this;if(typeof i=="number"&&isNaN(i))return this.clone(NaN);if(i instanceof pe){if(i.isNaN)return this.clone(NaN);if(i.isZero)return this.clone(1);if(i.isOne)return this;i.im?i={re:i.re,im:i.im}:i=i.re}if(typeof i=="object"&&("re"in i||"im"in i)){let[u,c]=[(i==null?void 0:i.re)??0,(i==null?void 0:i.im)??0];if(Number.isNaN(c)||Number.isNaN(u))return this.clone(NaN);if(c===0)i=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let f=this.pow(u),p=this.decimal.ln().mul(c),h=this.clone({re:p.cos(),im:Ti(p.sin().toNumber())});return f.mul(h)}}if(this.isPositiveInfinity){if(i===-1)return this.clone(0);if(i===1/0)return this.clone(1/0);if(i===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&i===1/0)return this.clone(NaN);if((i===1/0||i===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(i===1)return this;if(i===-1)return this.inv();if(i===0)return this.clone(1);if(this.isZero){if(i>0)return this;if(i<0)return this.clone({im:1/0})}if(i<0)return this.pow(-i).inv();if(this.im===0)return this.clone(this.decimal.pow(i));let r=this.decimal,n=this.im,s=r.mul(r).add(n*n).sqrt(),a=Z.atan2(n,r),o=s.pow(i),l=a.mul(i);return this.clone({re:o.mul(l.cos()),im:Ti(o.mul(l.sin()).toNumber())})}root(i){if(!Number.isInteger(i))return this._makeExact(NaN);if(i===0)return this._makeExact(NaN);if(i===1)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):i===2?this.clone(this.decimal.sqrt()):i===3?this.clone(this.decimal.cbrt()):this.clone(this.decimal.pow(1/i));let r=this.decimal,n=this.im,s=r.mul(r).add(n*n).sqrt(),a=Z.atan2(n,r),o=s.pow(1/i),l=a.div(i);return this.clone({re:o.mul(l.cos()),im:Ti(o.mul(l.sin()).toNumber())})}sqrt(){if(this.isZero||this.isOne)return this;if(this.im!==0){let i=this.decimal,r=this.im,n=i.mul(i).add(r*r).sqrt(),s=i.add(n).div(2).sqrt(),a=Ti(Math.sign(r)*n.sub(i).div(2).sqrt().toNumber());return this.clone({re:s,im:a})}return this.decimal.isPositive()?this.clone(this.decimal.sqrt()):this.clone({im:Math.sqrt(-this.re)})}gcd(i){if(this.isZero)return i;if(i.isZero)return this;if(this.im!==0||i.im!==0)return this._makeExact(NaN);if(!this.decimal.isInteger())return this._makeExact(1);let r=this.bignum(i.bignumRe??i.re);if(!r.isInteger())return this._makeExact(1);let n=this.decimal;for(;!r.isZero();){let s=r;r=n.mod(r),n=s}return this.clone(n.abs())}abs(){return this.im===0?this.decimal.isPositive()?this:this.clone(this.decimal.neg()):this.clone(this.decimal.pow(2).add(this.im**2).sqrt())}ln(i){if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):i===void 0?this.clone(this.decimal.ln()):this.clone(this.decimal.log(i));let r=this.decimal,n=this.im,s=r.mul(r).add(n*n).sqrt(),a=Z.atan2(n,r).toNumber();return i===void 0?this.clone({re:s.ln(),im:a}):this.clone({re:s.log(i),im:a})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let i=this.decimal.exp();return this.clone({re:i.mul(Ti(Math.cos(this.im))),im:Ti(i.mul(Math.sin(this.im)).toNumber())})}return this.clone(this.decimal.exp())}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(de(this.decimal.floor()))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(de(this.decimal.ceil()))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(de(this.decimal.round()))}eq(i){return this.isNaN?!1:typeof i=="number"?this.im===0&&this.decimal.eq(i):i.isNaN?!1:Number.isFinite(this.im)?this.decimal.eq(i.bignumRe??i.re)&&this.im-i.im===0:!Number.isFinite(i.im)}lt(i){return this.im,typeof i=="number"?this.decimal.lt(i):this.decimal.lt(i.bignumRe??i.re)}lte(i){return this.im,typeof i=="number"?this.decimal.lte(i):this.decimal.lte(i.bignumRe??i.re)}gt(i){return this.im,typeof i=="number"?this.decimal.gt(i):this.decimal.gt(i.bignumRe??i.re)}gte(i){return this.im,typeof i=="number"?this.decimal.gte(i):this.decimal.gte(i.bignumRe??i.re)}};function an(e){let t=e.toString();if(e.isInteger()&&t.includes("e")){let i=e.toFixed(),r=i.match(/0+$/);if((r?r[0].length:0)<=5)return i}return t}function Ti(e){return Math.abs(e)<=1e-14?0:e}var qs=class Hu extends pe{constructor(i,r){super();m(this,"__brand");m(this,"decimal");m(this,"bignum");if(this.bignum=r,typeof i=="number")this.decimal=i,this.im=0;else if(i instanceof Z)this.decimal=i.toNumber(),this.im=0;else{let n=i.re===void 0?0:i.re instanceof Z?i.re.toNumber():i.re;this.decimal=n,this.im=i.im??0,isFinite(this.im)||(this.decimal=this.im)}isNaN(this.im)}_makeExact(i){return new _e(i,r=>this.clone(r),this.bignum)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal===0?"imaginary":"finite_complex":Number.isFinite(this.decimal)?Number.isInteger(this.decimal)?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&Number.isInteger(this.decimal)}get asExact(){if(this.isExact)return this._makeExact(this.decimal)}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.im===0?Ge(this.decimal):["Complex",Ge(this.decimal),Ge(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return ze(this.decimal);if(this.decimal===0)return this.im===1?"i":this.im===-1?"-i":`${ze(this.im)}i`;if(this.isComplexInfinity)return"~oo";let i="";return this.im===1?i="+ i":this.im===-1?i="- i":this.im>0?i=`+ ${ze(this.im)}i`:i=`- ${ze(-this.im)}i`,`(${ze(this.decimal)} ${i})`}clone(i){return new Hu(i,this.bignum)}get re(){return this.decimal}get bignumRe(){}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return Number.isNaN(this.decimal)}get isPositiveInfinity(){return!Number.isFinite(this.decimal)&&this.decimal>0&&this.im===0}get isNegativeInfinity(){return!Number.isFinite(this.decimal)&&this.decimal<0&&this.im===0}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal===0}isZeroWithTolerance(i){if(this.im!==0)return!1;let r=i instanceof Z?i.toNumber():i;return Math.abs(this.decimal)<r}get isOne(){return this.im===0&&this.decimal===1}get isNegativeOne(){return this.im===0&&this.decimal===-1}sgn(){if(!(this.im!==0||!Number.isFinite(this.decimal)))return Math.sign(this.decimal)}N(){return this}neg(){return this.isNaN?this._makeExact(NaN):this.isZero?this:this.clone({re:-this.decimal,im:-this.im})}inv(){if(this.isNaN)return this._makeExact(NaN);if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(1/this.decimal);let i=Math.hypot(this.re,this.im);return this.clone({re:this.decimal/i,im:-this.im/i})}add(i){return this.isNaN?this._makeExact(NaN):typeof i=="number"?i===0?this:this.clone({re:this.decimal+i,im:this.im}):i.isZero?this:this.isZero?this.clone({re:i.bignumRe??i.re,im:i.im}):this.clone({re:this.decimal+i.re,im:this.im+i.im})}sub(i){return this.add(i.neg())}mul(i){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this;if(i instanceof Z&&(i=i.toNumber()),i===1)return this;if(i===-1)return this.neg();if(i===0)return this.clone(0);if(this.isOne)return typeof i=="number"||i instanceof Z?this.clone(i):this.clone({re:i.bignumRe??i.re,im:i.im});if(typeof i=="number")return this.im===0?this.clone(this.decimal*i):this.clone({re:this.decimal*i,im:this.im*i});if(this.isNegativeOne){let r=i.neg();return this.clone({re:r.bignumRe??r.re,im:r.im})}return i.isOne?this:i.isNegativeOne?this.neg():i.isZero?this.clone(0):this.im===0&&i.im===0?this.clone(this.decimal*i.re):this.clone({re:this.decimal*i.re-this.im*i.im,im:this.re*i.im+this.im*i.re})}div(i){if(this.isNaN)return this._makeExact(NaN);if(typeof i=="number")return i===1?this:i===-1?this.neg():i===0?this.clone(NaN):this.clone({re:this.decimal/i,im:this.im/i});if(i.isOne)return this;if(i.isNegativeOne)return this.neg();if(i.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&i.im===0)return this.clone(this.decimal/i.re);let[r,n]=[this.decimal,this.im],[s,a]=[i.re,i.im],o=s*s+a*a;return this.clone({re:(r*s+n*a)/o,im:(n*s-r*a)/o})}pow(i){if(this.isNaN)return this._makeExact(NaN);if(typeof i=="number"&&isNaN(i))return this.clone(NaN);if(i instanceof pe){if(i.isNaN)return this.clone(NaN);if(i.isZero)return this.clone(1);if(i.isOne)return this;i.im?i={re:i.re,im:i.im}:i=i.re}if(typeof i=="object"&&("re"in i||"im"in i)){let[u,c]=[(i==null?void 0:i.re)??0,(i==null?void 0:i.im)??0];if(Number.isNaN(c)||Number.isNaN(u))return this.clone(NaN);if(c===0)i=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let f=this.pow(u).re,p=Math.log(this.decimal)*c;return this.clone({re:Ml(f*Math.cos(p)),im:Ml(f*Math.sin(p))})}}if(this.isPositiveInfinity){if(i===-1)return this.clone(0);if(i===1/0)return this.clone(1/0);if(i===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&i===1/0)return this.clone(NaN);if((i===1/0||i===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(i===1)return this;if(i===-1)return this.inv();if(i===0)return this.clone(1);if(this.isZero){if(i>0)return this;if(i<0)return this.clone({im:1/0})}if(i<0)return this.clone(1/this.decimal**-i);if(this.im===0)return this.clone(this.decimal**i);let r=this.decimal,n=this.im,s=Math.sqrt(r*r+n*n),a=Math.atan2(n,r),o=s**i,l=a**i;return this.clone({re:o*Math.cos(l),im:o*Math.sin(l)})}root(i){if(this.isNaN)return this._makeExact(NaN);if(i===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(i===1)return this;if(i===2)return this.sqrt();if(i===3)return this.clone(Math.cbrt(this.decimal));if(this.im===0)return this.decimal<0?i%2===0?this.clone(NaN):this.clone(-Math.pow(-this.decimal,1/i)):this.clone(Math.pow(this.decimal,1/i));let r=this.decimal,n=this.im,s=Math.hypot(r,n),a=Math.atan2(n,r),o=Math.pow(s,1/i),l=a/i;return this.clone({re:o*Math.cos(l),im:o*Math.sin(l)})}sqrt(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero||this.isOne)return this;if(this.im!==0){let i=this.decimal,r=this.im,n=Math.sqrt(i*i+r*r),s=Math.sqrt((i+n)/2),a=Math.sign(r)*Math.sqrt((n-i)/2);return this.clone({re:s,im:a})}return this.decimal>0?this.clone(Math.sqrt(this.decimal)):this.clone({im:Math.sqrt(-this.decimal)})}gcd(i){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return i;if(i.isZero)return this;if(this.im!==0||i.im!==0)return this._makeExact(NaN);if(!Number.isInteger(this.decimal))return this._makeExact(1);let r=i.re;if(!Number.isInteger(r))return this._makeExact(1);let n=this.decimal;for(;r!==0;){let s=r;r=n%r,n=s}return this.clone(Math.abs(n))}abs(){return this.isNaN?this._makeExact(NaN):this.im===0?this.decimal>0?this:this.clone(-this.decimal):this.clone(Math.sqrt(this.decimal**2+this.im**2))}ln(i){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal<0?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):i===void 0?this.clone(Math.log(this.decimal)):this.clone(Math.log(this.decimal)/Math.log(i));let r=this.decimal,n=this.im,s=Math.hypot(r,n),a=Math.atan2(n,r),o=i===void 0?Math.log(s):Math.log(s)/Math.log(i);return this.clone({re:o,im:a})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let i=Math.exp(this.decimal);return this.clone({re:i*Math.cos(this.im),im:i*Math.sin(this.im)})}return this.clone(Math.exp(this.decimal))}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.floor(this.decimal))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.ceil(this.decimal))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.round(this.decimal))}eq(i){return this.isNaN?!1:typeof i=="number"?this.im===0&&this.decimal-i===0:i.isNaN?!1:Number.isFinite(this.im)?this.decimal-i.re===0&&this.im-i.im===0:!Number.isFinite(i.im)}lt(i){return this.im,typeof i=="number"?this.decimal<i:this.decimal<i.re}lte(i){return this.im,typeof i=="number"?this.decimal<=i:this.decimal<=i.re}gt(i){return this.im,typeof i=="number"?this.decimal>i:this.decimal>i.re}gte(i){return this.im,typeof i=="number"?this.decimal>=i:this.decimal>=i.re}};function Ml(e){return Math.abs(e)<=1e-14?0:e}var Al=class{constructor(e,t){m(this,"engine");m(this,"terms",[]);this.engine=e;let i=0,r=0,n=[];for(let s of t){if(s.type.is("complex")&&s.isInfinity){this.terms=[{term:e.ComplexInfinity,coef:[]}];return}if(s.isNaN||s.symbol==="Undefined"){this.terms=[{term:e.NaN,coef:[]}];return}let[a,o]=s.toNumericValue();a.isPositiveInfinity?i+=1:a.isNegativeInfinity&&(r+=1),o.is(1)?a.isZero||n.push(a):this.add(a,o)}if(i>0&&r>0){this.terms=[{term:e.NaN,coef:[]}];return}if(i>0){this.terms=[{term:e.PositiveInfinity,coef:[]}];return}if(r>0){this.terms=[{term:e.NegativeInfinity,coef:[]}];return}n.length===1?this.add(n[0],e.One):n.length>0&&$l(e,n).forEach(s=>this.add(s,e.One))}add(e,t){if(t.is(0)||e.isZero)return;if(t.is(1)){let r=this.engine;this.terms.push({coef:[],term:r.number(e)});return}if(t.operator==="Add"){for(let r of t.ops){let[n,s]=r.toNumericValue();this.add(e.mul(n),s)}return}if(t.operator==="Negate"){this.add(e.neg(),t.op1);return}let i=this.find(t);if(i>=0){this.terms[i].coef.push(e);return}t.numericValue===null||t.is(1),this.terms.push({coef:[e],term:t})}find(e){return this.terms.findIndex(t=>t.term.isSame(e))}N(){let e=this.engine,t=this.terms;if(t.length===0)return e.Zero;let i=[],r=[];for(let{coef:s,term:a}of t)if(s.length===0)a.isNumberLiteral?typeof a.numericValue=="number"?r.push(e._numericValue(a.numericValue)):r.push(a.numericValue):i.push(a);else{let o=s.reduce((l,u)=>l.add(u)).N();if(o.isZero)continue;o.eq(1)?i.push(a.N()):o.eq(-1)?i.push(a.N().neg()):i.push(a.N().mul(e.box(o)))}let n=Kh(e,r);if(!n.isZero){if(i.length===0)return e.box(n);i.push(e.box(n))}return It(e,i)}asExpression(){let e=this.engine,t=this.terms;return t.length===0?e.Zero:It(e,t.map(({coef:i,term:r})=>{if(i.length===0)return r;let n=$l(e,i);if(n.length===0)return r;if(n.length>1)return De(e,[It(e,n.map(a=>e.box(a))),r]);let s=n[0];return s.isNaN?e.NaN:s.isZero?e.Zero:s.eq(1)?r:s.eq(-1)?r.neg():r.is(1)?e.box(s):r.mul(e.box(s))}))}};function $l(e,t){let i=s=>e.bignum(s),r=s=>new _e(s,n,i),n=e.precision>Jt?s=>new Cs(s,i):s=>new qs(s,r);return _e.sum(t,n,i)}function Kh(e,t){let i=a=>e.bignum(a),r=a=>new _e(a,n,i),n=e.precision>Jt?a=>new Cs(a,i):a=>new qs(a,r),s=_e.sum(t,n,i);return s.length===0?r(0):s.length===1?s[0].N():s.reduce((a,o)=>a.add(o).N())}function It(e,t){var r;if(t=fe(t,"Add"),t=t.filter(n=>n.numericValue===null||!n.is(0)),t.length===0)return e.Zero;if(t.length===1&&!t[0].isIndexedCollection)return t[0];let i=[];for(let n=0;n<t.length;n++){let s=t[n];if(s.isNumberLiteral){let a=s.numericValue;if(typeof a=="number"||_(a.type,"real")&&!a.isExact||_(a.type,"integer")){let o=t[n+1];if(o){let l=(r=un(o))==null?void 0:r.numericValue;if(l!==void 0){let u=typeof l=="number"?l:l==null?void 0:l.re;if(u!==0){let c=typeof a=="number"?a:a.re;i.push(e.number(e._numericValue({re:c,im:u??0}))),n++;continue}}}}}i.push(s)}return i.length===1?i[0]:e._fn("Add",[...i].sort(ps))}function Xh(e){return e.length===0?"finite_integer":e.length===1?e[0].type:$e(...e.map(t=>t.type.type))}function me(...e){return e.length>0,e.every(t=>t.isValid)?new Al(e[0].engine,e).asExpression():e[0].engine._fn("Add",e)}function em(...e){return e.length>0,e.every(t=>t.isValid)?(e=e.map(t=>t.isNumberLiteral?t.evaluate():t.N()),new Al(e[0].engine,e).N()):e[0].engine._fn("Add",e)}function pt(e,t){if(e.operator==="Negate"&&t.operator==="Negate")return pt(e.op1,t.op1);let i=e.engine;if(e.operator==="Negate")return pt(e.op1,t).neg();if(t.operator==="Negate")return pt(e,t.op1).neg();if(e.operator==="Divide"&&t.operator==="Divide"){let r=e.op2.mul(t.op2);return pt(e.op1,t.op1).div(r)}return e.operator==="Divide"?pt(e.op1,t).div(e.op2):t.operator==="Divide"?pt(e,t.op1).div(t.op2):e.operator==="Add"?me(...e.ops.map(r=>pt(r,t))):t.operator==="Add"?me(...t.ops.map(r=>pt(e,r))):new Mt(i,[e,t]).asExpression()}function on(e,t){if(t.length===0)return null;if(t.length===1)return t[0];if(t.length===2)return pt(t[0],t[1]);let i=on(e,t.slice(1));return i===null?null:pt(t[0],i)}var rr=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]];function Cl(e,t){for(;e>=rr.length;){let i=rr.length,r=[1],n=rr[i-1];for(let s=1;s<i;s++)r[s]=n[s-1]+n[s];r[i]=1,rr.push(r)}return rr[e][t]}function tm(e){let t=e.reduce((r,n)=>r+n,0),i=1;for(let r=0;r<e.length;r+=1)i*=Cl(t,e[r]),t-=e[r];return i}function*ql(e,t){if(e===1){yield[t];return}for(let i=0;i<=t;i+=1)for(let r of ql(e-1,t-i))yield[i,...r]}function Ds(e,t){let i=e.engine;if(t<0){let a=Ds(e,-t);return a?a.inv():null}if(t===0)return i.One;if(t===1)return ht(e);if(e.operator==="Negate"&&Number.isInteger(t)){let a=t%2===0?1:-1,o=Ds(e.op1,t);return o===null?null:a>0?o:o.neg()}if(e.operator,e.operator!=="Add")return null;let r=e.ops,n=ql(r.length,t),s=[];for(let a of n){let o=[i.number(tm(a))];for(let l=0;l<a.length;l+=1)a[l]!==0&&(a[l]===1?o.push(r[l]):o.push(r[l].pow(a[l])));s.push(Ve(...o))}return me(...s)}function im(e,t,i){var n;let r=null;if(t==="Divide"){let s=ht(i[0]);return s===null?null:s.operator==="Add"?me(...s.ops.map(a=>a.div(i[1]))):e._fn("Divide",[s,i[1]])}if(t==="Multiply")return on(e,i);if(t==="Negate")return((n=ht(i[0]))==null?void 0:n.neg())??null;if(t==="Add")return me(...i.map(s=>ht(s)??s));if(t==="Power"){let s=se(i[1]);r=s!==null?Ds(i[0],s):null}return r}function ht(e){return e=e==null?void 0:e.canonical,!e||typeof e.operator!="string"?null:Xt(e.operator)?e.engine._fn(e.operator,e.ops.map(t=>ht(t)??t)):im(e.engine,e.operator,e.ops??[])}function Ps(e){if(!e.operator||!e.ops)return null;let t=e.ops.map(r=>Ps(r)??r),i=e.engine.function(e.operator,t);return ht(i)??i}function rm(e){let t=-1;for(;e.operator==="Negate";)e=e.op1,t=-t;return t===1?e:e.isNumberLiteral?e.neg():e.engine._fn("Negate",[e])}function nr(e){let t=-1;for(;e.operator==="Negate";)e=e.op1,t=-t;if(t===1)return e;if(e.numericValue!==null)return e.neg();let i=e.engine;return e.operator==="Subtract"?e.op2.sub(e.op1):e.operator==="Add"?me(...e.ops.map(r=>nr(r))):e.operator==="Multiply"?Dl(i,e.ops):e.operator==="Divide"?nr(e.op1).div(e.op2):i._fn("Negate",[e])}function Dl(e,t){if(t.length===0)return e.NegativeOne;if(t.length===1)return nr(t[0]);let i=[],r=!1;for(let n of t)!r&&n.operator==="Negate"?(r=!0,n.op1.is(1)||i.push(n.op1)):i.push(n);if(!r){i=[];for(let n of t)r||n.numericValue===null&&!n.isInteger?i.push(n):(r=!0,n.is(-1)||i.push(n.neg()))}if(r)return e._fn("Multiply",i.sort(we));if(!r){i=[];for(let n of t)r||n.numericValue===null||!n.isNumber?i.push(n):(r=!0,n.is(-1)||i.push(n.neg()))}return r?e._fn("Multiply",i.sort(we)):e._fn("Negate",[e._fn("Multiply",[...t].sort(we))])}function Ut(e,t){let i=e.engine;if(!e.isValid||!t.isValid)return i._fn("Divide",[e,t]);if(e.isNaN||t.isNaN)return i.NaN;if(t.is(0))return e.is(0)?i.NaN:i.ComplexInfinity;if(e.is(0))return i.Zero;if(t.is(0)===!1&&(e.symbol!==null&&e.symbol===t.symbol&&e.isConstant||e.isSame(t)))return i.One;if(e.operator==="Negate"&&t.operator==="Negate"&&(e=e.op1,t=t.op1),e.operator==="Divide"&&t.operator==="Divide")return Ut(De(i,[e.op1,t.op2]),De(i,[e.op2,t.op1]));if(e.operator==="Divide")return Ut(e.op1,De(i,[e.op2,t]));if(t.operator==="Divide")return Ut(De(i,[e,t.op2]),t.op1);if(t.is(1))return e;if(t.is(-1))return e.neg();if(e.is(1))return t.inv();if(t.isInfinity)return e.isInfinity?i.NaN:i.Zero;if(e.operator==="Sqrt"&&t.operator==="Sqrt"){let c=se(e.op1),f=se(t.op1);if(c!==null&&f!==null)return i.number(i._numericValue({radical:c*f,rational:[1,f]}))}else if(e.operator==="Sqrt"){let c=se(e.op1),f=se(t);if(c!==null&&f!==null)return i.number(i._numericValue({radical:c,rational:[1,f]}))}else if(t.operator==="Sqrt"){let c=se(e),f=se(t.op1);if(c!==null&&f!==null)return i.number(i._numericValue({radical:f,rational:[c,f]}))}let r=e.numericValue,n=t.numericValue;if(r!==null&&n!==null){if(typeof r!="number"&&r.im!==0||typeof n!="number"&&n.im!==0)return i._fn("Divide",[e,t]);if(typeof r=="number"&&Number.isInteger(r)&&typeof n=="number"&&Number.isInteger(n))return i.number([r,n]);if(typeof r=="number"&&Number.isInteger(r)){if(r===0)return i.Zero;if(typeof n!="number"&&_(n.type,"integer")){let c=n.bignumRe;if(c!==void 0){if(c.isInteger())return i.number([de(r),de(c)])}else{let f=n.re;if(Number.isInteger(f))return i.number([r,f])}}}return i._fn("Divide",[e,t])}let[s,a]=e.toNumericValue();if(s.isZero)return i.Zero;let[o,l]=t.toNumericValue();if(o.isZero)return i.NaN;let u=s.div(o);return u.isOne?l.is(1)?a:i._fn("Divide",[a,l]):u.isNegativeOne?l.is(1)?a.neg():i._fn("Divide",[a.neg(),l]):u.isExact?a.is(1)&&l.is(1)?i.number(u):l.is(1)?De(i,[i.number(u),a]):i._fn("Divide",[De(i,[i.number(u.numerator),a]),De(i,[i.number(u.denominator),l])]):i._fn("Divide",[e,t])}function Fs(e,t){let i=e.engine;if(e=e.canonical,typeof t!="number"&&(t=t.canonical),e.isNaN)return i.NaN;if(typeof t=="number"){if(isNaN(t))return i.NaN;if(e.is(0))return t===0||!isFinite(t)?i.NaN:e;if(t===1)return e;if(t===-1)return e.neg();if(t===0)return i.NaN;if(e.isNumberLiteral){let n=e.numericValue;if(typeof n=="number"){if(Number.isInteger(n)&&Number.isInteger(t))return i.number(i._numericValue({rational:[n,t]}))}else if(n.isExact&&Number.isInteger(t))return i.number(n.asExact.div(t))}}else{if(t.isNaN)return i.NaN;if(e.is(0))return t.is(0)||t.isFinite===!1?i.NaN:i.Zero;if(t.is(1))return e;if(t.is(-1))return e.neg();if(t.is(0))return i.NaN;if(e.isNumberLiteral&&t.isNumberLiteral){let n=e.numericValue,s=t.numericValue;if(typeof n=="number"&&typeof s=="number"&&Number.isInteger(n)&&Number.isInteger(s))return i.number(i._numericValue({rational:[n,s]}));if(typeof n=="number"&&Number.isInteger(n)&&typeof s!="number"){if(s.isExact)return i.number(i._numericValue(n).div(s.asExact))}else if(typeof s=="number"&&Number.isInteger(s)&&typeof n!="number"){if(n.isExact)return i.number(n.asExact.div(s))}else if(typeof n!="number"&&typeof s!="number"&&n.isExact&&s.isExact)return i.number(n.asExact.div(s.asExact))}}let r=new Mt(i,[e]);return r.div(typeof t=="number"?i._numericValue(t):t),r.asRationalExpression()}function De(e,t){let i=1,r=[];for(let s of t){let[a,o]=nm(s);i*=o,r.push(a)}r=r.filter(s=>!s.is(1));let n=[];for(let s=0;s<r.length;s++){let a=r[s];if(s+1>=r.length){n.push(a);continue}let o=r[s+1];if(a.isNumberLiteral){if(o.operator==="Sqrt"&&o.op1.isNumberLiteral&&o.op1.type.matches("finite_integer")){let l=o.op1.numericValue;if(typeof l!="number"&&(l=l.re),l>=U){n.push(a);continue}if(a.type.matches("finite_rational")){let u=a.numericValue,[c,f]=typeof u=="number"?[u,1]:[u.numerator.re,u.denominator.re];n.push(e.number(e._numericValue({rational:[c,f],radical:l}))),s++;continue}}else if(o.isNumberLiteral&&o.numericValue instanceof pe){let l=o.numericValue;if(l instanceof _e&&Ue(l.rational)&&l.radical!==1){let u=Vt(a);if(u){n.push(e.number(e._numericValue({rational:u,radical:l.radical}))),s++;continue}}else if(l.im===1){let u=a.numericValue;if(typeof u=="number"){n.push(e.number(e.complex(0,u))),s++;continue}else if(u.im===0){if(Number.isInteger(u.re)){n.push(e.number(e.complex(0,u.re))),s++;continue}else if(!u.isExact){n.push(e.number(e.complex(0,u.re))),s++;continue}}}}}n.push(a)}return i<0?n.length===0?e.number(-1):n.length===1?n[0].neg():Dl(e,n):n.length===0?e.number(1):n.length===1?n[0]:e._fn("Multiply",[...n].sort(we))}function nm(e){let t=1;for(;e.operator==="Negate";)t=-t,e=e.op1;return e.isNumberLiteral&&e.isNegative&&(t=-t,e=e.neg()),[e,t]}function Ve(...e){if(e.length>0,e.length===1)return e[0];let t=e[0].engine,i=on(t,e);if(i){if(i.operator!=="Multiply")return i;e=i.ops}return new Mt(t,e).asRationalExpression()}function sm(...e){e.length>0;let t=e[0].engine;e=e.map(r=>r.N());let i=on(t,e);if(i){if(i.operator!=="Multiply")return i;e=i.ops}return new Mt(t,e).asExpression({numericApproximation:!0})}var Mt=class Qu{constructor(t,i,r){m(this,"engine");m(this,"coefficient");m(this,"terms",[]);m(this,"_isCanonical",!0);if(this.options=r,r=r?{...r}:{},"canonical"in r||(r.canonical=!0),this._isCanonical=r.canonical,this.engine=t,this.coefficient=t._numericValue(1),i)for(let n of i)this.mul(n)}static from(t){return new Qu(t.engine,[t])}mul(t,i){if(t.isCanonical||t.isStructural,this.coefficient.isNaN)return;if(t.isNaN){this.coefficient=this.engine._numericValue(NaN);return}if(t.operator==="Multiply"){for(let s of t.ops)this.mul(s,i);return}if(t.operator==="Negate"){this.mul(t.op1,i),this.coefficient=this.coefficient.neg();return}if(this._isCanonical){if(t.symbol==="Nothing")return;i??(i=[1,1]);let s=t.numericValue;if(s!==null){if(t.is(1))return;if(t.is(0)){this.coefficient=this.engine._numericValue(Rt(i)?NaN:0);return}if(t.is(-1)){Ue(i)?this.coefficient=this.coefficient.neg():this.coefficient=this.coefficient.mul(this.engine._numericValue(-1).pow(this.engine._numericValue(i)));return}if(t.isInfinity){Ue(i)?this.coefficient=this.engine._numericValue(t.isNegative?-1/0:1/0):this.terms.push({term:t,exponent:i});return}Ue(i)?this.coefficient=this.coefficient.mul(s):this.coefficient=this.coefficient.mul(this.engine._numericValue(s).pow(this.engine._numericValue(i)));return}let a=Ko(t);if(a!==null){this.coefficient=this.coefficient.mul(this.engine._numericValue({radical:a[0]*a[1],rational:[1,Number(a[1])]}).pow(this.engine._numericValue(i)));return}if(!t.symbol){let o;[o,t]=t.toNumericValue(),i&&!Ue(i)&&(o=o.pow(this.engine._numericValue(i))),this.coefficient=this.coefficient.mul(o)}}if(t.is(1)&&(!i||Ue(i))||t.is(0)===!1&&i&&Rt(i))return;if(t.is(0)){i&&Rt(i)?this.coefficient=this.engine._numericValue(NaN):this.coefficient=this.engine._numericValue(0);return}let r=i??[1,1];if(t.operator==="Power"){let s=Vt(t.op2);if(s){this.mul(t.op1,vi(r,s));return}}if(t.operator==="Sqrt"){this.mul(t.op1,vi(r,[1,2]));return}if(t.operator==="Root"){let s=Vt(t.op2);if(s){this.mul(t.op1,vi(r,sh(s)));return}}if(t.operator==="Divide"){this.mul(t.op1,r),this.mul(t.op2,Wr(r));return}let n=!1;for(let s of this.terms)if(s.term.isSame(t)){s.exponent=Ji(s.exponent,r),n=!0;break}n||this.terms.push({term:t,exponent:r})}div(t){t instanceof pe?this.coefficient=this.coefficient.div(t):this.mul(t,[-1,1])}groupedByDegrees(t){t??(t={}),"mode"in t||(t.mode="expression");let i=t.mode;if(i==="numeric"&&(this.coefficient.isNegativeInfinity||this.coefficient.isPositiveInfinity))return[];if(this.coefficient.isZero)return[];let r=this.engine;if(this.terms.length===0)if(i==="numeric"){let s=this.coefficient.N();return[{exponent:[1,1],terms:[r.number(s)]}]}else return[{exponent:[1,1],terms:[r.number(this.coefficient)]}];let n=[];if(!this.coefficient.isOne)if(i==="rational"&&this.coefficient.type==="finite_rational"){let s=this.coefficient.numerator;s.isOne||n.push({exponent:[1,1],terms:[r.number(s)]});let a=this.coefficient.denominator;a.isOne||n.push({exponent:[-1,1],terms:[r.number(a)]})}else if(i==="numeric"){let s=this.coefficient.N();n.push({exponent:[1,1],terms:[r.number(s)]})}else n.push({exponent:[1,1],terms:[r.number(this.coefficient)]});for(let s of this.terms){let a=cs(s.exponent);if(a[0]===0)continue;let o=!1;for(let l of n)if(a[0]===l.exponent[0]&&a[1]===l.exponent[1]){l.terms.push(s.term),o=!0;break}o||n.push({exponent:a,terms:[s.term]})}return n}asExpression(t={numericApproximation:!1}){let i=this.engine,r=this.coefficient;if(r.isNaN)return i.NaN;if(r.isPositiveInfinity)return i.PositiveInfinity;if(r.isNegativeInfinity)return i.NegativeInfinity;if(r.isZero)return i.Zero;let n=r.isNegativeOne;n&&(this.coefficient=i._numericValue(1));let s=this.groupedByDegrees({mode:t.numericApproximation?"numeric":"expression"});if(s===null)return i.NaN;if(n){let a=ln(i,s).neg();return this.coefficient=i._numericValue(-1),a}return ln(i,s)}asNumeratorDenominator(){let t=this.engine,i=this.coefficient;if(i.isZero)return[t.Zero,t.One];if(i.isPositiveInfinity||i.isNegativeInfinity)return this.terms.length===0?[i.isPositiveInfinity?t.PositiveInfinity:t.NegativeInfinity,t.One]:[t.NaN,t.NaN];let r=i.isNegativeOne;r&&(this.coefficient=t._numericValue(1));let n=this.groupedByDegrees({mode:"rational"});if(this.coefficient=i,n===null)return[t.NaN,t.NaN];let s=n.filter(l=>l.exponent[0]>=0),a=n.filter(l=>l.exponent[0]<0).map(l=>({exponent:Wr(l.exponent),terms:l.terms})),o=ln(t,s);return[r?o.neg():o,ln(t,a)]}asRationalExpression(){let[t,i]=this.asNumeratorDenominator();return Ut(t,i)}};function am(e,t){let i=e.engine,r=e.coefficient.gcd(t.coefficient);if(r.isOne)return[i._numericValue(1),i.One];let n=[];for(let s of e.terms){let a=t.terms.find(l=>s.term.isSame(l.term));if(!a)continue;let o=Wo(s.exponent,a.exponent);if(Ue(o))n.push(s.term);else{let[l,u]=ah(o);u===1?n.push(s.term.pow(l)):l===1?n.push(s.term.root(u)):n.push(s.term.pow(l).root(u))}}return[r,n.length===0?i.One:Ve(...n)]}function ln(e,t){let i=t.map(({terms:r,exponent:n})=>{let s=fe(r,"Multiply"),a=s.length<=1?s[0]:e._fn("Multiply",[...s].sort(we));return Ue(n)?a:a.pow(e.number(n))});return i=fe(i,"Multiply"),i.length===0?e.One:i.length===1?i[0]:e._fn("Multiply",i.sort(we))}function Pl(e,t,i,r,n){if(t.numericValue!==null&&t.isNegative){let s=t.numericValue;if(typeof s=="number")return F(e,"Subtract",[i,e.number(-s)],r,n);if(t.type.matches("rational"))return F(e,"Subtract",[i,e.number(s.neg())],r,n)}return t.operator==="Negate"&&i.operator!=="Negate"?F(e,"Subtract",[i,t.op1],r,n):null}function om(e,t,i,r,n){var a,o,l,u,c;let s=r.exclude;if(t==="Add"&&i.length===2&&!s.includes("Subtract")){let f=Pl(e,i[0],i[1],r,n)??Pl(e,i[1],i[0],r,n);if(f)return f}if(t==="Divide"&&i.length===2&&s.includes("Divide"))return F(e,"Multiply",[i[0],e._fn("Power",[i[1],e.NegativeOne])],r,n);if(t==="Multiply"&&!s.includes("Negate")&&i[0].im===0&&i[0].re===-1)return i.length===2?F(e,"Negate",[i[1]],r):F(e,"Negate",[e._fn("Multiply",[...i.slice(1)].sort(we))],r,n);if(t==="Multiply"&&!s.includes("Divide")){let f=new Mt(e,i,{canonical:!1}).asRationalExpression();if(f.operator==="Divide")return F(e,f.operator,f.ops,r,n)}if(t==="Power"){if(!s.includes("Exp")&&((a=i[0])==null?void 0:a.symbol)==="ExponentialE")return F(e,"Exp",[i[1]],r,n);if(((o=i[1])==null?void 0:o.numericValue)!==null){let f=se(i[1]);if(f===2&&!s.includes("Square"))return F(e,"Square",[i[0]],r,n);if(f!==null&&f<0&&!s.includes("Divide"))return F(e,"Divide",[e.One,f===-1?i[0]:i[0].pow(-f)],r,n);let p=i[1].re;if(!s.includes("Sqrt")&&p===.5)return F(e,"Sqrt",[i[0]],r,n);if(!s.includes("Sqrt")&&p===-.5)return F(e,"Divide",[e.One,e._fn("Sqrt",[i[0]])],r,n);if(bi(p)){let h=ih(p),d=rh(p);if(h===1){if(!s.includes("Sqrt")&&d===2)return F(e,"Sqrt",[i[0]],r,n);if(!s.includes("Root"))return F(e,"Root",[i[0],e.number(p[1])],r,n)}if(h===-1){if(!s.includes("Sqrt")&&d===2)return F(e,"Divide",[e.One,e._fn("Sqrt",[i[0]])],r,n);if(!s.includes("Root"))return F(e,"Divide",[e.One,e._fn("Root",[i[0],e.number(p[1])])],r,n)}}}}if(t==="Add"&&i.length===2&&!s.includes("Subtract")){if(((l=i[1])==null?void 0:l.numericValue)!==null){let f=se(i[1]);if(f!==null&&f<0)return F(e,"Subtract",[i[0],e.number(-f)],r,n)}if(((u=i[1])==null?void 0:u.operator)==="Negate")return F(e,"Subtract",[i[0],i[1].op1],r,n)}if(t==="Tuple"){if(i.length===1&&!s.includes("Single"))return F(e,"Single",i,r,n);if(i.length===2&&!s.includes("Pair"))return F(e,"Pair",i,r,n);if(i.length===3&&!s.includes("Triple"))return F(e,"Triple",i,r,n)}if(t==="Function"&&i.length>0&&i[0].operator==="Block"){let f=i[0];if(f.nops===1){let p=i.slice(1);return p.every(h=>/_\d?/.test(h.symbol))?(c=f.op1.ops)!=null&&c.every((h,d)=>{var y;return h.symbol===((y=p[d])==null?void 0:y.symbol)})?F(e,"Function",[e.symbol(f.op1.operator,{canonical:!1})],r,n):F(e,"Function",[f.op1],r,n):F(e,"Function",[f.op1,...i.slice(1)],r,n)}}return F(e,t,i,r,n)}function F(e,t,i,r,n){var l,u;let s=r.exclude;if(t==="Negate"&&i.length===1){let c=(l=i[0])==null?void 0:l.numericValue;if(c!==null){if(typeof c=="number")return et(e,-c,r);if(c instanceof Z||c instanceof W)return et(e,c.neg(),r);if(bi(c))return et(e,Wr(c),r)}}if(typeof t=="string"&&s.includes(t)){if(t==="Rational"&&i.length===2)return F(e,"Divide",i,r,n);if(t==="Complex"&&i.length===2)return F(e,"Add",[i[0],e._fn("Multiply",[i[1]??e.symbol("Undefined"),e.I])],r,n);if(t==="Sqrt"&&i.length===1)return F(e,"Power",[i[0],s.includes("Half")?e.number([1,2]):e.Half],r,n);if(t==="Root"&&i.length===2&&((u=i[1])==null?void 0:u.numericValue)!==null){let c=se(i[1]);if(c===2)return F(e,"Sqrt",[i[0]],r);if(c!==null)return c<0?F(e,"Divide",[e.One,e._fn("Power",[i[0]??e.symbol("Undefined"),e.number([1,-c])])],r,n):F(e,"Power",[i[0],e.number([1,-c])],r,n)}if(t==="Square"&&i.length===1)return F(e,"Power",[i[0],e.number(2)],r,n);if(t==="Exp"&&i.length===1)return F(e,"Power",[e.E,i[0]],r,n);if(t==="Pair"||t=="Single"||t==="Triple")return F(e,"Tuple",i,r,n);if(t==="Subtract"&&i.length===2)return F(e,"Add",[i[0],e._fn("Negate",[i[1]??e.symbol("Undefined")])],r,n);if(t==="Subtract"&&i.length===1)return F(e,"Negate",i,r,n)}let a=[t,...i.map(c=>c?Ol(e,c,r):"Undefined")],o={...n??{}};return r.metadata.includes("latex")?o.latex=o.latex??e.box({fn:a}).latex:o.latex="",r.metadata.includes("wikidata")||(o.wikidata=""),!o.latex&&!o.wikidata&&r.shorthands.includes("function")?a:o.latex&&o.wikidata?{fn:a,latex:o.latex,wikidata:o.wikidata}:o.latex?{fn:a,latex:o.latex}:o.wikidata?{fn:a,wikidata:o.wikidata}:{fn:a}}function lm(e,t){return e=e,t.shorthands.includes("string")?zt(e)||vt(e)?`'${e}'`:e:{str:e}}function Gt(e,t,i,r){if(t==="Half"&&i.exclude.includes("Half"))return et(e,[1,2],i,r);if(r={...r},i.metadata.includes("latex")?(r.latex=r.latex??e.box({sym:t}).latex,r.latex!==void 0&&(r.latex=r.latex)):r.latex=void 0,i.metadata.includes("wikidata")){if(r.wikidata===void 0){let n=e.lookupDefinition(t);if(n){let s=le(n)?n.operator.wikidata:n.value.wikidata;s!==void 0&&(r.wikidata=s)}}}else r.wikidata=void 0;return t=t,r.latex===void 0&&r.wikidata===void 0&&i.shorthands.includes("symbol")?vt(t)?t:`\`${t}\``:r.latex!==void 0&&r.wikidata!==void 0?{sym:t,latex:r.latex,wikidata:r.wikidata}:r.latex!==void 0?{sym:t,latex:r.latex}:r.wikidata!==void 0?{sym:t,wikidata:r.wikidata}:{sym:t}}function Fl(e,t){if(!t.repeatingDecimal)return e;let[i,r,n,s]=e.match(/^(.*)\.([0-9]+)([e|E][-+]?[0-9]+)?$/)??[];if(!n)return e.toLowerCase();let a=n[n.length-1];n=n.slice(0,-1);let o=16,l="";for(let u=0;u<n.length-o;u++){l=n.substring(0,u);for(let c=0;c<=o;c++){let f=n.substring(u,u+c+1),p=Math.floor((n.length-l.length)/f.length);if(p<3)break;if((l+f.repeat(p+1)).startsWith(n))return f==="0"?a==="0"?r+"."+l+(s??""):e:r+"."+l+"("+f+")"+(s??"")}}for(n+=a;n.endsWith("0");)n=n.slice(0,-1);return typeof t.fractionalDigits=="number"&&(n=n.slice(0,t.fractionalDigits)),s?`${r}.${n}${s.toLowerCase()}`:`${r}.${n}`}function et(e,t,i,r){r={...r},i.metadata.includes("latex")||(r.latex=void 0);let n=r.latex===void 0&&r.wikidata===void 0&&!i.metadata.includes("latex")&&i.shorthands.includes("number"),s=i.exclude;if(t instanceof pe){if(t.isNaN)return Gt(e,"NaN",i,r);if(t.isPositiveInfinity)return Gt(e,"PositiveInfinity",i,r);if(t.isNegativeInfinity)return Gt(e,"NegativeInfinity",i,r);if(t.isComplexInfinity)return Gt(e,"ComplexInfinity",i,r);if(n){if(t.isZero)return 0;if(t.isOne)return 1;if(t.isNegativeOne)return-1}if(t instanceof _e){t.im;let l=u=>Yi(u)?et(e,t.rational[0],i):["Rational",et(e,t.rational[0],i),et(e,t.rational[1],i)];return t.radical===1?l(t.rational):Ue(t.rational)?["Sqrt",t.radical]:us(t.rational)?["Negate",["Sqrt",t.radical]]:t.rational[0]==1?["Divide",["Sqrt",t.radical],et(e,t.rational[1],i)]:t.rational[0]==-1?["Negate",["Divide",["Sqrt",t.radical],et(e,t.rational[1],i)]]:["Multiply",l(t.rational),["Sqrt",t.radical]]}if(t.im===0){let l=t.bignumRe??t.re;return et(e,l,i,r)}return Number.isFinite(t.im)?F(e,"Complex",[e.number(t.bignumRe??t.re),e.number(t.im)],i,{...r,wikidata:"Q11567"}):Gt(e,"ComplexInfinity",i,r)}let a="";if(t instanceof Z){let l;if(t.isNaN())l="NaN";else if(!t.isFinite())l=t.isPositive()?"PositiveInfinity":"NegativeInfinity";else{if(n&&sn(t))return t.toNumber();if(t.isInteger()&&t.e<t.precision()+4)a=t.toFixed(0);else{let u=i.fractionalDigits,c;if(u==="max"?c=t.toString():u==="auto"?c=t.toPrecision(e.precision):c=t.toDecimalPlaces(u).toString(),a=Fl(c,i),n){let f=t.toNumber();if(f.toString()===a)return f}}}return i.metadata.includes("latex")&&(r.latex=r.latex??e.box(l??{num:a}).latex),l?r.latex!==void 0?{sym:l,latex:r.latex}:n?l:{sym:l}:r.latex!==void 0?{num:a,latex:r.latex}:n?a:{num:a}}if(t instanceof W)return t.isInfinite()?Gt(e,"ComplexInfinity",i,r):t.isNaN()?(a="NaN",i.metadata.includes("latex")&&(r.latex=r.latex??e.box({num:a}).latex),r.latex!==void 0?{num:a,latex:r.latex}:{num:a}):F(e,"Complex",[e.number(t.re),e.number(t.im)],i,{...r,wikidata:"Q11567"});if(bi(t)){let l=!s.includes("Rational");return n&&i.shorthands.includes("function")&&re(t)?t[0]===1&&t[1]===2&&!s.includes("Half")?Gt(e,"Half",i,r):[l?"Rational":"Divide",t[0],t[1]]:F(e,l?"Rational":"Divide",[e.number(t[0]),e.number(t[1])],i,{...r})}if(typeof t=="bigint")if(t>=Number.MIN_SAFE_INTEGER&&t<=Number.MAX_SAFE_INTEGER)t=Number(t);else return i.metadata.includes("latex")&&(r.latex=r.latex??e.box({num:t.toString()}).latex),r.latex!==void 0?{num:t.toString(),latex:r.latex}:n?Ge(t,i.fractionalDigits):{num:ze(t,i.fractionalDigits)};let o;return Number.isNaN(t)?o="NaN":Number.isFinite(t)?a=Fl(t.toString(),i):o=t>0?"PositiveInfinity":"NegativeInfinity",i.metadata.includes("latex")&&(r.latex=r.latex??e.box({num:a}).latex),o?r.latex!==void 0?{sym:o,latex:r.latex}:n?o:{sym:o}:r.latex!==void 0?{num:a,latex:r.latex}:n&&a===t.toString()?t:{num:a}}function Ol(e,t,i){let r=t.wikidata;return t.numericValue!==null?et(e,t.numericValue,i,{latex:t.verbatimLatex}):t.rank>0?t.json:t.string!==null?lm(t.string,i):t.symbol!==null?Gt(e,t.symbol,i,{latex:t.verbatimLatex,wikidata:r}):t.ops?t.isValid&&(t.isCanonical||t.isStructural)&&i.prettify?om(e,t.operator,t.structural.ops,i,{latex:t.verbatimLatex,wikidata:r}):F(e,t.operator,t.structural.ops,i,{latex:t.verbatimLatex,wikidata:r}):t.json}var ge=class{constructor(e,t){m(this,"engine");m(this,"verbatimLatex");this.engine=e,(t==null?void 0:t.latex)!==void 0&&(this.verbatimLatex=t.latex)}valueOf(){var e;try{return this.symbol==="True"?!0:this.symbol==="False"?!1:this.symbol==="NaN"?NaN:this.symbol==="PositiveInfinity"?1/0:this.symbol==="NegativeInfinity"?-1/0:this.symbol==="ComplexInfinity"?"~oo":this.isInfinity?this.isPositive?1/0:this.isNegative?-1/0:"~oo":typeof this.string=="string"?this.string:typeof this.symbol=="string"?((e=this.value)==null?void 0:e.valueOf())??this.symbol:nn(this)}catch(t){if(t instanceof Bt){let i=t.message??"<canceled>";return t.cause?`${i}: ${t.cause}`:`${i}`}return t.message?t.message:"<error>"}}[Symbol.toPrimitive](e){if(e==="number"){let t=this.valueOf();return typeof t=="number"?t:null}return this.toString()}toString(){try{if(this.isLazyCollection){let e=this.evaluate({materialization:!0});if(!e.isLazyCollection)return nn(e)}return nn(this)}catch(e){if(e instanceof Bt){let t=e.message??"<canceled>";return e.cause?`${t}: ${e.cause}`:`${t}`}return e.message?e.message:"<error>"}}toLatex(e){if(this.isLazyCollection){let r=this.evaluate({materialization:(e==null?void 0:e.materialization)??!0});if(!r.isLazyCollection)return r.toLatex(e)}let t=this.toMathJson({prettify:(e==null?void 0:e.prettify)??!0}),i={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.engine.decimalSeparator,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",digitGroup:3,truncationMarker:"\\ldots",repeatingDecimal:"vinculum",fractionalDigits:"max",notation:"auto",avoidExponentsInRange:[-7,20],prettify:!0,materialization:!1,invisibleMultiply:"",invisiblePlus:"",multiply:"\\times",missingSymbol:"\\blacksquare",applyFunctionStyle:tp,groupStyle:ip,rootStyle:rp,fractionStyle:np,logicStyle:sp,powerStyle:ap,numericSetStyle:op};return(e==null?void 0:e.fractionalDigits)==="auto"?i.fractionalDigits=-this.engine.precision:i.fractionalDigits=(e==null?void 0:e.fractionalDigits)??"max",typeof i.fractionalDigits=="number"&&i.fractionalDigits>this.engine.precision&&(i.fractionalDigits=this.engine.precision),i={...i,...e??{},fractionalDigits:i.fractionalDigits},!i.prettify&&this.verbatimLatex?this.verbatimLatex:Hh(t,this.engine._indexedLatexDictionary,i)}get latex(){return this.toLatex()}toJSON(){return this.json}toMathJson(e){var r,n;let t={exclude:[],shorthands:["function","symbol","string","number"],metadata:[],fractionalDigits:"max",repeatingDecimal:!0,prettify:!0};e&&((typeof e.shorthands=="string"&&e.shorthands==="all"||(r=e.shorthands)!=null&&r.includes("all"))&&(t.shorthands=["function","symbol","string","number"]),Array.isArray(e.shorthands)&&(t.shorthands=e.shorthands),(typeof e.metadata=="string"&&e.metadata==="all"||(n=e.metadata)!=null&&n.includes("all"))&&(t.metadata=["latex","wikidata"]),e.fractionalDigits==="auto"&&(t.fractionalDigits=-this.engine.precision),typeof e.fractionalDigits=="number"&&(t.fractionalDigits=e.fractionalDigits));let i={...t,...e,fractionalDigits:t.fractionalDigits,shorthands:t.shorthands,metadata:t.metadata};return Ol(this.engine,this,i)}print(){let e=console.info;e==null||e(this.toString())}get isStructural(){return!0}get canonical(){return this}get structural(){return this}get isValid(){return!0}get isPure(){return!1}get isConstant(){return!0}get isNumberLiteral(){return!1}get numericValue(){return null}toNumericValue(){return[this.engine._numericValue(1),this]}get isEven(){}get isOdd(){}get re(){return NaN}get im(){return NaN}get bignumRe(){}get bignumIm(){}get sgn(){}get isPositive(){}get isNonNegative(){}get isNegative(){}get isNonPositive(){}neg(){return this.engine.NaN}inv(){return this.engine.NaN}abs(){return this.engine.NaN}add(e){return this.engine.NaN}sub(e){return this.add(e.neg())}mul(e){return this.engine.NaN}div(e){return this.engine.NaN}pow(e){return this.engine.NaN}root(e){return this.engine.NaN}sqrt(){return this.engine.NaN}ln(e){return this.engine.NaN}get numerator(){return this}get denominator(){return this.engine.One}get numeratorDenominator(){return[this,this.engine.One]}is(e){var t,i,r;return typeof e=="number"||typeof e=="bigint"||e==null?!1:typeof e=="boolean"?e===!0?((t=this.value)==null?void 0:t.symbol)==="True":e===!1?((i=this.value)==null?void 0:i.symbol)==="False":!1:typeof e=="string"?((r=this.value)==null?void 0:r.string)===e:Hi(this,this.engine.box(e))}isSame(e){return Hi(this,e)}isEqual(e){return Bo(this,e)}isLess(e){let t=Gr(this,e);if(t!==void 0)return t==="<"}isLessEqual(e){let t=Gr(this,e);if(t!==void 0)return t==="<="||t==="<"||t==="="}isGreater(e){let t=Gr(this,e);if(t!==void 0)return t===">"}isGreaterEqual(e){let t=Gr(this,e);if(t!==void 0)return t===">="||t===">"||t==="="}get symbol(){return null}get tensor(){return null}get string(){return null}getSubexpressions(e){return zl(this,e)}get subexpressions(){return this.getSubexpressions("")}get symbols(){let e=new Set;return Ll(this,e),Array.from(e).sort()}get unknowns(){let e=new Set;return Rl(this,e),Array.from(e).sort()}get errors(){return this.getSubexpressions("Error")}get isFunctionExpression(){return!1}get ops(){return null}get isScoped(){return!1}get localScope(){}get nops(){return 0}get op1(){return this.engine.Nothing}get op2(){return this.engine.Nothing}get op3(){return this.engine.Nothing}get isNaN(){}get isInfinity(){}get isFinite(){}get shape(){return[]}get rank(){return 0}subs(e,t){return(t==null?void 0:t.canonical)===!0?this.canonical:this}map(e,t){if(!this.ops)return e(this);let i=(t==null?void 0:t.canonical)??this.isCanonical,r=(t==null?void 0:t.recursive)??!0,n=this.ops.map(s=>r?s.map(e,t):e(s));return e(this.engine.function(this.operator,n,{canonical:i}))}solve(e){return null}replace(e){return null}has(e){return!1}get description(){if(this.baseDefinition&&this.baseDefinition.description)return typeof this.baseDefinition.description=="string"?[this.baseDefinition.description]:this.baseDefinition.description}get url(){var e;return((e=this.baseDefinition)==null?void 0:e.url)??void 0}get wikidata(){var e;return((e=this.baseDefinition)==null?void 0:e.wikidata)??void 0}get complexity(){}get baseDefinition(){}get valueDefinition(){}get operatorDefinition(){}infer(e,t){return!1}bind(){}reset(){}get value(){}set value(e){throw new Error(`Can't change the value of \\(${this.toString()}\\)`)}get type(){return $.unknown}set type(e){throw new Error(`Can't change the type of \\(${this.toString()}\\)`)}get isNumber(){}get isInteger(){}get isRational(){}get isReal(){}simplify(e){return this}expand(){return ht(this)??this}evaluate(e){return this.simplify()}evaluateAsync(e){return Promise.resolve(this.evaluate())}N(){return this.evaluate({numericApproximation:!0})}compile(e){try{if(e!=null&&e.to&&e.to!=="javascript")throw new Error(`Unexpected compilation target "${e.to}"`);return e??(e={}),Oh(this,e.functions,e.vars,e.imports,e.preamble)}catch(t){if((e==null?void 0:e.fallback)??!0)return eh(this);throw t}}get isCollection(){return!1}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}xcontains(e){}subsetOf(e,t){}get xsize(){}get isEmptyCollection(){if(!this.isCollection)return;let e=this.xsize;if(e!==void 0)return e===0}get isFiniteCollection(){if(!this.isCollection)return;let e=this.xsize;if(e!==void 0)return Number.isFinite(e)}each(){return(function*(){})()}at(e){}get(e){}indexWhere(e){}};function zl(e,t){let i=!t||e.operator===t?[e]:[];if(e.ops)for(let r of e.ops)i.push(...zl(r,t));return i}function Ll(e,t){if(e.symbol){t.add(e.symbol);return}if(e.ops)for(let i of e.ops)Ll(i,t)}function Rl(e,t){var i;if(e.symbol){let r=e.symbol;if(r==="Unknown"||r==="Undefined"||r==="Nothing"||(i=e.valueDefinition)!=null&&i.isConstant||e.operatorDefinition)return;e.engine._getSymbolValue(r)===void 0&&t.add(r);return}if(e.ops)for(let r of e.ops)Rl(r,t)}var Ei=class{constructor(e,t,i){m(this,"name");m(this,"wikidata");m(this,"description");m(this,"url");m(this,"_engine");m(this,"_defValue");m(this,"_value");m(this,"_type");m(this,"inferredType");m(this,"_isConstant",!1);m(this,"holdUntil","evaluate");m(this,"eq");m(this,"neq");m(this,"cmp");m(this,"collection");if(this._engine=e,this.name=t,i.wikidata&&(this.wikidata=i.wikidata),i.description&&(this.description=i.description),i.url&&(this.url=i.url),i.holdUntil&&(this.holdUntil=i.holdUntil),i.isConstant&&(this._isConstant=i.isConstant,this._defValue=i.value),i.type){let r=i.type instanceof $?i.type:R(i.type);if(!Mr(r))throw new Error([`Symbol "${this.name}"`,`The type "${i.type}" is invalid `].join(`
|   `));this._type=new $(r,e._typeResolver),this.inferredType=i.inferred??!1,e.listenToConfigurationChange(this)}if(this._value=Vl(this._engine,i.value),this._value){if(!this._type||this._type.isUnknown)this.isConstant?(this._type=this._value.type,this.inferredType=!1):(this._type=um(e,this._value),this.inferredType=!0);else if(!this._value.type.matches(this._type))throw new Error([`Symbol "${this.name}"`,`The value "${this._value.toString()}" of type "${this._value.type}" is not compatible with the type "${this._type}"`].join(`
|   `))}if(i.eq&&(this.eq=i.eq),i.neq&&(this.neq=i.neq),i.cmp&&(this.cmp=i.cmp),i.collection&&(this.collection=Ro(i.collection)),this.holdUntil==="never"&&!this.isConstant)throw new Error([`Symbol "${this.name}"`,'The "holdUntil" property cannot be "never" for a non-constant symbol'].join(`
|   `))}toJSON(){let e={name:this.name,isConstant:this._isConstant};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),this._type&&(e.type=this._type.toString()),e.inferredType=this.inferredType,e.holdUntil=this.holdUntil,this.collection&&(e.collection=this.collection),e}get isConstant(){return this._isConstant}get value(){return this._value===null&&(this._value=Vl(this._engine,this._defValue)),this._value}get type(){var e;return this._type??((e=this._value)==null?void 0:e.type)??$.unknown}set type(e){if(this._isConstant)throw new Error(`The type of the constant "${this.name}" cannot be changed`);this._type=e instanceof $?e:new $(e,this._engine._typeResolver),this._type.isUnknown&&(this._defValue=void 0,this._value=void 0)}onConfigurationChange(){this.isConstant&&(this._value=null)}};function Vl(e,t){if(t!==void 0)return Kn(t)?e.parse(t)??e.symbol("Undefined"):typeof t=="function"?e.box(t(e)??"Undefined"):t instanceof ge?t:e.box(t)}function um(e,t){return t?t.type.matches("integer")?e.type("integer"):t.type.matches("rational")||t.type.matches("real")?e.type("real"):t.type.matches("complex")?e.type("number"):t.type:e.type("unknown")}function cm(e){return e!=null&&e instanceof ge&&e.type.matches("dictionary")}function Ii(e){return e instanceof ge}function be(e){return e.precision>Jt}function Mi(e){let t=0;for(let i=0;i<e.length;i++)t=Math.imul(31,t)+e.charCodeAt(i)|0;return Math.abs(t)}function Os(e){return e==null?[]:typeof e=="string"?[e]:Ii(e)?Os(e.symbol):typeof e[Symbol.iterator]=="function"?Array.from(e).map(t=>typeof t=="string"?t:t.symbol):[]}function zs(e){return e.symbol==="Numbers"?"number":e.symbol==="ComplexNumbers"?"complex":e.symbol==="ImaginaryNumbers"?"imaginary":e.symbol==="RealNumbers"?"real":e.symbol==="RationalNumbers"?"rational":e.symbol==="Integers"?"integer":"unknown"}function fm(e){if(!e)return e;let t=e.engine,i=t.angularUnit;return i==="rad"||(i==="deg"&&(e=e.mul(t.Pi).div(180)),i==="grad"&&(e=e.mul(t.Pi).div(200)),i==="turn"&&(e=e.mul(t.Pi).mul(2))),e}function Bl(e){if(!e)return e;let t=fm(e);if(!t)return;if(t.N().im!==0)return t;let i=t.engine,[r,n]=ni(t);if(r.isZero)return i.number(n);let s=i._numericValue(r.bignumRe?r.bignumRe.mod(2):r.re%2);return i.number(n.add(i.Pi.mul(s).N().numericValue))}function un(e){var i,r;if(typeof e=="number")return;let t=e.engine;if(e.symbol==="ImaginaryUnit")return t.One;if(e.re===0)return t.number(e.im);if(e.operator==="Negate")return(i=un(e.op1))==null?void 0:i.neg();if(e.operator==="Complex")return e.op1.is(0)&&!isNaN(e.op2.re)?t.number(e.op2.re):void 0;if(e.operator==="Multiply"&&e.nops===2){let[n,s]=e.ops;if(n.symbol==="ImaginaryUnit")return s;if(s.symbol==="ImaginaryUnit")return n;if(s.isNumberLiteral&&s.re===0&&s.im!==0)return n.mul(s.im);if(n.isNumberLiteral&&n.re===0&&n.im!==0)return s.mul(n.im)}if(e.operator==="Divide"){let n=e.op2;return n.is(0)||(r=un(e.op1))==null?void 0:r.div(n)}}function Ls(e){let{engine:t}=e;return e===t.I?!0:e.isNumberLiteral?e.re===0&&e.im===1:e.symbol!==null?e.canonical.isSame(t.I):!1}function ni(e){let t=e.engine;if(e.symbol==="Pi")return[t._numericValue(1),t._numericValue(0)];if(e.operator==="Negate"){let[i,r]=ni(e.ops[0]);return[i.neg(),r.neg()]}if(e.operator==="Add"&&e.nops===2){let[i,r]=ni(e.op1),[n,s]=ni(e.op2);return[i.add(n),r.add(s)]}if(e.operator==="Multiply"&&e.nops===2){if(e.op1.isNumberLiteral){let[i,r]=ni(e.op2),n=e.op1.numericValue;return[i.mul(n),r.mul(n)]}if(e.op2.isNumberLiteral){let[i,r]=ni(e.op1),n=e.op2.numericValue;return[i.mul(n),r.mul(n)]}}if(e.operator==="Divide"&&e.op2.isNumberLiteral){let[i,r]=ni(e.op1),n=e.op2.numericValue;return[i.div(n),r.div(n)]}return[t._numericValue(0),t._numericValue(e.N().numericValue??0)]}function Rs(e){if(e==null||typeof e!="object"||Ii(e))return!1;if(("signature"in e||"complexity"in e)&&"constant"in e)throw new Error("Operator definition cannot have a `constant` field and value definition cannot have a `signature` field.");if(!("evaluate"in e)&&!("signature"in e)&&!("sgn"in e)&&!("complexity"in e)&&!("canonical"in e))return!1;if("type"in e&&e.type!==void 0&&typeof e.type!="function")throw new Error("The `type` field of an operator definition should be a function");if("sgn"in e&&e.sgn!==void 0&&typeof e.sgn!="function")throw new Error("The `sgn` field of an operator definition should be a function");return!0}function Vs(e){if(e==null||typeof e!="object"||Ii(e))return!1;if("value"in e||"constant"in e||"inferred"in e){if("type"in e&&typeof e.type=="function")return!1;if("signature"in e)throw new Error("Value definition cannot have a `signature` field. Use a `type` field instead.");if("sgn"in e)throw new Error("Value definition cannot have a `sgn` field. Use a `flags.sgn` field instead.");return!0}if("type"in e&&e.type!==void 0&&typeof e.type!="function")return!0;if("description"in e)throw new Error("Definitions should have a `type` or `value` field.");return!1}function oe(e){return e!==void 0&&"value"in e}function le(e){return e!==void 0&&"operator"in e}function cn(e,t,i,r){r instanceof Ei?(delete i.operator,i.value=r.value):Vs(r)?(delete i.operator,i.value=new Ei(e,t,r)):r instanceof gs?(delete i.value,i.operator=r):Rs(r)&&(delete i.value,i.operator=new gs(e,t,r))}function At(e,t,i){if(t=fe(t),!e.strict||t.length===i)return t;let r=[...t.slice(0,i)],n=Math.min(i,t.length);for(;n<i;)r.push(e.error("missing")),n+=1;for(;n<t.length;)r.push(e.error("unexpected-argument",t[n].toString())),n+=1;return r}function je(e,t,i){var o,l,u,c;let r=typeof i=="number"?i:i==null?void 0:i.count,n=typeof i=="number"||i==null?void 0:i.flatten;if(t=fe(t,n),!e.strict){let f="real";for(let p of t)if(_("complex",p.type.type)){f="number";break}for(let p of t)Ie(p)||p.infer(f);return t}let s=!0;r??(r=t.length);let a=[];for(let f=0;f<=Math.max(r-1,t.length-1);f++){let p=t[f];if(f>r-1)s=!1,a.push(e.error("unexpected-argument",p.toString()));else if(p===void 0)s=!1,a.push(e.error("missing"));else if(!p.isValid)s=!1,a.push(p);else if(p.isNumber)a.push(p);else if(p.symbol&&!e.lookupDefinition(p.symbol))a.push(p);else if(p.type.isUnknown)a.push(p);else if(Ie(p)){for(let h of p.each())if(!h.isNumber){s=!1;break}s?a.push(p):a.push(e.typeError("number",p.type,p))}else(o=p.valueDefinition)!=null&&o.inferredType&&_("number",p.type.type)||(l=p.operatorDefinition)!=null&&l.inferredSignature&&_("number",p.type.type)||p.operator==="Hold"||((c=(u=p.valueDefinition)==null?void 0:u.value)==null?void 0:c.operator)==="Hold"?a.push(p):(s=!1,a.push(e.typeError("number",p.type,p)))}if(s){let f="real";for(let p of a)if(_("complex",p.type.type)){f="number";break}for(let p of a)if(Ie(p))for(let h of p.each())h.infer(f);else p.infer(f)}return a}function ke(e,t,i){return t==null?e.error("missing"):i===void 0?e.error("unexpected-argument",t.toString()):(t=t.canonical,!t.isValid||t.type.matches(i)?t:e.typeError(i,t.type,t))}function Bs(e,t,i){if(t.length===i.length&&t.every((n,s)=>n.type.matches(i[s])))return t;let r=[];for(let n=0;n<=i.length-1;n++)r.push(ke(e,t[n],i[n]));for(let n=i.length;n<=t.length-1;n++)r.push(e.error("unexpected-argument",t[n].toString()));return r}function fn(e,t,i,r,n){var p,h,d,y,x,T,C,I;if(!e.strict||typeof i=="string"||i.kind!=="signature")return null;let s=[],a=!0,o=((p=i.args)==null?void 0:p.map(E=>E.type))??[],l=((h=i.optArgs)==null?void 0:h.map(E=>E.type))??[],u=(d=i.variadicArg)==null?void 0:d.type,c=i.variadicMin??0,f=0;for(let E of o){let w=t[f++];if(!w){s.push(e.error("missing")),a=!1;continue}if(r){s.push(w);continue}if(!w.isValid){s.push(w),a=!1;continue}if(w.type.isUnknown){s.push(w);continue}if(n&&Ie(w)){s.push(w);continue}if((y=w.valueDefinition)!=null&&y.inferredType&&w.type.matches(E)){s.push(w);continue}if((x=w.operatorDefinition)!=null&&x.inferredSignature&&w.type.matches(E)){s.push(w);continue}if(!w.type.matches(E)){s.push(e.typeError(E,w.type,w)),a=!1;continue}s.push(w)}for(let E of l){let w=t[f];if(!w)break;if(r){s.push(w),f+=1;continue}if(!w.isValid){s.push(w),a=!1,f+=1;continue}if(w.type.isUnknown){s.push(w),f+=1;continue}if(n&&Ie(w)){s.push(w),f+=1;continue}if((T=w.valueDefinition)!=null&&T.inferredType&&w.type.matches(E)){s.push(w),f+=1;continue}if(!w.type.matches(E)){s.push(e.typeError(E,w.type,w)),a=!1,f+=1;continue}s.push(w),f+=1}if(u){let E=0;for(let w of t.slice(f)){if(f+=1,E+=1,r){s.push(w);continue}if(!w.isValid){s.push(w),a=!1;continue}if(w.type.isUnknown){s.push(w);continue}if(n&&Ie(w)){s.push(w);continue}if((C=w.valueDefinition)!=null&&C.inferredType&&w.type.matches(u)){s.push(w);continue}if(!w.type.matches(u)){s.push(e.typeError(u,w.type,w)),a=!1;continue}s.push(w)}E<c&&(s.push(e.error("missing")),a=!1)}if(f<t.length)for(let E of t.slice(f))s.push(e.error("unexpected-argument",E.toString())),a=!1;if(!a)return s;f=0;for(let E of o)r||(!n||!Ie(t[f]))&&t[f].infer(E),f+=1;for(let E of l){if(!t[f])break;(!n||!Ie(t[f]))&&((I=t[f])==null||I.infer(E)),f+=1}if(u)for(let E of t.slice(f))r||(!n||!Ie(E))&&E.infer(u),f+=1;return null}function Zl(e){let t={},i=hm(e.engine),r=pm(e.engine);if(e.symbol&&!t[e.symbol]&&!e.symbol.startsWith("_")){if(!i.includes(e.symbol)){let n=Un(e.symbol,i);n&&(t[e.symbol]=n)}}else if(e.ops&&!t[e.operator]&&!e.operator.startsWith("_")){let n=e.operator;if(!r.includes(n)){let s=Un(n,r);s&&(t[n]=s)}for(let s of e.ops)t={...t,...Zl(s)}}return t}function pm(e){let t=[],i=e.context.lexicalScope;for(;i;){for(let r of i.bindings.keys()){let n=i.bindings.get(r);le(n)&&t.push(r)}i=i.parent}return t}function hm(e){let t=[],i=e.context.lexicalScope;for(;i;){for(let r of i.bindings.keys()){let n=i.bindings.get(r);oe(n)&&t.push(r)}i=i.parent}return t}function mt(e){let t=Zl(e);if(Object.keys(t).length===0)return"";if(Object.keys(t).length===1){let[r,n]=Object.entries(t)[0];return`Unknown symbol "${r}". Did you mean "${n}"?`}let i=[];for(let[r,n]of Object.entries(t))i.push(`- "${r}" -> "${n}"?`);return`Unknown symbols found:
${i.join(`
`)}`}function Zs(e){if(e!==void 0)return isNaN(e)?"unsigned":e>0?"positive":e<0?"negative":"zero"}function Us(e){return e==="positive"?"negative":e==="non-negative"?"non-positive":e==="negative"?"positive":e==="non-positive"?"non-negative":e}function Ai(e){if(e.isGreater(1))return"positive";if(e.isGreaterEqual(1))return"non-negative";if(e.isLessEqual(1)&&e.isGreaterEqual(0))return"non-positive";if(e.isLess(1)&&e.isGreaterEqual(0))return"negative";if(e.is(1))return"zero";if(e.isNegative||e.isReal===!1)return"unsigned"}var mm=[{Abs:{wikidata:"Q3317982",broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([e])=>e.type,sgn:([e])=>e.is(0)?"zero":e.isNumberLiteral?"positive":"non-negative",evaluate:([e])=>gm(e)},Add:{wikidata:"Q32043",associative:!0,commutative:!0,commutativeOrder:ps,broadcastable:!0,idempotent:!0,complexity:1300,lazy:!0,signature:"(number+) -> number",type:Xh,sgn:e=>{if(e.some(t=>t.isNaN))return"unsigned";if(e.every(t=>t.is(0)))return"zero";if(e.every(t=>t.isNonNegative))return e.some(t=>t.isPositive)?"positive":"non-negative";if(e.every(t=>t.isNonPositive))return e.some(t=>t.isNegative)?"negative":"non-positive"},evaluate:(e,{numericApproximation:t})=>t?em(...e):me(...e.map(i=>i.evaluate()))},Ceil:{description:"Rounds a number up to the next largest integer",complexity:1250,broadcastable:!0,signature:"(real) -> integer",sgn:([e])=>{if(e.isLessEqual(-1))return"negative";if(e.isPositive)return"positive";if(e.isNonNegative)return"non-negative";if(e.isNonPositive&&e.isGreater(-1))return"zero";if(e.isNonPositive)return"non-positive";if(e.isReal==!1&&e.isNumberLiteral)return e.im>0||e.im<=-1?"unsigned":Zs(e.re)},evaluate:([e])=>X(e,Math.ceil,t=>t.ceil(),t=>t.ceil(0))},Chop:{associative:!0,broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([e])=>e.type,evaluate:e=>{let t=e[0],i=t.engine;return X(t,r=>i.chop(r),r=>i.chop(r),r=>i.complex(i.chop(r.re),i.chop(r.im)))}},Divide:{wikidata:"Q1226939",complexity:2500,broadcastable:!0,signature:"(number, number+) -> number",type:([e,t])=>t.is(1)?e.type:t.isNaN||e.isNaN?"number":t.isFinite===!1||e.isFinite===!1?"non_finite_number":t.isInteger&&e.isInteger?"finite_rational":t.isReal&&e.isReal?"finite_real":"finite_number",sgn:e=>{let[t,i]=[e[0],e[1]];if(i.is(0))return"unsigned";if(i.isPositive)return t.sgn;if(i.isNegative)return Us(t.sgn);let r=i.sgn;if(t.is(0)&&r==="not-zero"||t.isFinite&&i.isInfinity)return"zero";if(t.sgn==="not-zero"&&r==="not-zero")return"not-zero"},canonical:(e,{engine:t})=>{let i=t;e=je(i,e);let r=e[0];if(r===void 0)return i.error("missing");if(e.length<2)return r;let n=e.slice(1);for(let s of n)r=Ut(r,s);return r},evaluate:([e,t])=>e.div(t)},Exp:{wikidata:"Q168698",broadcastable:!0,complexity:3500,signature:"(number) -> number",canonical:(e,{engine:t})=>(e=je(t,e,1),t.function("Power",[t.E,...e]))},Factorial:{description:"Factorial function: the product of all positive integers less than or equal to n",wikidata:"Q120976",broadcastable:!0,complexity:9e3,signature:"(integer) -> integer",sgn:([e])=>e.isNonNegative?"positive":e.isNegative||e.isReal===!1?"unsigned":void 0,canonical:(e,{engine:t})=>{let i=e[0];return i.isNumberLiteral&&i.isNegative?t._fn("Factorial",[i.neg()]).neg():t._fn("Factorial",[i])},evaluate:([e])=>{let t=e.engine;if(e.im!==0&&e.im!==void 0)return t.number(t.complex(e.re,e.im).add(1));if(e.isFinite){if(e.isNegative)return t.number(wi(1+e.re));try{return t.number(Yr(ls(BigInt((e.bignumRe??e.re).toFixed())),t._timeRemaining))}catch{return}}},evaluateAsync:async([e],{signal:t})=>{let i=e.engine;if(e.im!==0&&e.im!==void 0)return i.number(i.complex(e.re,e.im).add(1));if(e.isFinite){if(e.isNegative)return i.number(wi(1+e.re));try{return i.number(await Qr(ls(BigInt((e.bignumRe??e.re).toFixed())),(i._deadline??1/0)-Date.now(),t))}catch{return}}}},Factorial2:{description:"Double Factorial Function",complexity:9e3,broadcastable:!0,signature:"(integer) -> integer",sgn:([e])=>e.isNonNegative?"positive":e.isNegative||e.isReal===!1?"unsigned":void 0,evaluate:e=>{let t=e[0],i=L(t);if(i===null)return;let r=t.engine;return be(r)?r.number(Jh(r,r.bignum(i))):r.number(zf(i))}},Floor:{wikidata:"Q56860783",complexity:1250,broadcastable:!0,signature:"(number) -> integer",sgn:([e])=>{if(e.isNegative)return"negative";if(e.isGreaterEqual(1))return"positive";if(e.isNonNegative&&e.isLess(1))return"zero";if(e.isNonNegative)return"non-negative";if(e.isReal==!1&&e.isNumberLiteral)return e.im<0||e.im>=1?"unsigned":Zs(e.re)},evaluate:([e])=>X(e,Math.floor,t=>t.floor(),t=>t.floor(0))},Gamma:{wikidata:"Q190573",complexity:8e3,broadcastable:!0,signature:"(number) -> number",sgn:([e])=>e.isPositive?"positive":e.is(0)?"zero":void 0,evaluate:([e],{numericApproximation:t,engine:i})=>t?X(e,r=>wi(r),r=>pl(i,r),r=>r):void 0},GammaLn:{complexity:8e3,broadcastable:!0,signature:"(number) -> number",evaluate:(e,{numericApproximation:t,engine:i})=>t?X(e[0],r=>Xr(r),r=>fl(i,r),r=>r):void 0},Ln:{description:"Natural Logarithm",wikidata:"Q204037",complexity:4e3,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([e])=>Ai(e),evaluate:([e],{numericApproximation:t,engine:i})=>t?X(e,r=>r===0?-1/0:r>=0?Math.log(r):i.complex(r).log(),r=>r.isZero()?-1/0:r.isNeg()?i.complex(r.toNumber()).log():r.ln(),r=>r.isZero()?NaN:r.log()):e.ln()},Log:{description:"Log(z, b = 10) = Logarithm of base b",wikidata:"Q11197",complexity:4100,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([e,t])=>{if(!t)return Ai(e);if(t.is(1)||t.isReal==!1)return"unsigned";if(t.isGreater(1))return Ai(e);if(t.isLess(1))return Us(Ai(e))},evaluate:(e,{numericApproximation:t,engine:i})=>{var n;if(!t)return((n=e[0])==null?void 0:n.ln(e[1]??10))??void 0;let r=i;return e[1]===void 0?X(e[0],s=>s===0?-1/0:s>=0?Math.log10(s):r.complex(s).log().div(Math.LN10),s=>s.isZero()?-1/0:s.isNeg()?r.complex(s.toNumber()).log().div(Math.LN10):Z.log10(s),s=>s.isZero()?NaN:s.log().div(Math.LN10)):ti(e[0],e[1],(s,a)=>Math.log(s)/Math.log(a),(s,a)=>s.log(a),(s,a)=>s.log().div(typeof a=="number"?Math.log(a):a.log()))}},Lb:{description:"Base-2 Logarithm",wikidata:"Q581168",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([e])=>Ai(e),canonical:([e],{engine:t})=>t._fn("Log",[e,t.number(2)])},Lg:{description:"Base-10 Logarithm",wikidata:"Q966582",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([e])=>Ai(e),canonical:([e],{engine:t})=>t._fn("Log",[e])},Mod:{description:"Modulo",wikidata:"Q1799665",complexity:2500,broadcastable:!0,signature:"(number, number) -> number",sgn:e=>{var i;let t=e[1];if(!(t===void 0||t.isReal==!1)){if(t.is(0))return"unsigned";if(e[0].isNumberLiteral&&t.isNumberLiteral)return((i=ti(e[0],t,(r,n)=>(r%n+n)%n,(r,n)=>r.modulo(n)))==null?void 0:i.sgn)??void 0}},evaluate:([e,t])=>ti(e,t,(i,r)=>(i%r+r)%r,(i,r)=>i.modulo(r))},Multiply:{wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,complexity:2100,broadcastable:!0,lazy:!0,signature:"(number*) -> number",type:e=>e.length===0?"finite_integer":e.length===1?e[0].type:e.some(t=>t.isNaN)?"number":e.some(t=>t.isFinite===!1)?"non_finite_number":e.every(t=>t.isInteger)?"finite_integer":e.every(t=>t.isReal)?"finite_real":e.every(t=>t.isRational)?"finite_rational":"finite_number",sgn:e=>{if(!e.some(t=>t.sgn===void 0||t.isReal===!1)){if(e.some(t=>t.is(0)))return e.every(t=>t.isFinite)?"zero":e.some(t=>t.isFinite===!1)?"unsigned":void 0;if(!(e.some(t=>t.isFinite===!1||t.isFinite===void 0)&&e.some(t=>{t.sgn}))){if(e.every(t=>t.isPositive||t.isNegative)){let t=0;return e.forEach(i=>{i.isNegative&&t++}),t%2===0?"positive":"negative"}if(e.every(t=>t.isNonPositive||t.isNonNegative)){let t=0;return e.forEach(i=>{i.isNonPositive&&t++}),t%2===0?"non-positive":"non-negative"}if(e.every(t=>t.sgn==="not-zero"||t.sgn==="positive"||t.sgn==="negative"))return"not-zero"}}},evaluate:(e,{numericApproximation:t})=>t?sm(...e):Ve(...e.map(i=>i.evaluate()))},Negate:{description:"Additive Inverse",wikidata:"Q715358",complexity:2e3,broadcastable:!0,signature:"(number) -> number",type:([e])=>e.type,sgn:([e])=>Us(e.sgn),canonical:(e,{engine:t})=>(e=je(t,e),e.length===0?t.error("missing"):e[0].neg()),evaluate:([e])=>e.neg()},PlusMinus:{description:"Plus or Minus",wikidata:"Q120812",complexity:1200,signature:"(value, value) -> tuple",canonical:(e,{engine:t})=>(e=je(t,e,2),e.length===0?t.error("missing"):t._fn("PlusMinus",[e[0],e[1].abs()])),type:([e,t])=>R(`tuple<${e.type}, ${t.type}>`),evaluate:([e,t],{engine:i})=>i.tuple(e.add(t.neg()),e.add(t))},Power:{wikidata:"Q33456",broadcastable:!0,complexity:3500,signature:"(number, number) -> number",type:([e,t])=>e.isNaN||t.isNaN?"number":t.isFinite?e.isInteger&&t.isInteger?"finite_integer":e.isRational&&t.isInteger?"finite_rational":e.isReal&&t.isReal?"finite_real":"finite_number":"non_finite_number",canonical:(e,{engine:t})=>{if(e=je(t,e,2),e.length!==2)return t._fn("Power",e);let[i,r]=e;return Ni(i,r)},sgn:([e,t])=>{let i=e.sgn,r=t.sgn;if(!(e.isReal===!1||t.isReal===!1||e.isNaN||t.isNaN||i===void 0||r===void 0)){if(e.is(0))return t.isNonPositive?"unsigned":t.isPositive?"zero":void 0;if(e.is(0)&&t.is(0))return"unsigned";if(e.isNonNegative||t.numerator.isOdd&&t.denominator.isOdd)return e.sgn;if(t.numerator.isEven&&t.denominator.isOdd){if(e.isReal){let n=e.sgn;return n==="positive"||n==="not-zero"||n==="negative"?"positive":"non-negative"}return e.type.matches("complex")?"negative":e.is(0)?void 0:"not-zero"}if(t.isRational===!1||t.numerator.isOdd&&t.denominator.isEven&&e.isNonPositive)return"unsigned"}},evaluate:([e,t],{numericApproximation:i})=>Ce(e,t,{numericApproximation:i??!1})},Rational:{complexity:2400,signature:"(number, integer?) -> rational",sgn:([e])=>e.sgn,canonical:(e,{engine:t})=>{let i=t;return e=fe(e),e.length===0?i._fn("Rational",[i.error("missing")]):e.length===1?i._fn("Rational",[ke(i,e[0],"real")]):(e=Bs(i,e,["integer","integer"]),e.length!==2||!e[0].isValid||!e[1].isValid?i._fn("Rational",e):e[0].div(e[1]))},evaluate:(e,{numericApproximation:t,engine:i})=>{let r=i;if(e.length===1){let a=e[0].N();return a.numericValue===null||a.im!==0?void 0:r.number(oh(a.re))}if(t)return ti(e[0],e[1],(a,o)=>a/o,(a,o)=>a.div(o),(a,o)=>a.div(o));let[n,s]=[se(e[0]),se(e[1])];if(n!==null&&s!==null)return r.number([n,s])}},Root:{complexity:3200,broadcastable:!0,signature:"(number, number) -> number",type:([e,t])=>e.isNaN||t.isNaN?"number":e.isFinite===!1||t.isFinite===!1?"non_finite_number":t.is(0)?"finite_integer":t.is(1)?e.type:e.isReal&&t.isReal&&e.isPositive===!0?"finite_real":"finite_number",sgn:([e,t])=>{if(e.isReal===!1||t.isReal===!1)return"unsigned";if(e.is(0)){if(t.isNonPositive)return"unsigned";if(t.isPositive)return"zero"}if(e.isPositive===!0)return"positive";if(e.isNonNegative===!0)return"non-negative";if(t.isOdd===!0||t.numerator.isOdd&&t.denominator.isOdd)return e.sgn;if(e.isNegative&&t.isOdd===!1)return"unsigned"},canonical:(e,{engine:t})=>{e=je(t,e,2);let[i,r]=e;return Ki(i,r)},evaluate:([e,t],{numericApproximation:i})=>fs(e,t,{numericApproximation:i})},Round:{complexity:1250,broadcastable:!0,signature:"(number) -> integer",type:([e])=>e.isNaN?"number":e.isFinite===!1||e.isReal===!1?"non_finite_number":"finite_integer",sgn:([e])=>{if(e.isNaN)return"unsigned";if(e.isNumberLiteral)return e.im>=.5||e.im<=-.5?"unsigned":Zs(Math.round(e.re));if(e.isGreaterEqual(.5))return"positive";if(e.isLessEqual(-.5))return"negative";if(e.isLess(.5)&&e.isGreater(-.5))return"zero";if(e.isNonNegative)return"non-negative";if(e.isNonPositive)return"non-positive"},evaluate:([e])=>X(e,Math.round,t=>t.round(),t=>t.round(0))},Sign:{complexity:1200,broadcastable:!0,signature:"(number) -> integer",sgn:([e])=>e.sgn,evaluate:([e],{engine:t})=>{if(e.is(0))return t.Zero;if(e.isPositive)return t.One;if(e.isNegative)return t.NegativeOne}},Sqrt:{description:"Square Root",wikidata:"Q134237",complexity:3e3,broadcastable:!0,signature:"(number) -> number",type:([e])=>e.isNaN?"number":e.isFinite===!1?"non_finite_number":e.isReal?e.isNegative?"complex":"finite_real":"finite_number",sgn:([e])=>{if(e.isPositive)return"positive";if(e.isNegative)return"unsigned";if(e.isNonNegative)return"non-negative";if(e.sgn==="not-zero")return"not-zero"},evaluate:([e],{numericApproximation:t,engine:i})=>{if(!t)return e.sqrt();let[r,n]=e.toNumericValue();return n.is(1)?i.number(r.sqrt().N()):i.number(r.sqrt().N()).mul(n)}},Square:{wikidata:"Q3075175",complexity:3100,broadcastable:!0,signature:"(number) -> number",sgn:([e])=>{if(e.is(0))return"zero";if(e.isReal){let t=e.sgn;return t==="not-zero"||t==="positive"||t==="negative"?"positive":"non-negative"}if(e.type.matches("complex"))return"negative";if(e.isReal==!1||e.isNaN)return"unsigned"},canonical:(e,{engine:t})=>{let i=t;return e=fe(e),e.length!==1?i._fn("Square",e):i._fn("Power",[e[0],i.number(2)]).canonical}},Subtract:{wikidata:"Q40754",complexity:1350,broadcastable:!0,signature:"(number+) -> number",canonical:(e,{engine:t})=>{if(e=je(t,e),e.length===0)return t.error("missing");let i=e[0],r=e.slice(1);return It(t,[i,...r.map(n=>n.neg())])}}},{ImaginaryUnit:{type:"imaginary",isConstant:!0,holdUntil:"never",wikidata:"Q193796",value:e=>e.I},i:{type:"imaginary",isConstant:!0,holdUntil:"never",value:e=>e.I},ExponentialE:{type:"finite_real",wikidata:"Q82435",isConstant:!0,holdUntil:"N",value:e=>e.number(be(e)?e._BIGNUM_ONE.exp():Math.exp(1))},e:{type:"finite_real",isConstant:!0,holdUntil:"never",value:"ExponentialE"},ComplexInfinity:{type:"complex",isConstant:!0,holdUntil:"never",value:e=>e.ComplexInfinity},PositiveInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:1/0},NegativeInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:-1/0},NaN:{type:"number",isConstant:!0,holdUntil:"never",value:e=>e.NaN},ContinuationPlaceholder:{description:"This symbol indicates that some elements in a collection have been omitted, for example in a long list of numbers, or in an infinite set",type:"unknown",isConstant:!0},MachineEpsilon:{type:"finite_real",holdUntil:"N",isConstant:!0,value:{num:Number.EPSILON.toString()}},Half:{type:"finite_rational",isConstant:!0,holdUntil:"never",value:["Rational",1,2]},GoldenRatio:{type:"finite_real",wikidata:"Q41690",isConstant:!0,holdUntil:"N",value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{type:"finite_real",wikidata:"Q855282",isConstant:!0,holdUntil:"N",value:{num:`0.91596559417721901505460351493238411077414937428167
                  21342664981196217630197762547694793565129261151062
                  48574422619196199579035898803325859059431594737481
                  15840699533202877331946051903872747816408786590902
                  47064841521630002287276409423882599577415088163974
                  70252482011560707644883807873370489900864775113225
                  99713434074854075532307685653357680958352602193823
                  23950800720680355761048235733942319149829836189977
                  06903640418086217941101917532743149978233976105512
                  24779530324875371878665828082360570225594194818097
                  53509711315712615804242723636439850017382875977976
                  53068370092980873887495610893659771940968726844441
                  66804621624339864838916280448281506273022742073884
                  31172218272190472255870531908685735423498539498309
                  91911596738846450861515249962423704374517773723517
                  75440708538464401321748392999947572446199754961975
                  87064007474870701490937678873045869979860644874974
                  64387206238513712392736304998503539223928787979063
                  36440323547845358519277777872709060830319943013323
                  16712476158709792455479119092126201854803963934243
                  `}},EulerGamma:{type:"finite_real",wikidata:"Q273023",holdUntil:"N",isConstant:!0,value:{num:`0.57721566490153286060651209008240243104215933593992359880576723488486772677766
          467093694706329174674951463144724980708248096050401448654283622417399764492353
          625350033374293733773767394279259525824709491600873520394816567085323315177661
          152862119950150798479374508570574002992135478614669402960432542151905877553526
          733139925401296742051375413954911168510280798423487758720503843109399736137255
          306088933126760017247953783675927135157722610273492913940798430103417771778088
          154957066107501016191663340152278935867965497252036212879226555953669628176388
          792726801324310104765059637039473949576389065729679296010090151251959509222435
          014093498712282479497471956469763185066761290638110518241974448678363808617494
          551698927923018773910729457815543160050021828440960537724342032854783670151773
          943987003023703395183286900015581939880427074115422278197165230110735658339673`}}},{PreIncrement:{signature:"(number) -> number"},PreDecrement:{signature:"(number) -> number"}},{IsPrime:{description:"`IsPrime(n)` returns `True` if `n` is a prime number",wikidata:"Q49008",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:([e],{engine:t})=>{let i=Gs(e);if(i!==void 0)return t.symbol(i?"True":"False")}},IsComposite:{description:"`IsComposite(n)` returns `True` if `n` is not a prime number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(e,{engine:t})=>t.box(["Not",["IsPrime",...e]])},IsOdd:{description:"`IsOdd(n)` returns `True` if `n` is an odd number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:(e,{engine:t})=>{let i=!1,r=e.every(n=>{if(n.im!==0)return!1;let s=xi(n);if(s!==null)return s%BigInt(2)!==BigInt(0);let a=n.re;return Number.isInteger(a)?a%2!==0:(i=!0,!1)});if(!i)return t.symbol(r?"True":"False")}},IsEven:{description:"Even Number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(e,{engine:t})=>t.box(["Not",["IsOdd",...e]])}},{GCD:{description:"Greatest Common Divisor",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:e=>Gl(e,"GCD")},LCM:{description:"Least Common Multiple",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:e=>Gl(e,"LCM")},Numerator:{description:"Numerator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(e,{engine:t})=>{if(e.length===0)return t.Nothing;let i=e[0];return i.operator==="Rational"||i.operator==="Divide"?i.op1:t._fn("Numerator",Et(t,e))},sgn:([e])=>e.sgn,evaluate:(e,{engine:t})=>{let i=t;if(e.length===0)return i.Nothing;let r=e[0];return r.operator==="Rational"||r.operator==="Divide"?r.op1.evaluate():r.numerator}},Denominator:{description:"Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(e,{engine:t})=>{if(e.length===0)return t.Nothing;let i=e[0];if(i.operator==="Rational"||i.operator==="Divide")return i.op2;let r=Vt(i);return r!==void 0?t.number(r[1]):t._fn("Denominator",Et(t,e))},sgn:()=>"positive",evaluate:(e,{engine:t})=>{let i=t;if(e.length===0)return i.Nothing;let r=e[0];return r.operator==="Rational"||r.operator==="Divide"?r.op2.evaluate():r.denominator}},NumeratorDenominator:{description:"Sequence of Numerator and Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> tuple<number, number> | nothing",canonical:(e,{engine:t})=>{if(e.length===0)return t.Nothing;let i=e[0];if(i.operator==="Rational"||i.operator==="Divide")return t.tuple(...i.ops);let r=Vt(i.evaluate());return r!==void 0?t.tuple(t.number(r[0]),t.number(r[1])):t._fn("NumeratorDenominator",e.map(n=>n.evaluate()))},evaluate:(e,{engine:t})=>{let i=t;if(e.length===0)return i.Nothing;let r=e[0];return r.operator==="Rational"||r.operator==="Divide"?i.tuple(...r.ops):i.tuple(...r.numeratorDenominator)}}},{Max:{description:"Maximum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",sgn:e=>{if(e.some(t=>t.isReal==!1||t.isNaN))return"unsigned";if(!e.some(t=>t.isReal==!1||t.isNaN!==!1)){if(e.some(t=>t.isPositive))return"positive";if(e.every(t=>t.isNonPositive))return e.some(t=>t.is(0))?"zero":"non-positive";if(e.some(t=>t.isNonNegative))return"non-negative";if(e.every(t=>t.isNegative))return"negative";if(e.some(t=>!t.is(0)))return"not-zero"}},evaluate:(e,{engine:t})=>pn(t,e,"Max")},Min:{description:"Minimum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value+) -> number | list",sgn:e=>{if(e.some(t=>t.isReal==!1||t.isNaN))return"unsigned";if(!e.some(t=>t.isReal==!1||t.isNaN!==!1)){if(e.some(t=>t.isNegative))return"negative";if(e.every(t=>t.isNonNegative))return e.some(t=>t.is(0))?"zero":"non-negative";if(e.some(t=>t.isNonPositive))return"non-positive";if(e.every(t=>t.isPositive))return"positive"}},evaluate:(e,{engine:t})=>pn(t,e,"Min")},Supremum:{description:"Like Max, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(e,{engine:t})=>pn(t,e,"Supremum")},Infimum:{description:"Like Min, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(e,{engine:t})=>pn(t,e,"Infimum")},Product:{description:"`Product(f, a, b)` computes the product of `f` from `a` to `b`",wikidata:"Q901718",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number+) -> number, (tuple<integer>|tuple<integer, integer>)+) -> number",canonical:([e,...t],{scope:i})=>ll("Product",e,t,i),evaluate:(e,t)=>{let i=(n,s)=>(s=s.evaluate(t),s.isNumberLiteral?n.mul(s.numericValue):null),r=Yr(Jr(e[0],e.slice(1),i,t.engine._numericValue(1)),t.engine._timeRemaining);return t.engine.number(r??NaN)},evaluateAsync:async(e,t)=>{let i=(n,s)=>(s=s.evaluate(t),s.isNumberLiteral?n.mul(s.numericValue):null),r=await Qr(Jr(e[0],e.slice(1),i,t.engine._numericValue(1)),t.engine._timeRemaining,t.signal);return t.engine.number(r??NaN)}},Sum:{description:"`Sum(f, [a, b])` computes the sum of `f` from `a` to `b`",wikidata:"Q218005",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number) -> number, bounds:tuple+) -> number",canonical:([e,...t],{scope:i})=>ll("Sum",e,t,i),evaluate:([e,...t],{engine:i})=>i.number(Yr(Jr(e,t,(r,n)=>(n=n.evaluate(),n.isNumberLiteral?r.add(n.numericValue):null),i._numericValue(0)),i._timeRemaining)),evaluateAsync:async(e,{engine:t,signal:i})=>t.number(await Qr(Jr(e[0],e.slice(1),(r,n)=>(n=n.evaluate(),n.isNumberLiteral?r.add(n.numericValue):null),t._numericValue(0)),t._timeRemaining,i))}}];function gm(e){let t=e.engine,i=e.numericValue;if(i!==null)return typeof i=="number"?t.number(Math.abs(i)):t.number(i.abs());if(e.isNonNegative)return e;if(e.isNegative)return e.neg()}function Ul(e,t){let i=e.engine,r=t==="Max"||t==="Supremum";if(e.operator==="Interval"){let n=r?e.op2:e.op1;return!n.isNumber||n.numericValue===null?[void 0,[e]]:[n,[]]}if(e.operator==="Range")if(r){let n=Xe(e),s=mh(n);return[i.number(Math.max(n[0],s)),[]]}else return[i.number(Xe(e)[0]),[]];if(e.operator==="Linspace")return e.nops===1?e=r?e.op1:i.One:r?e=e.op2:e=e.op1,[e,[]];if(e.isCollection){let n,s=[];for(let a of e.each()){let[o,l]=Ul(a,t);o&&(n?(r&&o.isGreater(n)||!r&&o.isLess(n))&&(n=o):n=o),s.push(...l)}return[n,s]}return!e.isNumber||e.numericValue===null?[void 0,[e]]:[e,[]]}function pn(e,t,i){let r=i==="Max"||i==="Supremum";if(t=fe(t),t.length===0)return r?e.NegativeInfinity:e.PositiveInfinity;let n,s=[];for(let a of t){let[o,l]=Ul(a,i);o&&(n?(r&&o.isGreater(n)||!r&&o.isLess(n))&&(n=o):n=o),s.push(...l)}return s.length>0?e.box(n?[i,n,...s]:[i,...s]):n??(r?e.NegativeInfinity:e.PositiveInfinity)}function Gl(e,t){let i=e[0].engine,r=t==="LCM"?Yh:Il,n=[];if(be(i)){let s=null;for(let a of e)if(s===null)s=Ho(a),(s===null||!s.isInteger())&&n.push(a);else{let o=Ho(a);o&&o.isInteger()?s=r(s,o):n.push(a)}return n.length===0?s===null?i.One:i.number(s):s===null?i._fn(t,n):i._fn(t,[i.number(s),...n])}for(let s of e)s.isInteger&&n.push(s);return n.length===0?i.One:i._fn(t,n)}function Gs(e){if(!e.isInteger||e.isNegative||e.numericValue===null)return;let t=L(e);if(t!==null)return Xa(t);let i=xi(e);if(i!==null)return Cf(i)}var dm={Sin:["Cos","_"],Cos:["Negate",["Sin","_"]],Tan:["Power",["Sec","_"],2],Sec:["Multiply",["Tan","_"],["Sec","_"]],Csc:["Multiply",["Negate",["Cot","_"]],["Csc","_"]],Cot:["Negate",["Power",["Csc","_"],2]],Arcsin:["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],Arccos:["Negate",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]]],Arctan:["Power",["Add",1,["Power","_",2]],-1],Arcsec:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccsc:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccot:["Negate",["Power",["Add",1,["Power","_",2]],-1]],Sinh:["Cosh","_"],Cosh:["Sinh","_"],Tanh:["Power",["Sech","_"],2],Sech:["Multiply",["Tanh","_"],"Sech"],Csch:["Multiply",["Coth","_"],"Csch"],Coth:["Negate",["Power",["Csch","_"],2]],Arcsinh:["Power",["Add",["Power","_",2],1],["Negate","Half"]],Arccosh:["Power",["Subtract",["Power","_",2],1],["Negate","Half"]],Arctanh:["Power",["Subtract",1,["Power","_",2]],-1],Arcsech:["Negate",["Power",["Multiply","2","Subtract",["Power","_",2]],["Negate","Half"]]],Arccsch:["Negate",["Power",["Multiply","2","Add",["Power","_",2]],["Negate","Half"]]],Arccoth:["Negate",["Power",["Subtract",1,["Power","_",2]],-1]],Ln:["Divide",1,"_"],Log:["Power",["Multiply","_",["Ln","10"]],-1],Sqrt:["Multiply",["Power","_",["Negate","Half"]],"Half"],Abs:["Which",["Equal","_",0],NaN,["Less","_",0],-1,["Greater","_",0],1,"True",["D",["Abs","_"],"_"]],Erf:["Multiply",["Divide","2",["Sqrt","Pi"]],["Exp",["Negate",["Square","_"]]]],Gamma:["Multiply",["Gamma","_"],["Digamma","_"]],Digamma:["Add",["Multiply",["Digamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Zeta:["Multiply",["Multiply",-1,["Zeta","_"]],["Digamma","_"]],PolyGamma:["Add",["Multiply",["PolyGamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Beta:["Multiply",["Add",["Multiply",["Beta","_"],["Digamma","_"]],["Multiply",["Power","_",-1],["Beta","_"]]],["Beta","_"]],Erfc:["Multiply",["Negate",["Erfc","_"]],["Exp",["Negate",["Power","_",2]]],["Power","_",-1]],LambertW:["Multiply",["Power","_",-1],["Multiply",["Add","_",["LambertW","_"]],["Add",["LambertW","_"],1]]],AiryAi:["Multiply",["AiryAi","_"],["AiryBi","_"]],AiryBi:["Multiply",["AiryAi","_"],["AiryBi","_"]],BesselJ:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselY:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselI:["Multiply",["BesselI","_"],["BesselK","_"]],BesselK:["Multiply",["BesselI","_"],["BesselK","_"]],FresnelS:["Multiply",["FresnelS","_"],["FresnelC","_"]],FresnelC:["Multiply",["FresnelS","_"],["FresnelC","_"]],Erfi:["Multiply",["Erfi","_"],["Erf","_"]]};function ym(e,t){var s;if(t===0)return e;let i=e.engine,r="_";e.symbol&&e.operatorDefinition&&(e=ei(i.symbol(e.symbol),[i.symbol("_")])),e.operator==="Function"&&(r=((s=e.ops[1])==null?void 0:s.symbol)??"_",e=e.ops[0]);let n=e;for(;t-- >0&&n;)n=tt(n,r);return n}function tt(e,t){let i=e.engine;if(e.string)return;if(e.isNumberLiteral)return e.engine.Zero;if(e.symbol===t)return e.engine.One;if(e.symbol)return e.engine.Zero;if(!e.operator)return;if(e.operator==="Negate"){let a=tt(e.op1,t);return a?a.neg():i._fn("D",[e.op1,i.symbol(t)]).neg()}if(e.operator==="Add"){let a=e.ops.map(o=>tt(o,t));return a.some(o=>o===void 0)?void 0:me(...a).evaluate()}if(e.operator==="Multiply"){let a=e.ops.map((o,l)=>{let u=e.ops.slice();u.splice(l,1);let c=Ve(...u);return(tt(o,t)??i._fn("D",[o,i.symbol(t)])).mul(c)});return a.some(o=>o===void 0)?void 0:me(...a).evaluate()}if(e.operator==="Power"){let[a,o]=e.ops;if(a.symbol===t)return o.mul(a.pow(o.add(i.NegativeOne))).evaluate();let l=a,u=o,c=tt(l,t)??i._fn("D",[l,i.symbol(t)]),f=(tt(u,t)??i._fn("D",[u,i.symbol(t)])).mul(l.ln()),p=u.mul(c).div(l);return e.mul(f.add(p)).evaluate()}if(e.operator==="Divide"){let[a,o]=e.ops,l=tt(a,t)??i._fn("D",[a,i.symbol(t)]),u=tt(o,t)??i._fn("D",[o,i.symbol(t)]);return l.mul(o).sub(u.mul(a)).div(o.pow(2)).evaluate()}let r=dm[e.operator];if(!r){if(e.nops>1)return;let a=i._fn("Derivative",[i.symbol(e.operator),i.One]);if(!a.isValid)return;let o=e.ops[0],l=tt(o,t)??i._fn("D",[o,i.symbol(t)]);return l.isValid?i._fn("Apply",[a,o]).mul(l):void 0}if(e.nops>1)return i._fn("D",[e,i.symbol(t)]);let n=e.ops[0],s=tt(n,t)??i._fn("D",[n,i.symbol(t)]);return ei(i.box(r),[n]).mul(s)}var jl={boolean:e=>e.type.matches("boolean"),string:e=>e.string!==null,number:e=>e.isNumberLiteral,symbol:e=>e.symbol!==null,expression:e=>!0,numeric:e=>{let[t,i]=e.toNumericValue();return i.is(1)},integer:e=>e.isInteger,rational:e=>e.isRational,irrational:e=>e.isRational===!1,real:e=>e.isReal,notreal:e=>!e.isReal,complex:e=>e.type.matches("complex"),imaginary:e=>e.type.matches("imaginary"),positive:e=>e.isPositive,negative:e=>e.isNegative,nonnegative:e=>e.isNonNegative,nonpositive:e=>e.isNonPositive,even:e=>e.isEven,odd:e=>e.isOdd,prime:e=>Gs(e)===!0,composite:e=>Gs(e)===!1,notzero:e=>e.is(0)===!1,notone:e=>e.is(1)===!1,finite:e=>e.isFinite,infinite:e=>e.isFinite===!1,constant:e=>{var t;return((t=e.valueDefinition)==null?void 0:t.isConstant)??!1},variable:e=>{var t;return!(((t=e.valueDefinition)==null?void 0:t.isConstant)??!0)},function:e=>e.operatorDefinition!==void 0,relation:e=>Xt(e.operator),equation:e=>e.operator==="Equal",inequality:e=>gi(e.operator),collection:e=>e.isCollection,list:e=>e.operator==="List",set:e=>e.operator==="Set",tuple:e=>e.operator==="Tuple"||e.operator==="Single"||e.operator==="Pair"||e.operator==="Triple",single:e=>e.operator==="Single",pair:e=>e.operator==="Pair",triple:e=>e.operator==="Triple",scalar:e=>e.rank===0,tensor:e=>e.rank>0,vector:e=>e.rank===1,matrix:e=>e.rank===2,unit:e=>e.operator==="Unit",dimension:e=>e.operator==="Dimension",angle:e=>e.operator==="Angle",polynomial:e=>e.unknowns.length===1};function bm(e,t){for(let i of t)if(jl[i](e)!==!0)return!1;return!0}function vm(e){let t=/\\[a-zA-Z]+|[{}]|[\d]+|[+\-*/^_=()><,.;]|[a-zA-Z]/g,i=e.match(t);return i?i.filter(r=>!/^[ \f\n\r\t\v\xA0\u2028\u2029]+$/.test(r)):[]}function xm(e){let t=e.peek,i=null;if(t==="\\mathrm")e.nextToken(),i=e.parseStringGroup();else if(/^[a-z]$/.test(t))for(i=e.nextToken();/^[a-z]$/.test(e.peek);)i+=e.nextToken();else{let r={">0":"positive","\\gt0":"positive","<0":"negative","\\lt0":"negative",">=0":"nonnegative","\\geq0":"nonnegative","<=0":"nonpositive","\\leq0":"nonpositive","!=0":"notzero","\\neq0":"notzero","\\neq1":"notone","!=1":"notone","\\in\\R":"real","\\in\\mathbb{R}":"real","\\in\\C":"complex","\\in\\mathbb{C}":"complex","\\in\\Q":"rational","\\in\\mathbb{Q}":"rational","\\in\\Z^+":"integer,positive","\\in\\Z^-":"intger,negative","\\in\\Z^*":"nonzero","\\in\\R^+":"positive","\\in\\R^-":"negative","\\in\\R^*":"real,nonzero","\\in\\Z":"integer","\\in\\mathbb{Z}":"integer","\\in\\N":"integer,nonnegative","\\in\\mathbb{N}":"integer,nonnegative","\\in\\N^*":"integer,positive","\\in\\N_0":"integer,nonnegative","\\in\\R\\backslash\\Q":"irrational"};for(let n in r)if(e.matchAll(vm(n))){i=r[n];break}}if(!i)return null;if(!Object.keys(jl).includes(i))throw new Error(`Unexpected condition "${i}" in a rule`);return i}function Wl(e){let t=[];do{let i=xm(e);if(!i)break;t.push(i)}while(e.match(","));return t.join(",")}function js(e){let t=null;if(e.match(":"))t=Wl(e);else if(e.matchAll(["_","<{>"])&&(t=Wl(e),!e.match("<}>")))return null;return t}function Hl(e,t,i){if(!(t===void 0||typeof t=="function")){if(typeof t=="string"){let r=e.parse(t,{canonical:(i==null?void 0:i.canonical)??!1});return r=r.map(n=>n.symbol&&n.symbol.length===1?e.symbol("_"+n.symbol):n,{canonical:!1}),r}return e.box(t,{canonical:(i==null?void 0:i.canonical)??!1})}}function Nm(e,t,i){let r=h=>({kind:"symbol",latexTrigger:h,parse:(d,y)=>{s[h]||(s[h]=`_${h}`);let x=js(d);return x!==null&&(a[h]?a[h]+=","+x:a[h]=x),s[h]}}),n=e.latexDictionary,s={},a={};e.latexDictionary=[...n,{kind:"prefix",precedence:100,latexTrigger:"...",parse:(h,d)=>{let y=h.nextToken();if(!"abcfghjklmnopqrstuvwxyz".includes(y))return null;let x="__";if(h.match("?")&&(x="___"),s[y]&&s[y]!==`${x}${y}`)throw new Error(`Duplicate wildcard "${y}"`);s[y]||(s[y]=`${x}${y}`);let T=js(h);return T===null?null:(a[y]?a[y]+=","+T:a[y]=T,`${x}${y}`)}},..."abcfghjklmnopqrstuvwxyz".split("").map(r),{kind:"infix",precedence:100,latexTrigger:"->",parse:(h,d,y)=>{let x=h.parseExpression({...y,minPrec:20});if(x===null)return null;let T=null;if(h.match(";")){let E=!1,w=h.index;do{h.skipSpace();let Se=h.nextToken();if(s[Se]){let at=js(h);if(at===null||!at){E=!0,h.index=w;break}a[Se]?a[Se]+=","+at:a[Se]=at}}while(!E&&!h.atEnd);T=h.parseExpression(y)}let C=[];for(let E in a){let w=a[E].split(",");w.length!==0&&(w.length===1?C.push(["Condition",s[E],w[0]]):C.push(["Condition",s[E],["And",...w]]))}let I;return T&&C.length>0?I=["And",T,...C]:T?I=T:C.length===1?I=C[0]:C.length>1&&(I=["And",...C]),I?["Rule",d,x,I]:["Rule",d,x]}}];let o=(i==null?void 0:i.canonical)??!1,l=e.parse(t);if(e.latexDictionary=n,!l.isValid||l.operator!=="Rule")throw new Error(`Invalid rule "${t}"
|   ${mn(l).toString()}
|   A rule should be of the form:
|   <match> -> <replace>; <condition>`);let[u,c,f]=l.ops;if(o&&(u=u.canonical,c=c.canonical),!Yl(c,u))throw new Error(`Invalid rule "${t}"
|   The replace expression contains wildcards not present in the match expression`);if(u.isSame(c))throw new Error(`Invalid rule "${t}"
|   The match and replace expressions are the same.
|   This may be because the rule is not necessary due to canonical simplification`);let p;if(f!==void 0){if(!Yl(f,u))throw new Error(`Invalid rule "${t}"
|   The condition expression contains wildcards not present in the match expression`);p=h=>{var d;return((d=f.subs(h).canonical.evaluate())==null?void 0:d.symbol)==="True"}}return Ql(e,{match:u,replace:c,condition:p,id:t},i)}function Ql(e,t,i){if(t==null)throw new Error("Expected a rule, not "+t);if(wm(t))return t;if(typeof t=="string")return Nm(e,t,i);if(typeof t=="function")return{_tag:"boxed-rule",match:void 0,replace:t,condition:void 0,id:t.toString().replace(/\n/g," ")};let{match:r,replace:n,condition:s,id:a,onMatch:o,onBeforeMatch:l}=t;if(n===void 0)throw new Error(`Invalid rule "${a??JSON.stringify(t,void 0,4)}"
|   A rule must include at least a replace property`);let u;if(typeof s=="string"){let p=Gi(s);if(p){let h=e.parse(p,{canonical:(i==null?void 0:i.canonical)??!1});u=(d,y)=>{var x;return((x=h.subs(d).evaluate())==null?void 0:x.symbol)==="True"}}}else{if(s!==void 0&&typeof s!="function")throw new Error(`Invalid rule ${a??JSON.stringify(t,void 0,4)}
|   condition is not a valid function`);u=s}if(typeof r=="function")throw new Error(`Invalid rule ${a??JSON.stringify(t,void 0,4)}
|   match is not a valid expression.
|   Use a replace function instead to validate and replace the expression`);e.pushScope();let c=Hl(e,r,i),f=Hl(e,n,i);if(e.popScope(),a||(typeof r=="string"?a=r:a=JSON.stringify(r,void 0,4),n&&(a+=" -> ",typeof n=="string"?a+=n:typeof n=="function"?a+=n==null?void 0:n.toString().replace(/\n/g," "):a=JSON.stringify(n,void 0,4)),typeof s=="string"?a+=`; ${s}`:typeof s=="function"&&(a+=`; ${s.toString().replace(/\n/g," ")}`)),c&&!c.isValid)throw new Error(`Invalid rule ${a}
|   the match expression is not valid: ${c.toString()}`);if(f&&!f.isValid)throw new Error(`Invalid rule ${a??JSON.stringify(t,void 0,4)}
|   The replace expression is not valid: ${f==null?void 0:f.toString()}`);if(!f&&typeof n!="function")throw new Error(`Invalid rule ${a??JSON.stringify(t,void 0,4)}
|   The replace expression could not be parsed`);return{_tag:"boxed-rule",match:c,replace:f??n,condition:u,useVariations:t.useVariations,id:a,onMatch:o,onBeforeMatch:l}}function hn(e,t,i){if(!t)return{rules:[]};if(typeof t=="object"&&"rules"in t)return t;Array.isArray(t)||(t=[t]);let r=[];for(let n of t)try{r.push(Ql(e,n,i))}catch(s){throw new Error(`
${s.message}
|   Skipping rule ${JSON.stringify(n,void 0,4)}

`)}return{rules:r}}function Ws(e,t,i,r){let n=(r==null?void 0:r.canonical)??(t.isCanonical||t.isStructural),s=!1;if(t.ops&&(r!=null&&r.recursive)){let x=t.ops.map(T=>{let C=Ws(e,T,{},r);return C?(s=!0,C.value):T});s&&(t=t.engine.function(t.operator,x,{canonical:n}))}let{match:a,replace:o,condition:l,id:u,onMatch:c,onBeforeMatch:f}=e,p=u??"";if(n&&a){let x=or(a),T=a;a=a.canonical;let C=or(a);if(!x.every(I=>C.includes(I)))throw new Error(`
|   Invalid rule "${e.id}"
|   The canonical form of ${mn(T).toString()} is "${mn(a).toString()}" and it does not contain all the wildcards of the original match.
|   This could indicate that the match expression in canonical form is already simplified and this rule may not be necessary`)}let h=e.useVariations??(r==null?void 0:r.useVariations)??!1;f==null||f(e,t);let d=a?t.match(a,{substitution:i,...r,useVariations:h}):{};if(d===null)return s?{value:t,because:p}:null;if(typeof l=="function"){let x={...Object.fromEntries(Object.entries(d).map(([T,C])=>[T.slice(1),C])),...d};try{if(!l(x,t.engine))return s?{value:t,because:p}:null}catch(T){return console.error(`
|   Rule "${e.id}"
|   Error while checking condition
|    ${T.message}`),null}}let y=typeof o=="function"?o(t,d):o.subs(d,{canonical:n});return y?(c==null||c(e,t,y),_m(y)?n?{...y,value:y.value.canonical}:y:{value:n?y.canonical:y,because:p}):null}function sr(e,t,i){if(!t)throw new Error("replace(): Expected one or more rules");let r=(i==null?void 0:i.iterationLimit)??1,n=0,s=(i==null?void 0:i.once)??!1,a;typeof t=="object"&&"rules"in t?a=t.rules:a=e.engine.rules(Array.isArray(t)?t:[t]).rules;let o=!1,l=[];for(;!o&&n<r;){o=!0;for(let u of a)try{let c=Ws(u,e,{},i);if(c!==null&&c.value!==e&&!c.value.isSame(e)){if(s)return[c];if(l.some(f=>f.value.isSame(c.value)))return l;l.push(c),o=!1,e=c.value}}catch(c){return console.error(`
${e.toString()}
${u.id}
${c.message}`),l}n+=1}return l}function ar(e,t,i,r){let n=[];for(let s of t.rules){let a=Ws(s,e,i,r);a!==null&&!n.some(o=>o.isSame(a.value))&&n.push(a.value)}return n}function mn(e){let t=e.symbol;if(t&&t.startsWith("_"))return e.engine.symbol(t.slice(1));if(e.ops){let i=e.ops.map(r=>mn(r));return e.engine.function(e.operator,i,{canonical:!1})}return e}function or(e){let t=[];return e.symbol&&e.symbol.startsWith("_")&&t.push(e.symbol),e.ops&&e.ops.forEach(i=>t.push(...or(i))),t}function Yl(e,t){let i=or(e),r=or(t);return i.every(n=>r.includes(n))}function _m(e){return e&&typeof e=="object"&&"because"in e&&"value"in e}function wm(e){return e&&typeof e=="object"&&e._tag==="boxed-rule"}function B(e){for(let[t,i]of Object.entries(e))if(t!=="x"&&t!=="_x"&&i.has("_x"))return!1;return!0}var km=[{match:["Power",["Add",["Multiply","_a","_x"],"__b"],"_n"],replace:["Divide",["Power",["Add",["Multiply","_a","_x"],"__b"],["Add","_n",1]],["Multiply","_a",["Add","_n",1]]],condition:e=>B(e)&&!e._n.is(-1)},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/2],replace:["Divide",["Multiply",2,["Power",["Add",["Multiply","_a","_x"],"__b"],3]],["Multiply",3,"_a"]],condition:e=>B(e)&&e._a.isNumberLiteral},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/3],replace:["Divide",["Multiply",3,["Power",["Add",["Multiply","_a","_x"],"__b"],4]],["Multiply",4,"_a"]],condition:e=>B(e)&&e._a.isNumberLiteral},{match:["Power","__a","_x"],replace:["Divide",["Power","__a","_x"],["Ln",["Abs","__a"]]],condition:e=>B(e)&&e._x.isNumberLiteral},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],-1],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:B},{match:["Divide",1,["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:B},{match:["Ln",["Add",["Multiply","_a","_x"],"__b"]],replace:["Subtract",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Ln","_x"]],["Subtract",["Multiply","_a","_x"],"__b"]],condition:B},{match:["Exp",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Exp",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:B},{match:["Power",["Sech",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Tanh",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:B},{match:["Power",["Sin",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:B},{match:["Power",["Cos",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:B},{match:["Sin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Cos",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:B},{match:["Cos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Sin",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:B},{match:["Tan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sec",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Sec",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:B},{match:["Csc",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Add",["Csc",["Add",["Multiply","_a","_x"],"__b"]],["Cot",["Add",["Multiply","_a","_x"],"__b"]]]]]],"_a"],condition:B},{match:["Cot",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Sin",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:B},{match:["Sinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Cosh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Cosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sinh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Tanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sech",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Sech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Tanh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Csch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Coth",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:B},{match:["Coth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Csch",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:B},{match:["Arcsinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:B},{match:["Arccosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:B},{match:["Arctanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",1,["Add",["Multiply","_a","_x"],"__b"]],["Subtract",1,["Add",["Multiply","_a","_x"],"__b"]]]],["Multiply",2,"_a"]],condition:B},{match:["Arcsech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:B},{match:["Arccsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:B},{match:["Arccoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",["Add",["Multiply","_a","_x"],"__b"],1],["Subtract",["Add",["Multiply","_a","_x"],"__b"],1]]],["Multiply",2,"_a"]],condition:B},{match:["Arccsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:B},{match:["Arccoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:B},{match:["Arctan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:B},{match:["Arccos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:B},{match:["Arcsin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]]]],"_a"],condition:B}];function $i(e,t){if(e.operator==="Function"||e.operator==="Block"||e.operator==="Delimiter")return $i(e.op1,t);let i=e.engine;if(e.symbol===t)return i.box(["Divide",["Power",e,2],2]);if(!e.has(t))return i.box(["Multiply",e,i.symbol(t)]);if(e.operator==="Add"){let a=e.ops.map(o=>$i(o,t));return me(...a).evaluate()}if(e.operator==="Negate")return $i(e.op1,t).neg();if(e.operator==="Multiply"){let a=e.ops.map((o,l)=>{let u=e.ops.slice();u.splice(l,1);let c=Ve(...u);return $i(o,t).mul(c)});return me(...a).evaluate()}if(e.operator==="Divide"){if(!e.op2.has(t)){let a=$i(e.op1,t);return e.engine.box(["Divide",a,e.op2])}return Jl(e,t)}let r=i.rules(km),n=(Ps(e)??e).subs({[t]:"_x"},{canonical:!0}),s=ar(n,r,{_x:i.symbol("_x")},{useVariations:!0,canonical:!0});return s&&s[0]?s[0].subs({_x:t}):Jl(e,t)}function Jl(e,t){let i=e.engine;return i.function("Integrate",[e,i.symbol(t,{canonical:!1})])}var Sm=[{Derivative:{broadcastable:!1,lazy:!0,signature:"(function, order:number?) -> function",canonical:(e,{engine:t})=>{var n;let i=Me(e[0].canonical);if(!i)return null;if(!e[1])return t._fn("Derivative",[i]);let r=ke(t,(n=e[1])==null?void 0:n.canonical,"number");return t._fn("Derivative",[i,r])},evaluate:e=>{var r;let t=e[0].evaluate(),i=Math.floor((r=e[1])==null?void 0:r.N().re);return ym(t,isNaN(i)?1:i)}},D:{broadcastable:!1,scoped:!0,lazy:!0,signature:"(expression, variable:symbol, variables:symbol+) -> expression",canonical:(e,{engine:t,scope:i})=>{let r=jr(t,e);return r?t._fn("D",[r,...e.slice(1)],{scope:i}):null},evaluate:(e,{engine:t})=>{let i=e[0].canonical;i=i.evaluate();let r=e.slice(1);r.length===0&&(i=void 0);for(let n of r){if(!n.symbol){i=void 0;break}if(i&&i.operator==="Function"&&(i=i.op1),i=tt(i,n.symbol),i===void 0)break}return i=i==null?void 0:i.canonical,(i==null?void 0:i.operator)==="D"?i:i==null?void 0:i.evaluate()}},ND:{broadcastable:!1,lazy:!0,signature:"(function, at:number) -> number",canonical:(e,{engine:t})=>{var n;let i=Me(e[0]);if(!i)return null;let r=ke(t,(n=e[1])==null?void 0:n.canonical,"number");return t._fn("ND",[i,r])},evaluate:([e,t],{engine:i})=>{let r=t.N().re;if(!isNaN(r))return i.number(Lf(e.compile(),r))}},Integrate:{wikidata:"Q80091",broadcastable:!1,lazy:!0,signature:"(function, limits+) -> number",canonical:(e,{engine:t})=>{if(!e[0])return null;let i=Me(e[0]);if(!i)return null;let r=wh(e.slice(1),{engine:t});return t._fn("Integrate",[i,...r])},evaluate:(e,{engine:t,numericApproximation:i})=>{var a,o;if(i){let l=e[0],u=e[1],[c,f]=[u.op2.N().re,u.op3.N().re];if(isNaN(c)||isNaN(f))return;let p=l.compile(),h=Kr(p,c,f,p.isCompiled?1e7:1e4);return t.box(["PlusMinus",t.number(h.estimate),t.number(h.error)])}let r=e[0],n=((o=(a=r.ops)==null?void 0:a.slice(1))==null?void 0:o.map(l=>l.symbol))??[],s=e.slice(1);if(s.length!==0){for(let l=s.length-1;l>=0;l--){let[u,c,f]=s[l].ops,p=u.symbol;(!p||p==="Nothing")&&l<n.length&&(p=n[l]),p||(p="x");let h=$i(r,p);if(h.operator!=="Integrate"){let d=h;if(c.symbol==="Nothing"&&f.symbol==="Nothing")r=d;else{let y=t.box(["Function",h,p]);r=t.box(["EvaluateAt",y,c,f])}}else if(c.symbol==="Nothing"&&f.symbol==="Nothing")r=h;else{let d=t.box(["Function",h,p]);r=t.box(["EvaluateAt",d,c,f])}}return r.operator!=="Integrate"?r.evaluate({numericApproximation:i}):r}}},NIntegrate:{broadcastable:!1,lazy:!0,signature:"(function, limits:(tuple|symbol)?) -> number",canonical:(e,{engine:t})=>{let[i,r,n]=e,s=Me(i);return!s||!r||!n?null:t._fn("NIntegrate",[s,r.canonical,n.canonical])},evaluate:([e,t,i],{engine:r})=>{let[n,s]=[t.N().re,i.N().re];if(isNaN(n)||isNaN(s))return;let a=e.compile();return r.number(Kr(a,n,s,a.isCompiled?1e7:1e4).estimate)}},Limits:{description:"Limits of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(index:symbol, lower:number, upper:number) -> tuple",canonical:(e,{engine:t})=>ri(e,{engine:t})??null}},{Limit:{description:"Limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([e,t,i],{engine:r})=>{let n=Me(e);return!n||!t?null:i===void 0?r._fn("Limit",[n,t.canonical]):r._fn("Limit",[n,t.canonical,i.canonical])},evaluate:([e,t,i],{engine:r,numericApproximation:n})=>{if(n){let s=t.N().re;if(Number.isNaN(s))return;let a=e.compile();return r.number(hi(a,s,i?i.re:1))}}},NLimit:{description:"Numerical approximation of the limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([e,t,i],{engine:r})=>{let n=Me(e);return!n||!t?null:i===void 0?r._fn("NLimit",[n,t.canonical]):r._fn("NLimit",[n,t.canonical,i.canonical])},evaluate:([e,t,i],{engine:r})=>{let n=t.N().re;if(Number.isNaN(n))return;let s=e.compile();return r.number(hi(s,n,i?i.re:1))}}}],Tm=[{Block:{lazy:!0,scoped:!0,signature:"(unknown*) -> unknown",type:e=>e.length===0?"nothing":e[e.length-1].type,canonical:Mm,evaluate:Im},Condition:{lazy:!0,signature:"(value, symbol) -> boolean",evaluate:([e,t],{engine:i})=>{let r=[];return t.symbol?r=[t.symbol]:t.operator==="And"&&(r=t.ops.map(n=>n.symbol??"")),bm(e,r)?i.True:i.False}},If:{lazy:!0,signature:"(expression, expression, expression) -> any",type:([e,t,i])=>$e(t.type.type,i.type.type),canonical:([e,t,i],{engine:r})=>r._fn("If",[e.canonical,t.canonical,i.canonical]),evaluate:([e,t,i],{engine:r})=>{let n=e.evaluate().symbol;if(n==="True")return(t==null?void 0:t.evaluate())??r.Nothing;if(n==="False")return(i==null?void 0:i.evaluate())??r.Nothing;throw new Error(`Condition must evaluate to "True" or "False". ${mt(e)}`)}},Loop:{lazy:!0,signature:"(body:expression, collection:expression) -> any",type:([e])=>e.type,evaluate:([e,t],{engine:i})=>Yr(Kl(e,t,i),i._timeRemaining),evaluateAsync:async([e,t],{engine:i,signal:r})=>Qr(Kl(e,t,i),i._timeRemaining,r)},Which:{lazy:!0,signature:"(expression+) -> unknown",type:e=>e.length%2!==0?"nothing":$e(...e.filter((t,i)=>i%2===1).map(t=>t.type.type)),canonical:(e,t)=>e.length%2!==0?t.engine.Nothing:t.engine._fn("Which",e.map(i=>i.canonical)),evaluate:(e,t)=>Em(e,t)},FixedPoint:{lazy:!0,signature:"(any) -> unknown"}}];function Em(e,t){let i=0;for(;i<e.length-1;){let r=e[i].evaluate().symbol;if(r==="True")return e[i+1]?e[i+1].evaluate(t):t.engine.symbol("Undefined");if(r!=="False")throw new Error(`Condition must evaluate to "True" or "False". ${mt(e[i])}`);i+=2}return t.engine.symbol("Undefined")}function Im(e,{engine:t}){if(e.length===0)return t.Nothing;let i;for(let r of e){let n=r.operator;if(n==="Return"){i=r.op1.evaluate();break}if(n==="Break"||n==="Continue"){i=t.box([n,r.op1.evaluate()]);break}i=r.evaluate()}return i??t.Nothing}function Mm(e,t){let{engine:i,scope:r}=t;return e.length===0?null:i._fn("Block",i._inScope(r,()=>e.map(n=>n.canonical)),{scope:r})}function*Kl(e,t,i){if(e??(e=i.Nothing),e.symbol==="Nothing")return e;if(t!=null&&t.isCollection){let n,s=ne(e),a=0;for(let o of t.each()){if(n=s([o])??i.Nothing,n.operator==="Break")return n.op1;if(n.operator==="Return")return n;if(a+=1,a%1e3===0&&(yield n),a>i.iterationLimit)throw new Bt({cause:"iteration-limit-exceeded"})}return n}let r=0;for(;;){let n=e.evaluate();if(n.operator==="Break")return n.op1;if(n.operator==="Return")return n;if(r+=1,r%1e3===0&&(yield n),r>i.iterationLimit)throw new Bt({cause:"iteration-limit-exceeded"})}}var Am=[{Choose:{complexity:1200,signature:"(n:number, m:number) -> number",evaluate:(e,{engine:t})=>{let i=e[0].re,r=e[1].re;if(!(!Number.isFinite(i)||!Number.isFinite(r)))return i<0||r<0||r>i?t.NaN:t.number(Cl(i,r))}}},{Fibonacci:{description:"Compute the nth Fibonacci number.",wikidata:"Q47577",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null)return;if(i<0n)return t.function("Negate",["Fibonacci",t.number(-i)]);if(i===0n)return t.Zero;if(i===1n)return t.One;let r=0n,n=1n;for(let s=2n;s<=i;s++){let a=r+n;r=n,n=a}return t.number(n)}},Binomial:{description:"Compute the binomial coefficient C(n, k) = n! / (k! (n-k)!).",wikidata:"Q209875",signature:"(integer, integer) -> integer",evaluate:([e,t],{engine:i})=>{let r=he(e),n=he(t);if(r===null||n===null)return;if(n<0n||n>r)return i.number(0);if(n===0n||n===r)return i.number(1);let s=1n;for(let a=1n;a<=n;a++)s*=r-(n-a),s/=a;return i.number(s)}},CartesianProduct:{description:"Return the Cartesian product of input sets.",wikidata:"Q173740",signature:"(set+) -> set",collection:{contains:(e,t)=>{let i=e.ops;return!t.isCollection||t.ops.length!==i.length?!1:i.every((r,n)=>r.xcontains(t.ops[n])??!1)},count:e=>{let t=e.ops.map(i=>i.xsize);return t.includes(1/0)?1/0:t.reduce((i,r)=>i*r,1)},iterator:$m}},PowerSet:{description:"Return the power set of a set (set of all subsets).",wikidata:"Q205170",signature:"(set) -> set",collection:{contains:(e,t)=>{let i=e.ops[0];return t.isCollection?t.ops.every(r=>i.xcontains(r)??!1):!1},count:e=>{let t=e.ops[0];return t.isEmptyCollection?1:t.isFiniteCollection===!1?1/0:2**t.xsize},iterator:Cm}},Permutations:{description:"Return all permutations of length k (default full length) of a collection.",signature:"(collection, integer?) -> list<list>",evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=Array.from(e.each()),n=t?L(t):r.length;if(n===null||n<0||n>r.length)return;function*s(a,o){if(a.length===n){yield a;return}for(let l=0;l<o.length;l++){let u=o.slice(),[c]=u.splice(l,1);yield*s([...a,c],u)}}return i.function("List",[...s([],r)].map(a=>i.function("List",a)))}},Combinations:{description:"Return all k-element combinations of a collection.",wikidata:"Q193606",signature:"(collection, integer) -> list<list>",evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=Array.from(e.each()),n=L(t);if(n===null||n<0||n>r.length)return;function*s(a,o){if(o.length===n){yield o;return}for(let l=a;l<r.length;l++)yield*s(l+1,[...o,r[l]])}return i.function("List",[...s(0,[])].map(a=>i.function("List",a)))}},Multinomial:{description:"Compute the multinomial coefficient for multiple integers.",wikidata:"Q20820114",signature:"(integer+) -> integer",evaluate:(e,{engine:t})=>{let i=e.map(L);if(i.some(s=>s===null||s<0))return;let r=i.reduce((s,a)=>s+(a??0),0),n=1;for(let s=1;s<=r;s++)n*=s;for(let s of i)for(let a=1;a<=s;a++)n/=a;return t.number(n)}},Subfactorial:{description:"Compute the number of derangements (subfactorial) of n items.",wikidata:"Q2361661",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=L(e);if(i===null||i<0)return;let r=1;for(let n=1;n<=i;n++)r=Math.round(r*n*(1-1/n));return t.number(r)}},BellNumber:{description:"Compute the Bell number B(n), the number of partitions of a set of n elements.",wikidata:"Q816063",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=L(e);if(i===null||i<0)return;let r=[1];for(let n=1;n<=i;n++){let s=0;for(let a=0;a<n;a++)s+=qm(n-1,a)*r[a];r[n]=s}return t.number(r[i])}}}];function*$m(e){let t=e.ops,i=t.map(s=>[...s.each()]),r=i.map(s=>s.length);if(r.some(s=>s===0))return;let n=Array(t.length).fill(0);for(;;){let s=n.map((o,l)=>i[l][o]);yield e.engine._fn("Tuple",s);let a=n.length-1;for(;a>=0&&(n[a]++,!(n[a]<r[a]));)n[a]=0,a--;if(a<0)break}}function*Cm(e){let t=[...e.ops[0].each()],i=t.length,r=e.engine,n=1<<i;for(let s=0;s<n;s++){let a=[];for(let o=0;o<i;o++)(s&1<<o)!==0&&a.push(t[o]);yield a.length===0?r.symbol("EmptySet"):r._fn("Set",a)}}function qm(e,t){if(t<0||t>e)return 0;if(t===0||t===e)return 1;let i=1;for(let r=1;r<=t;r++)i*=e-(t-r),i/=r;return i}var Dm=[{Real:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([e])=>{let t=e.re;if(!isNaN(t))return t===0?"zero":t>0?"positive":"negative"},evaluate:(e,{engine:t})=>{let i=e[0].numericValue;if(i!==null)return typeof i=="number"?e[0]:t.number(i.bignumRe??i.re)}},Imaginary:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([e])=>{let t=e.im;if(!isNaN(t))return t===0?"zero":t>0?"positive":"negative"},evaluate:(e,{engine:t})=>{let i=e[0].numericValue;if(i!==null)return typeof i=="number"?t.Zero:t.number(i.im)}},Argument:{broadcastable:!0,complexity:1200,signature:"(number) -> real",evaluate:(e,{engine:t})=>{let i=e[0].numericValue;if(i!==null)return typeof i=="number"?i>=0?t.Zero:t.Pi:i.im===0?i.re>=0?t.Zero:t.Pi:t.function("ArcTan2",[i.im,i.re]).evaluate()}},AbsArg:{broadcastable:!0,complexity:1200,signature:"(number) -> tuple<real, real>",evaluate:(e,{engine:t})=>{if(e[0].numericValue!==null)return t.tuple(t.function("Abs",e).evaluate(),t.function("Argument",e).evaluate())}},Conjugate:{broadcastable:!0,complexity:1200,signature:"(number) -> number",type:([e])=>e.type,sgn:([e])=>e.sgn,evaluate:(e,{engine:t})=>{let i=e[0].numericValue;if(i!==null)return typeof i=="number"||i.im===0?e[0]:t.number(t.complex(i.re,-i.im))}},ComplexRoots:{broadcastable:!0,complexity:1200,signature:"(number, number) -> list<number>",evaluate:(e,{engine:t})=>{let i=e[0].re;if(isNaN(i))return;let r=e[1].re;if(!Number.isInteger(r)||r<=0)return;let n=[],s=e[0].im??0,a=Math.atan2(s,i),o=Math.sqrt(i*i+s*s);for(let l=0;l<r;l++){let u=(a+2*Math.PI*l)/r,c=Math.pow(o,1/r);n.push([c*Math.cos(u),c*Math.sin(u)])}return t.function("List",n.map(l=>t.number(l[1]!==0?t.complex(l[0],l[1]):l[0])))}}}];function Xl(e,{engine:t}){if(e.length===0)return null;let i=e[0];if(e.length===1)return i.canonical;if(e.length===2){let r=tu(i);if(!Number.isNaN(r)){let s=e[1];if(s.operator==="Divide"||s.operator==="Rational"){let[a,o]=[s.op1.canonical.re,s.op2.canonical.re];if(a>0&&a<=1e3&&o>1&&o<=1e3&&Number.isInteger(a)&&Number.isInteger(o)){let l=s.canonical;return r<0&&(l=l.neg()),t._fn("Add",[i.canonical,l])}}}let n=e[1];if(!Number.isNaN(r)&&Ls(n))return t.number(t.complex(0,r));if(i.symbol&&n.operator==="Delimiter"){if(n.nops===0){let a=t.lookupDefinition(i.symbol);return a?le(a)?t.box([i.symbol]):a.value.type.isUnknown?(i.infer("function"),t.box([i.symbol])):a.value.type.matches("function")?t.box([i.symbol]):t.typeError("function",a.value.type,i):(t.declare(i.symbol,"function"),t.box([i.symbol]))}let s=n.op1.operator==="Sequence"?n.op1.ops:[n.op1];if(s=fe(s),!t.lookupDefinition(i.symbol))return t.declare(i.symbol,"function"),t.function(i.symbol,s)}if(i.symbol&&n.operator==="Delimiter"&&(n.op2.string==="[,]"||n.op2.string==="[;]")){let s=n.op1.operator==="Sequence"?n.op1.ops:[n.op1];return t.function("At",[i,...s])}}return e=eu(e),e=fe(e),e.every(r=>r.isValid&&(r.type.isUnknown||r.type.matches("number")||r.isIndexedCollection&&!r.string))?t._fn("Multiply",e):t._fn("Tuple",e)}function eu(e){let t=[];for(let i of e)i.operator==="InvisibleOperator"?t.push(...eu(i.ops)):t.push(i);return t}function tu(e){if(e.isNumberLiteral){let t=e.re;if(Number.isInteger(t))return t}if(e.operator==="Negate"){let t=tu(e.op1);if(!Number.isNaN(t))return-t}return Number.NaN}function lr(e,t,i){if(t===!1)return e;if(t===!0)return e.engine._inScope(i,()=>e.canonical);typeof t=="string"&&(t=[t]),e=su(e);for(let r of t)switch(r){case"InvisibleOperator":e=Qs(e);break;case"Number":e=iu(e);break;case"Multiply":e=ru(e);break;case"Add":e=nu(e);break;case"Power":e=gn(e);break;case"Divide":e=au(e);break;case"Flatten":e=Hs(e);break;case"Order":e=tl(e,{recursive:!0});break;default:throw Error("Invalid canonical form")}return e}function Hs(e){if(!e.operator||!e.ops||e.nops===0)return e;if(e.operator==="Delimiter")return Hs(e.op1);let t=e.engine,i=e.operator==="Add"||e.operator==="Multiply";if(!i){let r=t.lookupDefinition(e.operator);le(r)&&r.operator.associative&&(i=!0)}return i?t.function(e.operator,yi(e.ops.map(Hs),e.operator)):e}function Qs(e){return e.ops?e.operator==="InvisibleOperator"?Xl(e.ops.map(Qs),{engine:e.engine})??e:e.engine._fn(e.operator,e.ops.map(Qs)):e}function iu(e){if(e.isNumberLiteral)return e.canonical;if(Ls(e))return e.engine.I;if(!e.isFunctionExpression)return e;let{engine:t}=e,i=e.ops.map(iu),{operator:r}=e;if((r==="Divide"||r==="Rational")&&i.length===2){let n=xi(i[0]);if(n!==null){let s=xi(i[1]);if(s!==null)return t.number([n,s])}return r="Divide",t._fn("Divide",i,{canonical:!1})}if(r==="Complex"){if(i.length===1){let n=i[0];return n.isNumberLiteral?t.number(t.complex(0,n.re)):t._fn("Multiply",[n,t.I],{canonical:!1})}if(i.length===2){let n=i[0].re,s=i[1].re;return s!==null&&n!==null&&!isNaN(s)&&!isNaN(n)?s===0&&n===0?t.Zero:s!==0?t.number(t._numericValue({re:n,im:s})):i[0]:t._fn("Add",[i[0],t._fn("Multiply",[i[1],t.I],{canonical:!1})],{canonical:!1})}throw new Error("Expected one or two arguments with `Complex` expression")}if(r==="Negate"&&i.length===1){let n=i[0],{numericValue:s}=n;if(s!==null)return t.number(typeof s=="number"?-s:s.neg());if(Ls(n))return t.number(t.complex(0,-1))}return i.every((n,s)=>n===e.ops[s])?e:t._fn(r,i,{canonical:!1})}function ru(e){if(!e.ops)return e;let t=e.ops.map(ru);return e.operator==="Multiply"?De(e.engine,t.map(i=>i.canonical)):e.operator==="Negate"?De(e.engine,[t[0],e.engine.NegativeOne]):e}function nu(e){if(!e.ops)return e;let t=e.ops.map(nu);return e.operator==="Add"?It(e.engine,t):e.operator==="Subtract"?It(e.engine,[t[0],t[1].neg()]):e.engine._fn(e.operator,t)}function gn(e){if(!e.ops)return e;let t=e.ops.map(i=>gn(i));return e.operator==="Power"?Ni(t[0],t[1]):e.engine._fn(e.operator,t,{canonical:!1})}function su(e){return e.symbol!==null?e.canonical:e.isFunctionExpression?e.engine._fn(e.operator,e.ops.map(su),{canonical:!1}):e}function au(e){return e.operator==="Divide"?Ut(gn(e.op1),gn(e.op2)):e.ops?e.engine._fn(e.operator,e.ops.map(au)):e}function ur(e){return e[Math.floor(Math.random()*e.length)]}function ou(e,t){if(e==="Add"||e==="Multiply"){let i=[],r=1+Math.floor(Math.random()*12);for(;r>0;)i.push($t(t+1)),r-=1;return[e,...i]}return e==="Divide"||e==="Power"?[e,$t(t+1),$t(t+1)]:e==="Root"?[e,$t(t+1),$t(10)]:e==="trig"?Pm():[e,$t(t+1)]}function Pm(){return[ur(["Cos","Sin","Tan","Sinh","Arccos","Arcsinh"]),ur(["Pi","-1","0","1",["Divide","Pi",-5],["Multiply",-2,["Divide","Pi",11]],["Multiply","Half","Pi"],["Multiply",5,"Pi"],["Multiply",12,"Pi"],["Divide","Pi",5],["Divide","Pi",9],["Multiply",5,["Divide","Pi",9]],["Multiply",2,["Divide","Pi",11]],["Multiply",2,["Divide","Pi",3]]])]}function $t(e){if(e??(e=1),e===1){let t=ur([["Sqrt",["Multiply",6,["Sum",["Divide",1,["Power","n",2]],["Triple",["Hold","n"],1,"PositiveInfinity"]]]],"Add","Add","Add","Add","Add","Multiply","Multiply","Multiply","Multiply","Divide","Divide","Divide","Root","Sqrt","Subtract","Negate","trig"]);return typeof t=="string"?ou(t,1):t}if(e===2){let t=Math.random();if(t>.75)return $t(1);if(t>.5)return $t(3);let i=ur(["Multiply","Multiply","Add","Power","trig","Ln","Exp"]);return ou(i,2)}return ur([-12345e-9,-2,-2,-2,-3,-5,-6,-12,-1654e-60,0,0,12345e-8,1654e-60,1,2,2,2,2,3,3,5,5,6,6,1234.5678,5678.1234,10,15,18,30,60,1234e54,"123456789.12345678912345e200","987654321.12345678912345",["Rational",-6,10],["Rational",-12,15],["Rational",-15,12],["Rational",3,5],["Rational",12,15],["Rational",15,12],"ExponentialE",["Sqrt",3],["Sqrt",5],["Sqrt",15],["Sqrt",25],["Complex",-1.1,1.1],["Complex",4,5],"x","x","x","x",["Add","x",1],["Divide","x",3],["Square","x"],["Power","x",3],["Power","x",4],["Subtract","x",1],["Add","x",1],"Pi"])}var Fm=[{Nothing:{type:"nothing"}},{InvisibleOperator:{complexity:9e3,lazy:!0,signature:"function",canonical:(e,{engine:t})=>{let i=Xl(e,{engine:t});return i?i.operator==="Multiply"?De(t,i.ops):i:t.Nothing}},Sequence:{lazy:!0,signature:"function",type:e=>e.length===0?"nothing":e.length===1?e[0].type:"any",canonical:(e,{engine:t})=>{let i=fe(e);return i.length===0?t.Nothing:i.length===1?i[0]:t._fn("Sequence",i)}},Delimiter:{complexity:9e3,lazy:!0,signature:"(any, string?) -> any",type:e=>e.length===0?"nothing":e[0].type,canonical:(e,{engine:t})=>{var n;if(e.length===0)return t._fn("Tuple",[]);if(e.length>2)return t._fn("Delimiter",At(t,e,2));let i=e[0];if(i.operator==="Sequence")return t._fn("Tuple",Et(t,i.ops));i=i.canonical;let r=(n=e[1])==null?void 0:n.string;return!r||r.startsWith("(")&&r.endsWith(")")?i:((r==null?void 0:r.length)??0)>3?t._fn("Delimiter",[i,t.error("invalid-delimiter",e[1].toString())]):t._fn("Delimiter",[e[0],ke(t,e[1],"string")])},evaluate:(e,t)=>{let i=t.engine;if(e.length===0)return i.Nothing;let r=e[0];return(r.operator==="Sequence"||r.operator==="Delimiter")&&(e=Vo(e[0].ops)),e.length===1?e[0].evaluate(t):i._fn("Tuple",e.map(n=>n.evaluate(t)))}},Error:{lazy:!0,complexity:500,signature:"((string|expression<ErrorCode>), expression?) -> nothing",canonical:(e,{engine:t})=>t._fn("Error",e)},ErrorCode:{complexity:500,lazy:!0,signature:"(string, any*) -> error",canonical:(e,{engine:t})=>{let i=ke(t,e[0],"string").string;return i==="incompatible-type"?t._fn("ErrorCode",[t.string(i),e[1],e[2]]):t._fn("ErrorCode",e)}},Unevaluated:{description:"Prevent an expression from being evaluated",lazy:!0,signature:"(any) -> unknown",type:([e])=>e.type,canonical:(e,{engine:t,scope:i})=>t._fn("Unevaluated",Et(t,e,i)),evaluate:([e],t)=>e.evaluate(t)},Hold:{description:"Hold an expression, preventing it from being canonicalized or evaluated until `ReleaseHold` is applied to it",lazy:!0,signature:"(any) -> unknown",type:([e])=>e.symbol?"symbol":e.string?"string":e.isNumberLiteral?e.type:e.ops?Ot(e.type.type)??"unknown":"unknown",eq:(e,t)=>(t.operator==="Hold"&&(t=t.ops[0]),e.ops[0].isSame(t)),evaluate:([e],{engine:t})=>t.hold(e)},ReleaseHold:{description:"Release an expression held by `Hold`",lazy:!0,signature:"(any) -> unknown",type:([e])=>e.operator==="Hold"?e.op1.type:e.type,evaluate:([e],t)=>(e.operator==="Hold"&&(e=e.op1),e.canonical.evaluate(t))},HorizontalSpacing:{signature:"(number) -> nothing",canonical:(e,{engine:t})=>e.length===2?e[0].canonical:t.Nothing},Annotated:{signature:"(expression, dictionary) -> expression",type:([e])=>e.type,complexity:9e3,lazy:!0,canonical:([e,t],{engine:i})=>(e=e.canonical,t=t.canonical,!cm(t)||t.keys.length===0?e:i._fn("Annotated",[e,t])),evaluate:([e,t],i)=>e.evaluate(i)},Text:{description:"A sequence of strings, annotated expressions and other Text expressions",signature:"(any*) -> expression"}},{About:{description:"Return information about an expression",lazy:!0,signature:"(any) -> string",evaluate:([e],{engine:t})=>{let i=[e.toString()];if(i.push(""),e.string)i.push("string");else if(e.symbol)if(e.valueDefinition){let r=e.valueDefinition;r.isConstant&&i.push("constant"),typeof r.description=="string"?i.push(r.description):Array.isArray(r.description)&&i.push(r.description.join(`
`)),r.wikidata&&i.push(`WikiData: ${r.wikidata}`),r.url&&i.push(`Read More: ${r.url}`)}else i.push("symbol"),i.push(`value: ${e.evaluate().toString()}`);else e.isNumberLiteral?i.push(e.type.toString()):e.ops?(i.push(e.type.toString()),i.push(e.isCanonical?"canonical":"non-canonical")):i.push("Unknown expression's type");return t.string(i.join(`
`))}},Head:{description:"Return the head of an expression, the name of the operator",lazy:!0,signature:"(any) -> symbol",canonical:(e,{engine:t})=>{if(e.length!==1)return null;let i=e[0];return i.operator?t.box(i.operator):t._fn("Head",Et(t,e))},evaluate:(e,{engine:t})=>{var i;return t.symbol(((i=e[0])==null?void 0:i.operator)??"Undefined")}},Tail:{description:"Return the tail of an expression, the operands of the expression",lazy:!0,signature:"(any) -> collection",canonical:(e,{engine:t})=>{if(e.length!==1)return null;let i=e[0];return i.ops?t._fn("Sequence",i.ops):t._fn("Tail",Et(t,e))},evaluate:([e],{engine:t})=>e!=null&&e.ops?t._fn("Sequence",e.ops):t.Nothing},Identity:{description:"Return the argument unchanged",signature:"(any) -> unknown",type:([e])=>e.type,evaluate:([e])=>e}},{Apply:{description:"Apply a function to a list of arguments",signature:"(name:symbol, arguments:expression*) -> unknown",type:([e])=>Ot(e.type.type)??"unknown",canonical:(e,{engine:t})=>e[0].symbol?t.function(e[0].symbol,e.slice(1)):t._fn("Apply",e),evaluate:e=>ei(e[0],e.slice(1))},Assign:{description:"Assign a value to a symbol",lazy:!0,pure:!1,signature:"(symbol, any) -> any",type:([e,t])=>t.type,canonical:(e,{engine:t})=>{if(e.length!==2)return null;let i=e[0];return i.symbol||(i=ke(t,e[0],"symbol")),t._fn("Assign",[i,e[1].canonical])},evaluate:([e,t],{engine:i})=>{let r=e.evaluate();if(!r.symbol)return;let n=t.evaluate();return i.assign(r.symbol,n),n}},Assume:{description:"Assume a type for a symbol",lazy:!0,pure:!1,signature:"(any) -> symbol",evaluate:(e,{engine:t})=>t.symbol(t.assume(e[0]))},Declare:{lazy:!0,pure:!1,signature:"(symbol, type: string | symbol) -> nothing",canonical:(e,{engine:t})=>{let i=e[0];return i.symbol||(i=ke(t,e[0],"symbol")),e.length===1?t._fn("Declare",[i]):e.length!==2?null:t._fn("Declare",[i,e[1]])},evaluate:(e,{engine:t})=>{let i=e[0].evaluate().symbol;if(!i)return;if(!e[1])return t.declare(i,{inferred:!0,type:"unknown"}),t.Nothing;let r=e[1].canonical.evaluate(),n=R(r.string??r.symbol??void 0);if(Mr(n))return t.declare(i,n),t.Nothing}},Type:{lazy:!0,signature:"(any) -> string",evaluate:([e],{engine:t})=>t.string(e.type.toString()??"unknown")},Evaluate:{lazy:!0,signature:"(any) -> unknown",type:([e])=>e.type,canonical:(e,{engine:t})=>t._fn("Evaluate",At(t,e,1)),evaluate:([e],t)=>e.evaluate(t)},EvaluateAt:{lazy:!0,signature:"(function, lower:number, upper:number) -> number",type:([e])=>Ot(e.type.type)??"number",canonical:(e,{engine:t})=>{if(e.length===0)return null;let i=Me(e[0]);return i?t._fn("EvaluateAt",[i,...e.slice(1).map(r=>ke(t,r,"value"))]):null},evaluate:([e,t,i],{engine:r})=>{if(i===void 0){let a=ei(e,[t]);return a&&a.isNumberLiteral?a:r._fn("EvaluateAt",[e,t])}let n=ei(e,[t]),s=ei(e,[i]);return n&&s&&n.N().isNumberLiteral&&s.N().isNumberLiteral?s.sub(n):r._fn("EvaluateAt",[e,t,i])}},BuiltinFunction:{complexity:9876,lazy:!0,signature:"(symbol | string) -> symbol",canonical:([e],{engine:t})=>t.symbol(e.symbol??e.string??"Undefined")},Function:{description:"A function literal",complexity:9876,lazy:!0,signature:"(expression, symbol*) -> function",type:([e,...t])=>`(${t.map(i=>i.type.type)}) -> ${e.type.type}`,canonical:(e,{engine:t})=>jr(t,e)??null,evaluate:e=>{}},Rule:{lazy:!0,signature:"(match: expression, replace: expression, predicate: function?) -> expression",evaluate:([e,t,i],{engine:r})=>{}},Simplify:{lazy:!0,signature:"(any) -> expression",canonical:(e,{engine:t})=>t._fn("Simplify",At(t,e,1)),evaluate:([e])=>e.simplify()??void 0},CanonicalForm:{description:["Return the canonical form of an expression","Can be used to sort arguments of an expression.",'Sorting arguments of commutative functions is a weak form of canonicalization that can be useful in some cases, for example to accept "x+1" and "1+x" while rejecting "x+1" and "2x-x+1"'],complexity:8200,lazy:!0,signature:"(any, symbol*) -> any",canonical:e=>{if(e.length===1)return e[0].canonical;let t=e.slice(1).map(i=>i.symbol??i.string).filter(i=>i!=null);return lr(e[0],t)}},N:{description:"Numerically evaluate an expression",lazy:!0,signature:"(any) -> unknown",type:([e])=>e.type,canonical:(e,{engine:t})=>{if(e.length!==1)return t._fn("N",At(t,e,1));let i=e[0].operator;return i==="N"||i==="Evaluate"?e[0].canonical:t._fn("N",e)},evaluate:([e])=>e.N()},Random:{description:["Random(): Return a random number between 0 and 1","Random(n): Return a random integer between 0 and n-1","Random(m, n): Return a random integer between m and n-1"],pure:!1,signature:"(lower:integer?, upper:integer?) -> finite_number",type:([e,t])=>e===void 0&&t===void 0?"finite_number":"finite_integer",sgn:()=>"non-negative",evaluate:(e,{engine:t})=>{if(e.length===0)return t.number(Math.random());let[i,r]=e,n,s;return r===void 0?(n=0,s=Math.floor(i.re-1),isNaN(s)&&(s=0)):(n=Math.floor(i.re),s=Math.floor(r.re),isNaN(n)&&(n=0),isNaN(s)&&(s=0)),t.number(n+Math.floor(Math.random()*(s-n)))}},Signature:{lazy:!0,signature:"(symbol) -> string | nothing",evaluate:([e],{engine:t})=>e.operatorDefinition?t.string(e.operatorDefinition.signature.toString()):t.Nothing},Subscript:{lazy:!0,signature:"(collection, any) -> any",type:([e,t],{engine:i})=>e.string&&se(t)!==null?"integer":e.isIndexedCollection?bt(e.type.type)??"any":e.symbol?"symbol":"expression",canonical:([e,t],{engine:i})=>{var r;if(e=e.canonical,e.string){let n=se(t.canonical);if(n!==null&&n>1&&n<=36){let[s,a]=Hr(e.string,n);return a?i.error(["unexpected-digit",a[0]],e.toString()):i.number(s)}return i._fn("Baseform",[e,i.error(["invalid-base",t.toString()])])}if(e.isIndexedCollection)return i._fn("At",[e,t.canonical]);if(e.symbol){let n=t.string??t.symbol??((r=se(t))==null?void 0:r.toString());if(n)return i.symbol(e.symbol+"_"+n)}return t.operator==="Sequence"&&i._fn("Subscript",[e,i._fn("List",t.ops)]),i._fn("Subscript",[e,t])}},Symbol:{complexity:500,description:"Construct a new symbol with a name formed by concatenating the arguments",broadcastable:!0,lazy:!0,signature:"function",type:e=>e.length===0?"nothing":"symbol",canonical:(e,{engine:t})=>e.length===0?t.Nothing:t._fn("Symbol",e.map(i=>i.symbol?i:i.canonical)),evaluate:(e,{engine:t})=>{e.length>0;let i=e.map(r=>{var n;return r.symbol??r.string??((n=se(r))==null?void 0:n.toString())??""}).join("");return t.symbol(i)}},Timing:{description:"`Timing(expr)` evaluates `expr` and return a `Pair` of the number of second elapsed for the evaluation, and the value of the evaluation",signature:"(value, repeat: integer?) -> tuple<result:value, time:number>",evaluate:(e,{engine:t})=>{if(e[1].symbol==="Nothing"){let l=globalThis.performance.now(),u=e[0].evaluate(),c=1e3*(globalThis.performance.now()-l);return t.tuple(t.number(c),u)}let i=Math.max(3,L(e[1])??3),r=[],n;for(;i>0;){let l=globalThis.performance.now();n=e[0].evaluate(),r.push(1e3*(globalThis.performance.now()-l)),i-=1}let s=Math.max(...r),a=Math.min(...r);r=r.filter(l=>l>a&&l<s);let o=r.reduce((l,u)=>l+u,0);return o===0?t.tuple(t.number(s),n):t.tuple(t.number(o/r.length),n)}}},{Wildcard:{signature:"(symbol) -> symbol",canonical:(e,{engine:t})=>e.length!==1?t.symbol("_"):t.symbol("_"+e[0].symbol)},WildcardSequence:{signature:"(symbol) -> symbol",canonical:(e,{engine:t})=>e.length!==1?t.symbol("__"):t.symbol("__"+e[0].symbol)},WildcardOptionalSequence:{signature:"(symbol) -> symbol",canonical:(e,{engine:t})=>e.length!==1?t.symbol("___"):t.symbol("___"+e[0].symbol)}},{LatexString:{description:"Value preserving type conversion/tag indicating the string is a LaTeX string",signature:"(string) -> string",evaluate:([e])=>e},Latex:{description:"Serialize an expression to LaTeX",signature:"(any+) -> string",evaluate:(e,{engine:t})=>t.box(["LatexString",t.string(k(e.map(i=>i.latex)))])},Parse:{description:"Parse a LaTeX string and evaluate to a corresponding expression",signature:"(string) -> any",evaluate:([e],{engine:t})=>t.parse(e.string)??t.Nothing}},{String:{description:"A string created by joining its arguments. The arguments are converted to their default string representation.",broadcastable:!0,signature:"(any*) -> string",evaluate:(e,{engine:t})=>e.length===0?t.string(""):t.string(e.map(i=>i.toString()).join(""))},StringFrom:{description:"Create a string by converting its arguments to a string and joining them.",broadcastable:!0,signature:"(any, format:string?) -> string",evaluate:([e,t],{engine:i})=>{if(e===void 0)return i.string("");let r=(t==null?void 0:t.string)??"default";return r==="default"?i.string(e.toString()):r==="utf-8"?e.isIndexedCollection?i.string(new TextDecoder("utf-8").decode(new Uint8Array([...e.each()].map(n=>L(n)??65533)))):i.typeError(R("indexed_collection<integer>"),e.type):r==="utf-16"?e.isIndexedCollection?i.string(new TextDecoder("utf-16").decode(new Uint16Array([...e.each()].map(n=>L(n)??65533)))):i.typeError(R("indexed_collection<integer>"),e.type):r==="unicode-scalars"?e.isIndexedCollection?i.string(String.fromCodePoint(...[...e.each()].map(n=>L(n)??65533))):i.typeError(R("indexed_collection<integer>"),e.type):i.string(e.toString())}},Utf8:{description:"A collection of utf-8 code units from a string.",signature:"(string) -> list<integer>",evaluate:([e],{engine:t})=>{if(!e.string)return;let i=e.buffer;return t.function("List",Array.from(i,r=>t.number(r)))}},Utf16:{description:"A collection of utf-16 code units from a string.",signature:"(string) -> list<integer>",evaluate:([e],{engine:t})=>{if(!e.string)return;let i=[];for(let r=0;r<e.string.length;r++){let n=e.string.charCodeAt(r);i.push(n)}return t.function("List",i.map(r=>t.number(r)))}},UnicodeScalars:{description:"A collection of Unicode scalars from a string, same as utf-32",signature:"(string) -> list<integer>",evaluate:([e],{engine:t})=>{if(!e.string)return;let i=e.unicodeScalars;return t.function("List",i.map(r=>t.number(r)))}},GraphemeClusters:{description:"A collection of grapheme clusters from a string.",signature:"(string) -> list<string>",evaluate:([e],{engine:t})=>{if(!e.string)return;let i=new Intl.Segmenter("en",{granularity:"grapheme"}),r=Array.from(i.segment(e.string),n=>t.string(n.segment));return t.function("List",r)}},BaseForm:{description:"`BaseForm(expr, base=10)`",complexity:9e3,signature:"(number, (string|integer)?) -> string | nothing",type:([e])=>e===void 0?"nothing":e.type,evaluate:([e])=>e},DigitsFrom:{description:"Return an integer representation of the string `s` in base `base`.",signature:"(string, (string|integer)?) -> integer",evaluate:(e,{engine:t})=>{var l,u;let i=(l=e[0])==null?void 0:l.string,r=t;if(!i)return r.typeError("string",(u=e[0])==null?void 0:u.type,e[0]);if(i=i.trim(),i.startsWith("0x"))return r.number(parseInt(i.slice(2),16));if(i.startsWith("0b"))return r.number(parseInt(i.slice(2),2));let n=e[1]??r.Nothing;if(n.symbol==="Nothing")return r.number(Number.parseInt(i,10));let s=n.re;if(!n.isInteger||!Number.isFinite(s)||s<2||s>36)return r.error(["unexpected-base",s.toString()],n.toString());let[a,o]=Hr(i,n.string??n.symbol??10);return o?r.error(["unexpected-digit",o[0]],o):r.number(a)}},IntegerString:{description:"`IntegerString(n, base=10)`       return a string representation of the integer `n` in base `base`.",broadcastable:!0,signature:"(integer, integer?) -> string",evaluate:(e,{engine:t})=>{let i=t,r=e[0];if(!r.isInteger)return i.typeError("integer",r.type,r);let n=r.re;if(!Number.isFinite(n))return i.typeError("integer",r.type,r);let s=e[1]??i.Nothing;if(s.symbol==="Nothing")return r.bignumRe!==void 0?i.string(r.bignumRe.abs().toString()):i.string(Math.abs(n).toString());let a=se(s);return a===null?i.typeError("integer",s.type,s):a<2||a>36?i.error(["out-of-range","2","36",a.toString()],s.toString()):i.string(Math.abs(n).toString(a))}}},{RandomExpression:{signature:"() -> expression",evaluate:(e,{engine:t})=>t.box($t())}}];function lu(e,t){switch(t){case"float64":case"float32":case"int32":case"uint8":return new uu(e);case"complex128":case"complex64":return new zm(e);case"bool":case"expression":return new Om(e);case void 0:return new uu(e)}throw new Error(`Unknown dtype ${t}`)}var uu=class{constructor(e){m(this,"one",1);m(this,"zero",0);m(this,"nan",NaN);this.ce=e}cast(e,t){let i=this.ce;switch(t){case"float64":case"float32":case"int32":case"uint8":return e;case"complex128":case"complex64":return Array.isArray(e)?e.map(r=>i.complex(r)):this.ce.complex(e);case"bool":return Array.isArray(e)?e.map(r=>r!==0):e!==0;case"expression":return Array.isArray(e)?e.map(r=>i.number(r)):i.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e===0}isOne(e){return e===1}equals(e,t){return e===t}add(e,t){return e+t}addn(...e){return e.reduce((t,i)=>t+i,0)}neg(e){return-e}sub(e,t){return e-t}mul(e,t){return e*t}muln(...e){return e.reduce((t,i)=>t*i,1)}div(e,t){return e/t}pow(e,t){return e**t}conjugate(e){return e}},Om=class{constructor(e){m(this,"one");m(this,"zero");m(this,"nan");m(this,"ce");this.zero=e.Zero,this.nan=e.NaN,this.ce=e}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":case"float32":return e.im===0?e.re:void 0;case"int32":return typeof e.re=="number"?Math.round(e.re):void 0;case"uint8":if(typeof e.re!="number")return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":case"complex64":let[r,n]=[e.re,e.im];return typeof r=="number"&&typeof n=="number"?this.ce.complex(r,n):typeof r=="number"?this.ce.complex(r):void 0;case"bool":let s=e.valueOf();return typeof s=="boolean"?s:void 0;case"expression":return e}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return e}isZero(e){return e.is(0)}isOne(e){return e.is(1)}equals(e,t){return e.isSame(t)===!0}add(e,t){return e.add(t)}addn(...e){return me(...e)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return Ve(...e)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return this.ce.function("Conjugate",[e]).evaluate()}},zm=class{constructor(e){m(this,"one");m(this,"zero");m(this,"nan");m(this,"ce");this.ce=e,this.one=e.complex(1),this.zero=e.complex(0),this.nan=e.complex(NaN)}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":return e.im===0?e.re:void 0;case"float32":return e.im===0?e.re:void 0;case"int32":return e.im===0?Math.round(e.re):void 0;case"uint8":if(e.im!==0)return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":return e;case"complex64":return e;case"bool":return!(e.im===0&&e.re===0);case"expression":return this.ce.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e.isZero()}isOne(e){return e.re===1&&e.im===0}equals(e,t){return e.equals(t)}add(e,t){return e.add(t)}addn(...e){return e.reduce((t,i)=>t.add(i),this.zero)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return e.reduce((t,i)=>t.mul(i),this.one)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return e.conjugate()}};function cu(e,t){return e===void 0?t:e===t?e:e==="expression"||t==="expression"?"expression":e==="complex128"||t==="complex128"?"complex128":e==="complex64"||t==="complex64"?"complex64":e==="float64"||t==="float64"?"float64":e==="float32"||t==="float32"?"float32":e==="int32"||t==="int32"?"int32":e==="uint8"||t==="uint8"?"uint8":e==="bool"||t==="bool"?"bool":"expression"}function Lm(e){if(e.symbol==="True"||e.symbol==="False")return"bool";if(e.symbol==="NaN"||e.symbol==="PositiveInfinity"||e.symbol==="NegativeInfinity")return"float64";if(e.symbol==="ComplexInfinity"||e.symbol==="ImaginaryUnit")return"complex128";if(e.isNumberLiteral)switch(e.type.type){case"real":case"rational":case"finite_real":case"finite_rational":case"integer":return"float64";case"complex":case"finite_complex":case"imaginary":return"complex128";case"finite_integer":{let t=e.re;return t>=0&&t<=255?"uint8":"int32"}default:return"expression"}return"expression"}var dn=class Qt{constructor(t,i){m(this,"field");m(this,"shape");m(this,"rank");m(this,"_strides");this.ce=t,this.shape=i.shape,this.rank=this.shape.length,this._strides=Rm(this.shape),this.field=lu(t,i.dtype)}static align(t,i){if(t.dtype===i.dtype)return[t,i];let r=cu(t.dtype,i.dtype);return t.dtype===r?[t,i.upcast(r)]:[t.upcast(r),i]}static broadcast(t,i,r){if(!(r instanceof Qt))return i.map1(t,r);let[n,s]=Qt.align(i,r),a=n.data.map((o,l)=>t(o,s.data[l]));return it(n.ce,{dtype:n.dtype,shape:n.shape,data:a})}get expression(){let t=this.shape,i=this.rank,r=this.data,n=this._index.bind(this),s=this.field.expression.bind(this.field),a=o=>{if(o.length===i-1){let l=n(o);return this.ce._fn("List",r.slice(l,l+t[i-1]).map(u=>s(u)))}else{let l=[];for(let u=1;u<=t[o.length];u++)l.push(a([...o,u]));return this.ce._fn("List",l)}};return a([])}get array(){let t=this.shape,i=this.rank,r=this.data;if(i===1)return r;if(i===2){let[a,o]=t,l=new Array(a);for(let u=0;u<a;u++)l[u]=r.slice(u*o,(u+1)*o);return l}let n=this._index.bind(this),s=a=>{if(a.length===i-1){let o=n(a);return r.slice(o,o+t[i-1])}else{let o=[];for(let l=0;l<t[a.length];l++)o.push(s([...a,l+1]));return o}};return s([])}_index(t){let i=this._strides;return t.reduce((r,n,s)=>r+(n-1)*i[s],0)}get isSquare(){let t=this.shape;return t.length===2&&t[0]===t[1]}get isSymmetric(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.equals.bind(this.field);for(let n=0;n<t;n++)for(let s=n+1;s<t;s++)if(!r(i[n*t+s],i[s*t+n]))return!1;return!0}get isSkewSymmetric(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.equals.bind(this.field),n=this.field.neg.bind(this.field);for(let s=0;s<t;s++)for(let a=s+1;a<t;a++)if(!r(i[s*t+a],n(i[a*t+s])))return!1;return!0}get isUpperTriangular(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.isZero.bind(this.field);for(let n=1;n<t;n++)for(let s=0;s<n;s++)if(r(i[n*t+s]))return!1;return!0}get isLowerTriangular(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.isZero.bind(this.field);for(let n=0;n<t-1;n++)for(let s=n+1;s<t;s++)if(!r(i[n*t+s]))return!1;return!0}get isTriangular(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.isZero.bind(this.field);for(let n=0;n<t;n++)for(let s=0;s<t;s++)if(n<s&&!r(i[n*t+s])||n>s&&!r(i[n*t+s]))return!1;return!0}get isDiagonal(){if(!this.isSquare)return!1;let t=this.shape[0],i=this.data,r=this.field.isZero.bind(this.field);for(let n=0;n<t;n++)for(let s=0;s<t;s++)if(n===s&&!r(i[n*t+s])||n!==s&&!r(i[n*t+s]))return!1;return!0}get isIdentity(){if(!this.isSquare)return!1;let[t,i]=this.shape,r=this.data,n=this.field.isOne.bind(this.field),s=this.field.isZero.bind(this.field);for(let a=0;a<i;a++)for(let o=0;o<i;o++)if(a===o&&!n(r[a*i+o])||a!==o&&!s(r[a*i+o]))return!1;return!0}get isZero(){let t=this.field.isZero.bind(this.field);return this.data.every(i=>t(i))}at(...t){let i=this.data.length;return this.data[this._index(t)%i]}diagonal(t,i){if(t??(t=1),i??(i=2),t===i||t<=0||t>this.shape.length||this.shape[t-1]!==this.shape[i-1])return;let r=new Array(this.shape[t-1]),n=this.data,s=this.shape[t-1];for(let a=0;a<s;a++)r[a]=n[a*s+a];return r}trace(t,i){if(this.rank!==2)return;let[r,n]=this.shape;if(r!==n)return;let s=this.data,a=new Array(r);for(let o=0;o<r;o++)a[o]=s[o*r+o];return this.field.addn(...a)}reshape(...t){return it(this.ce,{dtype:this.dtype,shape:t,data:this.data})}slice(t){if(t<0&&(t=this.shape[0]+t+1),this.rank===0)return this;if(this.rank===1){let s=this.data[t-1];return it(this.ce,{dtype:this.dtype,shape:[],data:[s]})}this.shape[1];let i=this._strides[0],r=t*i,n=r+i;return it(this.ce,{dtype:this.dtype,shape:this.shape.slice(1),data:this.data.slice(r,n)})}flatten(){return this.data}upcast(t){let i=this.field.cast(this.data,t);if(i===void 0)throw Error(`Cannot cast tensor to ${t}`);return it(this.ce,{dtype:t,shape:this.shape,data:i})}transpose(t,i,r){if(this.rank!==2)return;if(t??(t=1),i??(i=2),t===i)return this;if(t<=0||t>2||i<=0||i>2)return;let[n,s]=this.shape,a=this.data;r&&(a=a.map(c=>r(c)));let o=0,l=new Array(n*s),u=s;for(let c=0;c<s;c++)for(let f=0;f<n;f++)l[o++]=a[f*u+c];return it(this.ce,{dtype:this.dtype,shape:[s,n],data:l})}conjugateTranspose(t,i){let r=this.field.conjugate.bind(this.field);return this.transpose(t,i,r)}determinant(){if(this.rank!==2)return;let[t,i]=this.shape;if(t!==i)return;if(t===1)return this.data[0];let r=this.field.add.bind(this.field),n=this.field.mul.bind(this.field),s=this.field.neg.bind(this.field);if(t===2){let[y,x,T,C]=this.data;return r(n(y,C),s(n(x,T)))}let a=this.field.addn.bind(this.field),o=this.field.muln.bind(this.field);if(t===3){let[y,x,T,C,I,E,w,Se,at]=this.data;return a([o(y,I,at),o(x,E,w),o(T,C,Se),s(o(T,I,w)),s(o(x,C,at)),s(o(y,E,Se))])}let l=this.shape[0],u=!1,c=this.field.div.bind(this.field),f=this.field.sub.bind(this.field),p=new Array(l).fill(0).map((y,x)=>x),h=[...this.data];for(let y=0;y<l;y++){let x=p[y-1];if(this.at(x,y)===0){let I;for(I=y+1;I<l;I++)if(this.at(p[I],y)!==0){x=p[I],p[I-1]=p[y-1],p[y-1]=x,u=!u;break}if(I===l)return this.at(x,y)}let T=this.at(x,y),C=y===0?1:this.at(p[y-2],y-2);for(let I=y+1;I<l;I++){let E=p[I-1];for(let w=y+1;w<l;w++)h[E][w]=c(f(n(h[E][w],T),n(h[E][y],h[x][w])),C)}}let d=h[p[l-1]][l-1];return u?this.field.neg(d):d}inverse(){if(this.rank!==2)return;let[t,i]=this.shape;if(t!==i)return;if(t===2){let[p,h,d,y]=this.data,x=this.determinant();if(x===void 0||this.field.isZero(x))return;let T=this.field.div.bind(this.field),C=this.field.neg.bind(this.field),I=[T(y,x),C(T(h,x)),C(T(d,x)),T(p,x)];return it(this.ce,{dtype:this.dtype,shape:[i,i],data:I})}let r=this.shape[0],n=this.field.div.bind(this.field),s=this.field.sub.bind(this.field),a=this.field.mul.bind(this.field),o=this.array,l=new Array(r).fill(0).map((p,h)=>{let d=new Array(r).fill(0);return d[h]=1,d}),u=o.map((p,h)=>[...p,...l[h]]),c=new Array(r).fill(0).map((p,h)=>h);for(let p=0;p<r;p++){let h=c[p-1];if(this.at(h,p)===0){let x;for(x=p+1;x<r;x++)if(this.at(c[x],p)!==0){h=c[x],c[x-1]=c[p-1],c[p-1]=h;break}if(x===r)return}let d=this.at(h,p),y=p===0?1:this.at(c[p-2],p-2);for(let x=p+1;x<r;x++){let T=c[x-1];for(let C=p+1;C<r*2;C++)u[T][C]=s(u[T][C],a(n(a(u[T][p],u[h][C]),d),y))}}for(let p=r-1;p>=0;p--){let h=u[c[p],p];for(let d=0;d<p;d++){let y=c[d];for(let x=r;x<r*2;x++)u[y][x]=s(u[y][x],a(n(a(u[y][p],u[p][x]),h),h))}for(let d=r;d<r*2;d++)u[p][d]=n(u[p][d],h)}let f=u.map(p=>p.slice(r));return it(this.ce,{dtype:this.dtype,shape:[i,i],data:f})}pseudoInverse(){}adjugateMatrix(){}minor(t,i){}map1(t,i){return it(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map(r=>t(r,i))})}map2(t,i){let r=i.data;return it(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map((n,s)=>t(n,r[s]))})}add(t){return Qt.broadcast(this.field.add.bind(this.field),this,t)}subtract(t){return Qt.broadcast(this.field.sub.bind(this.field),this,t)}multiply(t){return Qt.broadcast(this.field.mul.bind(this.field),this,t)}divide(t){return Qt.broadcast(this.field.div.bind(this.field),this,t)}power(t){return Qt.broadcast(this.field.pow.bind(this.field),this,t)}equals(t){if(this.rank!==t.rank||!this.shape.every((s,a)=>s===t.shape[a]))return!1;let i=this.field.equals.bind(this.field),r=this.field.cast.bind(this.field),n=this.dtype;return this.dtype!==t.dtype?!!this.data.every((s,a)=>i(s,r(t.data[a],n))):this.data.every((s,a)=>i(s,t.data[a]))}};function Rm(e){let t=new Array(e.length);for(let i=e.length-1,r=1;i>=0;i--)t[i]=r,r*=e[i];return t}var Vm=class extends dn{constructor(t,i){super(t,i);m(this,"dtype","float64");m(this,"data");this.data=i.data}get isZero(){return this.data.every(t=>t===0)}},Bm=class extends dn{constructor(t,i){super(t,i);m(this,"dtype","complex128");m(this,"data");this.data=i.data}},Zm=class extends dn{constructor(t,i){super(t,i);m(this,"dtype","bool");m(this,"data");this.data=i.data}},Um=class extends dn{constructor(t,i){super(t,i);m(this,"dtype","expression");m(this,"data");this.data=i.data}};function it(e,t){let i=t.dtype;return i==="float64"||i==="float32"||i==="uint8"||i==="int32"?new Vm(e,t):i==="bool"?new Zm(e,t):i==="complex64"||i==="complex128"?new Bm(e,t):new Um(e,t)}function Ci(e){var t;return((t=e.symbol)==null?void 0:t.startsWith("_"))??(e.operator==="Wildcard"||e.operator==="WildcardSequence"||e.operator==="WildcardOptionalSequence")}function qi(e){var t;if((t=e.symbol)!=null&&t.startsWith("_"))return e.symbol;if(e.nops===1){let i=e.op1;if(e.operator==="Wildcard")return`_${i}`;if(e.operator==="WildcardSequence")return`__${i}`;if(e.operator==="WildcardOptionalSequence")return`___${i}`}return e.operator==="Wildcard"?"_":e.operator==="WildcardSequence"?"__":e.operator==="WildcardOptionalSequence"?"___":null}var fu=class Mn extends ge{constructor(i,r,n){super(i,n==null?void 0:n.metadata);m(this,"_tensor");m(this,"_expression");this.input=r,this.options=n;let s=jm(i,"List",r.ops,r.shape,r.dtype);if(!s)throw new Error("Invalid tensor");this._tensor=it(i,s)}get structural(){return this._expression??(this._expression=this._tensor.expression),this._expression}get tensor(){return this._tensor}get baseDefinition(){return this.structural.baseDefinition}get operatorDefinition(){return this.structural.operatorDefinition}get hash(){return Mi("BoxedTensor")}get canonical(){return this}get isCanonical(){return this._tensor?!0:this._expression.isCanonical}get isPure(){return this._tensor?!0:this.structural.isPure}get isValid(){return this._tensor?!0:this.structural.isValid}get complexity(){return 97}get operator(){return"List"}get nops(){return this._tensor?this._tensor.shape[0]:this.structural.nops}get ops(){return this.structural.ops}get op1(){if(this._tensor){let i=this._tensor.data;return i.length===0?this.engine.Nothing:this.engine.box(i[0])}return this.structural.op1}get op2(){if(this._tensor){let i=this._tensor.data;return i.length<2?this.engine.Nothing:this.engine.box(i[1])}return this.structural.op2}get op3(){if(this._tensor){let i=this._tensor.data;return i.length<3?this.engine.Nothing:this.engine.box(i[2])}return this.structural.op3}neg(){return this.structural.neg()}inv(){return this.engine.One.div(this.structural)}abs(){return this.structural.abs()}add(i){return this.structural.add(i)}sub(i){return this.structural.sub(i)}mul(i){return this.structural.mul(i)}div(i){return this.structural.div(i)}pow(i){return this.structural.pow(i)}root(i){return this.structural.root(i)}sqrt(){return this.structural.sqrt()}get shape(){return this.tensor.shape}get rank(){try{return this.tensor.rank}catch{}return 0}get type(){return new $(this.isValid?R("list<number>"):"error")}get json(){return this.structural.json}isEqual(i){return this===i?!0:i instanceof Mn?this.tensor.equals(i.tensor):this.structural.isEqual(i)}get isCollection(){return!0}get isIndexedCollection(){return!0}xcontains(i){return["float64","float32","int32","uint8"].includes(this.tensor.dtype)?this.tensor.data.includes(i.re):this.tensor.data.some(r=>i.isSame(this.tensor.field.cast(r,"expression")??i.engine.Nothing))}get xsize(){return this.tensor.shape.reduce((i,r)=>i*r,1)}each(){let i=this.tensor.shape,r=this.tensor.rank;if(r===0)return(function*(s){yield s})(this);let n=i[0];return r===1?(function*(s){for(let a=1;a<=n;a+=1){let o=s.tensor.data,l=a-1;l>=0&&l<o.length&&(yield s.engine.box(o[l]))}})(this):(function*(s){for(let a=1;a<=n;a+=1){let o=s.tensor.slice(a-1);yield new Mn(s.engine,{ops:o.expression.ops,shape:o.shape,dtype:o.dtype})}})(this)}at(i){let r=this.tensor.slice(i);if(r.rank===0)return this.engine.box(r.data[0]);if(r.rank===1)return this.engine.box(r.data[0]);if(r.rank>1)return new Mn(this.engine,{ops:r.expression.ops,shape:r.shape,dtype:r.dtype})}match(i,r){return Ii(i)||(i=this.engine.box(i,{canonical:!1})),Ci(i)?{[qi(i)]:this}:this.structural.match(i,r)}evaluate(i){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.evaluate(i)}simplify(i){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.simplify(i)}N(){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.N()}};function rt(e){return e instanceof fu}function Gm(e,t){let i,r=[],n=!0,s=(a,o=0)=>{if(!n)return;let l=a.length;if(l===0)return;if(r[o]===void 0)r[o]=l;else if(r[o]!==l){n=!1;return}let u=0;for(let f of a)f.operator===e&&u++;let c=l-u;if(u>0&&c>0){n=!1;return}if(u===l){for(let f of a)if(s(f.ops,o+1),!n)return}else for(let f of a)i=cu(i,Lm(f))};return s(t),n?{shape:r,dtype:i}:void 0}function jm(e,t,i,r,n){let s=!0,a=[],o=lu(e,"expression"),l=o.cast.bind(o),u=(c,f=0)=>{if(c.length!==0){if(r[f]===void 0)r[f]=c.length;else if(r[f]!==c.length){s=!1;return}for(let p of c){if(!s)return;if(p.operator===t)u(p.ops,f+1);else{let h=l(p,n);if(h===void 0){s=!1;return}a.push(h)}}}};if(u(i),!!s)return{shape:r,rank:r.length,data:a,dtype:n}}var Wm=[{Matrix:{complexity:9e3,lazy:!0,signature:"(matrix, string?, string?) -> matrix",type:([e])=>e.type,canonical:Hm,evaluate:(e,t)=>e[0].evaluate(t)},Vector:{complexity:9e3,lazy:!0,signature:"(number+) -> vector",type:e=>R(`vector<${e.length}>`,e[0].engine._typeResolver),canonical:(e,{engine:t})=>t._fn("Matrix",[t.function("List",e.map(i=>t.function("List",[i])))])}},{Shape:{complexity:8200,signature:"(value) -> tuple",evaluate:([e],{engine:t})=>t.tuple(...e.shape)},Rank:{description:"The length of the shape of the expression. Note this is not the matrix rank (the number of linearly independent rows or columns in the matrix)",complexity:8200,signature:"(value) -> number",sgn:()=>"positive",evaluate:([e],{engine:t})=>t.number(e.rank)},Reshape:{complexity:8200,signature:"(list<number>, tuple) -> value",type:([e,t])=>{if(!e.type.matches("list"))return"nothing";let i=e.type.type;return _(i.elements,"number")?R(`list<number^${t.ops.map(r=>r.toString()).join("x")}>`):"nothing"},evaluate:(e,{engine:t})=>{var n;let i=e[0],r=((n=e[1].ops)==null?void 0:n.map(s=>s.re))??[];if(!rt(i)&&Ie(i)&&(i=t.function("List",[...i.each()])),rt(i))return r.join("x")===i.shape.join("x")?i:i.tensor.reshape(...r).expression}},Flatten:{complexity:8200,signature:"(value) -> list",evaluate:(e,{engine:t})=>{let i=e[0];if(rt(i))return t.box(["List",...i.tensor.flatten().map(r=>t.box(r))]);if(Ie(i))return t.function("List",[...i.each()])}},Transpose:{complexity:8200,signature:"(matrix|vector, axis1: integer?, axis2: integer?) -> matrix",evaluate:(e,{engine:t})=>{var s,a;let i=e[0],r=1,n=2;if(e.length===3&&(r=e[1].re,n=e[2].re,r>0&&n>0),r!==n&&(!rt(i)&&Ie(i)&&(i=t.function("List",[...i.each()])),rt(i)))return r===1&&n===2?(s=i.tensor.transpose())==null?void 0:s.expression:(a=i.tensor.transpose(r,n))==null?void 0:a.expression}},ConjugateTranspose:{complexity:8200,signature:"(tensor, axis1: integer?, axis2: integer?) -> matrix",evaluate:e=>{var n;let t=e[0],i=1,r=2;if(e.length===3&&(i=e[1].re,r=e[2].re,i>0&&r>0),i!==r&&rt(t))return(n=t.tensor.conjugateTranspose(i,r))==null?void 0:n.expression}},Determinant:{complexity:8200,signature:"(matrix) -> number",evaluate:e=>{let t=e[0];if(rt(t))return t.tensor.determinant()}},Inverse:{complexity:8200,signature:"(matrix) -> matrix",type:([e])=>e.type,evaluate:([e])=>{var t;if(rt(e))return(t=e.tensor.inverse())==null?void 0:t.expression}},PseudoInverse:{complexity:8200,signature:"(matrix) -> matrix",evaluate:([e])=>{var t;if(rt(e))return(t=e.tensor.pseudoInverse())==null?void 0:t.expression}},AdjugateMatrix:{complexity:8200,signature:"(matrix) -> matrix",evaluate:e=>{var i;let t=e[0];if(rt(t))return(i=t.tensor.adjugateMatrix())==null?void 0:i.expression}},Trace:{complexity:8200,signature:"(matrix) -> number",evaluate:e=>{let t=e[0];if(rt(t))return t.tensor.trace()}}}];function Hm(e,{engine:t}){var a,o;let i="Matrix";if(e.length===0)return t._fn(i,[]);let r=e[0].operator==="Vector"?e[0].canonical.ops[0]:e[0].canonical,n=(a=e[1])==null?void 0:a.canonical,s=(o=e[2])==null?void 0:o.canonical;return e.length>3?t._fn(i,At(t,e,3)):s?t._fn(i,[r,n,s]):n?t._fn(i,[r,n]):t._fn(i,[r])}var Qm={True:{wikidata:"Q16751793",type:"boolean",isConstant:!0},False:{wikidata:"Q5432619",type:"boolean",isConstant:!0},And:{wikidata:"Q191081",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:pu},Or:{wikidata:"Q1651704",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:hu},Not:{wikidata:"Q190558",broadcastable:!0,involution:!0,complexity:10100,signature:"(boolean) -> boolean",evaluate:mu},Equivalent:{wikidata:"Q220433",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",canonical:(e,{engine:t})=>{let i=e[0].symbol,r=e[1].symbol;return i==="True"&&r==="True"||i==="False"&&r==="False"?t.True:i==="True"&&r==="False"||i==="False"&&r==="True"?t.False:t._fn("Equivalent",e)},evaluate:gu},Implies:{wikidata:"Q7881229",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",evaluate:du},Exists:{signature:"function",lazy:!0},NotExists:{signature:"function",lazy:!0},ExistsUnique:{signature:"function",lazy:!0},ForAll:{signature:"function",lazy:!0},NotForAll:{signature:"function",lazy:!0},KroneckerDelta:{description:"Return 1 if the arguments are equal, 0 otherwise",signature:"(value+) -> integer",evaluate:(e,{engine:t})=>{if(e.length===1)return e[0].symbol==="True"?t.One:t.Zero;if(e.length===2)return e[0].isEqual(e[1])?t.One:t.Zero;for(let i=1;i<e.length;i++)if(!e[i].isEqual(e[0]))return t.Zero;return t.One}},Boole:{description:"Return 1 if the argument is true, 0 otherwise. Also known as the Iverson bracket",signature:"(boolean) -> integer",evaluate:(e,{engine:t})=>e[0].symbol==="True"?t.One:t.Zero}};function pu(e,{engine:t}){if(e.length===0)return t.True;let i=[];for(let r of e){if(r.symbol==="False")return t.False;if(r.symbol!=="True"){let n=!1;for(let s of i)if(s.isSame(r))n=!0;else if(r.operator==="Not"&&r.op1.isSame(s)||s.operator==="Not"&&s.op1.isSame(r))return t.False;n||i.push(r)}}return i.length===0?t.True:i.length===1?i[0]:t._fn("And",i)}function hu(e,{engine:t}){if(e.length===0)return t.True;let i=[];for(let r of e){if(r.symbol==="True")return t.True;if(r.symbol!=="False"){let n=!1;for(let s of i)if(s.isSame(r))n=!0;else if(r.operator==="Not"&&r.op1.isSame(s)||s.operator==="Not"&&s.op1.isSame(r))return t.True;n||i.push(r)}}return i.length===0?t.False:i.length===1?i[0]:t._fn("Or",i)}function mu(e,{engine:t}){var r;let i=(r=e[0])==null?void 0:r.symbol;if(i==="True")return t.False;if(i==="False")return t.True}function gu(e,{engine:t}){let i=e[0].symbol,r=e[1].symbol;if(i==="True"&&r==="True"||i==="False"&&r==="False")return t.True;if(i==="True"&&r==="False"||i==="False"&&r==="True")return t.False}function du(e,{engine:t}){let i=e[0].symbol,r=e[1].symbol;if(i==="True"&&r==="True"||i==="False"&&r==="False"||i==="False"&&r==="True")return t.True;if(i==="True"&&r==="False")return t.False}function Ym(e){var i,r;let t=(r=(i={And:pu,Or:hu,Not:mu,Equivalent:gu,Implies:du})[e.operator])==null?void 0:r.call(i,e.engine,e.ops);if(t)return{value:t,because:"logic"}}var Jm=[{Totient:{wikidata:"Q190026",description:"Eulers totient function (n): count of positive integers  n that are coprime to n.",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1)return;let r=1n;for(let n=2n;n<i;n++)Qi(n,i)===1n&&r++;return t.number(r)}},Sigma0:{description:"Number of positive divisors of n.",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1)return;let r=0;for(let n=1n;n<=i;n++)i%n===0n&&r++;return t.number(r)}},Sigma1:{description:"Sum of positive divisors of n.",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1)return;let r=t.bignum(0);for(let n=1n;n<=i;n++)i%n===0n&&(r=r.add(t.bignum(n)));return t.number(r)}},SigmaMinus1:{description:"Sum of reciprocals of positive divisors of n.",signature:"(integer) -> number",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1)return;let r=t.bignum(0);for(let n=1n;n<=i;n++)i%n===0n&&(r=r.add(t.bignum(1).div(t.bignum(n))));return t.number(r)}},IsPerfect:{wikidata:"Q170043",description:'Returns "True" if n is a perfect number, a positive integer which equals the sum of all its divisors.',signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1)return;let r=0n;for(let n=1n;n<i;n++)i%n===0n&&(r+=n);return t.symbol(r===i?"True":"False")}},Eulerian:{description:"Eulerian number A(n, m): number of permutations of {1..n} with exactly m ascents.",signature:"(integer, integer) -> integer",evaluate:([e,t],{engine:i})=>{let r=he(e),n=he(t);if(r===null||n===null||r<0n||n<0n||n>=r)return;let s=(a,o)=>o===0n?1n:o>=a?0n:(o+1n)*s(a-1n,o)+(a-o)*s(a-1n,o-1n);return i.number(s(r,n))}},Stirling:{description:"Stirling number of the second kind S(n, m): ways to partition n elements into m non-empty subsets.",signature:"(integer, integer) -> integer",evaluate:([e,t],{engine:i})=>{let r=he(e),n=he(t);if(r===null||n===null||r<0n||n<0n||n>r)return;let s=(a,o)=>a===0n&&o===0n?1n:a===0n||o===0n?0n:s(a-1n,o-1n)+o*s(a-1n,o);return i.number(s(r,n))}},NPartition:{description:"Number of integer partitions of n.",signature:"(integer) -> integer",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<0n)return;let r=new Map,n=s=>{if(s===0n)return 1n;if(s<0n)return 0n;if(r.has(s))return r.get(s);let a=0n;for(let o=1n;;o++){let l=o*(3n*o-1n)/2n,u=o*(3n*o+1n)/2n;if(l>s&&u>s)break;let c=o%2n===0n?-1n:1n;a+=c*(n(s-l)+n(s-u))}return r.set(s,a),a};return t.number(n(i))}},IsTriangular:{description:"True if n is a triangular number.",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1n)return t.False;let r=8n*i+1n,n=BigInt(_r.sqrt(t.bignum(r)).toFixed(0));return t.symbol(n*n===r&&(n-1n)%2n===0n?"True":"False")}},IsSquare:{description:"True if n is a perfect square.",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<0n)return t.False;let r=BigInt(_r.sqrt(t.bignum(i)).toFixed(0));return t.symbol(r*r===i?"True":"False")}},IsOctahedral:{description:"True if n is an octahedral number.",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1n)return t.False;let r=3n*i+1n,n=BigInt(_r.sqrt(t.bignum(r)).toFixed(0));return t.symbol(n*n===r?"True":"False")}},IsCenteredSquare:{description:"True if n is a centered square number.",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1n||(i-1n)%4n!==0n)return t.False;let r=(i-1n)/4n,n=BigInt(_r.sqrt(t.bignum(r)).toFixed(0));return t.symbol(n*n*4n+1n===i?"True":"False")}},IsHappy:{wikidata:"Q44535",description:"True if n is a happy number, a number which eventually reaches 1 when the number is replaced by the sum of the square of each digit",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=new Set,r=he(e);if(r===null)return t.False;for(;!i.has(r);){if(r===1n)return t.True;i.add(r),r=Km(r)}return t.False}},IsAbundant:{description:"True if n is an abundant number (sum of divisors > 2n).",signature:"(integer) -> boolean",evaluate:([e],{engine:t})=>{let i=he(e);if(i===null||i<1n)return t.False;let r=1n;for(let n=2n;n*n<=i;n++)if(i%n===0n){r+=n;let s=i/n;s!==n&&(r+=s)}return t.symbol(r>i?"True":"False")}}}];function Km(e){return e.toString().split("").map(t=>BigInt(t)).reduce((t,i)=>t+i*i,0n)}function yn(e){let t=e.engine,i=e.operator;if(Xt(i))return t.function(i,e.ops.map(yn));if(i==="Divide")return e.ops[0].div(e.ops[1]);if(i==="Negate")return yn(e.ops[0]).neg();if(i==="Add"){let[r,n]=e.ops.reduce((s,a)=>(a.operator==="Divide"?(s[0].push(a.ops[0]),s[1].push(a.ops[1])):s[0].push(a),s),[[],[]]);return me(...r).div(me(...n))}return e}function cr(e){let t=e.operator;if(Xt(t)){let i=Mt.from(e.op1),r=Mt.from(e.op2),[n,s]=am(i,r),a=n.sgn()===-1;return n.isOne||(i.div(n),r.div(n)),s.is(1)||(s.isPositive?(i.div(s),r.div(s)):s.isNegative&&(i.div(s.neg()),r.div(s.neg()),a=!a)),a&&([i,r]=[r,i]),e.engine.function(t,[i.asExpression(),r.asExpression()])}if(t==="Negate")return cr(e.ops[0]).neg();if(t==="Add"){let i=e.engine,r,n=[];for(let a of e.ops){let[o,l]=a.toNumericValue();r=r?r.gcd(o):o,o.isZero||n.push({coeff:o,term:l})}if(!r||r.isOne)return e;let s=n.map(({coeff:a,term:o})=>Ve(o,i.box(a.div(r))));return Ve(i.number(r),me(...s))}return Mt.from(yn(e)).asExpression()}function Ys(e,t,i,r){let n=e.engine;return e.operator===i?n.box([r,...e.ops.map(s=>Ys(s,t,i,r))]):t.operator===i?n.box([r,...t.ops.map(s=>Ys(e,s,i,r))]):n.box([r,e,t])}function Xm(e,t="Add",i="Multiply"){if(e.operator!==i)return e;let r=e.ops;return!r||r.length<2?e:e.engine.box([t,r.slice(1).reduce((n,s)=>Ys(n,s,t,i),r[0])])}var eg=[{Expand:{description:"Expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([e])=>ht(e.canonical)??e.canonical},ExpandAll:{description:"Recursively expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([e])=>Ps(e.canonical)??e.canonical},Factor:{description:"Factors an algebraic expression into a product of irreducible factors",lazy:!0,signature:"(value)-> value",evaluate:([e])=>cr(e.canonical)??e.canonical},Together:{description:"Combine rational expressions into a single fraction",lazy:!0,signature:"(value)-> value",evaluate:([e])=>yn(e.canonical)},Distribute:{description:"Distribute multiplication over addition",lazy:!0,signature:"(value)-> value",evaluate:([e])=>e&&Xm(e.canonical)}}],tg={Congruent:{description:"Indicate that two expressions are congruent modulo a number",complexity:11e3,signature:"(number, number, modulo: integer) -> boolean",evaluate:(e,{engine:t})=>{if(e.length<3)return;let[i,r,n]=e,s=i.value,a=r.value,o=n.value;if(typeof s=="number"&&typeof a=="number"&&typeof o=="number")return s%o===a%o?t.True:t.False}},IsSame:{description:"Compare two expressions for structural equality",lazy:!0,signature:"(any, any) -> boolean",evaluate:(e,{engine:t})=>{if(e.length!==2)return;let[i,r]=e;return i.isSame(r)?t.True:t.False}},Equal:{complexity:11e3,signature:"(any, any) -> boolean",lazy:!0,canonical:(e,{engine:t})=>ee(t,"Equal",e),eq:(e,t)=>e.operator!==t.operator?!1:e.op1.sub(e.op2).N().isEqual(t.op1.sub(t.op2).N()),evaluate:(e,{engine:t})=>{if(e.length<2)return t.True;let i;for(let r of e)if(!i)i=r;else if(Bo(i,r)!==!0)return t.False;return t.True}},NotEqual:{wikidata:"Q28113351",complexity:11e3,signature:"(any, any) -> boolean",canonical:(e,{engine:t})=>ee(t,"NotEqual",e),eq:(e,t)=>e.operator!==t.operator?!1:!!(e.op1.isEqual(t.op1)&&e.op2.isEqual(t.op2)||e.op1.isEqual(t.op2)&&e.op2.isEqual(t.op1)),evaluate:(e,{engine:t})=>{if(e.length<2)return t.False;let i;for(let r of e)if(!i)i=r;else if(i.isEqual(r)===!0)return t.False;return t.True}},Less:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"Less",e),eq:(e,t)=>yu(e,t,"Greater"),evaluate:(e,{engine:t})=>{if(e.length===2){let[r,n]=e,s=r.isLess(n);return s===void 0?void 0:s?t.True:t.False}if(e.length<2)return t.True;let i;for(let r of e)if(!i)i=r;else{let n=r.isLess(i);if(n===void 0)return;if(n===!1)return t.False;i=r}return t.True}},NotLess:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"Less",e)])},Greater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"Less",[...e].reverse())},NotGreater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[t._fn("Greater",e)])},LessEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"LessEqual",e),eq:(e,t)=>yu(e,t,"LessGreater"),evaluate:(e,{engine:t})=>{if(e.length===2){let[r,n]=e,s=r.isLessEqual(n);return s===void 0?void 0:s?t.True:t.False}if(e.length<2)return t.True;let i;for(let r of e)if(!i)i=r;else{let n=r.isLessEqual(i);if(n===void 0)return;if(n===!1)return t.False;i=r}return t.True}},NotLessNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"LessEqual",e)])},GreaterEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"LessEqual",[...e].reverse())},NotGreaterNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"GreaterEqual",e)])},TildeFullEqual:{description:"Indicate isomorphism, congruence and homotopic equivalence",signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"TildeFullEqual",e)},NotTildeFullEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"TildeFullEqual",e)])},TildeEqual:{description:"Approximately or asymptotically equal",complexity:11e3,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"TildeEqual",e)},NotTildeEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"TildeEqual",e)])},Approx:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"Approx",e)},NotApprox:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"Approx",e)])},ApproxEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"ApproxEqual",e)},NotApproxEqual:{complexity:11100,canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"ApproxEqual",e)])},ApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"ApproxNotEqual",e)},NotApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"ApproxNotEqual",e)])},Precedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"Precedes",e)},NotPrecedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"Precedes",e)])},Succeeds:{signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>ee(t,"Succeeds",e)},NotSucceeds:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(e,{engine:t})=>t._fn("Not",[ee(t,"Succeeds",e)])}};function ee(e,t,i){i=fe(i,t);let r=[],n=[];for(let s of i)Xt(s.operator)?(r.push(s),n.push(s.ops[s.ops.length-1])):n.push(s);return r.length===0?e._fn(t,n):e._fn("And",[e._fn(t,n),...r])}function yu(e,t,i){return e.operator===t.operator?e.nops!==t.nops?!1:e.ops.every((r,n)=>r.isEqual(t.ops[n])):t.operator===i?e.nops!==t.nops?!1:e.ops.every((r,n)=>r.isEqual(t.ops[t.nops-1-n])):!1}var ig={EmptySet:{type:"set",isConstant:!0,wikidata:"Q226183",description:"The empty set, a set containing no elements.",eq:e=>e.type.matches("set")&&e.xsize===0,collection:{iterator:()=>({next:()=>({value:void 0,done:!0})}),count:()=>0,isEmpty:()=>!0,isFinite:()=>!0,contains:()=>!1,subsetOf:()=>!0,eltsgn:()=>{},elttype:()=>"never"}},Numbers:{type:"set<number>",isConstant:!0,description:"The set of all numbers.",collection:{iterator:Js,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(e,t)=>t.type.matches("number"),subsetOf:(e,t,i)=>t.operator==="Range"||t.operator==="Linspace"?!0:t.type.matches($.setNumber)&&(!i||t.symbol!=="Numbers"),eltsgn:()=>"unsigned",elttype:()=>"number"}},ComplexNumbers:{type:"set<finite_complex>",isConstant:!0,description:"The set of all finite complex numbers.",collection:{iterator:Js,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(e,t)=>t.type.matches("finite_complex"),subsetOf:(e,t,i)=>t.operator==="Range"||t.operator==="Linspace"?!0:t.type.matches($.setComplex)&&(!i||t.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"finite_complex"}},ExtendedComplexNumbers:{type:"set<complex>",isConstant:!0,description:"The set of all complex numbers, including infinities.",collection:{iterator:Js,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(e,t)=>t.type.matches("complex"),subsetOf:(e,t,i)=>t.operator==="Range"||t.operator==="Linspace"?!0:t.type.matches($.setComplex)&&(!i||t.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"complex"}},ImaginaryNumbers:{type:"set<imaginary>",isConstant:!0,description:"The set of all imaginary numbers.",collection:{iterator:ag,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(e,t)=>t.type.matches($.setImaginary),subsetOf:(e,t,i)=>t.type.matches($.setImaginary)&&(!i||t.symbol!=="ImaginaryNumbers"),eltsgn:()=>"unsigned",elttype:()=>"imaginary"}},RealNumbers:{type:"set<finite_real>",isConstant:!0,description:"The set of all finite real numbers.",collection:{iterator:e=>jt(e),contains:(e,t)=>t.type.matches("finite_real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>t.type.matches($.setReal)&&(!i||t.symbol!=="RealNumbers"),eltsgn:()=>{},elttype:()=>"finite_real"}},ExtendedRealNumbers:{type:"set<real>",isConstant:!0,description:"The set of all real numbers, including infinities.",collection:{iterator:e=>jt(e),contains:(e,t)=>t.type.matches("real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>t.type.matches($.setReal)&&(!i||t.symbol!=="ExtendedRealNumbers"),eltsgn:()=>{},elttype:()=>"real"}},Integers:{type:"set<finite_integer>",isConstant:!0,description:"The set of all finite integers.",collection:{iterator:bu,contains:(e,t)=>t.type.matches("finite_integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>t.operator==="Range"?!0:t.type.matches($.setFiniteInteger)&&(!i||t.symbol!=="Integers"),eltsgn:()=>{},elttype:()=>"finite_integer"}},ExtendedIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all integers, including infinities.",collection:{iterator:bu,contains:(e,t)=>t.type.matches("integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>t.operator==="Range"?!0:t.type.matches($.setInteger)&&(!i||t.symbol!=="ExtendedIntegers"),eltsgn:()=>{},elttype:()=>"integer"}},RationalNumbers:{type:"set<finite_rational>",isConstant:!0,description:"The set of all finite rational numbers.",collection:{iterator:e=>jt(e),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(e,t)=>t.type.matches("finite_rational"),subsetOf:(e,t,i)=>t.type.matches($.setRational)&&(!i||t.symbol!=="RationalNumbers"),eltsgn:()=>{},elttype:()=>"finite_rational"}},ExtendedRationalNumbers:{type:"set<rational>",isConstant:!0,description:"The set of all rational numbers, including infinities.",collection:{iterator:e=>jt(e),contains:(e,t)=>t.type.matches("rational"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>t.type.matches($.setRational)&&(!i||t.symbol!=="ExtendedRationalNumbers"),eltsgn:()=>{},elttype:()=>"rational"}},NegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all negative real numbers.",collection:{iterator:e=>jt(e,{sign:"-",includeZero:!1}),count:()=>1/0,contains:(e,t)=>t.type.matches("real")&&t.isNegative===!0,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"||t.operator==="Linspace"){let a=t.ops[0].re,o=t.ops[1].re;return a<0&&o<0}return t.type.matches($.setReal)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="negative"&&(!i||t.symbol!=="NegativeNumbers")},eltsgn:()=>"negative",elttype:()=>"real"}},NonPositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-positive real numbers.",collection:{iterator:e=>jt(e,{sign:"-",includeZero:!0}),contains:(e,t)=>t.type.matches("real")&&t.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"||t.operator==="Linspace"){let a=t.ops[0].re,o=t.ops[1].re;return a>=0&&o>=0}return t.type.matches($.setReal)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="non-positive"&&(!i||t.symbol!=="NonPositiveNumbers")},eltsgn:()=>"non-positive",elttype:()=>"real"}},NonNegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-negative real numbers.",collection:{iterator:e=>jt(e,{sign:"+",includeZero:!0}),contains:(e,t)=>t.type.matches("real")&&t.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"||t.operator==="Linspace"){let a=t.ops[0].re,o=t.ops[1].re;return a<=0&&o<=0}return t.type.matches($.setReal)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="non-negative"&&(!i||t.symbol!=="NonNegativeNumbers")},eltsgn:()=>"non-negative",elttype:()=>"real"}},PositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all positive real numbers.",collection:{iterator:e=>jt(e,{sign:"+",includeZero:!1}),contains:(e,t)=>t.type.matches("real")&&t.isPositive===!0,count:()=>1/0,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"||t.operator==="Linspace"){let a=t.ops[0].re,o=t.ops[1].re;return a>0&&o>0}return t.type.matches($.setReal)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="positive"&&(!i||t.symbol!=="PositiveNumbers")},eltsgn:()=>"positive",elttype:()=>"real"}},NegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all negative integers.",collection:{iterator:e=>bn(e.engine,-1,-1),contains:(e,t)=>t.type.matches("integer")&&t.isNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"){let a=t.ops[0].re,o=t.ops[1].re;return a<0&&o<0}return t.type.matches($.setInteger)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="negative"&&(!i||t.symbol!=="NegativeIntegers")},eltsgn:()=>"negative",elttype:()=>"integer"}},NonPositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-positive integers.",collection:{iterator:e=>bn(e.engine,0,-1),contains:(e,t)=>t.type.matches("integer")&&t.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"){let a=t.ops[0].re,o=t.ops[1].re;return a<=0&&o<=0}return t.type.matches($.setInteger)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="non-positive"&&(!i||t.symbol!=="NonPositiveIntegers")},eltsgn:()=>"non-positive",elttype:()=>"integer"}},NonNegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-negative integers.",collection:{iterator:e=>bn(e.engine,0,1),contains:(e,t)=>t.type.matches("integer")&&t.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"){let a=t.ops[0].re,o=t.ops[1].re;return a>0&&o>0}return t.type.matches($.setInteger)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="non-negative"&&(!i||t.symbol!=="NonNegativeIntegers")},eltsgn:()=>"non-negative",elttype:()=>"integer"}},PositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all positive integers.",collection:{iterator:e=>bn(e.engine,1,1),contains:(e,t)=>t.type.matches("integer")&&t.isPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(e,t,i)=>{var r,n,s;if(t.operator==="Range"){let a=t.ops[0].re,o=t.ops[1].re;return a>0&&o>0}return t.type.matches($.setInteger)&&((s=(n=(r=t.baseDefinition)==null?void 0:r.collection)==null?void 0:n.eltsgn)==null?void 0:s.call(n,t))==="positive"&&(!i||t.symbol!=="PositiveIntegers")},eltsgn:()=>"positive",elttype:()=>"integer"}},Element:{complexity:11200,signature:"(value, collection) -> boolean",description:"Test whether a value is an element of a collection.",evaluate:([e,t],{engine:i})=>{let r=t.xcontains(e);if(r===!0)return i.True;if(r===!1)return i.False}},NotElement:{complexity:11200,signature:"(value, collection) -> boolean",description:"Test whether a value is not an element of a collection.",evaluate:([e,t],{engine:i})=>{let r=t.xcontains(e);if(r===!0)return i.False;if(r===!1)return i.True}},Subset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict subset of the second.",evaluate:([e,t],{engine:i})=>{let r=si(e,t);if(r===!0)return i.True;if(r===!1)return i.False}},SubsetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a subset (possibly equal) of the second.",evaluate:([e,t],{engine:i})=>{let r=si(e,t,!1);if(r===!0)return i.True;if(r===!1)return i.False}},NotSubset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict subset of the second.",evaluate:([e,t],{engine:i})=>{let r=si(e,t);if(r===!0)return i.False;if(r===!1)return i.True}},Superset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict superset of the second.",evaluate:([e,t],{engine:i})=>{let r=si(t,e);if(r===!0)return i.True;if(r===!1)return i.False}},SupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a superset (possibly equal) of the second.",evaluate:([e,t],{engine:i})=>{let r=si(t,e,!0);if(r===!0)return i.True;if(r===!1)return i.False}},NotSuperset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict superset of the second.",evaluate:([e,t],{engine:i})=>{let r=si(t,e);if(r===!0)return i.False;if(r===!1)return i.True}},NotSupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a superset (possibly equal) of the second.",evaluate:([e,t],{engine:i})=>{let r=si(t,e,!0);if(r===!0)return i.False;if(r===!1)return i.True}},Complement:{wikidata:"Q242767",signature:"(set+) -> set",description:"Return the elements of the first set that are not in any of the subsequent sets.",collection:{contains:(e,t)=>{let[i,...r]=e.ops;return(i.xcontains(t)??!1)&&r.every(n=>!n.xcontains(t))},count:e=>vn(e,t=>e.ops.slice(1).every(i=>!i.xcontains(t))),iterator:ug}},Intersection:{wikidata:"Q185837",signature:"(set+) -> set",description:"Return the intersection of two or more sets.",canonical:(e,{engine:t})=>e.length===0||e.length===1?t.symbol("EmptySet"):(e=fn(t,fe(e,"Intersection"),R("(set+) -> set"))??e,t._fn("Intersection",e)),evaluate:ng,collection:{contains:hg,count:e=>vn(e,t=>e.ops.slice(1).every(i=>i.xcontains(t))),iterator:cg}},Union:{wikidata:"Q185359",signature:"(collection+) -> set",description:"Return the union of two or more collections as a set.",canonical:(e,{engine:t})=>e.length===0?t.symbol("EmptySet"):(e=fn(t,fe(e,"Union"),R("(collection+) -> set"))??e,t._fn("Union",e)),evaluate:rg,collection:{contains:(e,t)=>e.ops.some(i=>i.xcontains(t)),count:e=>pg(e,(t,i)=>i.every(r=>!r.xcontains(t))),isEmpty:e=>e.ops.every(t=>t.isEmptyCollection),isFinite:e=>e.ops.every(t=>t.isFiniteCollection),iterator:og}},SetMinus:{wikidata:"Q18192442",signature:"(set, value*) -> set",description:"Return the set difference between the first set and subsequent values.",evaluate:sg,collection:{contains:(e,t)=>{let[i,...r]=e.ops;return(i.xcontains(t)??!1)&&!r.some(n=>n.isSame(t))},count:e=>vn(e,t=>{let[i,...r]=e.ops;return!r.some(n=>n.isSame(t))}),iterator:lg}},SymmetricDifference:{wikidata:"Q1147242",signature:"(set, set) -> set",description:"Return the symmetric difference of two sets (elements in either set but not both).",collection:{contains:(e,t)=>{let[i,r]=e.ops,n=i.xcontains(t)??!1,s=r.xcontains(t)??!1;return n&&!s||!n&&s},count:e=>vn(e,t=>{let[i,r]=e.ops,n=i.xcontains(t)??!1,s=r.xcontains(t)??!1;return n&&!s||!n&&s}),iterator:fg}}};function si(e,t,i=!0){var r,n,s;return!e.isCollection||!t.isCollection?!1:!!((s=(n=(r=e.baseDefinition)==null?void 0:r.collection)==null?void 0:n.subsetOf)!=null&&s.call(n,e,t,i))}function rg(e,{engine:t}){let i=e.map(n=>n.isCollection?n:t.function("Set",[n]));if(i.reduce((n,s)=>n+(s.xsize??0),0)>Hp)return t._fn("Union",i);let r=[];for(let n of i)for(let s of n.each())r.every(a=>!a.isSame(s))&&r.push(s);return r.length===0?t.symbol("EmptySet"):t._fn("Set",r)}function ng(e,{engine:t}){let i=[...e[0].ops??[]];for(let r of e.slice(1))Ie(r)?i=i.filter(n=>[...r.each()].some(s=>n.isSame(s))):i=i.filter(n=>n.isSame(r));return i.length===0?t.symbol("EmptySet"):t._fn("Set",i)}function sg(e,{engine:t}){return t.symbol("EmptySet")}function ag(e){let t=no();return{next:()=>{let{value:i,done:r}=t.next();if(r)return{value:void 0,done:!0};let[n,s]=i;return{value:e.engine.number({re:0,im:n/s}),done:!1}}}}function Js(e){let t=Vf();return{next:()=>{let{value:i,done:r}=t.next();if(r)return{value:void 0,done:!0};let[n,s]=i;return{value:e.engine.number({re:n,im:s}),done:!1}}}}function*jt(e,t){let i=(t==null?void 0:t.sign)??"+-",r=(t==null?void 0:t.includeZero)??!0,n=i==="+-"?no():Rf();r||n.next();for(let s of n)if(i==="+-")yield e.engine.number(s);else{let a=i==="-"?-1:1,[o,l]=s;yield e.engine.number([a*o,l])}}function*bu(e){for(let t of Bf())yield e.engine.number(t)}function*bn(e,t,i){let r=t;for(;;)yield e.number(r),r+=i}function*og(e){let t=[];for(let i of e.ops){for(let r of i.each())t.every(n=>!n.xcontains(r))&&(yield r);t.push(i)}}function*lg(e){let[t,...i]=e.ops;for(let r of t.each())i.some(n=>n.isSame(r))||(yield r)}function*ug(e){let[t,...i]=e.ops;for(let r of t.each())i.every(n=>!n.xcontains(r))&&(yield r)}function*cg(e){for(let t of e.ops[0].each())e.ops.slice(1).every(i=>i.xcontains(t))&&(yield t)}function*fg(e){let[t,i]=e.ops;for(let r of t.each())(i.xcontains(r)??!1)||(yield r);for(let r of i.each())(t.xcontains(r)??!1)||(yield r)}function vn(e,t){if(e.ops.some(r=>r.xsize===1/0))return 1/0;let i=0;for(let r of e.ops[0].each())t(r)&&(i+=1);return i}function pg(e,t){if(e.ops.some(n=>n.xsize===1/0))return 1/0;let i=[],r=0;for(let n of e.ops){for(let s of n.each())t(s,i)&&(r+=1);i.push(n)}return r}function hg(e,t){return e.ops.every(i=>i.xcontains(t)??!1)}var mg=[{Erf:{complexity:7500,signature:"(number) -> number",evaluate:(e,{engine:t})=>{let i=e[0].re;if(Number.isFinite(i))return t.number(cl(i))}},Erfc:{complexity:7500,signature:"(number) -> number",evaluate:(e,{engine:t})=>{let i=e[0].re;if(Number.isFinite(i))return t.number(1-cl(i))}},ErfInv:{complexity:7500,signature:"(number) -> number",evaluate:(e,{engine:t})=>{let i=e[0].re;if(Number.isFinite(i))return t.number(Th(i))}}},{Mean:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",evaluate:(e,{engine:t})=>t.number(be(t)?Eh(t.bignum.bind(t),st(e)):vs(nt(e)))},Median:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",examples:["Mode([1, 2, 2, 3])  // Returns 2"],evaluate:(e,{engine:t})=>t.number(be(t)?ki(st(e)):Zt(nt(e)))},Variance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?hl(t.bignum.bind(t),st(e)):er(nt(e)))},PopulationVariance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?ml(t.bignum.bind(t),st(e)):tr(nt(e)))},StandardDeviation:{complexity:1200,broadcastable:!1,description:"Sample Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?hl(t.bignum.bind(t),st(e)).sqrt():Math.sqrt(er(nt(e))))},PopulationStandardDeviation:{complexity:1200,broadcastable:!1,description:"Population Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?ml(t.bignum.bind(t),st(e)).sqrt():Math.sqrt(tr(nt(e))))},Kurtosis:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?Ih(t.bignum.bind(t),st(e)):xs(nt(e)))},Skewness:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?Mh(t.bignum.bind(t),st(e)):Ns(nt(e)))},Mode:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?Ah(t.bignum.bind(t),st(e)):_s(nt(e)))},Quartiles:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> tuple<mid:number, lower:number, upper:number>",examples:["Quartiles([1, 2, 3, 4, 5])  // Returns (3, 2, 4)"],evaluate:(e,{engine:t})=>{let[i,r,n]=(be(t)?$h(st(e)):ws(nt(e))).map(s=>t.number(s));return t.tuple(i,r,n)}},InterquartileRange:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(e,{engine:t})=>t.number(be(t)?Ch(st(e)):ks(nt(e)))},Histogram:{description:"Compute a histogram of the values in a collection. Returns a list of (bin start, count) tuples.",complexity:8200,signature:"(collection, integer | list<number>) -> list<tuple<number, integer>>",examples:["Histogram([1, 2, 2, 3], 3)  // Returns [(1,1), (1.6667,2), (2.3333,1)]"],evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=Array.from(e.each()).map(l=>l.re).filter(Number.isFinite);if(r.length===0)return;let n=Math.min(...r),s=Math.max(...r),a;if((t==null?void 0:t.operator)==="List")a=t.ops.map(l=>l.re);else{let l=L(t);if(l===null||l<=0)return;let u=(s-n)/l;a=Array.from({length:l+1},(c,f)=>n+f*u)}let o=Array(a.length-1).fill(0);for(let l of r)for(let u=0;u<a.length-1;u++)if(l>=a[u]&&l<a[u+1]){o[u]++;break}return i.function("List",o.map((l,u)=>i._fn("Tuple",[i.number(a[u]),i.number(l)])))}},BinCounts:{description:"Count the number of elements falling into each bin.",complexity:8200,signature:"(collection, integer | list<number>) -> list<number>",examples:["BinCounts([1, 2, 2, 3], 3)  // Returns [1, 2, 1]"],evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=Array.from(e.each()).map(l=>l.re).filter(Number.isFinite);if(r.length===0)return;let n=Math.min(...r),s=Math.max(...r),a;if(t.isCollection)a=[...t.each()].map(l=>l.re);else{let l=L(t);if(l===null||l<=0)return;let u=(s-n)/l;a=Array.from({length:l+1},(c,f)=>n+f*u)}let o=Array(a.length-1).fill(0);for(let l of r)for(let u=0;u<a.length-1;u++)if(l>=a[u]&&l<a[u+1]){o[u]++;break}return i.function("List",o.map(l=>i.number(l)))}},SlidingWindow:{description:"Return overlapping sliding windows of fixed size over the collection.",complexity:8200,signature:"(collection, integer, integer?) -> list<list>",examples:["SlidingWindow([1, 2, 3, 4], 2)  // Returns [[1,2], [2,3], [3,4]]"],evaluate:([e,t,i],{engine:r})=>{if(!e.isFiniteCollection)return;let n=L(t),s=i?L(i):1;if(n===null||n<=0||s===null||s<=0)return;let a=Array.from(e.each()),o=[];for(let l=0;l<=a.length-n;l+=s)o.push(r.function("List",a.slice(l,l+n)));return r.function("List",o)}}},{Sample:{description:"Return a random sample of k elements from the collection, without replacement.",complexity:8200,signature:"(collection, integer) -> list",evaluate:([e,t],{engine:i})=>{if(!e.isFiniteCollection)return;let r=L(t);if(r===null||r<0)return;let n=Array.from(e.each());if(r>n.length)return;for(let a=n.length-1;a>0;a--){let o=Math.floor(Math.random()*(a+1));[n[a],n[o]]=[n[o],n[a]]}let s=n.slice(0,r);return i.function("List",s)}}}];function*vu(e){for(let t of e)t.isFiniteCollection?yield*t.each():yield t}function*nt(e){for(let t of vu(e))yield t.re}function*st(e){for(let t of vu(e))yield t.bignumRe??t.engine.bignum(t.re)}var gg={Sin:[[1,"Sin"],[1,"Cos"],[-1,"Sin"],[-1,"Cos"]],Cos:[[1,"Cos"],[-1,"Sin"],[-1,"Cos"],[1,"Sin"]],Sec:[[1,"Sec"],[-1,"Csc"],[-1,"Sec"],[1,"Csc"]],Csc:[[1,"Csc"],[1,"Sec"],[-1,"Csc"],[-1,"Sec"]],Tan:[[1,"Tan"],[-1,"Cot"],[1,"Tan"],[-1,"Cot"]],Cot:[[1,"Cot"],[-1,"Tan"],[1,"Cot"],[-1,"Tan"]]},Wt=["Sqrt",2],Di=["Sqrt",3],Pi=["Sqrt",5],xn=["Sqrt",6],dg=[[[0,1],{Sin:0,Cos:1,Tan:0,Cot:"ComplexInfinity",Sec:1,Csc:"ComplexInfinity"}],[[1,12],{Sin:["Divide",["Subtract",xn,Wt],4],Cos:["Divide",["Add",xn,Wt],4],Tan:["Subtract",2,Di],Cot:["Add",2,Di],Sec:["Subtract",xn,Wt],Csc:["Add",xn,Wt]}],[[1,10],{Sin:["Divide",["Subtract",Pi,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,Pi]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,Pi]]],5],Cot:["Sqrt",["Add",5,["Multiply",2,Pi]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,Pi]]],5],Csc:["Add",1,Pi]}],[[1,8],{Sin:"$\\frac{\\sqrt{2-\\sqrt2}}{2}$",Cos:"$\\frac{\\sqrt {2+{\\sqrt {2}}}}{2}$",Tan:"$\\sqrt{2} - 1$",Cot:"$\\sqrt{2} + 1$",Sec:"$\\sqrt{ 4 - 2\\sqrt{2}}$",Csc:"$\\sqrt{ 4 + 2\\sqrt{2}}$"}],[[1,6],{Sin:"$\\frac{1}{2}$",Cos:"$\\frac{\\sqrt{3}}{2}$",Tan:"$\\frac{\\sqrt{3}}{3}$",Cot:"$\\sqrt{3}$",Sec:"$\\frac{2\\sqrt{3}}{3}$",Csc:2}],[[1,5],{Sin:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Cos:"$\\frac{1+ \\sqrt{5}} {4}$",Tan:"$\\sqrt{5-2\\sqrt5}$",Cot:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Sec:"$\\sqrt{5} - 1$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,4],{Sin:["Divide",Wt,2],Cos:["Divide",Wt,2],Tan:1,Cot:1,Sec:Wt,Csc:Wt}],[[3,10],{Sin:"$\\frac{1+ \\sqrt5} {4}$",Cos:"$\\frac{\\sqrt{10- 2\\sqrt5}} {4}$",Tan:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Cot:"$\\sqrt{5-2\\sqrt5}$",Sec:"$\\frac{\\sqrt{50+10\\sqrt5}} {5}$",Csc:"$\\sqrt5-1$"}],[[1,3],{Sin:["Divide",Di,2],Cos:"Half",Tan:Di,Cot:["Divide",Di,3],Sec:2,Csc:["Divide",["Multiply",2,Di],3]}],[[3,8],{Sin:"$\\frac{ \\sqrt{2 + \\sqrt{2}} } {2}$",Cos:"$\\frac{ \\sqrt{2 - \\sqrt{2}} } {2}$",Tan:"$\\sqrt{2} + 1$",Cot:"$\\sqrt{2} - 1$",Sec:"$\\sqrt{ 4 + 2 \\sqrt{2} }$",Csc:"$\\sqrt{ 4 - 2 \\sqrt{2} }$"}],[[2,5],{Sin:"$\\frac{\\sqrt{10+ 2\\sqrt{5}}} {4}$",Cos:"$\\frac{\\sqrt{5}-1} {4}$",Tan:"$\\sqrt{5+2\\sqrt{5}}$",Cot:"$\\frac{\\sqrt{25-10\\sqrt{5}}} {5}$",Sec:"$1 + \\sqrt{5}$",Csc:"$\\frac{\\sqrt{50-10\\sqrt{5}}} {5}$"}],[[5,12],{Sin:"$\\frac{\\sqrt{6} + \\sqrt{2}} {4}$",Cos:"$\\frac{ \\sqrt{6} - \\sqrt{2}} {4}$",Tan:"$2+\\sqrt{3}$",Cot:"$2-\\sqrt{3}$",Sec:"$\\sqrt{6}+\\sqrt{2}$",Csc:"$\\sqrt{6} - \\sqrt{2}$"}],[[1,2],{Sin:1,Cos:0,Tan:"ComplexInfinity",Cot:0,Sec:"ComplexInfinity",Csc:1}]];function We(e,t,i,r){var s;let n=(s=Bl(e))==null?void 0:s.N();if(n!==void 0)return X(n,t,i,r)}function He(e){if(!e)return e;let t=e.engine,i=t.angularUnit;if(i==="rad")return e;let r=e.N().re;return Number.isNaN(r)?e:i==="deg"?t.number(r*(180/Math.PI)):i==="grad"?t.number(r*(200/Math.PI)):i==="turn"?t.number(r/(2*Math.PI)):e}function Nn(e,t){if(!t)return;let i=t.engine;switch(e){case"Arccos":return He(X(t,Math.acos,r=>r.acos(),r=>r.acos()));case"Arccot":return He(X(t,r=>Math.atan2(1,r),r=>Z.atan2(i._BIGNUM_ONE,r),r=>r.inverse().atan()));case"Arccsc":return He(X(t,r=>Math.asin(1/r),r=>i._BIGNUM_ONE.div(r).asin(),r=>r.inverse().asin()));case"Arccosh":return He(X(t,Math.acosh,r=>r.acosh(),r=>r.acosh()));case"Arccoth":return He(X(t,r=>Math.log((1+r)/(r-1))/2,r=>i._BIGNUM_ONE.add(r).div(r.sub(i._BIGNUM_ONE)).log().div(2),r=>i.complex(1).add(r).div(r.sub(1)).log().div(2)));case"Arccsch":return He(X(t,r=>Math.log(1/r+Math.sqrt(1/(r*r)+1)),r=>i._BIGNUM_ONE.div(r.mul(r)).add(i._BIGNUM_ONE).sqrt().add(i._BIGNUM_ONE.div(r)).log(),r=>r.mul(r).inverse().add(1).sqrt().add(r.inverse()).log()));case"Arcsec":return He(X(t,r=>Math.acos(1/r),r=>i._BIGNUM_ONE.div(r).acos(),r=>r.inverse().acos()));case"Arcsin":return He(X(t,Math.asin,r=>r.asin(),r=>r.asin()));case"Arcsech":return He(X(t,r=>Math.log((1+Math.sqrt(1-r*r))/r),r=>i._BIGNUM_ONE.sub(r.mul(r).add(i._BIGNUM_ONE).div(r)).log(),r=>i.complex(1).sub(r.mul(r)).add(1).div(r).log()));case"Arcsinh":return He(X(t,Math.asinh,r=>r.asinh(),r=>r.asinh()));case"Arctan":return He(X(t,Math.atan,r=>r.atan(),r=>r.atan()));case"Arctanh":return He(X(t,Math.atanh,r=>r.atanh(),r=>r.atanh()));case"Cos":return We(t,Math.cos,r=>i.chop(r.cos()),r=>r.cos());case"Cosh":return We(t,Math.cosh,r=>r.cosh(),r=>r.cosh());case"Cot":return We(t,r=>1/Math.tan(r),r=>i._BIGNUM_ONE.div(r.tan()),r=>r.tan().inverse());case"Coth":return We(t,r=>1/Math.tanh(r),r=>i._BIGNUM_ONE.div(r.tanh()),r=>r.tanh().inverse());case"Csc":return We(t,r=>1/Math.sin(r),r=>i._BIGNUM_ONE.div(r.sin()),r=>r.sin().inverse());case"Csch":return We(t,r=>1/Math.sinh(r),r=>i._BIGNUM_ONE.div(r.sinh()),r=>r.sinh().inverse());case"Sec":return We(t,r=>1/Math.cos(r),r=>i._BIGNUM_ONE.div(r.cos()),r=>r.cos().inverse());case"Sech":return We(t,r=>1/Math.cosh(r),r=>i._BIGNUM_ONE.div(r.cosh()),r=>r.cosh().inverse());case"Sin":return We(t,Math.sin,r=>i.chop(r.sin()),r=>r.sin());case"Sinh":return We(t,Math.sinh,r=>r.sinh(),r=>r.sinh());case"Tan":return We(t,r=>{let n=Math.tan(r);return n>1e6||n<-1e6?i.ComplexInfinity:n},r=>{let n=r.tan();return n.greaterThan(1e6)||n.lessThan(-1e6)?i.ComplexInfinity:n},r=>r.tan());case"Tanh":return We(t,Math.tanh,r=>r.tanh(),r=>r.tanh())}}function yg(e){return!!(e.startsWith("Ar")&&Ks(e))}function Ks(e){return{Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arcsinh",Cosh:"Arccosh",Tanh:"Arctanh",Sech:"Arcsech",Csch:"Arccsch",Arccosh:"Cosh",Arccos:"Cos",Arccsc:"Csc",Arccsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arcsinh:"Sinh",Arctan:"Tan",Arctanh:"Tanh"}[e]}function Xs(e,t){if(t.length!==1||!t[0].isValid)return;let i=t[0];if(i.operator==="InverseFunction")return i.op1.canonical;let r=i.symbol;if(typeof r!="string")return;let n=Ks(r);return n?e.symbol(n):void 0}function xu(e){return e!=="Cos"&&e!=="Sec"?-1:1}function bg(e,t,i,r){if(!i)return;let n=i.N().re;if(Number.isNaN(n))return;let s=Ks(t),a=e._cache("constructible-inverse-trigonometric-values-"+t,()=>{let l=[];for(let[[u,c],f]of r){let p=f[s];if(p===void 0)continue;let h=p.N().re;Number.isNaN(h)||l.push([[p,h],[u,c]])}return l},l=>{for(let[[u,c],[f,p]]of l)u.reset();return l}),o=0;n<0&&(o=xu(s)==-1?-1:1,n=-n,i=i.neg());for(let[[l,u],[c,f]]of a)if(e.chop(n-u)===0){let p=e.Pi.mul(c).div(f);return o==-1?p=p.neg():o==1&&(p=e.Pi.sub(p)),p.evaluate()}}function Nu(e,t){var n;let[i,r]=vg(t);if(i!==void 0)return r!==void 0&&((e==="Sin"||e==="Tan")&&(r===0||r===2)||(e==="Cos"||e==="Cot")&&(r===1||r===3))?"zero":(n={Sin:["positive","positive","negative","negative"],Cos:["positive","negative","negative","positive"],Sec:["positive","negative","negative","positive"],Csc:["positive","positive","negative","negative"],Tan:["positive","negative","positive","negative"],Cot:["positive","negative","positive","negative"]}[e])==null?void 0:n[i]}function _u(e){return["Sin","Cos","Tan","Csc","Sec","Cot"].includes(typeof e=="string"?e:e.operator)}function ea(e,t){var u;if(!t||!_u(e))return;let i=t.engine;if(t=t.N(),t.im!==0)return;let r=t.re;if(Number.isNaN(r))return;let n=i._cache("constructible-trigonometric-values",()=>dg.map(([c,f])=>[c,Object.fromEntries(Object.entries(f).map(([p,h])=>[p,(i.parse(Gi(h))??i.box(h)).simplify()]))]),c=>{for(let[f,p]of c)for(let h of Object.values(p))h.reset();return c});if(yg(e))return bg(i,e,t,n);let s=i.angularUnit;s!=="rad"&&(s==="deg"&&(r*=Math.PI/180),s==="grad"&&(r*=Math.PI/200),s==="turn"&&(r*=2*Math.PI));let a=xu(e)==-1?Math.sign(r):1;r=Math.abs(r%(2*Math.PI));let o=Math.floor(r*2/Math.PI);r=r%(Math.PI/2);let l;[l,e]=((u=gg[e])==null?void 0:u[o])??[1,e];for(let[[c,f],p]of n){let h=p[e];if(h&&Math.abs(r-Math.PI*c/f)<=1e-12)return h.symbol==="ComplexInfinity"?h:a*l<0?h.neg():h}}function vg(e){if(!e.isValid||!e.isNumberLiteral)return[void 0,void 0];if(e.im!==0)return[void 0,void 0];let t=e.re;if(isNaN(t))return[void 0,void 0];let i=(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI);return Math.abs(i)<1e-12?[1,0]:Math.abs(i-Math.PI/2)<1e-12?[2,1]:Math.abs(i-Math.PI)<1e-12?[3,2]:Math.abs(i-3*Math.PI/2)<1e-12?[4,3]:[Math.floor(i/(Math.PI/2))+1,void 0]}var xg=[{Pi:{type:"finite_real",isConstant:!0,holdUntil:"N",wikidata:"Q167",value:e=>e.number(be(e)?e._BIGNUM_PI:Math.PI)}},{Degrees:{signature:"(real) -> real",canonical:(e,{engine:t})=>{let i=t;if(i.angularUnit==="deg")return e[0];if(e.length!==1)return i._fn("Degrees",e);let r=e[0];if(r.numericValue===null||!r.isValid)return i._fn("Degrees",e);let n=r.re;if(Number.isNaN(n))return r.mul(i.Pi).div(180);if(n=n%360,n<0&&(n+=360),Number.isInteger(n)){let s=cs([n,180]);return s[0]===0?i.Zero:s[0]===1&&s[1]===1?i.Pi:s[0]===1?i.Pi.div(s[1]):i.number(s).mul(i.Pi)}return i.number(n).div(180).mul(i.Pi)},evaluate:(e,t)=>t.engine.angularUnit==="deg"?e[0]:e[0].mul(t.engine.Pi.div(180)).evaluate(t)},Hypot:{broadcastable:!0,signature:"(real, real) -> real",sgn:()=>"non-negative",evaluate:([e,t],{engine:i})=>i.box(["Sqrt",["Add",["Square",e],["Square",t]]])},Sin:te("Sin",5e3)},{Arctan:{wikidata:"Q2257242",complexity:5200,broadcastable:!0,signature:"(number) -> finite_real",sgn:([e])=>Nu("Arctan",e),evaluate:([e],{numericApproximation:t})=>t?Nn("Arctan",e):ea("Arctan",e)??Nn("Arctan",e)},Arctan2:{wikidata:"Q776598",complexity:5200,broadcastable:!0,signature:"(y:number, x: number) -> real",evaluate:([e,t],{engine:i,numericApproximation:r})=>r?ti(e,t,Math.atan2,(n,s)=>Z.atan2(n,s)):e.isFinite===!1&&t.isFinite===!1?i.NaN:e.is(0)&&t.is(0)?i.Zero:t.isFinite===!1?t.isPositive?i.Zero:i.Pi:e.isFinite===!1?e.isPositive?i.Pi.div(2):i.Pi.div(-2):e.is(0)?t.isPositive?i.Zero:i.Pi:i.function("Arctan",[e.div(t)]).evaluate()},Cos:te("Cos",5050),Tan:te("Tan",5100)},{Arccosh:te("Arccosh",6200),Arcsin:te("Arcsin",5500),Arcsinh:te("Arcsinh",6100),Arctanh:te("Arctanh",6300),Cosh:te("Cosh",6050),Cot:te("Cot",5600),Csc:te("Csc",5600,"Cosecant"),Sec:te("Sec",5600,"Secant, inverse of cosine"),Sinh:te("Sinh",6e3),Haversine:{wikidata:"Q2528380",broadcastable:!0,signature:"(real) -> number",evaluate:([e],{engine:t})=>t.box(["Divide",["Subtract",1,["Cos",e]],2])},InverseHaversine:{broadcastable:!0,signature:"(real) -> real",evaluate:([e],{engine:t})=>t.box(["Multiply",2,["Arcsin",["Sqrt",e]]])}},{Csch:te("Csch",6200,"Hyperbolic cosecant"),Sech:te("Sech",6200,"Hyperbolic secant"),Tanh:te("Tanh",6200,"Hyperbolic tangent")},{Arccos:te("Arccos",5550),Arccot:te("Arccot",5650),Arccoth:te("Arccoth",6350),Arccsch:te("Arccsch",6250),Arcsec:te("Arcsec",5650),Arcsech:te("Arcsech",6250),Arccsc:te("Arccsc",5650),Coth:te("Coth",6300),InverseFunction:{lazy:!0,signature:"(function) -> function",canonical:(e,{engine:t})=>(e=At(t,e,1),Xs(t,e)??t._fn("InverseFunction",e)),evaluate:(e,{engine:t})=>Xs(t,e)}}];function te(e,t,i){return{complexity:t,description:i,broadcastable:!0,signature:"(number) -> number",sgn:([r])=>Nu(e,r),evaluate:([r],{numericApproximation:n})=>n?Nn(e,r):ea(e,r)??Nn(e,r)}}function wu(e){if(e==="all")return wu(["core","control-structures","logic","collections","relop","numeric","arithmetic","trigonometry","algebra","calculus","polynomials","combinatorics","number-theory","linear-algebra","statistics","dimensions","units","physics","other"]);typeof e=="string"&&(e=[e]);let t=[];for(let i of e){let r=Ng[i];if(!r)throw Error(`Unknown library category ${i}`);Array.isArray(r)?t.push(...r):t.push(r)}return Object.freeze(t)}var Ng={algebra:[],arithmetic:[...mm,...Dm],calculus:Sm,collections:[ig,hh],combinatorics:Am,"control-structures":Tm,core:Fm,dimensions:[],domains:[],"linear-algebra":Wm,logic:Qm,"number-theory":Jm,numeric:[],other:[],relop:tg,polynomials:eg,physics:{Mu0:{description:"Vaccum permeability",isConstant:!0,wikidata:"Q1515261",type:"real",value:125663706212e-17}},statistics:mg,trigonometry:xg,units:[]};function _g(e){if(e=e.normalize(),Le(e))return e;throw new Error(`Invalid definition name "${e}": ${Yt(e)}`)}function ku(e,t){let i=e.context.lexicalScope.bindings;e.strict;for(let[r,n]of Object.entries(t))try{if(r=_g(r),Rs(n))try{if(i.has(r))throw new Error(`Duplicate operator definition: "${r}"
${JSON.stringify(i.get(r),void 0,4)}
`);i.set(r,{operator:new gs(e,r,n)})}catch(s){console.error([`
Error in operator definition`,JSON.stringify(n,void 0,4),"",s.message].join(`
|   `)+`
`)}else if(Vs(n))try{if(i.has(r))throw new Error(`The symbol "${r}" is already defined`);i.set(r,{value:new Ei(e,r,n)})}catch(s){console.error([`
Error in value definition of "${r}"`,"",JSON.stringify(n,void 0,4),"",s.message].join(`
|   `))}else{let s=new Ei(e,r,{value:e.box(n)});i.set(r,{value:s})}}catch(s){console.error([`
Error in definition of "${r}"`,"",JSON.stringify(n,void 0,4),"",s.message].join(`
|   `)+`
`)}}function _n(e){return typeof e=="number"?e===0?1:Number.isInteger(e)?Math.floor(Math.log2(Math.abs(e))/Math.log2(10))+(e>0?1:2):2:e.isZero?1:e.im!==0?_n(e.re)+_n(e.im)+1:_n(e.re)}function ta(e){var r;if(e.symbol)return 1;if(e.isNumberLiteral)return _n(e.numericValue);let t=e.operator,i=2;if(["Add"].includes(t))i=3;else if(["Subtract","Negate"].includes(t))i=4;else if(["Square","Sqrt"].includes(t))i=5;else{if(["Power","Root"].includes(t))return ta(e.ops[1]);["Multiply"].includes(t)?i=7:["Divide"].includes(t)?i=8:["Ln","Exp","Log","Lb"].includes(t)?i=9:["Cos","Sin","Tan"].includes(t)?i=10:i=11}return i+(((r=e.ops)==null?void 0:r.reduce((n,s)=>n+ta(s),0))??0)}var Su=ta;function ve(e){for(let[t,i]of Object.entries(e))if(t!=="x"&&t!=="_x"&&i.has("_x"))return!1;return!0}var wg=[{match:["Multiply","_x","__a"],replace:0,id:"ax",condition:ve},{match:["Add",["Divide","_a","_x"],"__b"],replace:1/0,useVariations:!0,condition:ve},{match:["Add",["Multiply","_x","__a"],"__b"],replace:["Divide",["Negate","__b"],"__a"],useVariations:!0,condition:ve},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]],useVariations:!0,condition:e=>ve(e)&&!e._n.is(0)},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Negate",["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]]],useVariations:!0,condition:e=>ve(e)&&!e._n.is(0)&&(e._n.isEven??!1)},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Add",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:ve},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Subtract",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:ve},{id:"a^x + b = 0",match:["Add",["Power","_a","_x"],"__b"],replace:["Ln",["Negate","__b"],"_a"],useVariations:!0,onBeforeMatch:()=>{},condition:e=>ve(e)&&(e._a.isPositive??!1)&&(e.__b.isNegative??!1)},{match:["Add",["Multiply","__a",["Exp",["Multiply","__b","_x"]]],"__c"],replace:["Divide",["Ln",["Negate",["Divide","__c","__a"]]],"__b"],useVariations:!0,condition:e=>ve(e)&&((!e.__a.is(0)&&e.__c.div(e.__a).isNegative)??!1)},{match:["Add",["Multiply","__a",["Exp","_x"]],"__c"],replace:["Ln",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:e=>ve(e)&&((!e.__a.is(0)&&e.__c.div(e.__a).isNegative)??!1)&&!e.__a.has("_x")&&!e.__c.has("_x")},{match:["Add",["Exp","_x"],"__c"],replace:["Ln",["Negate","__c"]],useVariations:!0,condition:e=>ve(e)&&(e.__c.isNegative??!1)},{match:["Add",["Exp",["Multiply","__b","_x"]],"__c"],replace:["Divide",["Ln",["Negate","__c"]],"__b"],useVariations:!0,condition:e=>ve(e)&&(e.__c.isNegative??!1)},{match:["Add",["Multiply","__a",["Log","_x","__b"]],"__c"],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:e=>(ve(e)&&!e.__a.is(0)&&e.__b.isPositive)??!1},{match:["Multiply","__a",["Log","_x","__b"]],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:e=>(ve(e)&&!e.__a.is(0)&&e.__b.isPositive)??!1},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Subtract","__b","__c"],"__a"],condition:ve},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Negate",["Add","__b","__c"],"__a"]],condition:ve},{match:"ax + \\mathrm{__b} \\sqrt{cx + \\mathrm{__d}} + \\mathrm{__g}",replace:"\\frac{-(2 a g - \\mathrm{__b}^2 c) + \\sqrt{(2 a \\mathrm{__g} - \\mathrm{__b}^2 c)^2 - 4 a^2(g^2 - b^2 \\mathrm{__d})}}{2 a^2}",useVariations:!0,condition:ve},{match:"ax + \\mathrm{__b} \\sqrt{cx + \\mathrm{__d}} + \\mathrm{__g}",replace:"\\frac{-(2 a g - \\mathrm{__b}^2 c) - \\sqrt{(2 a \\mathrm{__g} - \\mathrm{__b}^2 c)^2 - 4 a^2(g^2 - b^2 \\mathrm{__d})}}{2 a^2}",useVariations:!0,condition:ve}];function Tu(e,t){let i=e.engine;e.operator==="Equal"?e=e.op1.expand().sub(e.op2.expand()).simplify():e=e.expand().simplify();let r=i.getRuleSet("solve-univariate"),n=[e.subs({[t]:"_x"},{canonical:!1})];i.pushScope(),i.declare("_x","number");let s=n.flatMap(a=>ar(a,r,{_x:i.symbol("_x")},{useVariations:!0,canonical:!0}));return s.length===0&&(n=n.flatMap(a=>Eu(a)),s=n.flatMap(a=>ar(a,r,{_x:i.symbol(t)},{useVariations:!0,canonical:!0}))),s.length===0&&(n=n.flatMap(a=>ht(a.canonical)).filter(a=>a!==null),n=n.flatMap(a=>Eu(a)),s=n.flatMap(a=>ar(a,r,{_x:i.symbol(t)},{useVariations:!0,canonical:!0}))),i.popScope(),Sg(e,t,s.map(a=>a.evaluate().simplify()))}var kg=[{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Multiply","__a","_x"],"__b","__c"]},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Negate",["Multiply","__a","_x"]],["Negate","__b"],"__c"]},{match:["Multiply","__a",["Power","_b","_n"]],replace:"_b",condition:({__a:e,_b:t,_n:i})=>!e.has("_x")&&t.has("_x")&&!i.is(0)&&!i.has("_x")},{match:["Multiply","__a",["Sqrt","_b"]],replace:["Multiply",["Square","_a"],"__b"],condition:({_b:e})=>e.has("_x")},{match:["Divide","_a","_b"],replace:"_a",condition:({_a:e,_b:t})=>e.has("_x")&&!t.is(0)},{match:["Multiply","__a","_b"],replace:"_b",condition:({__a:e,_b:t})=>!e.has("_x")&&t.has("_x")},{match:["Add",["Ln","_a"],["Ln","_b"],"__c"],replace:["Add",["Ln",["Multiply","_a","_b"]],"__c"]},{match:["Multiply",["Exp","__a"],["Exp","__b"],"__c"],replace:["Multiply",["Exp",["Add","_a","_b"]],"__c"]},{match:["Ln","_a"],replace:["Subtract","_a",1],condition:({_a:e})=>e.has("_x")},{match:["Sin","_a"],replace:"_a",condition:({_a:e})=>e.has("_x")},{match:["Cos","_a"],replace:["Subtract","_a",["Divide","Pi",2]],condition:({_a:e})=>e.has("_x")},{match:["Tan","_a"],replace:"_a",condition:({_a:e})=>e.has("_x")},{match:["Add",["Sin","_a"],["Cos","_a"]],replace:1,condition:({_a:e})=>e.has("_x")},{match:["Subtract",["Square",["Sin","_a"]],["Square",["Cos","_a"]]],replace:["PlusMinus",["Sin","_a"],["Divide",["Sqrt",2],2]],condition:({_a:e})=>e.has("_x")}];function Eu(e){let t=e.engine,i=t.getRuleSet("harmonization");return ar(e,i,{_x:t.symbol("_x")})}function Sg(e,t,i){return i.filter(r=>{let n=e.subs({[t]:r}).canonical.evaluate();return n===null||!n.isValid||n.isNaN||n.has(t)?!1:n.isEqual(0)})}function Iu(e,t){if(!e.ops)return[];let i=e.ops,r=e.operatorDefinition;if(!r||i.length===0)return i;let n=r!=null&&r.associative?e.operator:"";if(i=yi(i,n),r.lazy)return i;let s=[];for(let a of i){let o=a.operator;if(o==="Hold")s.push(a);else{let l=o==="ReleaseHold"?a.op1:a;if(l){let u=t(l);u!==null&&s.push(u)}}}return yi(s,n)}async function Tg(e,t){if(!e.ops)return[];let i=e.ops,r=e.operatorDefinition;if(!r||i.length===0)return i;let n=r!=null&&r.associative?e.operator:"";if(i=yi(i,n),r.lazy)return i;let s=[];for(let a of i){let o=a.operator;if(o==="Hold")s.push(a);else{let l=o==="ReleaseHold"?a.op1:a;if(l){let u=await t(l);u!==null&&s.push(u)}}}return yi(s,n)}function fr(e,t,i){if((s=>i&&i.some(a=>a.value.isSame(s)))(e)||(i||(i=[{value:e,because:"initial"}]),!e.isValid))return i;if(!(e.isCanonical||e.isStructural)){let s=e.canonical;return s.isCanonical||s.isStructural?fr(s,t,i):i}let r=e.engine,n=t!=null&&t.rules?r.rules(t.rules,{canonical:!0}):r.getRuleSet("standard-simplification");t={...t,rules:n};do{let s=Ig(e,n,t,i);if(s.length<=i.length)break;e=s.at(-1).value,i=s}while(!i.slice(0,-1).some(s=>s.value.isSame(e)));return i}function Eg(e,t,i){if(t==null||e===t||e.isSame(t))return!1;let r=e.engine;return i??(i=n=>r.costFunction(n)),i(t)<=1.2*i(e)}function Mu(e,t){return e.ops?e.engine.function(e.operator,Iu(e,i=>fr(i,t).at(-1).value)):e}function Ig(e,t,i,r){if(e.isNumberLiteral||e.string)return r;if(e.symbol){let a=sr(e,t,{recursive:!1,canonical:!0,useVariations:!1});return a.length>0?[...r,...a]:r}let n=Mu(e,i);n.isSame(e)||(r=[...r,{value:n,because:"simplified operands"}],e=n);let s=Mg(e,t,i,r);return s.length>r.length?s:r}function Mg(e,t,i,r){let n=sr(e,t,{recursive:!1,canonical:!0,useVariations:i.useVariations??!1});if(n.length===0)return r;let s=n.at(-1).value;return s.isSame(e)||(s=Mu(s),!Eg(e,s,i==null?void 0:i.costFunction))?r:(n.at(-1).value=s,[...r,...n])}function ia(e){return typeof e=="string"?e.startsWith("_"):Ci(e)?!0:e.ops?ia(e.operator)||e.ops.some(ia):!1}function wn(e,t,i){return e.startsWith("_"),e==="_"||e==="__"||e==="___"?i:e in i?t.isSame(i[e])?i:null:ia(t)?null:{...i,[e]:t}}function ai(e,t,i,r){if(Ci(t))return wn(qi(t),e,i);let n=r.acceptVariants??!0;if(r={...r,acceptVariants:!0},t.numericValue!==null)return e.numericValue===null?null:t.isEqual(e)?i:n?ra(e,t,i,r):null;let s=t.string;if(s!==null)return e.string===s?i:null;let a=t.symbol;if(a!==null)return a===e.symbol?i:n?ra(e,t,i,r):null;if(t.ops){let o=r.useVariations??!1,l=e.engine,u=null,c=t.operator;if(c.startsWith("_")?(u=wn(c,l.box(e.operator),i),u!==null&&(u=na(e,t.ops,u,r))):c===e.operator&&(u=t.operatorDefinition.commutative?$g(e,t,i,r):na(e,t.ops,i,r)),u===null&&o){if(!n)return null;u=ra(e,t,i,r)}return u!==null&&(i=u),r.recursive&&e.ops&&(u=Ag(e,t,i,{...r,acceptVariants:n})??u),u}return null}function Ag(e,t,i,r){e.ops;let n=null;for(let s of e.ops){let a=ai(s,t,i,r);a!==null&&(n=a,i=a)}return n}function ra(e,t,i,r){if(!r.useVariations)return null;let n=e.engine,s={...r,acceptVariants:!1},a=(l,u)=>ai(n.function(l,u,{canonical:!1}),t,i,s),o=t.operator;if(o==="Negate"&&e.is(0))return ai(n.Zero,t.op1,i,s);if(o==="Add"){let l=a("Add",[0,e]);if(l!==null||(e.operator==="Subtract"&&(l=a("Add",[e.op1,["Negate",e.op2]])),l!==null))return l}if(o==="Subtract"){let l=a("Subtract",[e,0]);if(l!==null||(e.operator==="Negate"&&(l=a("Subtract",[0,e.op1])),l!==null))return l}if(o==="Multiply"){let l=a("Multiply",[1,e]);if(l!==null||e.operator==="Negate"&&(l=a("Multiply",[-1,e.op1]),l!==null)||e.operator==="Divide"&&(l=a("Multiply",[e.op1,["Divide",1,e.op2]]),l!==null))return l}if(o==="Divide"){let l=a("Divide",[e,1]);if(l!==null)return l}if(o==="Square"){let l=a("Power",[e,2]);if(l!==null)return l}if(o==="Exp"){let l=a("Power",[n.E,e]);if(l!==null)return l}if(o==="Power"){if(t.op2.re===2&&t.op2.im===0){let l=a("Square",[e]);if(l!==null)return l}if(t.op1.symbol==="ExponentialE"){let l=a("Exp",[e]);if(l!==null)return l}{let l=a("Power",[e,1]);if(l!==null)return l}}return null}function $g(e,t,i,r){e.operator,t.operator;let n=Ef(t.ops);for(let s of n){let a=na(e,s,i,r);if(a!==null)return a}return null}function na(e,t,i,r){if(t.length===0)return e.ops&&e.ops.length===0?i:null;let n=t[0].engine,s={...i},a=[...e.ops],o=0;for(;o<t.length;){let l=t[o],u=qi(l);if(u!==null)if(u.startsWith("__")){let c=0;if(t[o+1]===void 0)c=a.length+1;else{let p=!1;for(;!p&&c<a.length;)p=ai(a[c],t[o+1],s,r)!==null,c+=1;if(!p&&u.startsWith("___"))return null}if(!u.startsWith("___")&&c<=1)return null;let f;if(c<=1)e.operator==="Add"?f=n.Zero:e.operator==="Multiply"?f=n.One:f=n.Nothing;else if(c===2){if(a.length===0)return null;f=a.shift()}else{let p=n.lookupDefinition(e.operator),h=a.splice(0,c-1);p&&le(p)&&p.operator.associative?f=n.function(e.operator,h,{canonical:!1}):f=n.function("Sequence",h,{canonical:!1})}s=wn(u,f,s)}else if(u.startsWith("_")){if(a.length===0)return null;s=wn(u,a.shift(),s)}else s=ai(a.shift(),l,s,r);else{let c=a.shift();if(!c)return null;s=ai(c,l,s,r)}if(s===null)return null;o+=1}return a.length>0?null:s}function sa(e,t,i){t=t.structural;let r=(i==null?void 0:i.useVariations)??!1,n={recursive:(i==null?void 0:i.recursive)??!1,useVariations:r,acceptVariants:r},s=(i==null?void 0:i.substitution)??{};return ai(e.structural,t.structural,s,n)}function Cg(e){let t=e.engine;if(e.operator==="Hold")return;let i;if(e.ops){let r=e.operatorDefinition;return r!=null&&r.sgn&&(i=r.sgn(e.ops,{engine:t})),i}return e.symbol||e.isNumberLiteral?e.sgn:"unsigned"}function aa(e){if(e!==void 0){if(e==="positive")return!0;if(["non-positive","zero","negative"].includes(e))return!1}}function oa(e){if(e!==void 0){if(["positive","positive-infinity","non-negative","zero"].includes(e))return!0;if(e==="negative")return!1}}function la(e){if(e!==void 0){if(e==="negative")return!0;if(["non-negative","zero","positive"].includes(e))return!1}}function ua(e){if(e!==void 0){if(["negative","non-positive","zero"].includes(e))return!0;if(["positive","positive-infinity"].includes(e))return!1}}function Au(e,t,i){return e.generation=t,e.value=i(),e.value}var qg=[5,5],xe=class extends ge{constructor(t,i,r,n){super(t,n==null?void 0:n.metadata);m(this,"_operator");m(this,"_ops");m(this,"_def");m(this,"_capturedContext");m(this,"_localScope");m(this,"_isPure");m(this,"_isStructural");m(this,"_hash");m(this,"_value",{value:null,generation:-1});m(this,"_valueN",{value:null,generation:-1});m(this,"_sgn",{value:null,generation:-1});m(this,"_type",{value:null,generation:-1});this._operator=i,this._ops=r,this._localScope=n==null?void 0:n.scope,this._isStructural=(n==null?void 0:n.structural)??!1,(n!=null&&n.canonical||this._isStructural)&&this.bind()}get hash(){if(this._hash!==void 0)return this._hash;let t=0;for(let i of this._ops)t=t<<1^i.hash|0;return t=t^Mi(this._operator)|0,this._hash=t,t}infer(t,i){let r=this.operatorDefinition;return!r||!r.inferredSignature?!1:(r.signature.is("function")?r.signature=new $({kind:"signature",result:t},this.engine._typeResolver):Qa(r.signature.type)&&(r.signature=new $({kind:"signature",result:i==="narrow"?Ir(r.signature.type.result,t):$e(r.signature.type.result,t)},this.engine._typeResolver)),this.engine._generation+=1,!0)}bind(){this._def=Uo(this._operator,this._localScope??this.engine.context.lexicalScope)}reset(){}get value(){}get isCanonical(){return this._def!==void 0&&this._def!==null}get isPure(){var i;if(this._isPure!==void 0)return this._isPure;let t=((i=this.operatorDefinition)==null?void 0:i.pure)??!1;return t&&(t=this._ops.every(r=>r.isPure)),this._isPure=t,t}get isConstant(){return this.isPure&&this._ops.every(t=>t.isConstant)}get constantValue(){return this.isConstant?this.value:void 0}get json(){return[this._operator,...this.structural.ops.map(t=>t.json)]}get operator(){return this._operator}get ops(){return this._ops}get nops(){return this._ops.length}get op1(){return this._ops[0]??this.engine.Nothing}get op2(){return this._ops[1]??this.engine.Nothing}get op3(){return this._ops[2]??this.engine.Nothing}get isScoped(){return this._localScope!==void 0}get localScope(){return this._localScope}get isValid(){return this._operator==="Error"?!1:this._ops.every(t=>t==null?void 0:t.isValid)}get canonical(){return this.isCanonical||!this.isValid?this:this.engine.function(this._operator,this._ops)}get structural(){if(this.isStructural)return this;let t=this.operatorDefinition;if(t!=null&&t.associative||t!=null&&t.commutative){let i=this.ops.map(n=>n.structural),r=[];if(!t.associative)r=i;else for(let n of i)n.operator===this.operator?r.push(...n.ops):r.push(n);return this.engine.function(this._operator,this.isValid?hs(this._operator,r):r,{canonical:!1,structural:!0})}return this.engine.function(this._operator,this.ops.map(i=>i.structural),{canonical:!1,structural:!0})}get isStructural(){return this._isStructural}toNumericValue(){this.isCanonical||this.isStructural;let t=this.engine;if(this.operator==="Complex")return[t._numericValue({re:this.op1.re,im:this.op2.re}),t.One];let i=this;if(i.operator==="Add"&&(i=cr(this),i.numericValue!==null)){if(typeof i.numericValue=="number"){if(Number.isInteger(i.numericValue))return[t._numericValue(i.numericValue),t.One]}else if(i.numericValue.isExact)return[i.numericValue,t.One]}if(i.operator==="Negate"){let[r,n]=i.op1.toNumericValue();return[r.neg(),n]}if(i.operator==="Multiply"){let r=[],n=t._numericValue(1);for(let s of i.ops){let[a,o]=s.toNumericValue();n=n.mul(a),o.is(1)||r.push(o)}return r.length===0?[n,t.One]:r.length===1?[n,r[0]]:[n,De(this.engine,r)]}if(i.operator==="Divide"){let[r,n]=i.op1.toNumericValue(),[s,a]=i.op2.toNumericValue(),o=r.div(s);return a.is(1)?[o,n]:[o,t.function("Divide",[n,a])]}if(i.operator==="Power"){if(i.op2.numericValue===null)return[t._numericValue(1),this];let[r,n]=i.op1.toNumericValue();if(r.isOne)return[r,this];let s=se(i.op2);return s!==null?[r.pow(s),t.function("Power",[n,i.op2])]:i.op2.is(.5)?[r.sqrt(),t.function("Sqrt",[n])]:[t._numericValue(1),this]}if(i.operator==="Sqrt"){let[r,n]=i.op1.toNumericValue();return n.is(1)||n.is(0)?r.isOne||r.isZero?[r,n]:[r.sqrt(),n]:[r.sqrt(),t.function("Sqrt",[n])]}if(i.operator==="Root"){let r=i.op2.re;if(isNaN(r)||i.op2.im!==0)return[t._numericValue(1),this];let[n,s]=i.op1.toNumericValue();return r===2?[n.sqrt(),t.function("Sqrt",[s])]:[n.root(r),t.function("Root",[s,i.op2])]}if(i.operator==="Abs"){let[r,n]=i.op1.toNumericValue();return[r.abs(),t.function("Abs",[n])]}if(i.operator,i.operator,i.operator==="Log"||i.operator==="Ln"){let r=i.op2.re;isNaN(r)&&i.operator==="Log"&&(r=10);let[n,s]=i.op1.toNumericValue();return n.isOne?[n,this]:t.box(n.ln(r)).add(t.function(i.operator,[s,i.op2])).toNumericValue()}return[t._numericValue(1),i]}subs(t,i){i??(i={canonical:void 0}),i.canonical===void 0&&(i={canonical:this.isCanonical});let r=this._ops.map(n=>n.subs(t,i));return r.every(n=>n.isValid)?this.engine.function(this._operator,r,i):this.engine.function(this._operator,r,{canonical:!1})}replace(t,i){var r;return((r=sr(this,t,i).at(-1))==null?void 0:r.value)??null}match(t,i){return sa(this,t,i)}has(t){if(typeof t=="string"){if(this._operator===t)return!0}else if(t.includes(this._operator))return!0;return this._ops.some(i=>i.has(t))}get sgn(){let t=this.isPure&&this._ops.every(i=>i.isConstant)?void 0:this.engine._generation;return Au(this._sgn,t,()=>{if(!(!this.isValid||this.isNumber!==!0))return Cg(this)})}get isNaN(){if(!this.isNumber)return!1}get isInfinity(){if(!this.isNumber)return!1}get isFinite(){if(this.isNumber!==!0||this.isNaN||this.isInfinity)return!1;if(!(this.isNaN===void 0||this.isInfinity===void 0))return!0}get isOne(){if(this.isNonPositive===!0||this.isReal===!1)return!1}get isNegativeOne(){if(this.isNonNegative===!0||this.isReal===!1)return!1}get isPositive(){return aa(this.sgn)}get isNonNegative(){return oa(this.sgn)}get isNegative(){return la(this.sgn)}get isNonPositive(){return ua(this.sgn)}get numerator(){return this.numeratorDenominator[0]}get denominator(){return this.numeratorDenominator[1]}get numeratorDenominator(){if(!this.isCanonical)return[this,this.engine.One];if(this.isNumber!==!0)return[this.engine.Nothing,this.engine.Nothing];let t=this.operator;if(t==="Divide")return[this.op1,this.op2];if(t==="Negate"){let[i,r]=this.op1.numeratorDenominator;return[i.neg(),r]}if(t==="Power"){let[i,r]=this.op1.numeratorDenominator;return[i.pow(this.op2),r.pow(this.op2)]}if(t==="Root"){let[i,r]=this.op1.numeratorDenominator;return[i.root(this.op2),r.root(this.op2)]}if(t==="Sqrt"){let[i,r]=this.op1.numeratorDenominator;return[i.sqrt(),r.sqrt()]}if(t==="Abs"){let[i,r]=this.op1.numeratorDenominator;return[i.abs(),r.abs()]}return t==="Multiply"?new Mt(this.engine,this.ops).asNumeratorDenominator():[this,this.engine.One]}neg(){if(!this.isCanonical)throw new Error("Not canonical");return nr(this)}inv(){if(!this.isCanonical)throw new Error("Not canonical");if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.operator==="Sqrt")return this.op1.inv().sqrt();if(this.operator==="Divide")return this.op2.div(this.op1);if(this.operator==="Power"){let t=this.op2.neg();return t.operator!=="Negate"?this.op1.pow(t):this.engine.function("Power",[this.op1,t])}if(this.operator==="Root"){let t=this.op2.neg();return t.operator!=="Negate"?this.op1.root(t):this.engine.function("Root",[this.op1,t])}return this.operator==="Exp"?this.engine.E.pow(this.op1.neg()):this.operator==="Rational"?this.op2.div(this.op1):this.operator==="Negate"?this.op1.inv().neg():this.engine._fn("Divide",[this.engine.One,this])}abs(){if(!this.isCanonical)throw new Error("Not canonical");return this.operator==="Abs"||this.operator==="Negate"?this:this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(t){if(t===0)return this;if(!this.isCanonical)throw new Error("Not canonical");return me(this,this.engine.box(t))}mul(t){if(!this.isCanonical)throw new Error("Not canonical");if(t===0)return this.engine.Zero;if(t===1)return this;if(t===-1)return this.neg();if(t instanceof pe){if(t.isZero)return this.engine.Zero;if(t.isOne)return this;if(t.isNegativeOne)return this.neg()}return Ve(this,this.engine.box(t))}div(t){if(!this.isCanonical)throw new Error("Not canonical");return Fs(this,t)}pow(t){return Ce(this,t,{numericApproximation:!1})}root(t){if(!this.isCanonical||typeof t!="number"&&!t.isCanonical)throw new Error("Not canonical");let i=typeof t=="number"?t:t.im===0?t.re:void 0;if(i===0)return this.engine.NaN;if(i===1)return this;if(i===-1)return this.inv();if(i===2)return this.engine.function("Sqrt",[this]);if(this.operator==="Power"&&i!==void 0){let[r,n]=this.ops;return r.pow(n.div(i))}if(this.operator==="Divide"){let[r,n]=this.ops;return r.root(t).div(n.root(t))}if(this.operator==="Negate"&&i!==void 0)return i%2===0?this.op1.root(t):this.op1.root(t).neg();if(this.operator==="Sqrt"){if(i!==void 0)return this.op1.root(i*2);if(typeof t!="number")return this.op1.root(t.mul(2))}if(this.operator==="Root"){let[r,n]=this.ops;return r.root(n.mul(t))}if(this.operator==="Multiply"){let r=this.ops.map(n=>n.root(t));return Ve(...r)}if(this.isNumberLiteral){let r=this.numericValue;if(typeof r=="number"){if(r<0)return this.engine.NaN;if(r===0)return this.engine.Zero;if(r===1)return this.engine.One;if(i!==void 0){let n=this.engine.number(Math.pow(r,1/i));if(!n.isFinite||n.isInteger)return n}}else{if(r.isOne)return this.engine.One;if(r.isZero)return this.engine.Zero;if(i!==void 0){let n=r.root(i);if(n.isExact)return this.engine.number(n)}}}return this.engine._fn("Root",[this,this.engine.box(t)])}sqrt(){return this.root(2)}ln(t){let i=t?this.engine.box(t):void 0;if(!this.isCanonical)throw new Error("Not canonical");if(this.is(0))return this.engine.NegativeInfinity;if(this.operator==="Exp")return this.op1;if(i&&this.isSame(i))return this.engine.One;if(!i&&this.isSame(this.engine.E))return this.engine.One;if(this.operator==="Power"){let[r,n]=this.ops;return r.isSame(this.engine.E)?n:n.mul(r.ln(i))}if(this.operator==="Root"){let[r,n]=this.ops;return n.div(r.ln(i))}return this.operator==="Sqrt"?this.op1.ln(i).div(2):this.operator==="Divide"?this.op1.ln(i).sub(this.op2.ln(i)):i&&i.type.matches("finite_integer")?i.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,i]):this.engine._fn("Ln",[this])}get complexity(){var t;if(this.isCanonical)return((t=this.operatorDefinition)==null?void 0:t.complexity)??_i}get baseDefinition(){if(this._def)return le(this._def)?this._def.operator:this._def.value}get operatorDefinition(){if(this._def)return le(this._def)?this._def.operator:void 0}get valueDefinition(){if(this._def)return oe(this._def)?this._def.value:void 0}get isNumber(){if(!this.type.isUnknown)return _(this.type.type,"number")}get isInteger(){if(!this.type.isUnknown)return _(this.type.type,"integer")}get isRational(){if(!this.type.isUnknown)return _(this.type.type,"rational")}get isReal(){if(!this.type.isUnknown)return _(this.type.type,"real")}get isFunctionExpression(){return!0}get type(){let t=this.isPure&&this._ops.every(i=>i.isConstant)?void 0:this.engine._generation;return Au(this._type,t,()=>new $(Dg(this),this.engine._typeResolver))??$.unknown}simplify(t){var i;return((i=fr(this,t).at(-1))==null?void 0:i.value)??this}evaluate(t){return Pg(this.engine,this._computeValue(t))()}evaluateAsync(t){return Fg(this.engine,this._computeValueAsync(t))()}N(){return this.evaluate({numericApproximation:!0})}solve(t){let i=Os(t??this.unknowns);return i.length!==1?null:Tu(this,i[0])}get isCollection(){var i;if(!this.isValid)return!1;let t=(i=this.baseDefinition)==null?void 0:i.collection;return!t||t.count!==void 0&&t.iterator,t!==void 0}get isIndexedCollection(){var t,i;return!this.isValid||!((i=(t=this.baseDefinition)==null?void 0:t.collection)!=null&&i.at)?!1:this.type.matches("indexed_collection")}get isLazyCollection(){var i,r;if(!this.isValid)return!1;let t=(i=this.baseDefinition)==null?void 0:i.collection;return t?((r=t==null?void 0:t.isLazy)==null?void 0:r.call(t,this))??!1:!1}xcontains(t){var i,r,n;return(n=(r=(i=this.baseDefinition)==null?void 0:i.collection)==null?void 0:r.contains)==null?void 0:n.call(r,this,t)}get xsize(){var t,i,r;return(r=(i=(t=this.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.count)==null?void 0:r.call(i,this)}get isEmptyCollection(){var t,i,r;if(this.isCollection)return(r=(i=(t=this.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.isEmpty)==null?void 0:r.call(i,this)}get isFiniteCollection(){var t,i,r;if(this.isCollection)return(r=(i=(t=this.operatorDefinition)==null?void 0:t.collection)==null?void 0:i.isFinite)==null?void 0:r.call(i,this)}each(){var i,r,n;let t=(n=(r=(i=this.operatorDefinition)==null?void 0:i.collection)==null?void 0:r.iterator)==null?void 0:n.call(r,this);return t?(function*(){let s=t.next();for(;!s.done;)yield s.value,s=t.next()})():(function*(){})()}at(t){var i,r,n;return(n=(r=(i=this.operatorDefinition)==null?void 0:i.collection)==null?void 0:r.at)==null?void 0:n.call(r,this,t)}get(t){var i,r,n,s,a,o;if(typeof t=="string")return(n=(r=(i=this.operatorDefinition)==null?void 0:i.collection)==null?void 0:r.at)==null?void 0:n.call(r,this,t);if(t.string)return(o=(a=(s=this.operatorDefinition)==null?void 0:s.collection)==null?void 0:a.at)==null?void 0:o.call(a,this,t.string)}indexWhere(t){var r,n;if((n=(r=this.operatorDefinition)==null?void 0:r.collection)!=null&&n.indexWhere)return this.operatorDefinition.collection.indexWhere(this,t);if(!this.isIndexedCollection||!this.isFiniteCollection)return;let i=0;for(let s of this.each()){if(t(s))return i;i+=1}}subsetOf(t,i){var r,n,s;return((s=(n=(r=this.operatorDefinition)==null?void 0:r.collection)==null?void 0:n.subsetOf)==null?void 0:s.call(n,this,t,i))??!1}_computeValue(t){return()=>{var l,u;if(!this.isValid||!this._def)return this;let i=(t==null?void 0:t.numericApproximation)??!1,r=(t==null?void 0:t.materialization)??!1;if(oe(this._def))return $u(this,this._def.value,t);let n=this._def.operator;if(n.broadcastable&&this.ops.some(c=>Ie(c))){let c=zo(this._ops);if(!c)return this.engine.Nothing;let f=[];for(;;){let{done:p,value:h}=c.next();if(p)break;f.push(this.engine._fn(this.operator,h).evaluate(t))}return f.length===0?this.engine.Nothing:f.length===1?f[0]:this.engine._fn("List",f)}if(r!==!1&&!n.evaluate&&this.isLazyCollection)return Og(this,n,t);let s=Iu(this,c=>c.evaluate(t)),a=this._localScope!==void 0||(t==null?void 0:t.withArguments);if(a&&(this.engine._pushEvalContext(this._localScope??{parent:(l=this.engine.context)==null?void 0:l.lexicalScope,bindings:new Map}),t==null?void 0:t.withArguments))for(let[c,f]of Object.entries(t.withArguments))this.engine.context.values[c]=f;let o=(u=n.evaluate)==null?void 0:u.call(n,s,{numericApproximation:i,engine:this.engine,materialization:r});return a&&this.engine._popEvalContext(),o??this.engine.function(this._operator,s)}}_computeValueAsync(t){return async()=>{var u,c,f;if(!this.isValid||!this._def)return this;let i=(t==null?void 0:t.numericApproximation)??!1;if(oe(this._def))return $u(this,this._def.value,t);let r=this._def.operator;if(r!=null&&r.broadcastable&&this.ops.some(p=>Ie(p))){let p=zo(this._ops);if(!p)return this.engine.Nothing;let h=[];for(;;){let{done:d,value:y}=p.next();if(d)break;h.push(this.engine._fn(this.operator,y).evaluateAsync(t))}return h.length===0?this.engine.Nothing:h.length===1?h[0]:Promise.all(h).then(d=>this.engine._fn("List",d))}let n=await Tg(this,async p=>await p.evaluateAsync(t)),s=this._localScope!==void 0||(t==null?void 0:t.withArguments);if(s&&(this.engine._pushEvalContext(this._localScope??{parent:(u=this.engine.context)==null?void 0:u.lexicalScope,bindings:new Map}),t==null?void 0:t.withArguments))for(let[p,h]of Object.entries(t.withArguments))this.engine.context.values[p]=h;let a=this.engine,o={numericApproximation:i,engine:a,signal:t==null?void 0:t.signal,eager:t==null?void 0:t.materialization},l=((c=r.evaluateAsync)==null?void 0:c.call(r,n,o))??((f=r.evaluate)==null?void 0:f.call(r,n,o));return s&&this.engine._popEvalContext(),Promise.resolve(l).then(p=>p??a.function(this._operator,n))}}};function Dg(e){if(!e.isValid)return"error";if(e.operator==="Function"){let i=e.ops[0].type,r=e.ops.slice(1);return R(`(${r.map(n=>"unknown").join(", ")}) -> ${i}`,e.engine._typeResolver)}let t=e.operatorDefinition;if(t){let i=t.signature instanceof $?t.signature.type:typeof t.signature=="string"?R(t.signature,e.engine._typeResolver):t.signature,r=Ot(i)??"unknown";if(typeof t.type=="function"){let n=t.type(e.ops,{engine:e.engine});n&&(n instanceof $?r=n.type:r=R(n,e.engine._typeResolver)??r)}return r}return e.valueDefinition?Ot(e.valueDefinition.type.type)??"unknown":"unknown"}function Pg(e,t){return()=>{if(e._deadline===void 0){e._deadline=Date.now()+e.timeLimit;let i=t();return e._deadline=void 0,i}return t()}}function Fg(e,t){return async()=>{if(e._deadline===void 0){e._deadline=Date.now()+e.timeLimit;let i=await t();return e._deadline=void 0,i}return t()}}function $u(e,t,i){let r=t.isConstant?t.value:e.engine._getSymbolValue(e.operator);if(r&&!r.type.matches("function"))return r.isValid?e.engine.typeError("function",r.type,r.toString()):e;let n=e.ops.map(s=>s.evaluate(i));return!r||r.type.isUnknown?e.engine.function(e.operator,n):ei(r,n)}function Og(e,t,i){var l,u;if(!e.isValid||(i==null?void 0:i.materialization)===!1)return e;let r=(i==null?void 0:i.materialization)??!1;typeof r=="boolean"&&(r=qg);let n=e.isIndexedCollection,s=e.isFiniteCollection,a=[];if(!e.isEmptyCollection)if(!n||!s){let c=typeof r=="number"?r:r[0],f=e.each();for(let p of f){if(a.length===c){f.next().done||a.push(e.engine.symbol("ContinuationPlaceholder"));break}a.push(p.evaluate(i))}}else{let[c,f]=typeof r=="number"?[Math.ceil(r/2),r-Math.ceil(r/2)]:r,p=1,h=e.each();for(let y of h)if(a.push(y.evaluate(i)),p+=1,p>c)break;let d=e.xsize;if(d===void 0||d<=c)(d===void 0||a.length<d)&&a.push(e.engine.symbol("ContinuationPlaceholder"));else{let y=Math.max(c+1,d-f+1);for(d>c+f&&a.push(e.engine.symbol("ContinuationPlaceholder")),p=y;p<=d;){let x=e.at(p);if(!x)break;a.push(x.evaluate(i)),p+=1}}}let o=(u=(l=t.collection)==null?void 0:l.elttype)==null?void 0:u.call(l,e);return o&&_(o,"tuple<string, any>")?e.engine.function("Dictionary",a):n?e.engine._fn("List",a):e.engine.function("Set",[...a])}var kn=class Yu extends(Bu=ge,Vu=Symbol.toStringTag,Bu){constructor(i,r,n){super(i,n);m(this,Vu,"[BoxedString]");m(this,"_string");m(this,"_utf8Buffer");m(this,"_unicodeScalarValues");this._string=r.normalize()}get json(){return vt(this._string)&&!zt(this._string)?this._string:`'${this._string}'`}get hash(){return Mi("String"+this._string)}get operator(){return"String"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(i){}get value(){return this}get type(){return $.string}get complexity(){return 19}get string(){return this._string}get buffer(){if(this._utf8Buffer===void 0){let i=new TextEncoder;this._utf8Buffer=i.encode(this._string)}return this._utf8Buffer}get unicodeScalars(){return this._unicodeScalarValues===void 0&&(this._unicodeScalarValues=zg(this._string)),this._unicodeScalarValues}match(i,r){return Ii(i)||(i=this.engine.box(i,{canonical:!1})),Ci(i)?{[qi(i)]:this}:i instanceof Yu&&this._string===i._string?{}:null}};function zg(e){let t=[];for(let i=0;i<e.length;i++){let r=e.codePointAt(i);t.push(r),r>65535&&i++}return t}var Cu=class ga extends(Uu=ge,Zu=Symbol.toStringTag,Uu){constructor(i,r,n){super(i,n==null?void 0:n.metadata);m(this,Zu,"[BoxedDictionary]");m(this,"_keyValues",{});m(this,"_type");r instanceof ge?this._initFromExpression(r,n):this._initFromRecord(r,n)}_initFromRecord(i,r){for(let n in i){if(typeof n!="string")throw new Error(`Dictionary keys must be strings, but got ${typeof n}`);if(n.length===0)throw new Error("Dictionary keys must not be empty strings");i[n]instanceof ge?this._keyValues[n]=i[n]:this._keyValues[n]=this.engine.box(i[n],r)}}_initFromExpression(i,r){if(i instanceof ga){Object.assign(this._keyValues,i._keyValues);return}if(i.operator==="Tuple"||i.operator==="Pair"||i.operator==="KeyValuePair"){if(i.nops!==2)throw new Error(`Expected a key/value pair, got ${i.nops} elements`);let[n,s]=i.ops,a;if(n.string)a=n.string;else if(n.symbol)a=n.symbol;else throw new Error(`Expected a string key, got ${n.type}`);this._keyValues[a]=s.canonical;return}if(i.operator==="Dictionary"){for(let n of i.ops)if(n.operator==="KeyValuePair"||n.operator==="Pair"||n.operator==="Tuple"){let[s,a]=n.ops,o;if(s.string)o=s.string;else if(s.symbol)o=s.symbol;else return;this._keyValues[o]=a.canonical}else throw new Error(`Expected a key/value pair, got ${n.type}`);return}}get json(){return["Dictionary",{dict:Object.fromEntries(Object.entries(this._keyValues).map(([i,r])=>[i,r.json]))}]}get hash(){return Mi("Dictionary"+JSON.stringify(this._keyValues))}get operator(){return"Dictionary"}get type(){if(this._type)return this._type;let i=$e(...Object.values(this._keyValues).map(r=>r.type.type));return this._type=this.engine.type(`dictionary<${i}>`),this._type}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(i){}get value(){}get complexity(){return 1e3}get isCollection(){return!0}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}xcontains(i){}get xsize(){return Object.keys(this._keyValues).length}get isEmptyCollection(){return Object.keys(this._keyValues).length===0}get isFiniteCollection(){return!0}each(){let i=this.engine;return(function*(r){for(let[n,s]of Object.entries(r._keyValues))yield i.tuple(i.string(n),s)})(this)}get(i){return this._keyValues[i]}has(i){return this._keyValues.hasOwnProperty(i)}get keys(){return Object.keys(this._keyValues)}get entries(){return Object.entries(this._keyValues)}get values(){return Object.values(this._keyValues)}match(i,r){if(Ci(i))return{[qi(i)]:this};if(!(i instanceof ga))return null;let n=null,s=Object.keys(i._keyValues);for(let a of s){if(!this._keyValues.hasOwnProperty(a))return null;let o=this._keyValues[a],l=i._keyValues[a];if(!o.match(l))return null;if(Ci(i._keyValues[a])){let u=qi(i._keyValues[a]);u&&(n={...n??{},[u]:o})}}return n}};function ca(e,t,i){if(t instanceof ge)return t;if(t=G(t),typeof t=="string")return gt(e,t,i);if(Array.isArray(t)){let[r,...n]=t;return new xe(e,r,n.map(s=>ca(e,s,i)),{canonical:!1})}if(typeof t=="object"){if("fn"in t)return ca(e,t.fn,i);if("str"in t)return new kn(e,t.str);if("sym"in t)return gt(e,t.sym,i);if("num"in t)return gt(e,t.num,i)}return gt(e,t,i)}function fa(e,t,i,r){if(r=r?{...r}:{},"canonical"in r||(r.canonical=!0),!Le(t))throw new Error(`Unexpected operator: "${t}" is not a valid symbol: ${Yt(t)}`);let n=r.structural??!1;if(t==="Hold")return new xe(e,"Hold",[ca(e,i[0],r)],{...r,canonical:!0,structural:n});if(t==="Error"||t==="ErrorCode")return new xe(e,t,i.map(s=>e.box(s,{canonical:!1})),{metadata:r==null?void 0:r.metadata,canonical:!0});if(t==="Number"&&i.length===1)return gt(e,i[0],r);if(n===!1&&r.canonical===!0){if((t==="Divide"||t==="Rational")&&i.length===2){let s=xi(i[0]);if(s!==null){let a=xi(i[1]);if(a!==null)return e.number([s,a],r)}t="Divide"}if(t==="Complex"){if(i.length===1){let s=i[0];if(s instanceof ge&&s.isNumberLiteral)return e.number(e.complex(0,s.re),r);let a=z(i[0]);return a!==null&&a!==0?e.number(e.complex(0,a),r):e.box(s).mul(e.I)}if(i.length===2){let s=i[0]instanceof ge?i[0].re:z(i[0]),a=i[1]instanceof ge?i[1].re:z(i[1]);return a!==null&&s!==null&&!isNaN(a)&&!isNaN(s)?a===0&&s===0?e.Zero:a!==0?e.number(e._numericValue({re:s,im:a}),r):gt(e,i[0],r):gt(e,i[0],r).add(gt(e,i[1],r).mul(e.I))}throw new Error("Expected one or two arguments with Complex expression")}if(t==="Negate"&&i.length===1){let s=i[0];if(typeof s=="number")return e.number(-s,r);if(s instanceof Z)return e.number(s.neg(),r);let a=e.box(s,r),o=a.numericValue;if(o!==null)return e.number(typeof o=="number"?-o:o.neg(),r);i=[a]}}return r.canonical===!0?Lg(e,t,i,r.metadata,r.scope):lr(new xe(e,t,i.map(s=>gt(e,s,{canonical:r.canonical,structural:n,scope:r.scope})),{metadata:r.metadata,canonical:!1,structural:n,scope:r.scope}),r.canonical??!1,r.scope)}function gt(e,t,i){if(t==null)return e.error("missing");if(t instanceof pe)return Vg(e,t);if(t instanceof ge)return lr(t,(i==null?void 0:i.canonical)??!0,i==null?void 0:i.scope);i=i?{...i}:{},"canonical"in i||(i.canonical=!0);let r=i.canonical===!0,n=i.structural??!1;if(Array.isArray(t)){if(typeof t[0]!="string")throw new Error(`The first element of an array should be a string (the function name): ${JSON.stringify(t,void 0,4)}`);return lr(fa(e,t[0],t.slice(1),{canonical:r,structural:n,scope:i==null?void 0:i.scope}),(i==null?void 0:i.canonical)??!0,i==null?void 0:i.scope)}if(typeof t=="number"||t instanceof Z||t instanceof W)return e.number(t);if(typeof t=="string"){if(vt(t)){let s=q(t);if(!s||!Le(s))return e.error("invalid-symbol",t);let a=r||i.canonical!==!1;return e.symbol(s,{canonical:a})}return zt(t)?e.number(t):(fo(t),new kn(e,j(t)))}if(typeof t=="object"){if("fn"in t){let[s,...a]=t.fn;return lr(fa(e,s,a,{canonical:r,structural:n}),i.canonical,i.scope)}if("str"in t)return new kn(e,t.str);if("sym"in t)return e.symbol(t.sym,{canonical:r});if("num"in t)return e.number(t,{canonical:r});if("dict"in t)return new Cu(e,t.dict,{canonical:r});throw new Error(`Unexpected MathJSON object: ${JSON.stringify(t,void 0,4)}`)}return e.symbol("Undefined")}function Lg(e,t,i,r,n){let s=Rg(e,t,i,r,n);if(s)return s;if(t==="List"){let f=i.map(h=>e.box(h,{canonical:!1})),p=Gm("List",f);return p&&p.dtype?new fu(e,{ops:Et(e,f,n),shape:p.shape,dtype:p.dtype},{metadata:r}):new xe(e,"List",Et(e,f,n),{canonical:!0})}if(t==="Dictionary"){let f=i.map(p=>e.box(p,{canonical:!1}));return new Cu(e,e._fn("Dictionary",f),{canonical:!0})}let a=e.lookupDefinition(t);if(!a)return e.declare(t,{type:"function",inferred:!0}),new xe(e,t,fe(oi(e,i)),{metadata:r,canonical:!0});if(oe(a))return new xe(e,t,fe(oi(e,i)),{metadata:r,canonical:!0});let o=a.operator;if(n??(n=o.scoped?{parent:e.context.lexicalScope,bindings:new Map}:void 0),o.lazy){let f=i.map(p=>e.box(p,{canonical:!1}));if(o.canonical){try{if(s=o.canonical(f,{engine:e,scope:n}),s)return s}catch(p){console.error(p.message)}return s=new xe(e,t,f,{metadata:r,canonical:!1}),s}return s=new xe(e,t,fn(e,f,o.signature.type,o.lazy,o.broadcastable)??f,{metadata:r,canonical:!0,scope:n}),s}let l=i.map(f=>e.box(f));if(o.canonical){try{let f=o.canonical(l,{engine:e,scope:n});if(f)return f}catch(f){console.error(f.message)}return new xe(e,t,l,{metadata:r,canonical:!1})}let u=fe(l,o.associative?t:void 0),c=fn(e,u,o.signature.type,o.lazy,o.broadcastable);if(c)return new xe(e,t,c,{metadata:r,canonical:!0,scope:n});if(u.length===1&&u[0].operator===t){if(o.involution)return u[0].op1;if(o.idempotent)return new xe(e,t,l[0].ops,{metadata:r,canonical:!0,scope:n})}return new xe(e,t,hs(t,u),{metadata:r,canonical:!0,scope:n})}function Rg(e,t,i,r,n){let s=[];if(t==="Add"||t==="Multiply")s=je(e,oi(e,i,n),{flatten:t});else if(t==="Negate"||t==="Square"||t==="Sqrt"||t==="Exp")s=je(e,oi(e,i,n),1);else if(t==="Ln"||t==="Log")s=je(e,oi(e,i,n)),s.length===0&&(s=[e.error("missing")]);else if(t==="Power"||t==="Root")s=je(e,oi(e,i,n),2);else if(t==="Divide")s=je(e,oi(e,i,n)),s.length===0&&(s=[e.error("missing"),e.error("missing")]),s.length===1&&(s=[s[0],e.error("missing")]);else return null;if(!s.every(a=>a.isValid))return new xe(e,t,s,{metadata:r,canonical:!0});if(t==="Add")return It(e,s);if(t==="Negate")return rm(s[0]);if(t==="Multiply")return De(e,s);if(t==="Divide")return s.length===2?Ut(...s):s.slice(1).reduce((a,o)=>Ut(a,o),s[0]);if(t==="Exp")return Ni(e.E,s[0]);if(t==="Square")return Ni(s[0],e.number(2));if(t==="Power")return Ni(s[0],s[1]);if(t==="Root")return Ki(s[0],s[1]);if(t==="Sqrt")return Ki(s[0],2);if(t==="Ln"||t==="Log"){if(s.length>0){if(s[0].is(1))return e.Zero;if(s.length===1)return new xe(e,t,s,{metadata:r,canonical:!0})}return new xe(e,"Log",s,{metadata:r,canonical:!0})}return null}function Vg(e,t){if(t.isZero)return e.Zero;if(t.isOne)return e.One;if(t.isNegativeOne)return e.NegativeOne;if(t.isNaN)return e.NaN;if(t.isNegativeInfinity)return e.NegativeInfinity;if(t.isPositiveInfinity)return e.PositiveInfinity;if(t=t.asExact??t,!t.isExact){let s=t.im;return s===0?e.number(t.bignumRe??t.re):t.re===0?e.number(e.complex(0,s)):t.bignumRe!==void 0&&!sn(t.bignumRe)?It(e,[e.number(t.bignumRe),e.number(e.complex(0,s))]):e.number(e.complex(t.re,t.im))}let i=[],r=t;if(r.sign!==0)if(r.radical===1)i.push(e.number(r.rational));else{let s=r.rational,a=e.function("Sqrt",[e.number(r.radical)]);if(Ue(s))i.push(a);else{let[o,l]=s;l===1?o===1?i.push(a):i.push(e.function("Multiply",[e.number(o),a])):o===1?i.push(e.function("Divide",[a,e.number(l)])):i.push(e.function("Divide",[e.function("Multiply",[e.number(o),a]),e.number(l)]))}}let n;return t.im===0?i.length===0?e.Zero:(n=i.length===1?i[0]:De(e,i),n):i.length===0?e.number(e.complex(0,t.im)):(n=i.length===1?i[0]:De(e,i),It(e,[n,e.number(e.complex(0,t.im))]))}function oi(e,t,i){return t.every(r=>r instanceof ge&&r.isCanonical)?t:t.map(r=>e.box(r,{scope:i}))}var qu=class Ju{constructor(t){m(this,"_items");t?t instanceof Ju?this._items=new Map(t._items):this._items=new Map(t):this._items=new Map}has(t){for(let i of this._items.keys())if(i.isSame(t))return!0;return!1}get(t){for(let[i,r]of this._items)if(i.isSame(t))return r}clear(){this._items.clear()}set(t,i){for(let r of this._items.keys())if(r.isSame(t)){this._items.set(r,i);return}this._items.set(t,i)}delete(t){this._items.delete(t)}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}},Qe=class extends ge{constructor(t,i,r){super(t,r==null?void 0:r.metadata);m(this,"_value");m(this,"_hash");i instanceof pe||typeof i=="number"?this._value=i:this._value=t._numericValue(i)}get hash(){return this._hash??(this._hash=Mi(this._value.toString())),this._hash}get json(){let t=this._value;return typeof t=="number"?Number.isNaN(t)?"NaN":Number.isFinite(t)?t:t>0?"PositiveInfinity":"NegativeInfinity":t.toJSON()}get operator(){return"Number"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(t){}get complexity(){return 1}valueOf(){return typeof this._value=="number"?this._value:this._value.N().valueOf()}get numericValue(){return this._value}get isNumberLiteral(){return!0}get re(){return typeof this._value=="number"?this._value:this._value.re}get im(){return typeof this._value=="number"?0:this._value.im}get bignumRe(){if(typeof this._value!="number")return this._value.bignumRe}get bignumIm(){return typeof this._value=="number"?this.engine._BIGNUM_ZERO:this.engine.bignum(this._value.im)}neg(){let t=this._value;return t===0?this:typeof t=="number"?this.engine.number(-t):this.engine.number(t.neg())}inv(){return typeof this._value=="number"?Math.abs(this._value)===1?this:Number.isInteger(this._value)?this.engine.number(this.engine._numericValue({rational:[1,this._value]})):this.engine.number(1/this._value):Math.abs(this.re)===1&&this.im===0?this:this.engine.number(this._value.inv())}abs(){return this.isPositive?this:typeof this._value=="number"?this.engine.number(-this._value):this.engine.number(this._value.abs())}add(t){let i=this.engine;return this.is(0)?i.box(t):typeof t=="number"?t===0?this:typeof this._value=="number"?i.number(this._value+t):i.number(this._value.add(t)):t.numericValue!==null?typeof this._value=="number"?typeof t.numericValue=="number"?i.number(this._value+t.numericValue):i.number(t.numericValue.add(this._value)):i.number(this._value.add(t.numericValue)):me(this,t.canonical)}mul(t){if(this.is(1))return this.engine.box(t);if(this.is(-1))return this.engine.box(t).neg();let i=this.engine;return typeof t=="number"?t===1?this:t===0||this.is(0)?this.engine.Zero:t===-1?this.neg():i.number(typeof this._value=="number"?this._value*t:this._value.mul(t)):typeof this._value=="number"&&typeof t=="number"?i.number(this._value*t):t instanceof pe?this.is(1)?i.number(t):this.is(-1)?i.number(t.neg()):i.number(t.mul(this._value)):t.numericValue!==null?i.number(i._numericValue(this._value).mul(t.numericValue)):Ve(this,t)}div(t){return Fs(this,t)}pow(t){return Ce(this,t,{numericApproximation:!1})}root(t){if(typeof t=="number"){if(t===0)return this.engine.NaN;if(t===1)return this;if(t===-1)return this.inv();if(t===2)return this.sqrt();if(this.isNegative){if(t%2===1)return this.neg().root(t).neg();if(t%2===0)return this.neg().root(t)}}else{if(t=t.canonical,t.is(0))return this.engine.NaN;if(t.is(1))return this;if(t.is(-1))return this.inv();if(t.is(2))return this.sqrt();if(this.isNegative){if(t.isOdd)return this.neg().root(t).neg();if(t.isEven)return this.neg().root(t)}}let i=typeof t=="number"?t:t.re;if(Number.isInteger(i))if(typeof this._value=="number"){let r=this._value**(1/i);if(Number.isInteger(r))return this.engine.number(r)}else{let r=this._value.root(i);if(_(r.type,"integer"))return this.engine.number(r)}return this.engine._fn("Root",[this,this.engine.box(t)])}sqrt(){return typeof this._value=="number"?this._value===0||this._value===1?this:this._value===-1?this.engine.I:this._value>0&&Number.isInteger(this._value)&&this._value<U?this.engine.number(this.engine._numericValue({radical:this._value})):this.engine.number(this.engine._numericValue(this._value).sqrt()):this.is(0)||this.is(1)?this:this.engine.number(this._value.sqrt())}ln(t){let i=t?this.engine.box(t):void 0;if(this.is(0))return this.engine.NegativeInfinity;if(i&&this.isSame(i))return this.engine.One;if((!i||i.symbol==="ExponentialE")&&this.symbol==="ExponentialE")return this.engine.One;let r=this.re;if(Number.isInteger(r)&&r>0){let n=this.engine,[s,a]=jn(r,3);if(s!==1)return n.number(s).ln(i).mul(3).add(n.number(a).ln(i));if([s,a]=jn(r,2),s!==1)return n.number(s).ln(i).mul(2).add(n.number(a).ln(i))}return i&&i.isInteger?typeof this._value=="number"?this.engine.number(Math.log(this._value)/Math.log(i.re)):this.engine.number(this._value.ln(i.re)):i===void 0?typeof this._value=="number"?this.engine.number(Math.log(this._value)):this.engine.number(this._value.ln()):this.engine._fn("Ln",[this])}get value(){return this}get type(){return typeof this._value=="number"?Number.isNaN(this._value)?$.number:Number.isFinite(this._value)?Number.isInteger(this._value)?$.finite_integer:$.finite_real:$.non_finite_number:new $(this._value.type,this.engine._typeResolver)}get sgn(){if(this._value===0)return"zero";let t;return typeof this._value=="number"?t=Math.sign(this._value):t=this._value.sgn(),t===void 0||Number.isNaN(t)?"unsigned":t===0?"zero":t>0?"positive":"negative"}get numerator(){return typeof this._value=="number"?this:this.engine.number(this._value.numerator)}get denominator(){return typeof this._value=="number"?this.engine.One:this.engine.number(this._value.denominator)}get numeratorDenominator(){if(typeof this._value=="number")return[this,this.engine.One];let t=this.engine;return[t.number(this._value.numerator),t.number(this._value.denominator)]}subs(t,i){return this.isStructural?this:this.structural.subs(t,i)}replace(t,i){var r;return((r=sr(this.structural,t,i).at(-1))==null?void 0:r.value)??null}match(t,i){return sa(this.structural,t,i)}get isPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>0:aa(this.sgn)}get isNonNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>=0:oa(this.sgn)}get isNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<0:la(this.sgn)}get isNonPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<=0:ua(this.sgn)}get isOdd(){if(this.is(1)||this.is(-1))return!0;if(this.is(0))return!1;if(!this.isFinite||!this.isInteger)return;if(typeof this._value=="number")return this._value%2!==0;let[t,i]=[this._value.numerator,this._value.denominator];return i.isOne?t.re%2!==0:t.re%2!==0&&i.re%2===0}get isEven(){let t=this.isOdd;return t!==void 0?!t:void 0}get isInfinity(){return typeof this._value=="number"?!Number.isFinite(this._value)&&!Number.isNaN(this._value):Number.isFinite(this._value.im)?this._value.isPositiveInfinity||this._value.isNegativeInfinity:!0}get isNaN(){return typeof this._value=="number"?Number.isNaN(this._value):this._value.isNaN}get isFinite(){return this.isInfinity===!1&&this.isNaN===!1}get isNumber(){return!0}get isInteger(){return typeof this._value=="number"?Number.isInteger(this._value):_(this._value.type,"integer")}get isRational(){return typeof this._value=="number"?Number.isInteger(this._value):_(this._value.type,"rational")}get isReal(){return typeof this._value=="number"?!0:_(this._value.type,"real")}is(t){return typeof t=="number"?typeof this._value=="number"?Object.is(this._value,t):this._value.isNaN?Object.is(t,NaN):this._value.eq(t):typeof t=="bigint"?typeof this._value=="number"?de(this._value)===t:this._value.eq(this.engine._numericValue(t)):typeof t=="boolean"?!1:this.isSame(t)}get canonical(){return this}get isStructural(){return typeof this._value=="number"||this.type.matches("rational")?!0:!(this._value instanceof _e)}get structural(){return this.isStructural?this:this.engine.box(this.json,{canonical:!1,structural:!0})}toNumericValue(){let t=this._value;return typeof t=="number"?[this.engine._numericValue(t),this.engine.One]:[t,this.engine.One]}simplify(t){return fr(this.structural,t).at(-1).value??this}evaluate(t){return t!=null&&t.numericApproximation?this.N():this}N(){let t=this._value;if(typeof t=="number")return this;let i=t.N();return t===i?this:this.engine.number(i)}};function pa(e,t){if(t==null)return NaN;if(t instanceof pe)return t;if(typeof t=="number")return Number.isInteger(t)&&t>=-U&&t<=U||!Number.isFinite(t)?t:e._numericValue(t);if(t instanceof Z){let i=t.toNumber();return t.isInteger()&&Math.abs(i)<=U?i:t.isNaN()?NaN:t.isFinite()?e._numericValue(t):i>0?1/0:-1/0}if(typeof t=="bigint")return t>=-U&&t<=U?Number(t):e._numericValue(t);if(t instanceof W)return t.im===0?pa(e,t.re):t.isNaN()?NaN:!t.isFinite()&&t.im===0?t.re>0?1/0:-1/0:e._numericValue({re:t.re,im:t.im});if(typeof t=="object"&&"num"in t){if(typeof t.num=="number")return pa(e,t.num);if(typeof t.num!="string")throw new Error("MathJSON `num` property should be a string of digits");return Du(e,t.num)}if(typeof t=="string")return Du(e,t);if(t[1]==0)return NaN;if(typeof t[1]=="number"&&!Number.isFinite(t[1]))return Number.isFinite(t[0])?0:NaN;if(typeof t[0]=="number"&&!Number.isFinite(t[0])){let i=t[0]>0?1:-1;return t[0]>0?i>0?1/0:-1/0:t[0]<0?i>0?-1/0:1/0:NaN}return e._numericValue(t)}function Du(e,t){if(t=t.toLowerCase(),/[0-9][nd]$/.test(t)&&(t=t.slice(0,-1)),t=t.replace(/[\u0009-\u000d\u0020\u00a0]/g,""),t==="nan")return NaN;if(t==="infinity"||t==="+infinity"||t==="oo"||t==="+oo")return Number.POSITIVE_INFINITY;if(t==="-infinity"||t==="-oo")return Number.NEGATIVE_INFINITY;if(t==="0")return 0;if(t==="1")return 1;if(t==="-1")return-1;if(/\([0-9]+\)/.test(t)){let[r,n,s,a]=t.match(/(.+)\(([0-9]+)\)(.+)?$/)??[];t=n+s.repeat(Math.ceil(e.precision/s.length))+(a??"")}let i=de(t);return i!==null?i>=-U&&i<=U?Number(i):e._numericValue(i):e._numericValue(e.bignum(t))}var Sn=class extends ge{constructor(t,i,r){super(t,r==null?void 0:r.metadata);m(this,"_hash");m(this,"_id");m(this,"_def");Le(i),`${i}${Yt(i)}`,this._id=i,this._def=r==null?void 0:r.def}get json(){return vt(this._id)?this._id:{sym:this._id}}get hash(){return this._hash??(this._hash=Mi(this._id)),this._hash}get isPure(){return!0}get isConstant(){let t=this._def;return(oe(t)&&(t==null?void 0:t.value.isConstant))??!1}bind(){}reset(){}get isCanonical(){return this._def!==void 0}set isCanonical(t){throw new Error("Setting the isCanonical property is not allowed. Use the canonical() method instead.")}get canonical(){return this._def?this:this.engine.symbol(this._id)}is(t){var i,r,n;return t===!0?this.symbol==="True"||((i=this.value)==null?void 0:i.symbol)==="True":t===!1?this.symbol==="False"||((r=this.value)==null?void 0:r.symbol)==="False":t instanceof ge&&t.symbol?this.symbol===t.symbol:((n=this.value)==null?void 0:n.is(t instanceof ge?t.value:t))??!1}toNumericValue(){this.isCanonical;let t=this.engine;return this.symbol==="ImaginaryUnit"?[t._numericValue({re:0,im:1}),t.One]:this.symbol==="PositiveInfinity"||this.isInfinity&&this.isPositive?[t._numericValue(1/0),t.One]:this.symbol==="NegativeInfinity"||this.isInfinity&&this.isNegative?[t._numericValue(-1/0),t.One]:this.symbol==="NaN"?[t._numericValue(NaN),t.One]:[t._numericValue(1),this]}neg(){return nr(this)}inv(){return this.engine._fn("Divide",[this.engine.One,this])}abs(){return this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(t){return t===0?this:me(this,this.engine.box(t))}mul(t){if(t===1)return this;if(t===-1)return this.neg();if(t===0&&!this.isNaN)return this.engine.Zero;if(t instanceof pe){if(t.isOne)return this;if(t.isNegativeOne)return this.neg();if(t.isZero&&!this.isNaN)return this.engine.Zero}return Ve(this,this.engine.box(t))}div(t){return Fs(this,t)}pow(t){return Ce(this,t,{numericApproximation:!1})}root(t){let i=typeof t=="number"?t:t.im===0?t.re:void 0,r=this.engine;return this.symbol==="ComplexInfinity"||i===0?r.NaN:i===1?this:i===2?this.sqrt():i===-1?this.inv():r._fn("Root",[this,r.box(t)])}sqrt(){let t=this.engine;return this.symbol==="ComplexInfinity"?t.NaN:this.is(0)?this:this.is(1)?this.engine.One:this.is(-1)?t.I:t._fn("Sqrt",[this])}ln(t){let i=t?this.engine.box(t):void 0;return this.is(0)?this.engine.NegativeInfinity:(!i||i.symbol==="ExponentialE")&&this.symbol==="ExponentialE"?this.engine.One:i?i.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,i]):this.engine._fn("Ln",[this])}solve(t){let i=Os(t);return i.length!==1?null:i.includes(this.symbol)?[this.engine.Zero]:null}get complexity(){return 7}get operator(){return"Symbol"}get symbol(){return this._id}get baseDefinition(){return this.valueDefinition??this.operatorDefinition}get valueDefinition(){if(oe(this._def))return this._def.value}get operatorDefinition(){if(le(this._def))return this._def.operator}infer(t,i="narrow"){if(!this._def)return!1;let r=this._def;if(oe(r))return r.value.inferredType||r.value.type.isUnknown?(r.value.isConstant,r.value.type=this.engine.type(i==="widen"?$e(r.value.type.type,t):Ir(r.value.type.type,t)),!0):!1;if(le(r)){let n=this.engine.type(i==="widen"?$e(r.operator.signature.type,t):Ir(r.operator.signature.type,t));return n.matches("function")?(r.operator.signature=n,!0):(delete r.operator,r.value={value:{type:n}},!0)}return!1}get _value(){if(!(!this._def||le(this._def)))return this._def.value.isConstant?this._def.value.value:this.engine._getSymbolValue(this._id)}get value(){return le(this._def)?this.engine._fn("Operator",[this.engine.string(this._id)]):this._value}set value(t){if(!this._def)throw new Error(`Cannot set value of non-canonical ${this._id}`);let i=this.engine;i.forget(this._id);let r;if(typeof t=="boolean"&&(t=t?i.True:i.False),typeof t=="string"&&(t=i.string(t)),typeof t=="object")if("re"in t&&"im"in t)t=i.complex(t.re??0,t.im);else if("num"in t&&"denom"in t)t=i.number([t.num,t.denom]);else if(Array.isArray(t))t=i._fn("List",t.map(n=>i.box(n)));else throw new Error(`Invalid value for symbol ${this._id}: ${t}`);if(t!==void 0&&(r=i.box(t).evaluate()),r==null?void 0:r.type.matches("function")){delete this._def.value,this._def.operator={signature:r.type,evaluate:r};return}if(oe(this._def)&&this._def.value.isConstant)throw new Error(`The value of the constant "${this._id}" cannot be changed`);i._setSymbolValue(this._id,r)}get type(){let t=this._def;return oe(t)?t.value.type:le(t)?t.operator.signature:$.unknown}set type(t){if(!this._def)throw new Error(`Cannot set type of non-canonical symbol "${this._id}"`);if(this._id[0]==="_")throw new Error(`The type of the wildcard "${this._id}" cannot be changed`);this.engine.forget(this._id),typeof t=="string"?t=R(t):t instanceof $&&(t=t.type),t==="function"||Qa(t)?le(this._def)?this._def.operator.signature=t:(delete this._def.value,this._def.operator={signature:t}):le(this._def)?(delete this._def.operator,this._def.value={type:t}):this._def.value.type=t}has(t){return typeof t=="string"?this._id===t:t.includes(this._id)}match(t,i){return sa(this,t,i)}get sgn(){var t;return(t=this.value)==null?void 0:t.sgn}get isOdd(){var t;return(t=this.value)==null?void 0:t.isOdd}get isEven(){var t;return(t=this.value)==null?void 0:t.isEven}get isFinite(){var t;return(t=this.value)==null?void 0:t.isFinite}get isInfinity(){var t;return(t=this.value)==null?void 0:t.isInfinity}get isNaN(){var t;return(t=this.value)==null?void 0:t.isNaN}get isPositive(){return aa(this.sgn)}get isNonPositive(){return ua(this.sgn)}get isNegative(){return la(this.sgn)}get isNonNegative(){return oa(this.sgn)}get isFunction(){if(!this.type.isUnknown)return this.type.matches("function")}get isNumber(){let t=this.type;if(!t.isUnknown)return t.matches("number")}get isInteger(){let t=this.type;if(!t.isUnknown)return t.matches("integer")}get isRational(){let t=this.type;if(!t.isUnknown)return t.matches("rational")}get isReal(){let t=this.type;if(!t.isUnknown)return t.matches("real")}get re(){var t;return((t=this.value)==null?void 0:t.re)??NaN}get im(){var t;return((t=this.value)==null?void 0:t.im)??NaN}get bignumRe(){var t;return(t=this.value)==null?void 0:t.bignumRe}get bignumIm(){var t;return(t=this.value)==null?void 0:t.bignumIm}simplify(t){var i;return((i=fr(this,t).at(-1))==null?void 0:i.value)??this}evaluate(t){var n,s;let i=this.valueDefinition;if(!i)return this;let r=i.holdUntil;if(i.isConstant){if(t!=null&&t.numericApproximation){if(r==="never"||r==="evaluate"||r==="N")return((n=i.value)==null?void 0:n.N())??this}else if(r==="never"||r==="evaluate")return((s=i.value)==null?void 0:s.evaluate(t))??this}else if(r==="never"||r==="evaluate"||r==="N"&&(t!=null&&t.numericApproximation)){let a=this.engine._getSymbolValue(this._id)??this;return a.operator==="Unevaluated"&&(a=a.evaluate(t)??this),a}return this}N(){var i;let t=this.valueDefinition;return t&&t.holdUntil==="never"?this:((i=t==null?void 0:t.value)==null?void 0:i.N())??this}replace(t,i){var r;return((r=sr(this,t,i).at(-1))==null?void 0:r.value)??null}subs(t,i){let r=(i==null?void 0:i.canonical)??this.isCanonical;return t[this._id]===void 0?r?this.canonical:this:this.engine.box(t[this._id],{canonical:r})}get _asCollection(){if(oe(this._def))return this._def.value.collection}get isCollection(){var t,i;return((t=this._asCollection)==null?void 0:t.iterator)!==void 0||(((i=this._value)==null?void 0:i.isCollection)??!1)}get isIndexedCollection(){var t,i;return((t=this._asCollection)==null?void 0:t.at)!==void 0||(((i=this._value)==null?void 0:i.isIndexedCollection)??!1)}get isLazyCollection(){var t,i,r;return((i=(t=this._asCollection)==null?void 0:t.isLazy)==null?void 0:i.call(t,this._value??this))??((r=this._value)==null?void 0:r.isLazyCollection)??!1}xcontains(t){var i,r,n,s;return((r=(i=this._asCollection)==null?void 0:i.contains)==null?void 0:r.call(i,this._value??this,t))??((s=(n=this._value)==null?void 0:n.xcontains)==null?void 0:s.call(n,t))}get xsize(){var t,i;return((t=this._asCollection)==null?void 0:t.count(this._value??this))??((i=this._value)==null?void 0:i.xsize)??0}get isEmptyCollection(){var t,i,r;return((i=(t=this._asCollection)==null?void 0:t.isEmpty)==null?void 0:i.call(t,this._value??this))??((r=this._value)==null?void 0:r.isEmptyCollection)??this.xsize===0}get isFiniteCollection(){var t,i,r;return((i=(t=this._asCollection)==null?void 0:t.isFinite)==null?void 0:i.call(t,this._value??this))??((r=this._value)==null?void 0:r.isFiniteCollection)??isFinite(this.xsize)}each(){var i,r,n;let t=(r=(i=this._asCollection)==null?void 0:i.iterator)==null?void 0:r.call(i,this._value??this);return t?(function*(){let s=t.next();for(;!s.done;)yield s.value,s=t.next()})():((n=this._value)==null?void 0:n.each())??(function*(){})()}at(t){var i,r,n,s;return((r=(i=this._asCollection)==null?void 0:i.at)==null?void 0:r.call(i,this._value??this,t))??((s=(n=this._value)==null?void 0:n.at)==null?void 0:s.call(n,t))}get(t){var i,r;return(r=(i=this._value)==null?void 0:i.get)==null?void 0:r.call(i,t)}indexWhere(t){var i,r;return(i=this._asCollection)!=null&&i.indexWhere?this._asCollection.indexWhere(this._value??this,t):(r=this._value)==null?void 0:r.indexWhere(t)}subsetOf(t,i){var r,n,s,a;return((n=(r=this._asCollection)==null?void 0:r.subsetOf)==null?void 0:n.call(r,this._value??this,t,i))??((a=(s=this._value)==null?void 0:s.subsetOf)==null?void 0:a.call(s,t,i))??!1}},Bg=["\\varphi -> \\frac{1+\\sqrt{5}}{2}",Zg,Ug,e=>{let t=ht(e);return t?{value:t,because:"expand"}:void 0},e=>{if(e.operator==="Add")return{value:me(...e.ops.map(t=>t.canonical.simplify())),because:"addition"}},e=>{if(e.operator==="Negate")return{value:e.op1.neg(),because:"negation"}},e=>{if(e.operator==="Multiply")return{value:Ve(...e.ops.map(t=>t.canonical.simplify())),because:"multiplication"}},e=>{if(e.operator==="Divide")return{value:e.op1.div(e.op2),because:"division"};if(e.operator==="Rational"&&e.nops===2)return{value:e.op1.div(e.op2),because:"rational"}},e=>{if(!e.op1.isNumberLiteral)return;if(e.operator==="Sqrt"){if(e.op1.isNegative)return{value:e.engine.box(["Multiply",["Sqrt",e.op1.neg()],"ImaginaryUnit"]).simplify(),because:"sqrt"};let r=e.op1.sqrt();return Pu(r.numericValue)?{value:r,because:"sqrt"}:void 0}let t=e.op1,i=e.op2;if(i.isNumberLiteral&&t.isInteger&&i.isInteger&&t.re<U&&i.re<U){if(e.operator==="Power")return{value:e.op1.pow(e.op2),because:"power"};if(e.operator==="Root"){let r=e.op1.root(e.op2);if(Pu(r.numericValue))return{value:e.op1.root(e.op2),because:"root"}}}},e=>{if(e.operator!=="Abs")return;let t=e.op1;if(t.isNonNegative)return{value:t,because:"|x| -> x"};if(t.isNegative)return{value:t.neg(),because:"|x| -> -x"}},e=>{if(e.operator!=="Sign")return;let t=e.sgn,i=e.engine;if(t!==void 0){if(t==="positive")return{value:i.One,because:"sign positive"};if(t==="negative")return{value:i.One,because:"sign negative"};if(t==="zero")return{value:i.Zero,because:"sign zero"};if(t==="unsigned")return{value:i.NaN,because:"sign unsinged"}}},e=>{if(e.operator==="Ln")return{value:e.op1.ln(e.ops[1]),because:"ln"};if(e.operator==="Log")return{value:e.op1.ln(e.ops[1]??10),because:"log"}},e=>{if(e.operator==="Max"){if(e.nops===0)return{value:e.engine.NegativeInfinity,because:"max"};if(e.nops===1)return{value:e.op1,because:"max"}}else if(e.operator==="Min"){if(e.nops===0)return{value:e.engine.PositiveInfinity,because:"min"};if(e.nops===1)return{value:e.op1,because:"min"}}else if(e.operator==="Supremum"){if(e.nops===0)return{value:e.engine.NegativeInfinity,because:"sup"};if(e.nops===1)return{value:e.op1,because:"sup"}}else if(e.operator==="Infimum"){if(e.nops===0)return{value:e.engine.PositiveInfinity,because:"inf"};if(e.nops===1)return{value:e.op1,because:"inf"}}},e=>{if(e.operator!=="Derivative")return;let t=e.engine,[i,r]=e.ops;if(e.nops===2)return{value:t.function("Derivative",[i.simplify(),r]),because:"derivative"};if(e.nops===1)return{value:t.function("Derivative",[i.simplify()]),because:"derivative"}},e=>e.operator!=="Hypot"?void 0:{value:e.engine.box(["Sqrt",["Add",["Square",e.op1],["Square",e.op2]]]).simplify(),because:"hypot(x,y) -> sqrt(x^2+y^2)"},e=>{if(e.operator!=="Congruent"||e.nops<3)return;let t=e.engine;return{value:t._fn("Equal",[t.function("Mod",[e.ops[0],e.ops[2]]).simplify(),t.function("Mod",[e.ops[1],e.ops[2]]).simplify()]).simplify(),because:"congruent"}},e=>{e.operator},e=>{if(!_u(e))return;let t=ea(e.operator,e.op1);if(t)return{value:t,because:"constructible value"}},e=>{if(e.operator!=="InverseFunction")return;let t=Xs(e.engine,e.ops);if(t)return{value:t,because:"inverse function"}},e=>{if(e.operator!=="Arctan2")return;let[t,i]=e.ops,r=e.engine;return t.isFinite===!1&&i.isFinite===!1?{value:r.NaN,because:"arctan2"}:t.is(0)&&i.is(0)?{value:r.Zero,because:"arctan2"}:i.isFinite===!1?{value:i.isPositive?r.Zero:r.Pi,because:"arctan2"}:t.isFinite===!1?{value:t.isPositive?r.Pi.div(2):r.Pi.div(-2),because:"arctan2"}:t.is(0)?{value:i.isPositive?r.Zero:r.Pi,because:"arctan2"}:{value:r.function("Arctan",[t.div(i)]).simplify(),because:"arctan2"}},"\\arcsinh(x) -> \\ln(x+\\sqrt{x^2+1})","\\arccosh(x) -> \\ln(x+\\sqrt{x^2-1})","\\arctanh(x) -> \\frac{1}{2}\\ln(\\frac{1+x}{1-x})","\\arccoth(x) -> \\frac{1}{2}\\ln(\\frac{x+1}{x-1})","\\arcsech(x) -> \\ln(\\frac{1+\\sqrt{1-x^2}}{x})","\\arccsch(x) -> \\ln(\\frac{1}{x} + \\sqrt{\\frac{1}{x^2}+1})",Ym];function Zg(e){let t=e.operator;if(!gi(t)&&!Rr(t))return;let i=e,r=e.engine,n=e.op1.simplify(),s=e.op2.simplify();if(e=r.function(e.operator,[n,s]),e=cr(e)??e,Xt(e.operator),e.nops===2&&!e.op2.is(0)){let a=cr(r.function(e.operator,[e.op1.sub(e.op2),r.Zero]));r.costFunction(a)<r.costFunction(e)&&(e=a)}if(!e.isSame(i))return{value:e,because:"simplify-relational-operator"}}function Ug(e){return e.operator!=="List"||!e.ops.every(t=>Rr(t.operator)||gi(t.operator))?void 0:{value:e.engine.function("List",e.ops.map(t=>t.simplify())),because:"simplify-system-of-equations"}}function Pu(e){return e===null?!1:typeof e=="number"?Number.isInteger(e):e.isExact}function Gg(e){if(e.operator==="Element")return Hg(e);if(e.operator==="Equal")return jg(e);if(gi(e.operator))return Wg(e);throw new Error("Unsupported assumption. Use `Element`, `Equal` or an inequality")}function jg(e){e.operator;let t=e.unknowns;if(t.length===0){let n=e.evaluate();return n.symbol==="True"?"tautology":n.symbol==="False"?"contradiction":(e.canonical.evaluate(),"not-a-predicate")}let i=e.engine,r=e.op1.symbol;if(r&&!Yg(i,r)&&!e.op2.has(r)){let n=e.op2.evaluate();if(!n.isValid)return"not-a-predicate";let s=i.lookupDefinition(r);return!s||!oe(s)?(i.declare(r,{value:n}),"ok"):s.value.type&&!n.type.matches(s.value.type)&&!s.value.inferredType?"contradiction":"ok"}if(t.length===1){let n=t[0],s=Tu(e,n);s.length===0&&i.context.assumptions.set(i.function("Equal",[e.op1.sub(e.op2),0]),!0);let a=s.length===1?s[0]:i.function("List",s),o=i.lookupDefinition(n);return!o||!oe(o)?(i.declare(n,{value:a}),"ok"):o.value.type&&!s.every(l=>!l.type||a.type.matches(l.type))?"contradiction":"ok"}return i.context.assumptions.set(e,!0),"ok"}function Wg(e){let t=e.engine,i="",r,n;if(e.operator==="Less"?(r=e.op1,n=e.op2,i="<"):e.operator==="LessEqual"?(r=e.op1,n=e.op2,i="<="):e.operator==="Greater"?(r=e.op2,n=e.op1,i="<"):e.operator==="GreaterEqual"&&(r=e.op2,n=e.op1,i="<="),!i)return"internal-error";let s=r.sub(n),a=t.box([i==="<"?"Less":"LessEqual",s,0]).evaluate();if(a.symbol==="True")return"tautology";if(a.symbol==="False")return"contradiction";let o=a.unknowns;return o.length===0?"not-a-predicate":(o.length===1&&(t.lookupDefinition(o[0])||t.declare(o[0],{type:"real"})),a.operator==="Less"||a.operator,t.context.assumptions.set(a,!0),"ok")}function Hg(e){var n,s;e.operator;let t=e.engine,i=Qg(e.op1);if(i.length===1){let a=e.op2.evaluate();if(!a.isValid)return"not-a-predicate";let o=zs(a);if(o==="unknown")throw new Error(`Invalid domain "${a.toString()}"`);return t.declare(i[0],o),"ok"}if(e.op1.symbol&&Fu(t,e.op1.symbol)){let a=e.op2.evaluate();if(!a.isValid)return"not-a-predicate";let o=zs(a);(s=(n=t.context)==null?void 0:n.lexicalScope)!=null&&s.bindings.has(e.op1.symbol)||t.declare(e.op1.symbol,zs(a));let l=t.lookupDefinition(e.op1.symbol);return oe(l)?l.value.type&&!_(o,l.value.type.type)?"contradiction":(l.value.type=new $(o,t._typeResolver),"ok"):le(l)?_(o,Ot(l.operator.signature.type))?"ok":"contradiction":"not-a-predicate"}if(i.length>0)return t.context.assumptions.set(e,!0),"ok";let r=e.evaluate();return r.symbol==="True"?"tautology":r.symbol==="False"?"contradiction":"not-a-predicate"}function Fu(e,t){return e.lookupDefinition(t)!==void 0}function Qg(e){return e.symbols.filter(t=>!Fu(e.engine,t))}function Yg(e,t){let i=e.lookupDefinition(t);return i?!!(oe(i)&&i.value.isConstant||e._getSymbolValue(t)!==void 0):!1}var Ou=(Gu=Symbol.toStringTag,Ht=class{constructor(t){m(this,"True");m(this,"False");m(this,"Pi");m(this,"E");m(this,"Nothing");m(this,"Zero");m(this,"One");m(this,"Half");m(this,"NegativeOne");m(this,"Two");m(this,"I");m(this,"NaN");m(this,"PositiveInfinity");m(this,"NegativeInfinity");m(this,"ComplexInfinity");m(this,"decimalSeparator",".");m(this,"_BIGNUM_NAN");m(this,"_BIGNUM_ZERO");m(this,"_BIGNUM_ONE");m(this,"_BIGNUM_TWO");m(this,"_BIGNUM_HALF");m(this,"_BIGNUM_PI");m(this,"_BIGNUM_NEGATIVE_ONE");m(this,"_precision");m(this,"_angularUnit");m(this,"_tolerance");m(this,"_bignumTolerance");m(this,"_negBignumTolerance");m(this,"__cache",{});m(this,"_configurationChangeTracker",new Mf);m(this,"_cost");m(this,"_commonSymbols",{Pi:null,True:null,False:null,All:null,Nothing:null,None:null,Undefined:null,ImaginaryUnit:null,ExponentialE:null});m(this,"_commonNumbers",{"-5":null,"-4":null,"-3":null,"-2":null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,36:null});m(this,"_evalContextStack",[]);m(this,"_generation",0);m(this,"strict");m(this,"deadline");m(this,"_latexDictionaryInput");m(this,"__indexedLatexDictionary");m(this,"_bignum");m(this,Gu,"ComputeEngine");m(this,"_timeLimit",2e3);m(this,"_deadline");m(this,"_iterationLimit",1024);m(this,"_recursionLimit",1024);if(t!==void 0&&typeof t!="object")throw Error("Unexpected argument");this.strict=!0;let i=(t==null?void 0:t.precision)??eo;i==="machine"&&(i=Math.floor(Jt)),this._bignum=Z.clone({precision:i}),this._precision=i,this.tolerance=(t==null?void 0:t.tolerance)??"auto",this._angularUnit="rad",this.Zero=new Qe(this,0),this.One=new Qe(this,1),this.Half=new Qe(this,{rational:[1,2]}),this.NegativeOne=new Qe(this,-1),this.Two=new Qe(this,2),this.NaN=new Qe(this,Number.NaN),this.PositiveInfinity=new Qe(this,Number.POSITIVE_INFINITY),this.NegativeInfinity=new Qe(this,Number.NEGATIVE_INFINITY),this.I=new Qe(this,{im:1}),this.ComplexInfinity=new Qe(this,{re:1/0,im:1/0}),this._reset(),this.pushScope(void 0,"system"),this.declareType("limits","expression<Limits>");for(let n of Ht.getStandardLibrary("domains"))ku(this,n);let r=(t==null?void 0:t.ids)??Ht.getStandardLibrary();for(let n of r)ku(this,n);for(let n of Object.keys(this._commonSymbols))this._commonSymbols[n]=new Sn(this,n,{def:this.lookupDefinition(n)});this.True=this._commonSymbols.True,this.False=this._commonSymbols.False,this.Pi=this._commonSymbols.Pi,this.E=this._commonSymbols.ExponentialE,this.Nothing=this._commonSymbols.Nothing,this.pushScope(void 0,"global"),If(this)}get context(){return this._evalContextStack[this._evalContextStack.length-1]}get contextStack(){return[...this._evalContextStack]}set contextStack(t){this._evalContextStack=[...t]}get _typeResolver(){let t=this;return{get names(){let i=[],r=t.context.lexicalScope;for(;r;)r.types&&i.push(...Object.keys(r.types)),r=r.parent;return i},resolve:i=>{var n;let r=t.context.lexicalScope;for(;r;){if((n=r.types)!=null&&n[i])return r.types[i];r=r.parent}},forward:i=>{var n;let r={kind:"reference",name:i,alias:!1,def:void 0};return(n=t.context.lexicalScope).types??(n.types={}),t.context.lexicalScope.types[i]=r,r}}}declareType(t,i,{alias:r}={}){var a;if(!Tf(t))throw Error(`The type name "${t}" is invalid`);let n=this.context.lexicalScope;if((a=n.types)!=null&&a[t])throw Error(`The type "${t}" is already defined in the current scope`);n.types??(n.types={}),r??(r=!1),n.types[t]={kind:"reference",name:t,alias:r,def:void 0};let s=i instanceof $?i.type:typeof i=="string"?R(i,this._typeResolver):i;n.types[t].def=s}get trace(){return this._evalContextStack.map(t=>t.name).filter(t=>t!==void 0).reverse()}static getStandardLibrary(t="all"){return wu(t)}static getLatexDictionary(t="all"){return Lp(t)}toJSON(){return"[ComputeEngine]"}get latexDictionary(){return this._latexDictionaryInput??Ht.getLatexDictionary()}set latexDictionary(t){this._latexDictionaryInput=t,this.__indexedLatexDictionary=Do(t,i=>{throw Error(typeof i.message=="string"?i.message:i.message.join(","))})}get _indexedLatexDictionary(){return this.__indexedLatexDictionary??(this.__indexedLatexDictionary=Do(this.latexDictionary,t=>console.error(t))),this.__indexedLatexDictionary}_reset(){this._bignum,this._generation+=1,this._BIGNUM_NEGATIVE_ONE=this.bignum(-1),this._BIGNUM_NAN=this.bignum(NaN),this._BIGNUM_ZERO=this.bignum(0),this._BIGNUM_ONE=this.bignum(1),this._BIGNUM_TWO=this.bignum(2),this._BIGNUM_HALF=this._BIGNUM_ONE.div(this._BIGNUM_TWO),this._BIGNUM_PI=this._BIGNUM_NEGATIVE_ONE.acos();for(let t of Object.values(this._commonSymbols))t==null||t.reset();for(let t of Object.keys(this.__cache))this.__cache[t].value&&(this.__cache[t].purge?this.__cache[t].value=this.__cache[t].purge(this.__cache[t].value):delete this.__cache[t]);this._configurationChangeTracker.notifyNow()}listenToConfigurationChange(t){return this._configurationChangeTracker.listen(t)}get precision(){return this._precision}set precision(t){t==="machine"&&(t=Jt),t==="auto"&&(t=eo);let i=this._precision;if(t!==i){if(typeof t!="number"||t<=0)throw Error('Expected "machine" or a positive number');this._precision=Math.max(t,Jt),this._bignum=this._bignum.config({precision:this._precision}),this.tolerance="auto",this._reset()}}get angularUnit(){return this._angularUnit}set angularUnit(t){if(t!==this._angularUnit){if(typeof t!="string")throw Error("Expected a string");this._angularUnit=t,this._reset()}}get timeLimit(){return this._timeLimit}set timeLimit(t){t<=0&&(t=Number.POSITIVE_INFINITY),this._timeLimit=t}get _timeRemaining(){return this.deadline===void 0?Number.POSITIVE_INFINITY:this.deadline-Date.now()}get iterationLimit(){return this._iterationLimit}set iterationLimit(t){t<=0&&(t=Number.POSITIVE_INFINITY),this._iterationLimit=t}get recursionLimit(){return this._recursionLimit}set recursionLimit(t){t<=0&&(t=Number.POSITIVE_INFINITY),this._recursionLimit=t}get tolerance(){return this._tolerance}set tolerance(t){t==="auto"&&(t=to),(!Number.isFinite(t)||t<0)&&(t=Math.pow(10,-this._precision+2)),this._tolerance=t,this._bignumTolerance=this.bignum(t),this._negBignumTolerance=this.bignum(-t)}chop(t){return typeof t=="number"?Math.abs(t)<=this._tolerance?0:t:t instanceof Z?t.isPositive()&&t.lte(this._bignumTolerance)||t.isNegative()&&t.gte(this._negBignumTolerance)||t.isZero()?0:t:t instanceof W&&Math.abs(t.re)<=this._tolerance&&Math.abs(t.im)<=this._tolerance?0:t}bignum(t){if(typeof t=="bigint")return new this._bignum(t.toString());try{return new this._bignum(t)}catch(i){console.error(i.message)}return this._BIGNUM_NAN}complex(t,i){return t instanceof Z&&(t=t.toNumber()),i instanceof Z&&(i=i.toNumber()),new W(t,i)}_numericValue(t){if(t instanceof pe)return t.asExact??t;let i=n=>this.bignum(n),r=this._precision>Jt?n=>new Cs(n,i):n=>new qs(n,i);if(typeof t=="number")return Number.isInteger(t)?new _e(t,r,i):r(t);if(typeof t=="bigint")return new _e(t,r,i);if(bi(t))return new _e({rational:t},r,i);if(t instanceof Z)return t.isInteger()&&t.e<=Of?new _e(de(t.toString()),r,i):r(t);if(t instanceof W)return t.im===0?this._numericValue(t.re):r({re:t.re,im:t.im});if("im"in t||"re"in t)return t.im!==void 0&&t.im!==0?r(t):t.re instanceof Z&&t.re.isInteger()?new _e({rational:[de(t.re.toString()),BigInt(1)]},r,i):typeof t.re=="number"&&Number.isInteger(t.re)?new _e({rational:[t.re,1]},r,i):r(t);if("radical"in t||"rational"in t){if(t.radical!==void 0&&(!Number.isInteger(t.radical)||t.radical>=U))throw Error("Unexpected value for radical part:"+t.radical);return t.rational&&re(t.rational)&&(!Number.isInteger(t.rational[0])||!Number.isInteger(t.rational[1]))?r(t):new _e(t,r,i)}throw Error("Unexpected value")}get costFunction(){return this._cost??Su}set costFunction(t){typeof t!="function"&&(this._cost=Su),this._cost=t}lookupDefinition(t){return Uo(t,this.context.lexicalScope)}_declareSymbolValue(t,i,r){r??(r=this.context.lexicalScope),r.bindings.set(t,{value:new Ei(this,t,{type:"unknown",inferred:!0})});let n=r.bindings.get(t);return cn(this,t,n,i),r===this.context.lexicalScope&&oe(n)&&n.value.value&&!n.value.isConstant&&(this.context.values[t]=n.value.value),this._generation+=1,n}_declareSymbolOperator(t,i,r){r??(r=this.context.lexicalScope),r.bindings.set(t,{value:new Ei(this,t,{type:"function"})});let n=r.bindings.get(t);return cn(this,t,n,i),this._generation+=1,n}pushScope(t,i){var r;this._pushEvalContext(t??{parent:(r=this.context)==null?void 0:r.lexicalScope,bindings:new Map},i)}popScope(){this._popEvalContext()}_pushEvalContext(t,i){var n;if(!i){let s=this._evalContextStack.length;s===0&&(i="system"),s===1&&(i="global"),i??(i=`anonymous_${s-1}`)}let r={};for(let[s,a]of t.bindings.entries())oe(a)&&!a.value.isConstant&&(r[s]=a.value.value);this._evalContextStack.push({lexicalScope:t,name:i,assumptions:new qu(((n=this.context)==null?void 0:n.assumptions)??[]),values:r})}_popEvalContext(){this._evalContextStack.pop()}_inScope(t,i){if(!t)return i();this._evalContextStack.push({lexicalScope:t,name:"",assumptions:new qu([]),values:{}});try{return i()}finally{this._evalContextStack.pop()}}_printStack(t){t?(t={...t},t.maxDepth??(t.maxDepth=1),t.details??(t.details=!1)):t={details:!1,maxDepth:-2},t.maxDepth!==void 0&&t.maxDepth<0&&(t.maxDepth=this._evalContextStack.length+t.maxDepth),t.maxDepth=Math.min(this._evalContextStack.length-1,t.maxDepth);let i=0;for(;i<=t.maxDepth;){let r=this._evalContextStack[this._evalContextStack.length-1-i];i===0?console.group(`${zn}${$a}${r.name}${Fe}`):console.groupCollapsed(`${zn}${$a}${r.name}${Fe} ${Oi}(${i})${Fe}`);let n=[...r.assumptions.entries()].map(([a,o])=>`${a}: ${o}`);if(n.length>0){console.groupCollapsed(`${zn}${n.length} assumptions${Fe}`);for(let a of n)console.info(a);console.groupEnd()}let s=Object.entries(r.values);if(s.length+r.lexicalScope.bindings.size===0){console.groupEnd(),i+=1;continue}for(let[a,o]of s)r.lexicalScope.bindings.has(a)?console.info(Ru(a,r.lexicalScope.bindings.get(a),o)):console.info(o===void 0?`${wr}${a}${Fe}: ${Oi}undefined${Fe}`:`${wr}${a}${Fe}: ${Oi}${o.toString()}${Fe}`);for(let[a,o]of r.lexicalScope.bindings)a in r.values||console.info(Ru(a,o));console.groupEnd(),i+=1}}_getSymbolValue(t){let i=this._evalContextStack.length-1;if(!(i<0))for(let r=i;r>=0;r--){let n=this._evalContextStack[r].values;if(t in n)return n[t]}}_setSymbolValue(t,i){let r=this._evalContextStack.length-1;if(r<0)throw new Error(`Unknown symbol "${t}"`);typeof i=="number"?i=this.number(i):typeof i=="boolean"&&(i=i?this.True:this.False);for(let s=r;s>=0;s--){let a=this._evalContextStack[s].values;if(t in a){a[t]=i,this._generation+=1;return}}let n=this.lookupContext(t);if(!n)throw new Error(`Unknown symbol "${t}"`);n.values[t]=i}declare(t,i,r){if(typeof t!="string"){for(let[a,o]of Object.entries(t))this.declare(a,o);return this}let n=t;if(n==="Nothing")return this;if(i==null)throw Error(`Expected a definition or type for "${n}"`);if(typeof n!="string"||n.length===0||!Le(n))throw new Error(`Invalid symbol "${n}": ${Yt(n)}`);if(r??(r=this.context.lexicalScope),r.bindings.has(n))throw new Error(`The symbol "${n}" is already declared in this scope`);let s=i;if(Vs(s))return this._declareSymbolValue(n,s,r),this;if(Rs(s))return this._declareSymbolOperator(n,s,r),this;{let a=R(s,this._typeResolver);if(!Mr(a))throw Error([`Invalid argument for "${n}"`,JSON.stringify(s,void 0,4),"Use a type, a `OperatorDefinition` or a `ValueDefinition`"].join(`
|   `));this._declareSymbolValue(n,{type:a},r)}return this}lookupContext(t){if(t.length===0||!Le(t))throw Error(`Invalid symbol "${t}": ${Yt(t)}}`);let i=this._evalContextStack.length-1;if(!(i<0))for(let r=i;r>=0;r--){let n=this._evalContextStack[r];if(n.lexicalScope.bindings.has(t))return n}}_swapContext(t){for(;this._evalContextStack.length>0&&this._evalContextStack[this._evalContextStack.length-1]!==t;)this._evalContextStack.pop();this._evalContextStack.length===0&&(this._evalContextStack=[t])}assign(t,i){if(typeof t=="object"){for(let[o,l]of Object.entries(t))this.assign(o,l);return this}let r=t;if(r==="Nothing")return this;let n=this.lookupDefinition(r);if(le(n)){if(zu(this,i))throw Error(`Cannot change the operator "${r}" to a value`);let o=Lu(this,i);if(!o)throw Error(`Cannot change the operator "${r}" to a value`);return cn(this,r,n,o),this}let s=zu(this,i);if(s!==void 0){if(!n)return this._declareSymbolValue(r,{value:s}),this;if(n.value.isConstant)throw Error(`Cannot assign a value to the constant "${r}"`);return n.value.inferredType&&(n.value.type=this.type($e(n.value.type.type,s.type.type))),this._setSymbolValue(r,s),this}let a=Lu(this,i);if(a===void 0)throw Error(`Invalid definition for symbol "${r}"`);return n?(cn(this,r,n,a),this._setSymbolValue(r,void 0)):this.declare(r,a),this}_shouldContinueExecution(){return this.deadline===void 0||this.deadline>=Date.now()}_checkContinueExecution(){if(!this._shouldContinueExecution())throw new Error("timeout")}_cache(t,i,r){var n;if(this.__cache[t]===void 0)try{this.__cache[t]={build:i,purge:r,value:i()}}catch(s){console.error(`Fatal error building cache "${t}":
	 ${s.toString()}`)}return(n=this.__cache[t])==null?void 0:n.value}box(t,i){return gt(this,t,i)}function(t,i,r){return fa(this,t,i,r)}error(t,i){let r;typeof t=="string"?r=this.string(t):r=this.function("ErrorCode",t.map(a=>this.string(a)));let n;i&&Kn(i)?n=this.function("LatexString",[this.string(Gi(i))]):typeof i=="string"&&i.length>0&&(n=this.string(i));let s=[this.box(r)];return n&&s.push(n),this.function("Error",s)}typeError(t,i,r){return i?this.error(["incompatible-type",Q(t),i.toString()],r):this.error(["incompatible-type",Q(t)],r)}hold(t){return this._fn("Hold",[this.box(t,{canonical:!1})])}tuple(...t){return new xe(this,"Tuple",t.map(i=>typeof i=="number"?this.number(i):i.canonical),{canonical:!0})}type(t){return t instanceof $?t:new $(t,this._typeResolver)}string(t,i){return new kn(this,t,i)}symbol(t,i){let r=(i==null?void 0:i.canonical)??!0;t=t.normalize();let n=t.toLowerCase();if(n==="infinity"||n==="+infinity")return this.PositiveInfinity;if(n==="-infinity")return this.NegativeInfinity;if(this.strict&&!Le(t))return this.error(["invalid-symbol",Yt(t)],t);if(!r)return new Sn(this,t);let s=this._commonSymbols[t];if(s)return s;let a=this.lookupDefinition(t);return oe(a)&&a.value.holdUntil==="never"?a.value.value??this.Nothing:a?new Sn(this,t,{def:a}):(a=this._declareSymbolValue(t,{type:"unknown",inferred:!0}),new Sn(this,t,{def:a}))}number(t,i){var s;let r=i==null?void 0:i.metadata,n=!1;if((!i||i.canonical===void 0||i.canonical==="Number"||i.canonical===!0||Array.isArray(i.canonical)&&i.canonical.includes("Number"))&&(n=!0),!n&&bi(t))return this._fn("Rational",[this.number(t[0]),this.number(t[1])],{...r,canonical:!1});if(t=pa(this,t),r===void 0){if(typeof t=="number"){let a=t;if(a===1)return this.One;if(a===0)return this.Zero;if(a===-1)return this.NegativeOne;if(a===2)return this.Two;if(Number.isInteger(a)&&this._commonNumbers[a]!==void 0)return(s=this._commonNumbers)[a]??(s[a]=new Qe(this,t)),this._commonNumbers[a];if(Number.isNaN(a))return this.NaN;if(!Number.isFinite(a))return a<0?this.NegativeInfinity:this.PositiveInfinity}else if(t instanceof pe){if(t.isZero)return this.Zero;if(t.isOne)return this.One;if(t.isNegativeOne)return this.NegativeOne;if(t.isNaN)return this.NaN;if(t.isNegativeInfinity)return this.NegativeInfinity;if(t.isPositiveInfinity)return this.PositiveInfinity}}return new Qe(this,t,{metadata:r})}rules(t,i){return hn(this,t,i)}getRuleSet(t){if(t??(t="standard-simplification"),t==="standard-simplification")return this._cache("standard-simplification-rules",()=>hn(this,Bg,{canonical:!0}));if(t==="solve-univariate")return this._cache("univariate-roots-rules",()=>hn(this,wg));if(t==="harmonization")return this._cache("harmonization-rules",()=>hn(this,kg))}_fn(t,i,r){let n=(r==null?void 0:r.canonical)??!0;return new xe(this,t,i,{...r,canonical:n})}parse(t,i){if(t==null)return null;if(typeof t!="string")throw Error("ce.parse(): expected a LaTeX string");let r={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.decimalSeparator,digitGroup:3,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",truncationMarker:"\\ldots",repeatingDecimal:"auto",skipSpace:!0,parseNumbers:"auto",getSymbolType:s=>{let a=this.lookupDefinition(s);return a?le(a)?a.operator.signature:oe(a)?a.value.type:$.unknown:$.unknown},parseUnexpectedToken:(s,a)=>null,preserveLatex:!1},n=Wp(Gi(t)??t,this._indexedLatexDictionary,{...r,...i});if(n===null)throw Error("Failed to parse LaTeX string");return this.box(n,{canonical:(i==null?void 0:i.canonical)??!0})}ask(t){let i=this.box(t,{canonical:!1}),r=[],n=this.context.assumptions;for(let[s,a]of n){let o=i.match(s);o!==null&&a===!0&&r.push(o)}return r}verify(t){return!1}assume(t){try{let i=Kn(t)?this.parse(t,{canonical:!1}):this.box(t,{canonical:!1});return this._generation+=1,Gg(i)}catch(i){throw console.error(i.message.toString()),i}}forget(t){var i;if(t===void 0){(i=this.context.assumptions)==null||i.clear(),this._generation+=1;return}if(Array.isArray(t)){for(let r of t)this.forget(r);return}if(typeof t=="string")for(let[r,n]of this.context.assumptions)r.has(t)&&this.context.assumptions.delete(r);this._generation+=1}},Ht);function zu(e,t){if(t==null||typeof t=="function")return;if(typeof t=="boolean")return t?e.True:e.False;if(typeof t=="number"||typeof t=="bigint")return e.number(t);let i=e.box(t);if(!(i.unknowns.length>0))return i}function Lu(e,t){if(typeof t=="function")return{evaluate:t,signature:"function"};if(t==null||typeof t=="boolean")return;let i=Me(e.box(t));if(i!==void 0)return{evaluate:i,signature:"function"}}function Ru(e,t,i){var n;let r="";if(oe(t)){let s=[];t.value.holdUntil==="never"&&s.push("(hold never)"),t.value.holdUntil==="N"&&s.push("(hold until N)"),t.value.inferredType&&s.push("inferred");let a=s.length>0?` ${s.join(" ")}`:"";r=`${wr}${e}${Fe}:${a}`,t.value.isConstant?(r+=` const ${t.value.type.toString()}`,t.value.value!==void 0&&(r+=` = ${(n=t.value.value)==null?void 0:n.toString()}`)):r+=` ${t.value.type.toString()}`}else if(le(t)){let s=[];t.operator.inferredSignature&&s.push("(inferred)");let a=s.length>0?` (${s.join(" ")})`:"";r=`${wr}${e}${Fe}:${a} ${t.operator.signature.toString()}`;let o=[];t.operator.lazy&&o.push("lazy"),t.operator.scoped&&o.push("scoped"),t.operator.broadcastable&&o.push("broadcastable"),t.operator.associative&&o.push("associative"),t.operator.commutative&&o.push("commutative"),t.operator.idempotent&&o.push("idempotent"),t.operator.involution&&o.push("involution"),t.operator.pure||o.push("not pure");let l=o.map(u=>`${Oi}${u}${Fe}`).join(" ");l.length>0&&(r+=`
    ${l}`)}else r="unknown";return i&&(i.isValid?i.isCanonical?r+=` = ${Oi}${i.toString()}${Fe}`:r+=` = ${ef}${i.toString()}${Fe} (not canonical)`:r+=` = ${tf}${i.toString()}${Fe} (not valid)`),r}var Jg="0.30.2";return globalThis[Symbol.for("io.cortexjs.compute-engine")]={ComputeEngine:Ou.prototype.constructor,version:"0.30.2"},rc(da)})();Object.assign(Ct,An),Object.defineProperty(Ct,"__esModule",{value:!0})}))})(hr,hr.exports)),hr.exports}var rd=td();export{rd as c};
//# sourceMappingURL=cortex-js_compute-engine-Bo_2zfG3.js.map
