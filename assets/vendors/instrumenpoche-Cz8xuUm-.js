import{_ as Oe}from"./three-q_6hD11P.js";import{s as Le}from"./sesajstools-DjIHbFnf.js";import"./seedrandom-Cz-2rAdY.js";const l="http://www.w3.org/2000/svg",Xe={alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",pi:"π",rho:"ρ",sigma:"σ",tau:"τ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",Gamma:"Γ",Delta:"Δ",Xi:"Ξ",Pi:"Π",Sigma:"Σ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω"},Ze={alpha2:"α",plus:"+",moins:"-",fois:"×",divise:"÷",petitf:"f",petitebarre:"–",grandebarre:"—",prime:"'",seconde:'"',puceronde:"•",grandC:"ℂ",euler:"ℂ",petitg:"ℊ",petith:"ℏ",Ironde:"ℑ",Lronde:"ℒ",lronde:"ℓ",grandN:"ℕ",Pronde:"℘",grandQ:"ℚ",Rronde:"ℜ",grandR:"ℝ",grandZ:"ℤ",Eronde:"ℰ",Fronde:"ℱ",Nronde:"ℵ",flecheG:"←",flecheH:"↑",flecheD:"→",flecheB:"↓",flecheDG:"↔",flecheGD:"↔",flecheHB:"↕",flecheBH:"↕",croissant:"↗",decroissant:"↘",alaligneadroite:"↳",alaligneagauche:"↵",doubleflecheG:"⇐",doubleflecheD:"⇒",doubleflecheDG:"⇔",doubleflecheGD:"⇔",flecheGbarre:"⇤",flecheDbarre:"⇥",flecheGcreuse:"⇦",flecheHcreuse:"⇧",flecheDcreuse:"⇨",flecheBcreuse:"⇩",qqsoit:"∀",pourtout:"∀",quelquesoit:"∀",complement:"∁",differentielpartiel:"∂",ilexiste:"∃",ilnexistepas:"∄",vide:"∅",nabla:"∇",appartienta:"∈",nappartientpasa:"∉",contient:"∋",petitcontient:"∍",grandproduit:"∏",grandcoproduit:"∐",grandesomme:"∑",petitebarrefine:"−",moinsouplus:"∓",antislash:"\\",asterisque:"∗",racine:"√",proportionnela:"∝",infini:"∞",angle:"∡",anglespherique:"∢",nedivisepas:"∤",parallelea:"//",nestpasparallelea:"∦",etlogique:"∧",oulogique:"∨",inter:"∩",intersection:"∩",union:"∪",integrale:"∫",doubleintegrale:"∬",tripleintegrale:"∭",integralecurviligne:"∮",integralesurfacique:"∯",integralevolumique:"∰",egaleasymptotiquea:"≃",environdroit:"≃",environegala:"≅",environ:"≈",egalpardefinition:"≝",differentde:"≠",identiquea:"≡",inferieura:"≤",superieura:"≥",inclusdans:"⊂",nestpasinclusdans:"⊄",necontientpas:"⊅",sommedirecte:"⊕",differencedirecte:"⊖",produittensoriel:"⊗",divisiondirecte:"⊘",produitdirect:"⊙",top:"⊤",perpendiculairea:"⊥",antecedentde:"⊶",imagede:"⊷",angledroitarc:"⊾",point:"⋅",pv:";"},D=Math.PI/180,He=180/Math.PI,Bt=Math.cos(30*D),Dt=.5;function ft(i,e,t,s,n,r){this.bold=i,this.italic=e,this.underline=t,this.couleur=s,this.fontface=n,this.taille=r}const je={};Object.entries(Ze).forEach(([i,e])=>{je[i.toLowerCase()]=e});const mt=i=>Math.abs(i)<1e-9,Je=i=>Math.abs(i)<1e-7;function Et(i){const e=Math.floor((i+180)/360);let t=i-360*e;return t===-180&&(t=180),t}function Ue(i){let e,t;return window.DOMParser?(e=new DOMParser,t=e.parseFromString(i,"text/xml")):window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(i)):console.error(Error("Votre navigateur ne peut pas analyser du XML, impossible d’utiliser instrumenpoche")),t}const St=i=>["compas","compasLeve","crayon","equerre","rapporteur","regle","requerre"].includes(i);function q(i){let e,t,s,n=!1;if(i.indexOf("<font")===0)t="</font>",n=!0;else{if(s=i.indexOf(">"),s===-1)return i.length;e=i.substring(0,s+1),t=e.substring(0,1)+"/"+e.substring(1)}const r=i.indexOf(t);if(r===-1){if(n){const o=i.indexOf("<font",5);if(o!==-1)return o}return-1}else return r+t.length}function Re(i){const e=i.trim(),t={},s=e.indexOf(","),n=e.indexOf(")");return t.erreur=s===-1||n===-1,t.erreur?(t.texte="",t):(t.operande=e.substring(3,s),t.exposant=e.substring(s+1,n),t.texte=e.substring(n+1),t)}function $(i,e){let t,s,n=1;for(t=e+1;t<i.length&&(s=i.charAt(t),s==="("?n++:s===")"&&n--,n!==0);)t++;return n===0?t:-1}function Ye(i,e){const t=Math.pow(10,e);return Math.round(i/t)*t}function Yt(i,e,t,s,n){const r=(s-n)/(e-t),o=s-r*e;return r*i+o}function We(i){let e="";const t=["objet","mouvement","vitesse","tempo","abscisse","ordonnee","id","couleur","pointille","echelle","angle","cible","texte","ecrire","rotation","translation","epaisseur","opacite","masquer","montrer","crayon","equerre","regle","compas","reglequerre","sens","hauteur","largeur","haut","gauche","Xmin","Ymin","Xmax","yMax","Xgrad","Ygrad","image","police","taille","ordonnee_bas_droite","abscisse_bas_droite","ordonnee_haut_gauche","abscisse_haut_gauche"];return i.split(/<action/gi).forEach((s,n)=>{t.forEach(r=>{const o=new RegExp(" "+r+'[^\\w ]*= *"[\\w]*"',"i"),c=s.search(o);c!==-1&&s.substring(c+1).search(o)!==-1&&(s=s.replace(o,""))}),e+=n===0?s:"<action"+s}),e}function _e(i){return i=i.replace(/<B>/g,"<b>"),i=i.replace(/<\/B>/g,"</b>"),i=i.replace(/<I>/g,"<i>"),i=i.replace(/<\/I>/g,"</i>"),i=i.replace(/<U>/g,"<u>"),i=i.replace(/<\/U>/g,"</u>"),i=i.replace(/£lt£i£gt£/gi,"<i>"),i=i.replace(/£i£/gi,"<i>"),i=i.replace(/£lt£\/i£gt£/gi,"</i>"),i=i.replace(/£\/i£/gi,"</i>"),i=i.replace(/£lt£b£gt£/gi,"<b>"),i=i.replace(/£b£/gi,"<b>"),i=i.replace(/£lt£\/b£gt£/gi,"</b>"),i=i.replace(/£\/b£/gi,"</b>"),i=i.replace(/£lt£u£gt£/gi,"<u>"),i=i.replace(/£u£/gi,"<u>"),i=i.replace(/£lt£\/u£gt£/gi,"</u>"),i=i.replace(/£\/u£/gi,"</u>"),i=i.replace(/£lt£br£gt£/gi,"<br>"),i=i.replace(/£lt£br\/£gt£/gi,"<br>"),i=i.replace(/£br£/gi,"<br>"),i=i.replace(/£br\/£/gi,"<br>"),i=i.replace(/£lt£font/gi,"<font"),i=i.replace(/£lt£\/font£gt£/gi,"</font>"),i=i.replace(/£lt£bold£gt£/gi,"<b>"),i=i.replace(/£lt£\/bold£gt£/gi,"</b>"),i=i.replace(/£lt£/gi,"<"),i=i.replace(/£gt£/gi,">"),i=i.replace(/£inferieurstrict£/gi,"<"),i=i.replace(/£superieurstrict£/gi,">"),i=i.replace(/£guillemet£/gi,'"'),i}function $e(i){if(!i.includes("£"))return i;const e=i.split("£").map((t,s)=>{if(s%2){const n=t.toLowerCase();return je[n]||`£${t}£`}return t}).join("");return(i.length-i.replace(/£/g,"").length)%2?(console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${i}`),e.substr(0,e.length-1)):e}function Ve(i,e){let t,s,n;for(n=1,t=e+1;t<i.length&&(s=i.charAt(t),s==="{"?n++:s==="}"&&n--,n!==0);)t++;return n===0?t:-1}function ze(i){return i.indexOf("\\frac")!==-1||i.indexOf("\\sqrt")!==-1||i.indexOf("}^{")!==-1||i.indexOf("}_{")!==-1||i.indexOf("\\widehat{")!==-1||i.indexOf("\\left[")!==-1||i.indexOf("\\left(")!==-1||i.indexOf("\\left|")!==-1||i.indexOf("\\left\\|")!==-1||i.indexOf("\\overrightarrow{")!==-1||i.indexOf("\\text{")!==-1}function Y(i){const e={noir:"black",rouge:"red",vert:"green",bleu:"blue",blanc:"white",gris:"grey",darkorange:"maroon"};if(i==="0")return"black";if(e[i])return e[i];const t=s=>s.length<7?"#"+"0".repeat(6-s.length)+s:s.substr(-6);return/^#/.test(i)?i.length===7?i:i.length===4?`#${i[1]}${i[1]}${i[2]}${i[2]}${i[3]}${i[3]}`:(console.error(Error(`couleur ${i} invalide, on va tronquer ou compléter avec des 0`)),t(i.substring(1))):/^0x/.test(i)?t(i.substring(2)):/^[0-9]/.test(i)?t(parseFloat(i).toString(16)):i}function Qe(i,e){const t=i.norme(),s=e.norme();return mt(t)||mt(s)?!0:mt((i.x*e.y-i.y*e.x)/t/s)}const xe=(i,e)=>Qe(i,e)&&i.x*e.x+i.y*e.y>=0;function K(i,e,t){let s,n,r=0,o=e;for(;o<i.length;){if(s=i.charAt(o),s==="("){if(n=$(i,o),n===-1)return-1;o=n}else if(s===","&&r++,r===t)return o;o++}return-1}function Jt(i,e,t){let s;return e*i<0?s=-Math.floor(-i/t)*t:Math.ceil(Math.log(Math.abs(i))/Math.LN10)!==Math.ceil(Math.log(Math.abs(e))/Math.LN10)?(i<0?s=-Math.pow(10,Math.floor(Math.log(Math.abs(i))/Math.LN10)):s=Math.pow(10,Math.ceil(Math.log(Math.abs(i))/Math.LN10)),s=s-Math.floor((s-i)/t)*t):(s=Ye(i,Math.floor(Math.log(t)/Math.LN10)),s<i&&(s+=t)),s}function B(i,e,t,s,n){if(i==="")return;let r,o,c,a,d,p,b,u,g;const f=i.search(/<b>|<i>|<u>|<font/),h=document.createElementNS(l,"tspan");if(h.setAttribute("pointer-events","none"),f===-1||f>0){r="",e.couleur&&(r+="fill:"+e.couleur+";"),e.bold&&(r+="font-weight:bold;"),e.italic&&(r+="font-style:italic;"),e.underline&&(r+="text-decoration:underline;"),e.fontface!==""?r+="font-family:"+e.fontface+";":r+='font-family: "Times New Roman", Times, serif;',r+="font-size:"+e.taille+"px;",h.setAttribute("style",r),s&&(h.setAttribute("x",0),s=!1),h.setAttribute("y",n);const w=f===-1?i:i.substring(0,f);h.appendChild(document.createTextNode(w)),t.appendChild(h),f>0&&B(i.substring(f),e,t,s,n)}else i.indexOf("<b>")===0?(g=new ft(!0,e.italic,e.underline,e.couleur,e.fontface),o=q(i),B(o===-1?i.substring(3):i.substring(3,o-4),g,t,s,n)):i.indexOf("<i>")===0?(g=new ft(e.bold,!0,e.underline,e.couleur,e.fontface),o=q(i),B(o===-1?i.substring(3):i.substring(3,o-4),g,t,s,n)):i.indexOf("<u>")===0?(g=new ft(e.bold,e.italic,!0,e.couleur,e.fontface),o=q(i),B(o===-1?i.substring(3):i.substring(3,o-4),g,t,s,n)):i.indexOf("<font")===0&&(o=q(i),o===-1&&(o=i.length),c=i.indexOf('face="'),c!==-1?(a=i.indexOf('"',c+6),a!==-1?d=i.substring(c+6,a):d=""):d="",p="",c=i.indexOf('couleur="'),c!==-1?(a=i.indexOf('"',c+9),a!==-1&&(p=Y(i.substring(c+9,a)))):(c=i.indexOf('color="'),c!==-1&&(a=i.indexOf('"',c+7),a!==-1&&(p=Y(i.substring(c+7,a))))),c=i.indexOf('size="'),c!==-1&&(a=i.indexOf('"',c+6),a!==-1?b=i.substring(c+6,a):b=e.taille),g=new ft(e.bold,e.italic,e.underline,p,d,b),u=i.indexOf(">"),/<\/font>/i.test(i)?B(i.substring(u+1,o-7),g,t,s,n):B(i.substring(u+1),g,t,s,n))}function Te(i){if(["a","c","d","f","g","n","p","r","s","u","v"].some(r=>i.includes(`£${r}(`)))return!0;let e,t,s,n=i;for(;(e=n.search(/£e\(|£i\(/g))!==-1;){if(t=$(n,e+3),t===-1&&(t=n.length),s=n.substring(e,t),s.search(/£e\(|£i\(£lt£font/g)!==-1)return!0;if(t===n.length)return!1;n=s.substring(t+1)}for(n=i;(e=n.search(/£lt£font/g))!==-1;){if(t=q(n.substring(e)),t===-1?t=n.length:t+=e,s=n.substring(e,t),s.search(/£e\(|£i\(/g)!==-1)return!0;if(t===n.length)return!1;n=s.substring(t+1)}return!1}function m(i,e){let t,s,n,r,o,c,a,d,p,b,u,g,f;const h=i;if(h==="")return"";for(;(t=h.indexOf("<font"))!==-1;)return d=null,a=h.substring(t),s=q(a),r=a.indexOf('couleur="'),r!==-1?(o=a.indexOf('"',r+9),o!==-1&&(d=Y(a.substring(r+9,o)))):(r=a.indexOf('color="'),r!==-1&&(o=a.indexOf('"',r+7),o!==-1&&(d=Y(a.substring(r+7,o))))),d!=null?(c=t+a.indexOf(">")+1,s===-1?m(h.substring(0,t)+"\\textcolor{"+d+"}{"+h.substring(c)+"}",e):(s+=t,m(h.substring(0,t)+"\\textcolor{"+d+"}{"+h.substring(c,s-7)+"}"+h.substring(s),e))):(c=t+a.indexOf(">")+1,s===-1?m(h.substring(0,t)+h.substring(c),e):(s+=t,m(h.substring(0,t)+h.substring(c,s-7)+h.substring(s),e)));for(;(t=h.indexOf("£u("))!==-1;)return s=$(h,t+2),s===-1?h:m(h.substring(0,t),e)+"\\unicode{x"+h.substring(t+3,s)+"}"+m(h.substring(s+1),e);for(;(t=h.indexOf("£f("))!==-1;)return n=K(h,t+3,1),s=$(h,t+2),n===-1||s===-1||n>s?h:m(m(h.substring(0,t),e)+"\\displaystyle{\\frac{"+m(h.substring(t+3,n),!1)+"}{"+m(h.substring(n+1,s),!1)+"}}"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£r("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\sqrt{"+m(h.substring(t+3,s),!1)+"}"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£a("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\widehat{"+m(h.substring(t+3,s),!0)+"}"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£g("))!==-1;)return b=K(h,t+3,1),u=K(h,t+3,2),g=K(h,t+3,3),s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\int_{"+m(h.substring(u+1,g),!1)+"}^{"+m(h.substring(g+1,s),!1)+"}"+m(h.substring(t+3,b),!1)+" d"+m(h.substring(b+1,u),!1)+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£c("))!==-1;)return s=$(h,t+2),s===-1?h:m(h.substring(0,t),e)+"\\left["+m(h.substring(t+3,s),e)+"\\right]"+m(h.substring(s+1),e);for(;(t=h.indexOf("£p("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\left("+m(h.substring(t+3,s),e)+"\\right)"+m(h.substring(s+1),e));for(;(t=h.indexOf("£d("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\left|"+m(h.substring(t+3,s),!1)+"\\right|"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£n("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\left\\|"+m(h.substring(t+3,s),!1)+"\\right\\|"+m(h.substring(s+1),e));for(;(t=h.indexOf("£i("))!==-1;)return n=K(h,t+3,1),s=$(h,t+2),n===-1||s===-1||n>s?h:m(m(h.substring(0,t),e)+"{"+m(h.substring(t+3,n),!1)+"}_{"+m(h.substring(n+1,s),!1)+"}"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("£e("))!==-1;)return n=K(h,t+3,1),s=$(h,t+2),n===-1||s===-1||n>s?h:m(m(h.substring(0,t),e)+"{"+m(h.substring(t+3,n),!1)+"}^{"+m(h.substring(n+1,s),!1)+"}"+m(h.substring(s+1),e));for(;(t=h.indexOf("£v("))!==-1;)return s=$(h,t+2),s===-1?h:m(m(h.substring(0,t),e)+"\\overrightarrow{"+m(h.substring(t+3,s),!1)+"}"+m(h.substring(s+1),e),e);for(;(t=h.indexOf("<u>"))!==-1;)return s=q(h.substring(t)),s===-1?h:(s+=t,m(h.substring(0,t),e)+"\\underline{"+m(h.substring(t+3,s-4),!0)+"}"+m(h.substring(s),e));for(;(t=h.indexOf("<i>"))!==-1;)return s=q(h.substring(t)),s===-1?m(h.substring(0,t),e)+"\\textit{"+m(h.substring(t+3),!1)+"}":(s+=t,m(h.substring(0,t),e)+"\\textit{"+m(h.substring(t+3,s-4),!1)+"}"+m(h.substring(s),e));for(;(t=h.indexOf("<b>"))!==-1;)return s=q(h.substring(t)),s===-1?m(h.substring(0,t),e)+"\\textbf{"+m(h.substring(t+3),!1)+"}":(s+=t,m(h.substring(0,t),e)+"\\textbf{"+m(h.substring(t+3,s-4),!1)+"}"+m(h.substring(s),e));if(e){if(f=h.charAt(0),f===")"||f===","||f==="}")return f+m(h.substring(1),e);if(ze(h))return h;if(t=h.indexOf("\\textcolor{"),t!==-1){for(p="",a=h;(t=a.indexOf("\\textcolor{"))!==-1;)r=a.indexOf("}{"),s=Ve(a,r+1),s===-1?t===0?(r+2!==a.length?p+=a.substring(0,r+2)+"\\text{"+a.substring(r+2)+"}":p+=a,a=""):(r+2!==a.length?p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2)+"\\text{"+a.substring(r+2)+"}":p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2),a=""):t===0?(p+=a.substring(0,s+1),s<a.length-1?a=a.substring(s+1):a=""):(p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2)+"\\text{"+a.substring(r+2,s+1)+"}",s<a.length-1?a=a.substring(s+1):a="");return a===""?p:p+"\\text{"+a+"}"}else{let w=0,y=0;for(;h.charAt(y)===" ";)w++,y++;return"~".repeat(w)+"\\text{"+h.substring(y)+"}"}}else return h}function v(i,e){let t,s,n,r,o,c,a,d,p,b,u=i;if(u==="")return"";for(;(t=u.indexOf("<font"))!==-1;)return d=null,a=u.substring(t),s=q(a),r=a.indexOf('couleur="'),r!==-1?(o=a.indexOf('"',r+9),o!==-1&&(d=Y(a.substring(r+9,o)))):(r=a.indexOf('color="'),r!==-1&&(o=a.indexOf('"',r+7),o!==-1&&(d=Y(a.substring(r+7,o))))),d!==null?(c=t+a.indexOf(">")+1,s===-1?v(u.substring(0,t)+"\\textcolor{"+d+"}{"+u.substring(c)+"}",e):(s+=t,v(u.substring(0,t)+"\\textcolor{"+d+"}{"+u.substring(c,s-7)+"}"+u.substring(s),e))):(c=t+a.indexOf(">")+1,s===-1?v(u.substring(0,t)+u.substring(c),e):(s+=t,v(u.substring(0,t)+u.substring(c,s-7)+u.substring(s),e)));for(;(t=u.indexOf("£u("))!==-1;)return s=$(u,t+2),s===-1?u:v(u.substring(0,t),e)+"\\unicode{x"+u.substring(t+3,s)+"}"+v(u.substring(s+1),e);for(;(t=u.indexOf("£r("))!==-1;)return s=$(u,t+2),s===-1?u:v(v(u.substring(0,t),e)+"\\sqrt{"+v(u.substring(t+3,s),!1)+"}"+v(u.substring(s+1),e),e);for(;(t=u.indexOf("£d("))!==-1;)return s=$(u,t+2),s===-1?u:v(v(u.substring(0,t),e)+"\\left|"+v(u.substring(t+3,s),!1)+"\\right|"+v(u.substring(s+1),e),e);for(;(t=u.indexOf("£n("))!==-1;)return s=$(u,t+2),s===-1?u:v(v(u.substring(0,t),e)+"\\left\\|"+v(u.substring(t+3,s),!1)+"\\right\\|"+v(u.substring(s+1),e));for(;(t=u.indexOf("£i("))!==-1;)return n=K(u,t+3,1),s=$(u,t+2),n===-1||s===-1||n>s?u:v(v(u.substring(0,t),e)+"{"+v(u.substring(t+3,n),!0)+"}_{"+v(u.substring(n+1,s),!1)+"}"+v(u.substring(s+1),e),e);for(;(t=u.indexOf("£e("))!==-1;)return n=K(u,t+3,1),s=$(u,t+2),n===-1||s===-1||n>s?u:v(v(u.substring(0,t),e)+"{"+v(u.substring(t+3,n),!0)+"}^{"+v(u.substring(n+1,s),!1)+"}"+v(u.substring(s+1),e));for(;(t=u.indexOf("£v("))!==-1;)return s=$(u,t+2),s===-1?u:v(v(u.substring(0,t),e)+"\\overrightarrow{"+v(u.substring(t+3,s),!1)+"}"+v(u.substring(s+1),e),e);for(;(t=u.indexOf("<u>"))!==-1;)return s=q(u.substring(t)),s===-1?u:(s+=t,v(u.substring(0,t),e)+"\\underline{"+v(u.substring(t+3,s-4),!0)+"}"+v(u.substring(s),e));for(;(t=u.indexOf("<i>"))!==-1;)return s=q(u.substring(t)),s===-1?v(u.substring(0,t),e)+"\\textit{"+v(u.substring(t+3),!1)+"}":(s+=t,v(u.substring(0,t),e)+"\\textit{"+v(u.substring(t+3,s-4),!1)+"}"+v(u.substring(s),e));for(;(t=u.indexOf("<b>"))!==-1;)return s=q(u.substring(t)),s===-1?v(u.substring(0,t),e)+"\\textbf{"+v(u.substring(t+3),!1)+"}":(s+=t,v(u.substring(0,t),e)+"\\textbf{"+v(u.substring(t+3,s-4),!1)+"}"+v(u.substring(s),e));if(e){if(ze(u))return u;if(t=u.indexOf("\\textcolor{"),t!==-1){for(p="",a=u;(t=a.indexOf("\\textcolor{"))!==-1;)r=a.indexOf("}{"),s=Ve(a,r+1),s===-1?t===0?(r+2!==a.length?p+=a.substring(0,r+2)+"\\text{"+a.substring(r+2)+"}":p+=a,a=""):(r+2!==a.length?p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2)+"\\text{"+a.substring(r+2)+"}":p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2),a=""):t===0?(p+=a.substring(0,s+1),s<a.length-1?a=a.substring(s+1):a=""):(p+="\\text{"+a.substring(0,t)+"}"+a.substring(t,r+2)+"\\text{"+a.substring(r+2,s+1)+"}",s<a.length-1?a=a.substring(s+1):a="");return a===""?p:p+"\\text{"+a+"}"}else{if(b=u.charAt(0),b===")"||b===","||b==="}")return u;{let g="";for(;u.indexOf(" ")===0;)g+="~",u=u.substring(1);return g+"\\text{"+u+"}"}}}else return u}function at(i,e={}){if(!i||typeof i!="object")throw Error("objet invalide");const t=e.defaut||20,s=e.min||5,n=e.max||199;if(typeof t!="number"||typeof s!="number"||typeof n!="number")throw Error("options invalides");const r=Number(i.taille);return isNaN(r)?(console.error(Error(`taille invalide (${i.taille}) => ${t}`)),t):r<s?(console.error(Error(`taille trop petite (${i.taille} < ${s}) => ${t}`)),t):r>n?(console.error(Error(`taille trop grande (${i.taille} > ${n}) => ${t}`)),t):r}function P(i,e,t,s){arguments.length>2?(this.x=t-i,this.y=s-e):(this.x=i,this.y=e)}P.prototype.presqueNul=function(){return mt(this.x)&&mt(this.y)};P.prototype.norme=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};P.prototype.vecteurColineaire=function(i){const e=this.norme();return new P(this.x/e*i,this.y/e*i)};P.prototype.tourne=function(i){const e=Math.cos(i*D),t=Math.sin(i*D);return new P(e*this.x-t*this.y,e*this.y+t*this.x)};P.prototype.angle=function(){let i;return this.x===0&&this.y===0?0:(this.x===0?this.y>0?i=3*Math.PI/2:i=Math.PI/2:(this.x>=0?i=Math.atan(-this.y/this.x):i=Math.PI-Math.atan(this.y/this.x),i<0&&(i=i+2*Math.PI)),i*He)};function C(i){this.doc=i,this.x=200,this.y=400,this.angle=0,this.zoomfactor=1,this.visible=!1}C.prototype.montre=function(i){this.visible=i,this.g.setAttribute("visibility",i?"visible":"hidden")};C.prototype.updateg=function(){this.initialisePosition(),this.doc.svg.removeChild(this.g),this.doc.svg.appendChild(this.g)};C.prototype.translate=function(i,e){this.setPosition(i,e,this.angle,this.zoomfactor)};C.prototype.angleInit=function(){return 0};C.prototype.setPosition=function(i,e,t,s){let n;this.x=i,this.y=e,this.angle=t,arguments.length>=4?(n=s,this.zoomfactor=n):n=this.zoomfactor,this.g.setAttribute("transform","scale("+n+") translate("+String(i/n)+","+String(e/n)+") rotate("+t+")")};C.prototype.initialisePosition=function(){this.setPosition(200,400,this.angleInit(),1)};C.prototype.lanceAnimationTranslation=function(i,e,t){this.xfin=i,this.yfin=e,this.pix=Math.abs(t/2);const s=new P(this.x,this.y,i,e);if(this.dist=s.norme(),this.dist===0){this.doc.actionSuivante();return}this.vect=s.vecteurColineaire(this.pix);const n=this;this.timer=setInterval(function(){n.actionPourTranslation()},25)};C.prototype.actionPourTranslation=function(){const i=this.x+this.vect.x,e=this.y+this.vect.y,s=new P(i,e,this.xfin,this.yfin).norme();s>this.dist||!this.doc.animationEnCours?(this.setPosition(this.xfin,this.yfin,this.angle),this===this.doc.compas&&this.doc.compasLeve!=null&&this.doc.compasLeve.visible&&this.doc.compasLeve.setPosition(this.xfin,this.yfin,this.angle),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=s,this.setPosition(i,e,this.angle),this===this.doc.compas&&this.doc.compasLeve!=null&&this.doc.compasLeve.visible&&this.doc.compasLeve.setPosition(i,e,this.angle))};C.prototype.lanceAnimationRotation=function(i,e){const t=Et(this.angle);let s=Et(i);Math.abs(s-t)>180&&(s>t?s=s-360:s=s+360),this.anglefin=s,this.angle=t,this.pasdeg=e/3,this.pasdeg*=s>=t?1:-1,this.distang=Math.abs(s-this.angle);const n=this;this.timer=setInterval(function(){n.actionPourRotation()},25)};C.prototype.actionPourRotation=function(){const i=parseFloat(this.angle)+parseFloat(this.pasdeg),e=Math.abs(i-this.anglefin);e>this.distang||!this.doc.animationEnCours?(this.setPosition(this.x,this.y,this.anglefin),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=e,this.setPosition(this.x,this.y,i))};C.prototype.lanceAnimationZoom=function(i,e){this.zoomfin=i,this.vitesse=parseInt(e),this.pas=this.vitesse*.05*(this.zoomfin-this.zoomfactor),this.senspos=this.pas>=0;const t=this;this.timer=setInterval(function(){t.actionPourZoom()},100)};C.prototype.actionPourZoom=function(){const i=this.zoomfactor+this.pas;this.doc.animationEnCours&&(this.senspos&&i<this.zoomfin||!this.senspos&&i>this.zoomfin)?this.setPosition(this.x,this.y,this.angle,i):(this.zoomfactor=this.zoomfin,this.positionne(),clearInterval(this.timer),this.doc.actionSuivante())};C.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};function J(i){C.call(this,i),this.ecart=0,this.bretourne=!1,this.leve=!1,this.lon=185,this.longpointe=18;const e=this.lon+this.longpointe;this.alp=Math.asin(this.ecart/(2*e))/Math.PI*180,this.decbh=30,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle,1),i.svg.appendChild(this.g)}J.prototype=new C;J.prototype.initialisePosition=function(){C.prototype.initialisePosition.call(this),this.ecart=0,this.positionne()};J.prototype.creeg=function(){let i,e,t,s;const n=this.lon,r=this.longpointe,o=7,c=20,a=6,d=3.5,p=3,b=12,u=35,g=6,f=50,h=3,w=document.createElementNS(l,"g");this.bg=document.createElementNS(l,"g"),i=document.createElementNS(l,"line"),i.setAttribute("x1",0),i.setAttribute("y1",0),i.setAttribute("x2",0),i.setAttribute("y2",-r),i.setAttribute("style","stroke: black; stroke-width:1.5;"),this.bg.appendChild(i),e=document.createElementNS(l,"path"),t="M0 "+String(-r)+"L 0 "+String(-r-n)+" "+String(-o)+" "+String(-r-n)+" "+String(-o)+" "+String(-r)+"Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bg.appendChild(e),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o/2),s.setAttribute("cy",-r-c),s.setAttribute("r",a),s.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bg.appendChild(s),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o/2),s.setAttribute("cy",-r-c),s.setAttribute("r",2),s.setAttribute("style","stroke:black;stroke-width:1; fill: silver; fill-opacity: 1"),this.bg.appendChild(s),w.appendChild(this.bg),this.bd=document.createElementNS(l,"g"),e=document.createElementNS(l,"path"),t="M 0 0 L0 "+String(-r)+" "+d+" "+String(-r-d)+" "+d+" "+String(-d-3)+"Z",e.setAttribute("style","stroke:black;stroke-width:0.75; fill: blck; fill-opacity: 1"),e.setAttribute("d",t),this.bd.appendChild(e),e=document.createElementNS(l,"path"),t="M0 "+String(-r)+"L 0 "+String(-r-n)+" "+o+" "+String(-r-n)+" "+o+" "+String(-r)+"Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bd.appendChild(e),e=document.createElementNS(l,"path");const y=a/4*3,S=a/2;t="M"+o+" "+String(-r-c+y)+"A "+y+" "+S+" -90 0 0 "+o+" "+String(-r-c-y)+"Z",e.setAttribute("style","stroke:black;stroke-width:1; fill: silver; fill-opacity: 1"),e.setAttribute("d",t),this.bd.appendChild(e);const j="stroke: black; stroke-width:1;";i=document.createElementNS(l,"line"),i.setAttribute("x1",0),i.setAttribute("y1",-100),i.setAttribute("x2",o),i.setAttribute("y2",-100+o),i.setAttribute("style",j),this.bd.appendChild(i),i=document.createElementNS(l,"line"),i.setAttribute("x1",0),i.setAttribute("y1",-50),i.setAttribute("x2",o),i.setAttribute("y2",-50),i.setAttribute("style",j),this.bd.appendChild(i),i=document.createElementNS(l,"line"),i.setAttribute("x1",o/2),i.setAttribute("y1",-50),i.setAttribute("x2",o/2),i.setAttribute("y2",-73),i.setAttribute("style",j),this.bd.appendChild(i);const M=document.createElementNS(l,"rect");M.setAttribute("x",o),M.setAttribute("y",-68),M.setAttribute("width",4),M.setAttribute("height",12),M.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bd.appendChild(M),w.appendChild(this.bd),this.haut=document.createElementNS(l,"g"),e=document.createElementNS(l,"path"),t="M 0 0 L"+p+" 0 "+b+" "+String(-24)+" "+b+" "+String(-u)+"A"+String(f-u)+" "+String(b-g)+" -90 0 1 "+g+" "+String(-f)+"L"+h+" "+String(-70)+" "+String(-h)+" "+String(-70)+"L"+String(-g)+" "+String(-f)+"A"+String(f-u)+" "+String(b-g)+" 90 0 1 "+String(-b)+" "+String(-u)+" L "+String(-b)+" "+String(-24)+" "+String(-p)+" 0Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),this.haut.appendChild(e),i=document.createElementNS(l,"line"),i.setAttribute("x1",g),i.setAttribute("y1",-f),i.setAttribute("x2",-g),i.setAttribute("y2",-f),i.setAttribute("style","stroke: black; stroke-width:1;"),this.haut.appendChild(i);const I=document.createElementNS(l,"text");I.setAttribute("pointer-events","none"),I.appendChild(document.createTextNode("Sésamath")),I.setAttribute("x",0),I.setAttribute("y",0),I.setAttribute("style","font-family: Arial;font-size: 5pt;fill: white"),I.setAttribute("transform","rotate(-90) translate(4,2.5)"),this.haut.appendChild(I),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o+1),s.setAttribute("cy",-this.decbh),s.setAttribute("r",3),s.setAttribute("style","stroke:black;stroke-width:1; fill: white; fill-opacity: 1"),this.haut.appendChild(s),s=document.createElementNS(l,"circle"),s.setAttribute("cx",o-1),s.setAttribute("cy",-this.decbh),s.setAttribute("r",3),s.setAttribute("style","stroke:black;stroke-width:1; fill: white; fill-opacity: 1"),this.haut.appendChild(s),w.appendChild(this.haut),this.g=w};J.prototype.setPosition=function(i,e,t,s){let n;arguments.length>=4?(n=s,this.zoomfactor=n):n=this.zoomfactor,this.x=i,this.y=e,this.angle=t;const r=this.lon+this.longpointe;let o=this.ecart/(2*r*n);if(o>1&&(o=1),this.alp=Math.asin(o)/Math.PI*180,isNaN(this.alp))console.error(Error("dans compas.setPosition on a alp qui est NaN")),this.doc.debug&&console.debug(`avec x=${i}, y=${e}, angle=${t} et zoom=${n} on a d=${r} et ecart=${this.ecart} asin(${this.ecart}/${2*r*n}/π*180) donne NaN`);else{this.bg.setAttribute("transform",`rotate(${this.alp})`),this.bd.setAttribute("transform",`translate(${this.ecart/n}, 0) rotate(${-this.alp})`);const c=this.alp/180*Math.PI,a=this.ecart/2/n,d=-r*Math.cos(c)+this.decbh;this.haut.setAttribute("transform",`translate(${a},${d})`);const p=this.bretourne?`scale(${n},${-n})`:`scale(${n})`;this.g.setAttribute("transform",`${p} translate(${i/n},${e/n}) rotate(${t})`)}};J.prototype.retourne=function(){this.bretourne=!this.bretourne,this.setPosition(this.x,this.y,this.angle)};J.prototype.positionne=function(){C.prototype.positionne.call(this),this.leve&&this.doc.compasLeve!=null&&C.prototype.positionne.call(this.doc.compasLeve)};J.prototype.translate=function(i,e){C.prototype.translate.call(this,i,e),this.leve&&this.doc.compasLeve!=null&&C.prototype.translate.call(this.doc.compasLeve,i,e)};J.prototype.lanceAnimationEcartement=function(i,e){this.ecartfin=parseFloat(i),this.pasecart=e/4,this.pasecart*=i>=this.ecart?1:-1,this.distecart=Math.abs(i-this.ecart);const t=this;this.timer=setInterval(function(){t.actionPourEcartement()},25)};J.prototype.actionPourEcartement=function(){const i=this.ecart+this.pasecart,e=Math.abs(i-this.ecartfin);e>this.distecart||!this.doc.animationEnCours?(this.ecart=this.ecartfin,this.setPosition(this.x,this.y,this.angle),clearInterval(this.timer),this.doc.actionSuivante()):(this.distecart=e,this.ecart=i,this.setPosition(this.x,this.y,this.angle))};function Wt(i){C.call(this,i),this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),i.svg.appendChild(this.g)}Wt.prototype=new C;Wt.prototype.creeg=function(){let i,e;const o=103.83969465648855,c=16,a=131/223*(223-c),d=document.createElementNS(l,"g");i=document.createElementNS(l,"path"),e="M 0 0 L 131 0 L 0 "+String(-223)+" Z";const p="M 24 "+String(-31)+" L 24 "+String(-31-o)+" L "+String(85)+" "+String(-31)+" Z";e+=p,i.setAttribute("d",e),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: #c6cbe8; fill-opacity: 0.5"),d.appendChild(i),i=document.createElementNS(l,"path"),e="M "+c+" "+String(-c)+" L "+a+" "+String(-c)+" L "+c+" "+-195.76335877862596+" Z",e+=p,i.setAttribute("d",e),i.setAttribute("style","stroke-width:0; fill: #c6cbe8; fill-opacity: 0.5"),d.appendChild(i);const b=document.createElementNS(l,"text");b.setAttribute("pointer-events","none"),b.appendChild(document.createTextNode("Sésamath")),b.setAttribute("x",24),b.setAttribute("y",-c/2-5),b.setAttribute("style","font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon"),d.appendChild(b),this.g=d};function yt(i){C.call(this,i),this.graduationExterneVisible=!0,this.graduationInterneVisible=!0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),i.svg.appendChild(this.g)}yt.prototype=new C;yt.prototype.creeg=function(){let i,e,t,s,n;const d=String(156),p=89,b=String(p),u="116",g="7",f=document.createElementNS(l,"g");for(e=document.createElementNS(l,"path"),i="M "+d+" 0 A "+d+" "+d+" 0 0 0 -"+d+" 0 L -"+d+" 13 L "+d+" 13 L "+d+" 0",i+="M 0 0 L -"+b+" 0 A "+b+" "+b+" 0 0 1 "+b+" 0 Z",e.setAttribute("d",i),e.setAttribute("style","stroke:#999999;stroke-width:1; fill: #c6cbe8; fill-opacity: 0.5"),f.appendChild(e),e=document.createElementNS(l,"path"),i="M "+g+" 0 A "+g+" "+g+" 0 0 0 -"+g+" 0 M 0 0 L 0 -"+g,e.setAttribute("d",i),e.setAttribute("style","stroke: #666666;stroke-width:1; fill: none"),f.appendChild(e),s=0;s<=180;s++)t=document.createElementNS(l,"line"),t.setAttribute("x1",d),t.setAttribute("y1",0),t.setAttribute("x2",s%10===0?136:s%5===0?146:151),t.setAttribute("y2",0),t.setAttribute("transform","rotate(-"+s+")"),t.setAttribute("style","stroke: #333333;stroke-width:0.7;"),f.appendChild(t);for(this.gradext=document.createElementNS(l,"g"),s=0;s<=180;s++)s%10===0&&(n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode(s)),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("style","font-family: arial;font-size: 10px;text-anchor: middle; fill: black"),n.setAttribute("transform"," scale(-1) rotate("+String(-s-90)+") translate(0,"+String(-124)+")"),this.gradext.appendChild(n));f.appendChild(this.gradext);const h=120;for(e=document.createElementNS(l,"path"),i="M "+String(h)+" 0 L "+u+" 0 A "+u+" "+u+" 0 0 0 -"+u+" 0 L "+String(-h)+" 0",e.setAttribute("d",i),e.setAttribute("style","stroke: #666666;stroke-width:1; fill: none"),f.appendChild(e),s=0;s<=18;s++)t=document.createElementNS(l,"line"),t.setAttribute("x1",p),t.setAttribute("y1",0),t.setAttribute("x2",p+10),t.setAttribute("y2",0),t.setAttribute("transform","rotate(-"+String(10*s)+")"),t.setAttribute("style","stroke: #333333;stroke-width:0.7;"),f.appendChild(t);for(this.gradint=document.createElementNS(l,"g"),s=0;s<=18;s++)n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode(180-10*s)),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("style","font-family: arial;font-size: 9px;text-anchor: middle; fill: black"),n.setAttribute("transform","scale(-1) rotate("+String(-10*s-90)+") translate(0,"+String(-p-14)+")"),this.gradint.appendChild(n);f.appendChild(this.gradint);const w=document.createElementNS(l,"circle");w.setAttribute("cx",0),w.setAttribute("cy",0),w.setAttribute("r",2),w.setAttribute("style","stroke: black; stroke-width: 1;fill: none"),f.appendChild(w),n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode("Sésamath")),n.setAttribute("x",0),n.setAttribute("y","13"-2),n.setAttribute("style","font-family: sans-serif;font-size: 7pt;font-weight:bold;text-anchor: middle; fill: maroon"),f.appendChild(n),this.g=f};yt.prototype.montreGraduations=function(i){this.graduationInterneVisible=!0,this.visible&&this.gradint.setAttribute("visibility",i?"visible":"hidden")};yt.prototype.montreGraduationsExternes=function(i){this.graduationExterneVisible=!0,this.visible&&this.gradext.setAttribute("visibility",i?"visible":"hidden")};yt.prototype.montre=function(i){C.prototype.montre.call(this,i),i?(this.gradint.setAttribute("visibility",this.graduationInterneVisible?"visible":"hidden"),this.gradext.setAttribute("visibility",this.graduationExterneVisible?"visible":"hidden")):(this.gradint.setAttribute("visibility","hidden"),this.gradext.setAttribute("visibility","hidden"))};function At(i){C.call(this,i),this.x=100,this.y=400,this.angle=0,this.longueur=15,this.graduationVisible=!0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),i.svg.appendChild(this.g)}At.prototype=new C;At.prototype.creeg=function(){let i,e;const s=this.longueur*30+15,r=String(57),o=6,c=String(o),a=document.createElementNS(l,"g"),d=document.createElementNS(l,"rect");d.setAttribute("x",-c-1),d.setAttribute("y",0),d.setAttribute("width",String(s+o+1)),d.setAttribute("height",r),d.setAttribute("rx",c),d.setAttribute("ry",c),d.setAttribute("style","stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5;"),a.appendChild(d);const p=document.createElementNS(l,"line");p.setAttribute("x1",-c),p.setAttribute("y1",27),p.setAttribute("x2",s),p.setAttribute("y2",27),p.setAttribute("style","stroke:#999999;stroke-width:2;"),a.appendChild(p),this.graduations=document.createElementNS(l,"g");for(let b=0;b<=this.longueur*10;b++){i=document.createElementNS(l,"line");const u=3*b;i.setAttribute("x1",u),i.setAttribute("y1",0),i.setAttribute("x2",u),i.setAttribute("y2",b%10===0?12:b%5===0?9:6),b%10===0&&(e=document.createElementNS(l,"text"),e.setAttribute("pointer-events","none"),e.appendChild(document.createTextNode(String(b/10))),e.setAttribute("x",u),e.setAttribute("y",21),e.setAttribute("style","font-family: monospace;font-size: 9pt;text-anchor:middle"),this.graduations.appendChild(e)),i.setAttribute("style","stroke:black;stroke-width:0.7;"),this.graduations.appendChild(i)}e=document.createElementNS(l,"text"),e.setAttribute("pointer-events","none"),e.appendChild(document.createTextNode("Sésamath")),e.setAttribute("x",s/2-o-3),e.setAttribute("y",r-5),e.setAttribute("style","font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon;text-anchor:middle;"),a.appendChild(e),a.appendChild(this.graduations),this.g=a};At.prototype.montreGraduations=function(i){this.graduationVisible=i,this.graduations.setAttribute("visibility",this.visible&&i?"visible":"hidden")};At.prototype.montre=function(i){C.prototype.montre.call(this,i),i?this.graduations.setAttribute("visibility",this.graduationVisible?"visble":"hidden"):this.graduations.setAttribute("visibility","hidden")};At.prototype.initialisePosition=function(){if(this.longueur!==15){this.longueur=15;const i=this.visible,e=this.g;this.creeg(),this.g.setAttribute("visibility",i?"visible":"hidden"),this.doc.svg.replaceChild(this.g,e)}C.prototype.initialisePosition.call(this)};function xt(i){C.call(this,i),this.x=200,this.y=400,this.angle=0,this.zoomfactor=1,this.abscisse=0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),i.svg.appendChild(this.g)}xt.prototype=new C;xt.prototype.creeg=function(){let i,e;const p="stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5",b=document.createElementNS(l,"g");i=document.createElementNS(l,"path"),e="M 0 0 L "+String(167)+" 0 A 5 5 0 0 1 "+String(172)+" 5 L "+String(172)+" "+String(52)+" A 5 5 90 0 1 "+String(167)+" "+String(57)+" L "+String(-251)+" 57 A 5 5 180 0 1 -256 "+String(52)+" L "+String(-256)+" 5 A 5 5 -90 0 1 "+String(-251)+" 0Z";const u=42,g="M"+String(158)+" "+u+"A 6 6 180 0 0 "+String(146)+" "+String(u)+"A 6 6 180 0 0 "+String(158)+" "+String(u);e+=g,i.setAttribute("d",e),i.setAttribute("style",p),b.appendChild(i),i=document.createElementNS(l,"path"),e="M"+String(172)+" "+String(16)+"L"+String(172)+" "+String(52)+" A 5 5 90 0 1 "+String(167)+" "+String(57)+" L "+String(-251)+" 57 A 5 5 180 0 1 -256 "+String(52)+" L "+String(-256)+" "+String(16)+"Z"+g,i.setAttribute("d",e),i.setAttribute("style",p),b.appendChild(i);const f=document.createElementNS(l,"line");f.setAttribute("x1",0),f.setAttribute("y1",8),f.setAttribute("x2",0),f.setAttribute("y2",0),f.setAttribute("style","stroke: black"),b.appendChild(f);const h={};Wt.prototype.creeg.call(h),this.gequerre=h.g,this.gequerre.setAttribute("transform","scale(0.7)"),b.appendChild(this.gequerre),this.setAbs(this.abscisse),this.g=b};xt.prototype.setAbs=function(i){this.abscisse=i,this.gequerre.setAttribute("transform","translate("+i+",0)")};xt.prototype.lanceAnimationGlissement=function(i,e){this.absfin=i,this.pix=i>=this.abscisse?e/4:-e/4,this.dist=Math.abs(i-this.abscisse);const t=this;this.timer=setInterval(function(){t.actionPourGlissement()},25)};xt.prototype.actionPourGlissement=function(){const i=this.abscisse+this.pix,e=Math.abs(this.absfin-i);e>this.dist||!this.doc.animationEnCours?(this.setAbs(this.absfin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=e,this.setAbs(i))};function Qt(i){C.call(this,i),this.angle=this.angleInit(),this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),i.svg.appendChild(this.g)}Qt.prototype=new C;Qt.prototype.angleInit=function(){return-40};Qt.prototype.creeg=function(){let i,e,t,s,n;const p=document.createElementNS(l,"g");i=document.createElementNS(l,"defs"),s=document.createElementNS(l,"linearGradient"),s.setAttribute("id","gradpointe"),n=document.createElementNS(l,"stop"),n.setAttribute("offset","0%"),n.setAttribute("style","stop-color: #f00000;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","50%"),n.setAttribute("style","stop-color: #eeb444;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-color: #f00000"),s.appendChild(n),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","0%"),s.setAttribute("y2","100%"),i.appendChild(s),p.appendChild(i),i=document.createElementNS(l,"defs"),s=document.createElementNS(l,"linearGradient"),s.setAttribute("id","gradcorps"),n=document.createElementNS(l,"stop"),n.setAttribute("offset","0%"),n.setAttribute("style","stop-color: #810216;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","25%"),n.setAttribute("style","stop-color: #c64f00;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","50%"),n.setAttribute("style","stop-color: #ab4a36"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","75%"),n.setAttribute("style","stop-color: #c64f00;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-colr: #810216;"),s.appendChild(n),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","0%"),s.setAttribute("y2","100%"),i.appendChild(s),p.appendChild(i),e=document.createElementNS(l,"path");const b=4.5/3,u=b*3/4,g="A"+b+" "+u+" -90 0 0 15 "+String(b)+"A"+b+" "+u+" -90 0 1 15 "+String(-b)+"A"+b+" "+u+" -90 0 0 15 "+String(-4.5);t="M 0 0 L15 "+4.5+g+"Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black; stroke-width:0.5; fill: url(#gradpointe); fill-opacity: 1;"),p.appendChild(e),e=document.createElementNS(l,"path"),t="M 0 0 L 3 "+.9+" 3 "+String(-.9)+"Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black; stroke-width:0.5; fill: black; fill-opacity: 1;"),p.appendChild(e),e=document.createElementNS(l,"path"),t="M 15 "+4.5+g+" L 97 "+String(-4.5)+" L 97 "+String(4.5)+"Z",e.setAttribute("d",t),e.setAttribute("style","stroke:black; stroke-width:0.5; fill: url(#gradcorps); fill-opacity: 1;"),p.appendChild(e);const f=document.createElementNS(l,"circle");f.setAttribute("r",4.5),f.setAttribute("cx",97),f.setAttribute("cy",0),f.setAttribute("style","stroke:blue; stroke-width:0.5; fill: blue; fill-opacity: 1;"),p.appendChild(f),this.g=p};function x(i,e){arguments.length!==0&&(this.doc=i,typeof e=="string"&&(e=Number(e)),this.tempo=typeof e=="number"&&e>0&&Number.isFinite(e)?e*100:null,this.isReady=!1)}x.prototype.setReady=function(){this.isReady=!0};x.prototype.creegElement=function(){};x.prototype.actionVisible=function(){return!0};function Mt(i,e){x.call(this,i,e)}Mt.prototype=new x;Mt.prototype.execute=function(i){const e=this.doc.compas,t=this.doc.compasLeve;e.leve&&(t.montre(!1),e.setPosition(t.x,t.y,t.angle)),!i&&e.visible&&e.montre(!0),e.leve=!1,i||this.doc.actionSuivante(i)};Mt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas.compas,this.indice-1)?this.doc.getCompasStatus(this.indice-1)==="leve":!1};function k(i,e,t){this.doc=i,this.id=e,this.couleur=t,this.zoomfactor=1,this.visible=!1,this.objet="trait"}k.prototype.positionne=function(){};k.prototype.initialisePosition=function(){};k.prototype.translate=function(i,e){this.setPosition(i,e,this.angle,this.zoomfactor)};k.prototype.tourne=function(i){this.setPosition(this.x,this.y,i,this.zoomfactor)};k.prototype.zoom=function(i){this.zoomfactor=i,this.setPosition(this.x,this.y,this.angle,i)};k.prototype.montre=function(i){this.visible=i,this.g&&this.g.setAttribute("visibility",i?"visible":"hidden")};k.prototype.lanceAnimationTranslation=function(i,e,t){this.xfin=i,this.yfin=e,this.pix=Math.abs(t/4);const s=new P(this.x,this.y,i,e);if(this.dist=s.norme(),this.dist===0){this.translate(this.xfin,this.yfin),this.doc.actionSuivante();return}this.vect=s.vecteurColineaire(this.pix);const n=this;this.timer=setInterval(function(){n.actionPourTranslation()},25)};k.prototype.actionPourTranslation=function(){const i=this.x+this.vect.x,e=this.y+this.vect.y,s=new P(i,e,this.xfin,this.yfin).norme();s>this.dist||!this.doc.animationEnCours?(this.translate(this.xfin,this.yfin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=s,this.translate(i,e))};k.prototype.lanceAnimationRotation=function(i,e){const t=Et(this.angle);let s=Et(i);Math.abs(s-t)>180&&(s>t?s=s-360:s=s+360),this.anglefin=s,this.angle=t,this.pasdeg=e*2/3,this.pasdeg*=i>=this.angle?1:-1,this.distang=Math.abs(i-this.angle);const n=this;this.timer=setInterval(function(){n.actionPourRotation()},25)};k.prototype.actionPourRotation=function(){const i=parseFloat(this.angle)+parseFloat(this.pasdeg),e=Math.abs(i-this.anglefin);e>this.distang||!this.doc.animationEnCours?(this.tourne(this.anglefin),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=e,this.tourne(i))};k.prototype.lanceAnimationZoom=function(i,e){this.zoomfin=i,this.vitesse=parseInt(e),this.pas=this.vitesse*.05*(this.zoomfin-this.zoomfactor),this.senspos=this.pas>=0;const t=this;this.timer=setInterval(function(){t.actionPourZoom()},100)};k.prototype.actionPourZoom=function(){const i=this.zoomfactor+this.pas;this.doc.animationEnCours&&(this.senspos&&i<this.zoomfin||!this.senspos&&i>this.zoomfin)?this.zoom(i):(this.zoom(this.zoomfin),clearInterval(this.timer),this.doc.actionSuivante())};k.prototype.updateg=function(){const i=this.g;this.creeg(),this.doc.svg.replaceChild(this.g,i),this.doc.setElement(this.id,this),this.g.setAttribute("visibility","visible")};k.prototype.creationAnimee=function(){return!1};k.prototype.finAction=function(){};function W(i,e,t,s){k.call(this,i,e,"black"),this.x=parseFloat(t),this.y=parseFloat(s),this.xinit=this.x,this.yinit=this.y,this.taille=20,this.angle=0,this.texte="",this.objet="texte"}W.prototype=new k;W.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};W.prototype.translate=function(i,e){this.x=i,this.y=e,this.positionne()};W.prototype.updateg=function(i){const e=this.g;if(!e)return console.error("Il faut appeler creeg avant updateg");this.doc.svg.replaceChild(i,e),this.g=i,i.setAttribute("visibility","visible")};W.prototype.creeg=function(){this.g=document.createElementNS(l,"g")};W.prototype.setPosition=function(i,e,t,s){this.x=i,this.y=e,this.angle=t,this.zoomfactor=s;const n=at(this),r=e+n;this.g.setAttribute("transform","scale("+s+") translate("+String(i/s)+","+String(r/s)+") rotate("+t+")")};function _(i,e,t,s,n){x.call(this,i,s),this.id=e;const r=this.doc.getElement(e,t.objet);this.objetRemplace=r===null?null:r,this.objet=t,this.vitesse=arguments.length>=5&&n!=null?Math.abs(parseFloat(n)):8,this.objetRemplace!==null?this.doc.addElement(this.objet):this.doc.pushElement(this.objet)}_.prototype=new x;_.prototype.execute=function(i){this.objet instanceof W&&(this.objet.x=this.objet.xinit,this.objet.y=this.objet.yinit),this.objetRemplace!==null&&this.objetRemplace.montre(!1),this.objet.creationAnimee()&&!i?this.objet.lanceAnimation(this.vitesse):(this.objet.montre(!0),i?this.objet.finAction():this.doc.actionSuivante())};_.prototype.creegElement=function(){const i=this.doc,e=this.objet;e.creeg(),e.positionne(),e.g.setAttribute("visibility","hidden"),i.svg.appendChild(e.g)};_.prototype.actionVisible=function(){return!(this.objet instanceof W)};function Kt(i,e,t,s){x.call(this,i,t),this.ecartement=e,this.ec10=s===null?16:parseFloat(s)}Kt.prototype=new x;Kt.prototype.execute=function(i){i?(this.doc.compas.ecart=this.ecartement,this.doc.compas.positionne()):this.doc.compas.lanceAnimationEcartement(this.ecartement,this.ec10)};Kt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)};function Z(i,e,t,s,n,r,o,c,a,d,p,b,u,g,f,h){x.call(this,i,h),this.txt=this.doc.getElement(e,"texte"),this.id=e,this.couleur=t,this.taille=s==null?"20":s.replace(/O/g,"0"),this.style=r===null?"texte":r,this.couleurFond=o,this.opaciteFond=c==null?"0.6":parseFloat(c)/100,this.couleurCadre=a,d!==null&&a===null&&(this.couleurCadre=t),this.epaisseurCadre=d??(a==null?0:1),this.marge=p==null?0:parseFloat(p),this.margeGauche=b==null?0:parseFloat(b),this.margeDroite=u==null?0:parseFloat(u),this.margeHaut=g==null?0:parseFloat(g),this.margeBas=f==null?0:parseFloat(f),this.texte=n,this.estLatex=this.estAffichageLatex(),this.estLatex||(this.texte=_e($e(this.texte)),this.texte=this.traduitCaracteresGrecs(this.texte),this.texte=this.texte.replace(/\*/g,"×"),Te(n)&&(this.texte="$"+this.traiteMaths(this.texte)+"$",this.estLatex=!0))}Z.prototype=new x;Z.prototype.execute=function(i){if(this.txt!=null){this.angle=0;const e=this.txt;e.couleur=this.couleur,e.taille=this.taille,e.texte=this.texte,e.couleurFond=this.couleurFond,e.couleurCadre=this.couleurCadre,e.epaisseurCadre=this.epaisseurCadre,e.updateg(this.g),e.positionne()}i||this.doc.actionSuivante(i)};Z.prototype.estAffichageLatex=function(){return this.texte.charAt(0)==="$"&&this.texte.charAt(this.texte.length-1)==="$"};Z.prototype.traduitCaracteresGrecs=function(i){if(!i.includes("£"))return i;const e=i.split("£").map((t,s)=>s%2?Xe[t]||`£${t}£`:t).join("");return(i.length-i.replace(/£/g,"").length)%2?(console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${i}`),e.substr(0,e.length-1)):e};Z.prototype.traiteMaths=function(i){let e;const t=i,s=this.style==="texte",n=t.split(/<\/?br *\/?>/gi);if(n.length<=1)return m(i,s);let r="\\begin{array}{l}";for(e=0;e<n.length;e++)e!==0&&(r+="\\\\"),r+=m(n[e],s);return r+="\\end{array}",r};Z.prototype.prepare=function(){let i;if(this.estLatex&&(i=this.texte.replace(/^\$(.*)\$$/,"$1"),i||(console.error(Error("texte latex mais pas enveloppé de $, ignoré"),this.texte),this.estLatex=!1)),this.estLatex){const e=this;Oe(async()=>{const{default:t}=await Promise.resolve().then(()=>De);return{default:t}},void 0).then(({default:t})=>t()).then(()=>{const t=e.doc.getWidth(),s=e.taille,n=e.prelatex()+i;e.ex=s*.45;const r={em:s,ex:e.ex,containerWidth:t,display:!1};return e.doc.debug&&console.debug("On passe à MathJax la string",n),MathJax.tex2svgPromise(n,r)}).then(t=>{e.html=t,e.creegLatex(),e.setReady()}).catch(t=>{console.error(t),alert("Pb Mathjax, impossible d’afficher le LaTeX correctement")})}else this.creeg(),this.setReady()};Z.prototype.prelatex=function(){return"\\color{"+this.couleur+"}"};Z.prototype.creegLatex=function(){try{const i=this.html.firstChild,e=i.cloneNode(!0),t=document.createElementNS(l,"g");t.appendChild(e);const s=parseFloat(i.getAttribute("width"))*this.ex,n=parseFloat(i.getAttribute("height"))*this.ex,r=e.style["vertical-align"],o=(r&&parseFloat(r)||1)*this.ex;e.setAttribute("width",s+"px"),e.setAttribute("height",n+"px"),e.style["vertical-align"]=`${o}px`,e.setAttribute("x","0");const c=at(this);if(e.setAttribute("y",String(-c)),t.setAttribute("visibility","hidden"),this.couleurFond!==null||this.couleurCadre!==null){t.setAttribute("visibility","hidden"),this.doc.svg.appendChild(t),this.rectAff={};const a=parseFloat(this.epaisseurCadre),{x:d,y:p,width:b,height:u}=t.getBBox();this.rectAff.height=u+2*a+4+2*this.marge+this.margeHaut+this.margeBas,this.rectAff.width=b+2*a+2+2*this.marge+this.margeGauche+this.margeDroite,this.rectAff.x=d-a-1-this.marge-this.margeGauche,this.rectAff.y=p-a-1-this.marge-this.margeHaut,t.setAttribute("visibility","visible"),this.doc.svg.removeChild(t),this.creeRectangle(t,this.couleurFond==null?"white":this.couleurFond)}this.g=t}catch(i){console.error("Erreur dans ActionEcrireTexte.creegLatex (on remplace par un <g> vide) :",i),this.g=document.createElementNS(l,"g")}};Z.prototype.creeg=function(){let i,e,t,s,n,r,o,c,a,d,p,b,u,g,f,h,w,y,S=0;const j="<",M="£e(",I="£i(",F=document.createElementNS(l,"g"),E=at(this),O=E+2;let G=0;const z=E*.4;if(this.texte!==""){if(r=document.createElementNS(l,"text"),r.setAttribute("pointer-events","none"),r.setAttribute("x",0),r.setAttribute("y",0),n="text-anchor:left;font-size:"+E+"px;fill:"+this.couleur+";",r.setAttribute("style",n),s=this.texte.replace(/ /g," "),this.texte.indexOf(j)===-1&&this.texte.indexOf(M)===-1&&this.texte.indexOf(I)===-1&&this.texte.indexOf("<br>")===-1)r.appendChild(document.createTextNode(s));else for(f=s.split(/<br>/gi),g=-O,h=0;h<f.length;h++)for(w=!0,t=f[h];t!=="";)if(i=t.indexOf(j),c=t.indexOf(M),a=t.indexOf(I),w&&(g+=O+G),c!==-1&&(g+=z),i===-1&&c===-1&&a===-1){e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),S=0,e.appendChild(document.createTextNode(t)),r.appendChild(e);break}else for(;t.indexOf(j)!==-1||t.indexOf(M)!==-1||t.indexOf(I)!==-1;)if(i=t.indexOf(j),c=t.indexOf(M),a=t.indexOf(I),i===-1?c===-1?d=a:d=a===-1?c:Math.min(a,c):c===-1?d=a===-1?i:Math.min(i,a):a===-1?d=Math.min(i,c):d=Math.min(i,a,c),d>0)e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),S=0,e.appendChild(document.createTextNode(t.substring(0,d))),r.appendChild(e),t=t.substring(d);else if(i===0){const L=new ft(!1,!1,!1,this.couleur,"",E);o=q(t),B(o===-1?t:t.substring(0,o),L,r,w,g),w=!1,o!==-1?t=t.substring(o):t="",S=0}else p=d===c,y=Re(t),e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S+"px"),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),y.erreur?e.appendChild(document.createTextNode(t)):(e.appendChild(document.createTextNode(y.operande)),r.appendChild(e),e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.appendChild(document.createTextNode(y.exposant)),S=z,p?S=-S:G=S,e.setAttribute("dy",S+"px"),b=E*.6,u="font-size:"+b+"px;",e.setAttribute("style",u),r.appendChild(e),S=-S),t=y.texte;F.appendChild(r)}if(F.setAttribute("visibility","hidden"),this.couleurFond!=null||this.couleurCadre!=null){F.setAttribute("visibility","hidden"),this.doc.svg.appendChild(F),this.rectAff={};const L=parseFloat(this.epaisseurCadre);this.rectAff.height=F.getBBox().height+2*L+3+2*this.marge+this.margeHaut+this.margeBas,this.rectAff.width=F.getBBox().width+2*L+2+2*this.marge+this.margeGauche+this.margeDroite,this.rectAff.x=F.getBBox().x-L-1-this.marge-this.margeGauche,this.rectAff.y=F.getBBox().y-L-1-this.marge-this.margeHaut,F.setAttribute("visibility","visible"),this.doc.svg.removeChild(F),this.creeRectangle(F,this.couleurFond==null?"white":this.couleurFond)}this.g=F};Z.prototype.contientBalisesItaliqueOuUnderlineOuFontOuBold=function(i){return/<(u|b|i|font[^>]+)>/gi.test(i)};Z.prototype.creeRectangle=function(i,e){const t=document.createElementNS(l,"rect"),s="stroke-width:"+this.epaisseurCadre+"px;stroke:"+this.couleurCadre+";fill:"+e+";fill-opacity:"+this.opaciteFond+";";t.setAttribute("style",s),t.setAttribute("x",this.rectAff.x),t.setAttribute("y",this.rectAff.y),t.setAttribute("width",this.rectAff.width),t.setAttribute("height",this.rectAff.height),t.setAttribute("pointer-events","none"),i.insertBefore(t,i.childNodes[0])};function te(i,e,t,s){x.call(this,i,t),this.abscisseFin=parseFloat(e),this.pix10=s===null?8:String(Math.abs(s))}te.prototype=new x;te.prototype.execute=function(i){i?(this.doc.requerre.setAbs(this.abscisseFin),this.doc.requerre.positionne()):this.doc.requerre.lanceAnimationGlissement(this.abscisseFin,this.pix10)};te.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.requerre,this.indice-1)};function It(i,e,t,s,n){C.call(this,i);const r=i.compasLeve==null?null:i.compasLeve.g;this.x=e,this.y=t,this.angle=s,this.ecart=n,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(e,t,s),r==null?i.svg.appendChild(this.g):i.svg.replaceChild(this.g,r)}It.prototype=new C;It.prototype.creeg=function(){let i,e,t;const r=this.ecart,o=document.createElementNS(l,"g");this.ecart>16&&(i=document.createElementNS(l,"rect"),i.setAttribute("x",8),i.setAttribute("y",-7/2),i.setAttribute("width",this.ecart-16),i.setAttribute("height",7),i.setAttribute("rx",1),i.setAttribute("ry",1),i.setAttribute("style","stroke:black;stroke-width:0.5;fill:silver;fill-opacity:1"),o.appendChild(i)),t=document.createElementNS(l,"path"),t.setAttribute("d","M0 0 L8 1 8 -1Z"),t.setAttribute("style","stroke:black;stroke-width:0.5;fill:black;fill-opacity:1"),o.appendChild(t);const c=r-16;e=document.createElementNS(l,"line"),e.setAttribute("x1",8),e.setAttribute("y1",0),e.setAttribute("x2",8+c/8),e.setAttribute("y2",0),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e),t=document.createElementNS(l,"path");const a=String(r-8);t.setAttribute("d","M"+r+" 0 L"+a+" 1.5 "+a+" -1.5Z"),t.setAttribute("style","stroke:black;stroke-width:0.5;fill:black;fill-opacity:1"),o.appendChild(t),e=document.createElementNS(l,"line"),e.setAttribute("x1",a),e.setAttribute("y1",0),e.setAttribute("x2",String(r-8-c/8)),e.setAttribute("y2",0),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e),e=document.createElementNS(l,"line");let d=String(r-8-c/8-2);e.setAttribute("x1",d),e.setAttribute("y1",-7/2),e.setAttribute("x2",d),e.setAttribute("y2",7/2),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e),e=document.createElementNS(l,"line"),d=String(r-8-c/3-2),e.setAttribute("x1",d),e.setAttribute("y1",-7/2),e.setAttribute("x2",d),e.setAttribute("y2",7/2),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e),i=document.createElementNS(l,"rect"),i.setAttribute("x",String(8+c/8-5)),i.setAttribute("y",String(-7)),i.setAttribute("width",8),i.setAttribute("height",3),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(i),i=document.createElementNS(l,"rect"),i.setAttribute("x",String(r-8-c/8-4)),i.setAttribute("y",String(-7)),i.setAttribute("width",8),i.setAttribute("height",3),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(i);const p=12,b=4;t=document.createElementNS(l,"path");const u="M"+String(r/2+p)+" "+String(-b)+" A "+String(p)+" 2 180 0 0 "+String(r/2-p)+" "+String(-b)+"A"+String(b)+" 2 90 0 1 "+String(r/2-p)+" "+String(b)+"A"+String(p)+" 2 0 0 0 "+String(r/2+p)+" "+String(b)+"A"+String(b)+" 2 -90 0 1 "+String(r/2+p)+" "+String(-b);t.setAttribute("d",u),t.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),o.appendChild(t),e=document.createElementNS(l,"line"),e.setAttribute("x1",String(r/2+p)),e.setAttribute("y1",-7/2),e.setAttribute("x2",String(r/2-p)),e.setAttribute("y2",7/2),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e),e=document.createElementNS(l,"line"),e.setAttribute("x1",String(r/2-p)),e.setAttribute("y1",-7/2),e.setAttribute("x2",String(r/2+p)),e.setAttribute("y2",7/2),e.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(e);const g=document.createElementNS(l,"circle");g.setAttribute("cx",String(r/2)),g.setAttribute("cy",0),g.setAttribute("r",5),g.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),o.appendChild(g),i=document.createElementNS(l,"rect"),i.setAttribute("x",String(8+c/8-5)),i.setAttribute("y",String(-7)),i.setAttribute("width",7),i.setAttribute("height",3),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(i),i=document.createElementNS(l,"rect"),i.setAttribute("x",String(r-8-c/8-4)),i.setAttribute("y",String(-7)),i.setAttribute("width",7),i.setAttribute("height",3),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(i),this.g=o};It.prototype.setPosition=function(i,e,t){this.x=i,this.y=e,this.angle=t,this.g.setAttribute("transform","translate("+i+","+e+") rotate("+t+")")};function Ft(i,e){x.call(this,i,e)}Ft.prototype=new x;Ft.prototype.execute=function(i){const e=this.doc.compas;e.visible&&(e.montre(!1),e.visible=!0),this.doc.compasLeve=new It(this.doc,e.x,e.y,e.angle,e.ecart),!i&&e.visible&&this.doc.compasLeve.montre(!0),e.leve=!0,i||this.doc.actionSuivante(i)};Ft.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)?this.doc.getCompasStatus(this.indice-1)==="couche":!1};function Ot(i,e,t,s){x.call(this,i,s),this.objet=this.doc.getElement(e,t)}Ot.prototype=new x;Ot.prototype.execute=function(i){const e=this.objet;e!=null&&e.montre(!1),i||this.doc.actionSuivante(i)};Ot.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function Lt(i,e,t){x.call(this,i,t),this.instrument=e}Lt.prototype=new x;Lt.prototype.execute=function(i){const e=this.doc.compas;this.instrument.montre(!1),e.leve&&this.doc.compasLeve.montre(!1),i||this.doc.actionSuivante(i)};Lt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ee(i,e,t,s){x.call(this,i,s),this.instrument=e,this.longueur=t}ee.prototype=new x;ee.prototype.execute=function(i){if(this.instrument===this.doc.regle){const e=this.instrument.visible;this.instrument.longueur=this.longueur;const t=this.instrument.g;this.instrument.creeg(),this.instrument.g.setAttribute("visibility",e?"visible":"hidden"),this.doc.svg.replaceChild(this.instrument.g,t),this.instrument.translate(this.instrument.x,this.instrument.y)}i||this.doc.actionSuivante(i)};ee.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function jt(i,e,t,s){x.call(this,i,s),this.objet=this.doc.getElement(e,t)}jt.prototype=new x;jt.prototype.execute=function(i){const e=this.objet;e!==null&&e.montre(!0),i||this.doc.actionSuivante(i)};jt.prototype.actionVisible=function(){return!this.doc.getObjectVisibility(this.objet,this.indice-1)};function Ct(i,e,t,s){x.call(this,i,s),this.instrument=e,this.bmontrer=t}Ct.prototype=new x;Ct.prototype.execute=function(i){this.instrument.montreGraduations(this.bmontrer),i||this.doc.actionSuivante(i)};Ct.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function Rt(i,e,t,s,n){x.call(this,i,n),this.x=t===null?null:parseFloat(t),this.y=s===null?null:parseFloat(s),this.instrument=e}Rt.prototype=new x;Rt.prototype.execute=function(i){const e=this.doc.compas;this.x!==null&&this.y!==null&&this.instrument.translate(this.x,this.y),this.instrument===e&&!i?(e.leve?this.doc.compasLeve.montre(!0):e.montre(!0),e.visible=!0):this.instrument.montre(!0),i||this.doc.actionSuivante(i)};Rt.prototype.actionVisible=function(){return!this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function Nt(i,e,t){x.call(this,i,t),this.bmontrer=e}Nt.prototype=new x;Nt.prototype.execute=function(i){this.doc.rapporteur.montreGraduationsExternes(this.bmontrer),i||this.doc.actionSuivante(i)};Nt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.rapporteur,this.indice-1)};function _t(i,e,t){x.call(this,i,t),this.nomPoint=e}_t.prototype=new x;_t.prototype.prepare=function(){if(this.nomPoint.estLatex){const i=this,e=this.doc.getWidth(),t=at(this.nomPoint)-2,s=this.nomPoint.nom.substring(1);this.ex=t/2;const n={em:t,ex:this.ex,containerWidth:e,display:!1};this.doc.debug&&console.debug("chargement MathJax dans ActionNommerPoint"),Oe(async()=>{const{default:r}=await Promise.resolve().then(()=>De);return{default:r}},void 0).then(({default:r})=>r()).then(()=>MathJax.tex2svgPromise(s,n)).then(r=>{i.nomPoint.html=r,i.nomPoint.creegLatex(),i.setReady()}).catch(r=>{console.error(r),alert("Pb Mathjax, impossible d’afficher le point en LaTeX")})}else this.nomPoint.creeg(),this.setReady()};_t.prototype.execute=function(i){if(this.nomPoint.objet==="point"){this.nomPoint.positionne();const e=this.nomPoint.point;e.nom!==null?this.doc.svg.replaceChild(this.nomPoint.g,e.nom.g):this.doc.svg.appendChild(this.nomPoint.g),e.nom=this.nomPoint}this.nomPoint.g.setAttribute("visibility","visible"),i||this.doc.actionSuivante(i)};_t.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.nomPoint.point,this.indice-1)};function ie(i,e){x.call(this,i,e)}ie.prototype=new x;ie.prototype.execute=function(i){i||(this.doc.activeIconeContinuer(),this.doc.animationEnCours=!1)};ie.prototype.actionVisible=function(){return!1};function se(i,e,t,s,n){x.call(this,i,s),this.instrument=e,this.anglefin=parseFloat(t),this.deg10=n==null?8:Math.abs(parseFloat(n))}se.prototype=new x;se.prototype.execute=function(i){i?(this.instrument.angle=this.anglefin,this.instrument.positionne(),i||this.doc.actionSuivante(i)):this.instrument.lanceAnimationRotation(this.anglefin,this.deg10)};se.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ne(i,e){x.call(this,i,e)}ne.prototype=new x;ne.prototype.execute=function(i){this.doc.compas.retourne(),i||this.doc.actionSuivante(i)};ne.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)};function re(i,e,t,s,n,r){x.call(this,i,n),this.anglefin=parseFloat(t),this.deg10=r==null?8:Math.abs(parseFloat(r)),this.objet=this.doc.getElement(e,s)}re.prototype=new x;re.prototype.execute=function(i){const e=this.objet;if(e==null){i||this.doc.actionSuivante(i);return}i?(e.angle=this.anglefin,e.positionne()):e.lanceAnimationRotation(this.anglefin,this.deg10,this.tempo)};re.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function oe(i,e,t,s,n,r){x.call(this,i,n),this.instrument=e,this.xfin=parseFloat(t),this.yfin=parseFloat(s),this.pix10=r==null?8:parseFloat(r)}oe.prototype=new x;oe.prototype.execute=function(i){isNaN(this.xfin)||isNaN(this.yfin)?this.doc.actionSuivante(i):i?this.instrument.translate(this.xfin,this.yfin):this.instrument.lanceAnimationTranslation(this.xfin,this.yfin,this.pix10)};oe.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ae(i,e,t,s,n,r,o){x.call(this,i,r),this.xfin=parseFloat(t),this.yfin=parseFloat(s),this.pix10=o==null?8:parseFloat(o),this.type=n,this.objet=this.doc.getElement(e,n)}ae.prototype=new x;ae.prototype.execute=function(i){const e=this.objet;if(e==null){this.doc.actionSuivante(i);return}i?e.translate(this.xfin,this.yfin):e.lanceAnimationTranslation(this.xfin,this.yfin,this.pix10)};ae.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function le(i,e,t,s,n){x.call(this,i,s),this.instrument=e,this.zoomfin=parseFloat(t)/100,this.vitesse=parseInt(n)}le.prototype=new x;le.prototype.execute=function(i){i?(this.instrument.zoomfactor=this.zoomfin,this.instrument.positionne()):this.instrument.lanceAnimationZoom(this.zoomfin,this.vitesse)};le.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ce(i,e,t,s,n,r){x.call(this,i,n),this.objet=this.doc.getElement(e,s),this.zoomfin=parseFloat(t)/100,this.vitesse=r,this.type=s}ce.prototype=new x;ce.prototype.execute=function(i){const e=this.objet;if(e==null){this.doc.actionSuivante(i);return}i?(e.zoomfactor=this.zoomfin,e.positionne()):e.lanceAnimationZoom(this.zoomfin,this.vitesse)};ce.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function he(i,e,t,s,n,r){x.call(this,i,n),this.rayFin=parseFloat(t),this.pix10=r==null?8:parseFloat(r),this.type=s,this.objet=this.doc.getElement(e,s)}he.prototype=new x;he.prototype.execute=function(i){const e=this.objet;if(e==null){this.doc.actionSuivante(i);return}i?e.donneRayon(this.rayFin):e.lanceAnimationModificationRayon(this.rayFin,this.pix10)};he.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function V(i,e,t,s,n,r){k.call(this,i,e,t),this.epaisseur=s,this.opacite=arguments.length>=5?n:"100",this.styleTrait=arguments.length>=6?r:"continu";const o=parseFloat(this.opacite/100);this.style="stroke:"+t+";stroke-width:"+s+";stroke-opacity:"+o+";stroke-linecap:round;",this.styleTrait==="tiret"&&(this.style+="stroke-dasharray:10 8 10;")}V.prototype=new k;function be(i,e,t,s,n,r,o,c,a,d,p){this.x=parseFloat(t),this.y=parseFloat(s),this.ray=parseFloat(n),this.ang1=parseFloat(r),this.ang2=parseFloat(o),this.motif=p??"simple",V.call(this,i,e,c,a,1),this.opaciteRemplissage=d==null?.7:parseFloat(d)/100,this.objet="angle"}be.prototype=new V;be.prototype.creeg=function(){let i,e,t,s,n,r,o,c,a,d;const b=this.motif,u=this.ray,g=this.ang1,f=this.ang2,h=f-g,w=Et(h);Je(Math.abs(h)-180)?i=this.ang1<=this.ang2:i=w>0;const y=new P(this.x,this.y,this.x+Math.cos(g*D),this.y+Math.sin(g*D)).vecteurColineaire(u),S=new P(this.x,this.y,this.x+Math.cos(f*D),this.y+Math.sin(f*D)).vecteurColineaire(u);let j=this.x+y.x,M=this.y+y.y,I=this.x+S.x,F=this.y+S.y;const E=document.createElementNS(l,"g");let O=document.createElementNS(l,"path");const G=b.indexOf("plein")!==-1?this.couleur:"none";G!=="none"?e="M"+this.x+" "+this.y+"L"+j+" "+M+"A"+u+" "+u+" "+this.ang1+" 0 "+(i?"1 ":"0 ")+I+" "+F+" Z":e="M"+j+" "+M+"A"+u+" "+u+" "+this.ang1+" 0 "+(i?"1 ":"0 ")+I+" "+F,O.setAttribute("d",e);const z="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";",L=z+"fill:"+G+";fill-opacity:"+this.opaciteRemplissage+";";O.setAttribute("style",L),E.appendChild(O);const pt=b.indexOf("O")!==-1,vt=y.tourne(w/2),Tt=this.x+vt.x,qt=this.y+vt.y;if(pt){const U=document.createElementNS(l,"circle");U.setAttribute("r",5),U.setAttribute("cx",Tt),U.setAttribute("cy",qt),U.setAttribute("style",z+"fill:none;"),E.appendChild(U)}const fe=b.indexOf("triple")!==-1?2:b.indexOf("double")!==-1?1:0;for(let U=1;U<=fe;U++){O=document.createElementNS(l,"path");const Gt=u-U*5,ye=y.vecteurColineaire(Gt),Ae=S.vecteurColineaire(Gt);j=this.x+ye.x,M=this.y+ye.y,I=this.x+Ae.x,F=this.y+Ae.y,e="M"+j+" "+M+"A"+Gt+" "+Gt+" "+this.ang1+" 0 "+(i?"1 ":"0 ")+I+" "+F,O.setAttribute("d",e),O.setAttribute("style",z+"fill:none;"),E.appendChild(O)}const me=b.indexOf("///")!==-1?3:b.indexOf("//")!==-1?2:b.indexOf("/")!==-1?1:0;if(me===0){this.g=E;return}const X=fe+1,N=vt.vecteurColineaire(1);switch(me){case 1:o=this.x+N.x*u,c=this.y+N.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",o-N.x*5*X),t.setAttribute("y1",c-N.y*5*X),t.setAttribute("x2",o+N.x*5),t.setAttribute("y2",c+N.y*5),t.setAttribute("style",L),E.appendChild(t);break;case 2:a=w/6,d=6,Math.abs(a)>=Math.abs(d)&&(a=d),s=N.tourne(a),n=this.x+s.x*u,r=this.y+s.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",n-N.x*5*X),t.setAttribute("y1",r-N.y*5*X),t.setAttribute("x2",n+N.x*5),t.setAttribute("y2",r+N.y*5),t.setAttribute("style",L),E.appendChild(t),s=N.tourne(-a),n=this.x+s.x*u,r=this.y+s.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",n-N.x*5*X),t.setAttribute("y1",r-N.y*5*X),t.setAttribute("x2",n+N.x*5),t.setAttribute("y2",r+N.y*5),t.setAttribute("style",L),E.appendChild(t);break;case 3:o=this.x+N.x*u,c=this.y+N.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",o-N.x*5*X),t.setAttribute("y1",c-N.y*5*X),t.setAttribute("x2",o+N.x*5),t.setAttribute("y2",c+N.y*5),t.setAttribute("style",L),E.appendChild(t),a=w/4,d=9,Math.abs(a)>=Math.abs(d)&&(a=d),s=N.tourne(a),n=this.x+s.x*u,r=this.y+s.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",n-N.x*5*X),t.setAttribute("y1",r-N.y*5*X),t.setAttribute("x2",n+N.x*5),t.setAttribute("y2",r+N.y*5),t.setAttribute("style",L),E.appendChild(t),s=N.tourne(-a),n=this.x+s.x*u,r=this.y+s.y*u,t=document.createElementNS(l,"line"),t.setAttribute("x1",n-N.x*5*X),t.setAttribute("y1",r-N.y*5*X),t.setAttribute("x2",n+N.x*5),t.setAttribute("y2",r+N.y*5),t.setAttribute("style",L),E.appendChild(t);break}this.g=E};function Ut(i,e,t,s,n,r,o,c){this.xsommet=parseFloat(t),this.ysommet=parseFloat(s),this.xinter=parseFloat(n),this.yinter=parseFloat(r),V.call(this,i,e,o,c,100),this.objet="angle_droit"}Ut.prototype=new V;Ut.prototype.creeg=function(){let i=new P(this.xsommet,this.ysommet,this.xinter,this.yinter);const e=i.norme();i=i.vecteurColineaire(e/Math.sqrt(2)),i=i.tourne(45);const t=i.tourne(-90),s=document.createElementNS(l,"polyline"),n=String(this.xsommet+i.x)+" "+String(this.ysommet+i.y)+" "+this.xsommet+" "+this.ysommet+" "+String(this.xsommet+t.x)+" "+String(this.ysommet+t.y);s.setAttribute("points",n),s.setAttribute("style",this.style+"fill:none;"),this.g=s};function lt(i,e,t,s,n,r,o,c,a,d,p){this.x=parseFloat(t),this.y=parseFloat(s),this.ray=parseFloat(n),this.debut=parseFloat(r),this.fin=parseFloat(o),V.call(this,i,e,c,a,d,p)}lt.prototype=new V;lt.prototype.creeg=function(){const i=this.debut,e=this.fin,t=this.ray,s=i<e?"1":"0",n=Math.abs(e-i),r=document.createElementNS(l,"g");if(n>=359.9){const o=document.createElementNS(l,"circle");o.setAttribute("r",t),o.setAttribute("cx",0),o.setAttribute("cy",0),o.setAttribute("style",this.style+";fill:none;"),r.appendChild(o)}else{const o=document.createElementNS(l,"path"),c=new P(Math.cos(i*D)*t,Math.sin(i*D)*t),a=new P(Math.cos(e*D)*t,Math.sin(e*D)*t),d=c.x,p=c.y,b=a.x,u=a.y,g="M"+d+" "+p+"A"+t+" "+t+" "+i+" "+(n>180?"1":"0")+" "+s+" "+b+" "+u;o.setAttribute("d",g),o.setAttribute("style",this.style+";fill:none"),r.appendChild(o)}r.setAttribute("transform","translate("+this.x+","+this.y+")"),r.setAttribute("visibility","hidden"),this.g=r};lt.prototype.creationAnimee=function(){return!0};lt.prototype.lanceAnimation=function(i){const e=this.doc.compas;this.doc.compasLeve==null&&(this.doc.compasLeve=new It(this.doc,e.x,e.y,e.angle,e.ecart));const t=this.doc.compasLeve;this.ray=this.doc.compas.ecart,this.angfin=this.fin,this.pasdeg=i/2,this.pasdeg*=this.fin>=this.debut?1:-1,this.distang=Math.abs(this.fin-this.debut),this.fin=this.debut,e.setPosition(this.x,this.y,this.debut),t.setPosition(this.x,this.y,this.debut);const s=this;this.timer=setInterval(function(){s.actionPourAnimation()},25)};lt.prototype.actionPourAnimation=function(){const i=this.doc.compas,e=this.doc.compasLeve;this.fin+=this.pasdeg;const t=Math.abs(this.angfin-this.fin);t>this.distang||!this.doc.animationEnCours?(this.fin=this.angfin,this.updateg(),this.finAction(),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=t,this.updateg(),i.setPosition(this.x,this.y,this.fin),e!==null&&e.setPosition(this.x,this.y,this.fin))};lt.prototype.finAction=function(){this.doc.compas.setPosition(this.x,this.y,this.fin),this.doc.compasLeve!==null&&this.doc.compasLeve.setPosition(this.x,this.y,this.fin)};function it(i,e,t,s,n,r,o,c,a,d){V.call(this,i,e,o,c,d,"continu"),this.x=parseFloat(t),this.y=parseFloat(s),this.ray=n===null?10:parseFloat(n),this.ecartAngle=parseFloat(r),this.couleur=o,this.couleurFond=a===null?o:a,this.angle=0,this.objet="gabarit"}it.prototype=new V;it.prototype.creationAnimee=function(){return!1};it.prototype.creeg=function(){const i=this.ecartAngle,e=this.ray,t=i>=0?"1":"0",s=Math.abs(i),n=document.createElementNS(l,"g"),r=document.createElementNS(l,"path"),o=new P(Math.cos(i*D)*e,Math.sin(i*D)*e),c=e,a=0,d=o.x,p=o.y,b="M 0 0 L "+c+" "+a+" A "+e+" "+e+" 0 "+(s>180?"1":"0")+" "+t+" "+d+" "+p+" Z";r.setAttribute("d",b);const u=parseFloat(this.opacite/100),g="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";fill:"+this.couleurFond+";fill-opacity:"+u+";";r.setAttribute("style",g),n.appendChild(r),n.setAttribute("transform","translate("+this.x+","+this.y+") rotate("+this.angle+")"),n.setAttribute("visibility","hidden"),this.g=n};it.prototype.donneRayon=function(i){this.ray=i,this.updateg(),this.setPosition(this.x,this.y,this.angle)};it.prototype.setPosition=function(i,e,t){this.x=i,this.y=e,this.angle=t,this.g.setAttribute("transform","translate("+i+","+e+") rotate("+t+")")};it.prototype.lanceAnimationModificationRayon=function(i,e){this.rayFin=i,this.rayInit=this.ray;const t=i-this.ray;if(this.dist=Math.abs(t),this.dray=Math.sign(t)*Math.abs(e/4),this.dist===0)return;const s=this;this.timer=setInterval(function(){s.actionPourModificationRayon()},25)};it.prototype.actionPourModificationRayon=function(){const i=this.ray+this.dray,e=Math.abs(i-this.rayInit);e>this.dist||!this.doc.animationEnCours?(this.donneRayon(this.rayFin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=e,this.donneRayon(i))};function ct(i,e,t,s,n,r,o,c,a,d){k.call(this,i,"axeIEP",d),this.pente=e??"horizontal",this.largeur=t,this.haut=s==null?0:parseFloat(s),this.gauche=n==null?0:parseFloat(n),this.distanceBord=parseFloat(r),this.xgrad=o,this.xmin=c,this.xmax=a,this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.width=30*t,this.cadre.droite=this.gauche+this.width,this.cadre.bas=this.haut+this.width}ct.prototype=new k;ct.prototype.creeg=function(){let i,e,t,s;this.g=document.createElementNS(l,"g");const n="stroke:black;stroke-width:1;";this.pente==="horizontal"&&this.xmax-this.xmin>this.xgrad?(e=Math.floor((this.xmax-this.xmin)/this.xgrad),t=this.distanceBord*30,s=Jt(this.xmin,this.xmax,this.xgrad),this.tracer_abscisses(s,this.xgrad,e,t),i=document.createElementNS(l,"line"),i.setAttribute("style",n),i.setAttribute("x1",this.cadre.gauche),i.setAttribute("y1",t),i.setAttribute("x2",this.cadre.droite),i.setAttribute("y2",t),this.g.appendChild(i)):this.xmax-this.xmin>this.xgrad&&(e=Math.floor((this.xmax-this.xmin)/this.xgrad),t=Number(this.distanceBord)*30,s=Jt(this.xmin,this.xmax,this.xgrad),this.tracer_ordonnees(s,this.xgrad,e,t),i=document.createElementNS(l,"line"),i.setAttribute("style",n),i.setAttribute("x1",t),i.setAttribute("y1",this.cadre.bas),i.setAttribute("x2",t),i.setAttribute("y2",this.cadre.haut),this.g.appendChild(i))};ct.prototype.tracer_abscisses=function(i,e,t,s){let n,r,o,c;const d="stroke:black;stroke-width:1.5;";for(n=document.createElementNS(l,"line"),n.setAttribute("style",d),n.setAttribute("x1",this.cadre.gauche),n.setAttribute("y1",s),n.setAttribute("x2",this.cadre.droite),n.setAttribute("y2",s),this.g.appendChild(n),c=0;c<=t;c++){n=document.createElementNS(l,"line"),n.setAttribute("style",d),o=this.mettre_x_en_pixels(i+c*e),n.setAttribute("x1",o),n.setAttribute("y1",String(s-5)),n.setAttribute("x2",o),n.setAttribute("y2",String(s+5)),this.g.appendChild(n),r=document.createElementNS(l,"text"),r.setAttribute("x",o),r.setAttribute("y",s+12+5);const p="text-anchor:left;font-size:12px;fill:"+this.couleur+";";r.setAttribute("style",p),r.appendChild(document.createTextNode(String(i+c*e))),this.g.appendChild(r)}};ct.prototype.tracer_ordonnees=function(i,e,t,s){let n,r,o;const a="stroke:black;stroke-width:1.5;";for(n=document.createElementNS(l,"line"),n.setAttribute("style",a),n.setAttribute("x1",s),n.setAttribute("y1",this.cadre.haut),n.setAttribute("x2",s),n.setAttribute("y2",this.cadre.bas),this.g.appendChild(n),o=0;o<=t;o++){n=document.createElementNS(l,"line"),n.setAttribute("style",a);const d=this.mettre_y_en_pixels(i+o*e);n.setAttribute("x1",String(s-5)),n.setAttribute("y1",d),n.setAttribute("x2",String(s+5)),n.setAttribute("y2",d),this.g.appendChild(n),r=document.createElementNS(l,"text"),r.setAttribute("x",s+10),r.setAttribute("y",d+2);const p="text-anchor:left;font-size:12px;fill:"+this.couleur+";";r.setAttribute("style",p),r.appendChild(document.createTextNode(String(i+o*e))),this.g.appendChild(r)}};ct.prototype.mettre_x_en_pixels=function(i){return Yt(i,this.xmin,this.xmax,this.cadre.gauche,this.cadre.droite)};ct.prototype.mettre_y_en_pixels=function(i){return Yt(i,this.xmax,this.xmin,this.cadre.haut,this.cadre.bas)};function H(i,e,t,s,n,r,o,c,a,d){this.x1=parseFloat(t),this.y1=parseFloat(s),this.x2=parseFloat(n),this.y2=parseFloat(r),V.call(this,i,e,o,c,a,d)}H.prototype=new V;H.prototype.creeg=function(){const i=document.createElementNS(l,"g"),e=document.createElementNS(l,"line");e.setAttribute("x1",this.x1),e.setAttribute("y1",this.y1),e.setAttribute("x2",this.x2),e.setAttribute("y2",this.y2),e.setAttribute("style",this.style),i.appendChild(e),i.setAttribute("visibility","hidden"),this.g=i};H.prototype.creationAnimee=function(){return!0};H.prototype.lanceAnimation=function(i){this.vitesse=i/4;const e=new P(this.x1,this.y1,this.x2,this.y2);if(this.dist=e.norme(),mt(this.dist)){this.doc.actionSuivante();return}this.vect=e.vecteurColineaire(this.vitesse*1.8),this.xfin=this.x2,this.yfin=this.y2,this.x2=this.x1,this.y2=this.y1;const t=this.doc.crayon;t.setPosition(this.x1,this.y1,t.angle);const s=this;this.timer=setInterval(function(){s.actionPourAnimation(s)},25)};H.prototype.actionPourAnimation=function(){this.x2+=this.vect.x,this.y2+=this.vect.y;const e=new P(this.x1,this.y1,this.x2,this.y2).norme(),t=this.doc.crayon;e>this.dist||!this.doc.animationEnCours?(this.x2=this.xfin,this.y2=this.yfin,this.finAction(),this.updateg(),clearInterval(this.timer),this.doc.actionSuivante()):(t.translate(this.x2,this.y2),this.updateg())};H.prototype.finAction=function(){this.doc.crayon.translate(this.x2,this.y2)};function ht(i,e,t,s,n,r,o,c,a,d){H.call(this,i,e,t,s,n,r,o,c,a,d)}ht.prototype=new H;ht.prototype.creeg=function(){if(this.calcule(),this.horsFenetre)this.g=document.createElementNS(l,"g");else{const i=document.createElementNS(l,"line");i.setAttribute("x1",this.xext1),i.setAttribute("y1",this.yext1),i.setAttribute("x2",this.xext2),i.setAttribute("y2",this.yext2),i.setAttribute("style",this.style),this.g=i}this.g.setAttribute("visibility","hidden")};ht.prototype.calcule=function(){const{x1:i,y1:e,x2:t,y2:s}=this;if(i===t&&e===s){this.horsFenetre=!0;return}this.horsFenetre=!1;const n=this.doc.getWidth(),r=this.doc.getHeight();if(i===t){if(this.xext1=i,this.yext1=0,this.xext2=i,this.yext2=r,i<0||i>n){this.horsFenetre=!0;return}this.xext1=i,this.yext1=0,this.xext2=i,this.yext2=r;return}if(e===s){if(this.xext1=0,this.yext1=e,this.xext2=n,this.yext2=e,e<0||e>r){this.horsFenetre=!0;return}this.xext1=0,this.yext1=e,this.xext2=n,this.yext2=e;return}let o=0;const c=(s-e)/(t-i),a=0,d=this.y1+c*(a-i);d>=0&&d<=r&&(o++,this.xext1=a,this.yext1=d);const p=n,b=c*(p-i)+e;if(b>=0&&b<=r)if(o++,o===1)this.xext1=p,this.yext1=b;else{this.xext2=p,this.yext2=b;return}const u=0,g=(u-e)/c+i;if(g>0&&g<n)if(o++,o===1)this.xext1=g,this.yext1=u;else{this.xext2=g,this.yext2=u;return}const f=r,h=(f-e)/c+i;h>0&&h<=n?(o++,o===2?(this.xext2=h,this.yext2=f):this.horsFenetre=!0):this.horsFenetre=!0,this.horsFenetre&&(this.xext1=0,this.yext1=d,this.xext2=p,this.yext2=b)};function ge(i,e,t,s,n,r,o,c,a,d){ht.call(this,i,e,t,s,n,r,o,c,a,d)}ge.prototype=new ht;ge.prototype.calcule=function(){ht.prototype.calcule.call(this);const i=new P(this.x1,this.y1,this.x2,this.y2);if(this.horsFenetre)return;const e=new P(this.x1,this.y1,this.xext1,this.yext1);if(e.presqueNul()){const t=new P(this.x1,this.y1,this.xext2,this.yext2);xe(t,i)?(this.xext1=this.x1,this.yext1=this.y1):(this.xext2=this.xext1,this.yext2=this.yext1,this.xext1=this.x1,this.yext1=this.y1)}else xe(e,i)?(this.xext2=this.xext1,this.yext2=this.yext1,this.xext1=this.x1,this.yext1=this.y1):(this.xext1=this.x1,this.yext1=this.y1)};function ut(i,e,t){this.doc=i,this.id=e,this.url=t,this.x=0,this.y=0,this.angle=0,this.objet="image",this.zoomfactor=1}ut.prototype=new k;ut.prototype.initialisePosition=function(){this.x=0,this.y=0,this.angle=0,this.zoomfactor=1,this.positionne()};ut.prototype.prepareAction=function(){const i=new Image;i.owner=this,this.action=new _(this.doc,this.id,this),this.action.isReady=!1,this.doc.ajouteAction(this.action),i.onload=function(){const e=this.owner;e.width=this.width,e.height=this.height,e.action.isReady=!0},i.src=this.url};ut.prototype.creeg=function(){const i=document.createElementNS(l,"image");i.setAttribute("width",this.width),i.setAttribute("height",this.height),i.setAttributeNS("http://www.w3.org/1999/xlink","href",this.url),i.setAttribute("x",this.x),i.setAttribute("y",this.y),i.setAttribute("visibility","hidden"),this.g=i,this.setPosition(this.x,this.y,this.angle,this.zoomfactor),this.doc.svg.appendChild(i)};ut.prototype.setPosition=function(i,e,t,s){this.x=i,this.y=e,this.angle=t,this.zoomfactor=s,this.g?this.g.setAttribute("transform","scale("+s+") translate("+String(i/s)+","+String(e/s)+") rotate("+t+")"):console.error("Il faut appeler imag.creeg avant imag.setPosition")};ut.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};function tt(i,e,t,s,n,r,o,c,a,d){V.call(this,i,e,o,c,a,d),this.xdeb=t,this.ydeb=s,this.abs=n.split(","),this.ord=r.split(","),this.objet="trait"}tt.prototype=new V;tt.prototype.creeg=function(){let i,e;const t=document.createElementNS(l,"polyline");for(i=this.xdeb+" "+this.ydeb,e=0;e<this.abs.length;e++)i+=" "+this.abs[e]+" "+this.ord[e];t.setAttribute("points",i),t.setAttribute("style",this.style+"fill:none;"),t.setAttribute("visibility","hidden"),this.g=t};tt.prototype.creationAnimee=function(){return!0};tt.prototype.lanceAnimation=function(){this.sauveabs=this.abs,this.sauveord=this.ord,this.abs=[],this.ord=[],this.ind=-1;const i=this;this.timer=setInterval(function(){i.actionPourAnimation()},25)};tt.prototype.actionPourAnimation=function(){this.ind++;const i=this.doc.crayon;if(this.ind>=this.sauveabs.length)this.abs=this.sauveabs,this.ord=this.sauveord,this.updateg(),clearInterval(this.timer),this.finAction(),this.doc.actionSuivante();else{const e=this.sauveabs[this.ind],t=this.sauveord[this.ind];this.abs.push(e),this.ord.push(t),this.updateg(),i.setPosition(parseFloat(e),parseFloat(t),i.angle),this.updateg()}};tt.prototype.finAction=function(){const i=this.abs.length;this.doc.crayon.translate(parseFloat(this.abs[i-1]),parseFloat(this.ord[i-1]))};function $t(i,e,t,s,n,r,o){this.x=parseFloat(t),this.y=parseFloat(s),this.motif=o,V.call(this,i,e,n,r,100),this.objet="longueur"}$t.prototype=new V;$t.prototype.creeg=function(){let i,e,t;switch(this.motif){case"/":i=document.createElementNS(l,"line"),i.setAttribute("x1",5),i.setAttribute("y1",-5),i.setAttribute("x2",-5),i.setAttribute("y2",5),i.setAttribute("style",this.style);break;case"\\":i=document.createElementNS(l,"line"),i.setAttribute("x1",-5),i.setAttribute("y1",-5),i.setAttribute("x2",5),i.setAttribute("y2",5),i.setAttribute("style",this.style);break;case"//":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t+=2)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*2.5+5),e.setAttribute("y1",-5),e.setAttribute("x2",t*2.5-5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e);break;case"///":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t++)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*5+5),e.setAttribute("y1",-5),e.setAttribute("x2",t*5-5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e);break;case"\\\\":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t+=2)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*2.5-5),e.setAttribute("y1",-5),e.setAttribute("x2",t*2.5+5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e);break;case"\\\\\\":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t++)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*5-5),e.setAttribute("y1",-5),e.setAttribute("x2",t*5+5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e);break;case"X":i=document.createElementNS(l,"g"),e=document.createElementNS(l,"line"),e.setAttribute("x1",-5),e.setAttribute("y1",-5),e.setAttribute("x2",5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e),e=document.createElementNS(l,"line"),e.setAttribute("x1",5),e.setAttribute("y1",-5),e.setAttribute("x2",-5),e.setAttribute("y2",5),e.setAttribute("style",this.style),i.appendChild(e);break;case"O":i=document.createElementNS(l,"circle"),i.setAttribute("cx",0),i.setAttribute("cy",0),i.setAttribute("r",5),i.setAttribute("style",this.style+"fill:none;");break;default:i=document.createElementNS(l,"g")}this.g=i};$t.prototype.positionne=function(){this.g.setAttribute("transform","translate("+this.x+","+this.y+")")};$t.prototype.translate=function(i,e){this.x=i,this.y=e,this.positionne()};function kt(i,e,t,s,n,r,o,c,a,d,p){H.call(this,i,e,t,s,n,r,o,c,a,d),this.stylefleche=p}kt.prototype=new H;kt.prototype.creeg=function(){if(H.prototype.creeg.call(this),this.stylefleche==="vecteur"){const e=this.x1,t=this.x2,s=this.y1,n=this.y2,o=new P(t,n,e,s).vecteurColineaire(12),c=new P(o.x*Bt-o.y*Dt,o.x*Dt+o.y*Bt),a=new P(o.x*Bt+o.y*Dt,-o.x*Dt+o.y*Bt),d=String(t+c.x)+" "+String(n+c.y)+","+t+" "+n+","+String(t+a.x)+" "+String(n+a.y),p=document.createElementNS(l,"polyline");p.setAttribute("points",d);const b="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";stroke-opacity:"+this.opacite+";fill:none";p.setAttribute("style",b),this.g.appendChild(p)}};function Vt(i,e,t,s,n,r,o){this.idSeg=t,this.motif=r,this.rayon=o!==null?o:"5",V.call(this,i,e,s,n,100),this.objet="marque"}Vt.prototype=new V;Vt.prototype.creeg=function(){let i,e,t;if(this.doc.getElement(this.idSeg,"trait")instanceof kt){const n=this.rayon,r=5,o=r/2,c=5;switch(this.motif){case"/":i=document.createElementNS(l,"line"),i.setAttribute("x1",n),i.setAttribute("y1",-n),i.setAttribute("x2",-n),i.setAttribute("y2",n),i.setAttribute("style",this.style);break;case"\\":i=document.createElementNS(l,"line"),i.setAttribute("x1",-n),i.setAttribute("y1",-n),i.setAttribute("x2",n),i.setAttribute("y2",n),i.setAttribute("style",this.style);break;case"//":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t+=2)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*o+n),e.setAttribute("y1",-n),e.setAttribute("x2",t*o-n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e);break;case"///":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t++)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*r+n),e.setAttribute("y1",-n),e.setAttribute("x2",t*r-n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e);break;case"\\\\":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t+=2)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*o-n),e.setAttribute("y1",-n),e.setAttribute("x2",t*o+n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e);break;case"\\\\\\":for(i=document.createElementNS(l,"g"),t=-1;t<=1;t++)e=document.createElementNS(l,"line"),e.setAttribute("x1",t*r-n),e.setAttribute("y1",-n),e.setAttribute("x2",t*r+n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e);break;case"X":i=document.createElementNS(l,"g"),e=document.createElementNS(l,"line"),e.setAttribute("x1",-n),e.setAttribute("y1",-n),e.setAttribute("x2",n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e),e=document.createElementNS(l,"line"),e.setAttribute("x1",n),e.setAttribute("y1",-n),e.setAttribute("x2",-n),e.setAttribute("y2",n),e.setAttribute("style",this.style),i.appendChild(e);break;case"O":i=document.createElementNS(l,"circle"),i.setAttribute("cx",0),i.setAttribute("cy",0),i.setAttribute("r",c),i.setAttribute("style",this.style+"fill:none;");break;default:i=document.createElementNS(l,"g")}}else console.warn("Marque de segment non associée à un objet segment"),i=document.createElementNS(l,"g");this.g=i};Vt.prototype.positionne=function(){const i=this.doc.getElement(this.idSeg,"trait"),e=new P(i.x1,i.y1,i.x2,i.y2),t=(i.x1+i.x2)/2,s=(i.y1+i.y2)/2,n=-e.angle();this.g.setAttribute("transform","translate("+t+","+s+") rotate("+n+") ")};Vt.prototype.translate=function(i,e){this.x=i,this.y=e,this.positionne()};const{setStyles:Ke}=Le;function wt(i,e,t,s,n,r){k.call(this,i,e,r),this.dx=t==null?2:parseFloat(t),this.dy=s==null?4:parseFloat(s),this.nom=_e($e(n)),this.taille=20,this.point=this.doc.getElement(this.id,"point"),this.objet="point",this.nom=this.nom.replace(/\*/g,"×"),Te(n)?(this.nom="$"+this.traiteMaths(this.nom)+"$",this.estLatex=!0):this.estLatex=!1}wt.prototype=new k;wt.prototype.creeg=function(){let i,e,t,s,n,r,o,c,a,d,p,b,u,g,f,h,w,y,S=0;const j="<",M="£e(",I="£i(",F=document.createElementNS(l,"g"),E=at(this),O=E+2;let G=0;const z=E*.4;if(this.nom.length!==0){if(r=document.createElementNS(l,"text"),r.setAttribute("pointer-events","none"),r.setAttribute("x",0),r.setAttribute("y",0),n="text-anchor:left;font-size:"+E+"px;fill:"+this.couleur+";",r.setAttribute("style",n),s=this.nom.replace(/ /g," "),this.nom.indexOf(j)===-1&&this.nom.indexOf(M)===-1&&this.nom.indexOf(I)===-1&&this.nom.indexOf("<br>")===-1)r.appendChild(document.createTextNode(s));else for(f=s.split(/<br>/gi),g=-O,h=0;h<f.length;h++)for(w=!0,t=f[h];t.length!==0;)if(i=t.indexOf(j),c=t.indexOf(M),a=t.indexOf(I),w&&(g+=O+G),c!==-1&&(g+=z),i===-1&&c===-1&&a===-1){e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),S=0,e.appendChild(document.createTextNode(t)),r.appendChild(e);break}else for(;t.indexOf(j)!==-1||t.indexOf(M)!==-1||t.indexOf(I)!==-1;)if(i=t.indexOf(j),c=t.indexOf(M),a=t.indexOf(I),i===-1?c===-1?d=a:d=a===-1?c:Math.min(a,c):c===-1?d=a===-1?i:Math.min(i,a):a===-1?d=Math.min(i,c):d=Math.min(i,a,c),d>0)e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),S=0,e.appendChild(document.createTextNode(t.substring(0,d))),r.appendChild(e),t=t.substring(d);else if(i===0){const L=new ft(!1,!1,!1,this.couleur,"",E);o=q(t),B(o===-1?t:t.substring(0,o),L,r,w,g),w=!1,o!==-1?t=t.substring(o):t="",S=0}else p=d===c,y=Re(t),e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.setAttribute("dy",S+"px"),w&&(e.setAttribute("x",0),e.setAttribute("y",g),w=!1),y.erreur?e.appendChild(document.createTextNode(t)):(e.appendChild(document.createTextNode(y.operande)),r.appendChild(e),e=document.createElementNS(l,"tspan"),e.setAttribute("pointer-events","none"),e.appendChild(document.createTextNode(y.exposant)),S=z,p?S=-S:G=S,e.setAttribute("dy",S+"px"),b=E*.6,u="font-size:"+b+"px;",e.setAttribute("style",u),r.appendChild(e),S=-S),t=y.texte;F.appendChild(r),this.g=F}F.setAttribute("visibility","hidden")};wt.prototype.creegLatex=function(){try{const i=document.createElementNS(l,"g"),e=this.html.firstChild,t=e.cloneNode(!0);i.appendChild(t);const s=parseFloat(e.getAttribute("width"))*this.ex,n=parseFloat(e.getAttribute("height"))*this.ex,r=t.style["vertical-align"],o=(r&&parseFloat(r)||1)*this.ex;t.setAttribute("width",s+"px"),t.setAttribute("height",n+"px"),Ke(t,"vertical-align",o+"px"),t.setAttribute("x","0");const c=at(this);t.setAttribute("y",String(-c)),t.setAttribute("visibility","hidden"),this.g=i}catch(i){console.error(i,"on remplace par un <g> vide"),this.g=document.createElementNS(l,"g")}};wt.prototype.positionne=function(){this.point===null&&(this.point=this.doc.getElement(this.id,"point"));const i=this.point.x,e=this.point.y,t=at(this);this.g.setAttribute("transform","translate("+String(i+this.dx)+","+String(e+this.dy+t)+")")};wt.prototype.traiteMaths=function(i){return v(i,!0)};function st(i,e,t,s,n,r){this.x=parseFloat(t),this.y=parseFloat(s),this.xinit=this.x,this.yinit=this.y,this.xcons=this.x,this.ycons=this.y,V.call(this,i,e,n,r),this.style+="stroke-linecap:round;",this.nom=null,this.objet="point"}st.prototype=new V;st.prototype.initialisePosition=function(){this.x=this.xinit,this.y=this.yinit,this.positionne()};st.prototype.creeg=function(){const e=document.createElementNS(l,"g");let t;t=document.createElementNS(l,"line"),t.setAttribute("x1",-5),t.setAttribute("y1",5),t.setAttribute("x2",5),t.setAttribute("y2",-5),t.setAttribute("style",this.style),e.appendChild(t),t=document.createElementNS(l,"line"),t.setAttribute("x1",-5),t.setAttribute("y1",-5),t.setAttribute("x2",5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t),this.g=e};st.prototype.positionne=function(){this.g.setAttribute("transform","translate("+this.x+","+this.y+")")};st.prototype.translate=function(i,e){this.x=i,this.y=e,this.positionne(),this.nom!==null&&this.nom.positionne()};st.prototype.updateg=function(){this.setPosition(this.x,this.y)};st.prototype.montre=function(i){k.prototype.montre.call(this,i),this.nom!==null&&this.nom.g&&this.nom.montre(i)};function et(i,e,t,s,n,r,o,c){k.call(this,i,e,n),this.abs=t.split(","),this.ord=s.split(","),this.sauveabs=this.abs,this.sauveord=this.ord,this.epaisseur=r,this.opacite=c??"60";const a=parseFloat(this.opacite/100);o==null?this.couleurFond=this.couleur:this.couleurFond=o,this.style="stroke:"+n+";stroke-width:"+r+";fill:"+this.couleurFond+";",this.style+="fill-opacity:"+a+";",this.objet="trait"}et.prototype=new k;et.prototype.creeg=function(){let i,e;const t=document.createElementNS(l,"polygon");for(i="",e=0;e<this.abs.length;e++)i+=" "+this.abs[e]+" "+this.ord[e];t.setAttribute("points",i),t.setAttribute("style",this.style),t.setAttribute("visibility","hidden"),this.g=t};et.prototype.creationAnimee=function(){return!0};et.prototype.lanceAnimation=function(i){this.pix=parseFloat(i/2),this.abs=[],this.abs[0]=this.sauveabs[0],this.ord=[],this.ord[0]=this.sauveord[0],this.ind=0,this.n=0;const e=this.doc.crayon,t=new P(parseFloat(this.sauveabs[0]),parseFloat(this.sauveord[0]),parseFloat(this.sauveabs[1]),parseFloat(this.sauveord[1]));this.longcote=t.norme(),this.vect=t.vecteurColineaire(this.pix),e.setPosition(parseFloat(this.abs[0]),parseFloat(this.ord[0]),e.angle);const s=this;this.timer=setInterval(function(){s.actionPourAnimation()},25)};et.prototype.actionPourAnimation=function(){const i=this.doc.crayon;let e=this.ind;const t=parseFloat(this.abs[e]),s=parseFloat(this.ord[e]);if(this.n++,this.doc.animationEnCours)if(this.n*this.pix<=this.longcote){const n=t+this.n*this.vect.x,r=s+this.n*this.vect.y;this.abs[e+1]=String(n),this.ord[e+1]=String(r),i.translate(n,r),this.updateg()}else if(this.ind++,e++,e===this.sauveabs.length-1)clearInterval(this.timer),this.finAction(),this.doc.actionSuivante();else{this.abs[e]=this.sauveabs[e],this.ord[e]=this.sauveord[e],i.translate(parseFloat(this.abs[e]),parseFloat(this.ord[e]));const n=new P(parseFloat(this.sauveabs[e]),parseFloat(this.sauveord[e]),parseFloat(this.sauveabs[e+1]),parseFloat(this.sauveord[e+1]));this.longcote=n.norme(),this.vect=n.vecteurColineaire(this.pix),this.n=0}else clearInterval(this.timer),this.finAction(),this.doc.actionSuivante()};et.prototype.finAction=function(){this.abs=this.sauveabs,this.ord=this.sauveord;const i=this.abs.length;this.updateg(),this.doc.crayon.translate(parseFloat(this.abs[i-1]),parseFloat(this.ord[i-1]))};function Pt(i,e,t,s,n,r,o){k.call(this,i,"quadrillageIEP",o),this.hauteur=parseFloat(t),this.largeur=parseFloat(s),this.haut=n==null?0:parseFloat(n),this.gauche=r==null?0:parseFloat(r),this.type=e,this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.cadre.droite=this.cadre.gauche+this.largeur*30,this.cadre.bas=this.cadre.haut+this.hauteur*30,this.objet="quadrillage"}Pt.prototype=new k;Pt.prototype.creeg=function(){const i=this.cadre.gauche,e=this.cadre.droite,t=this.cadre.haut,s=this.cadre.bas,n=this.couleur;this.g=document.createElementNS(l,"g");const r=this.doc.svg.getElementById("quadrillageIEP");switch(r!=null&&this.doc.svg.removeChild(r),this.type){case"seyes":this.tracer_grille(n,24,6,i,t,e,s,!1,1),this.tracer_grille(n,24,24,i,t,e,s,!1,1);break;case"millimetre":this.tracer_grille(n,3,3,i,t,e,s,!1,.6),this.tracer_grille(n,30,30,i,t,e,s,!1,.8),this.tracer_grille(n,150,150,i,t,e,s,!1,1);break;case"10x10":case"10x":this.tracer_grille(n,30,30,i,t,e,s,!1,1);break;default:this.tracer_grille(n,15,15,i,t,e,s,!1,1);break}};Pt.prototype.tracer_grille=function(i,e,t,s,n,r,o,c,a){let d,p;const b="stroke:"+i+";stroke-width:0.5;stroke-opacity:"+a+";";c&&(this.style+="stroke-dasharray:2 2;");let u=Math.ceil(Math.abs(r-s)/e);for(p=0;p<u;p++)d=document.createElementNS(l,"line"),d.setAttribute("style",b),d.setAttribute("x1",s+p*e),d.setAttribute("y1",n),d.setAttribute("x2",s+p*e),d.setAttribute("y2",o),d.setAttribute("style",b),this.g.appendChild(d);for(u=Math.ceil(Math.abs(o-n)/t),p=0;p<u;p++)d=document.createElementNS(l,"line"),d.setAttribute("style",b),d.setAttribute("x1",s),d.setAttribute("y1",n+p*t),d.setAttribute("x2",r),d.setAttribute("y2",n+p*t),d.setAttribute("style",b),this.g.appendChild(d)};function dt(i,e,t,s,n,r,o,c,a,d,p,b,u,g,f){k.call(this,i,"repereIEP",b),this.hauteur=e,this.largeur=t,this.haut=s==null?0:parseFloat(s),this.gauche=n==null?0:parseFloat(n),this.xgrad=parseFloat(r),this.ygrad=parseFloat(o),this.xmin=parseFloat(c),this.xmax=parseFloat(a),this.ymin=parseFloat(d),this.ymax=parseFloat(p),this.grille=u??"visible",this.axes=g??"visible",this.etiquettes=f??"visible",this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.cadre.droite=this.cadre.gauche+this.largeur*30,this.cadre.bas=this.cadre.haut+this.hauteur*30}dt.prototype=new k;dt.prototype.mettre_x_en_pixels=function(i){return Yt(i,this.xmin,this.xmax,this.cadre.gauche,this.cadre.droite)};dt.prototype.mettre_y_en_pixels=function(i){return Yt(i,this.ymax,this.ymin,this.cadre.haut,this.cadre.bas)};dt.prototype.tracer_abscisses=function(i,e,t,s,n,r){let o,c,a,d;const b="stroke:black;stroke-width:0.5;";for(this.grille==="invisible"&&this.axes!=="invisible"&&(o=document.createElementNS(l,"line"),o.setAttribute("style",b),o.setAttribute("x1",this.cadre.gauche),o.setAttribute("y1",s),o.setAttribute("x2",this.cadre.droite),o.setAttribute("y2",s),this.g.appendChild(o)),d=0;d<=t;d++)if(o=document.createElementNS(l,"line"),o.setAttribute("style",b),a=this.mettre_x_en_pixels(i+d*e),this.grille==="invisible"?this.axes!=="invisible"&&(o.setAttribute("x1",a),o.setAttribute("y1",String(s-5)),o.setAttribute("x2",a),o.setAttribute("y2",String(s+5)),this.g.appendChild(o)):(o.setAttribute("x1",a),o.setAttribute("y1",n),o.setAttribute("x2",a),o.setAttribute("y2",r),this.g.appendChild(o)),this.etiquettes!=="invisible"&&this.axes!=="invisible"){c=document.createElementNS(l,"text"),c.setAttribute("x",a+2),c.setAttribute("y",s+12);const u="text-anchor:left;font-size:12px;fill:"+this.couleur+";";c.setAttribute("style",u),c.appendChild(document.createTextNode(String(i+d*e))),this.g.appendChild(c)}};dt.prototype.tracer_ordonnees=function(i,e,t,s,n,r){let o,c,a,d;const b="stroke:black;stroke-width:0.5;";for(this.grille==="invisible"&&this.axes!=="invisible"&&(o=document.createElementNS(l,"line"),o.setAttribute("style",b),o.setAttribute("x1",s),o.setAttribute("y1",this.cadre.haut),o.setAttribute("x2",s),o.setAttribute("y2",this.cadre.bas),this.g.appendChild(o)),d=0;d<=t;d++)if(o=document.createElementNS(l,"line"),o.setAttribute("style",b),a=this.mettre_y_en_pixels(i+d*e),this.grille==="invisible"?this.axes!=="invisible"&&(o.setAttribute("x1",String(s-5)),o.setAttribute("y1",a),o.setAttribute("x2",String(s+5)),o.setAttribute("y2",a),this.g.appendChild(o)):(o.setAttribute("x1",n),o.setAttribute("y1",a),o.setAttribute("x2",r),o.setAttribute("y2",a),this.g.appendChild(o)),this.etiquettes!=="invisible"&&this.axes!=="invisible"){c=document.createElementNS(l,"text"),c.setAttribute("x",s+2),c.setAttribute("y",a+12);const u="text-anchor:left;font-size:12px;fill:"+this.couleur+";";c.setAttribute("style",u),c.appendChild(document.createTextNode(String(i+d*e))),this.g.appendChild(c)}};dt.prototype.creeg=function(){const i=this.cadre.droite-this.cadre.gauche,e=this.cadre.bas-this.cadre.haut;this.g=document.createElementNS(l,"g");const t=document.createElementNS(l,"defs"),s=document.createElementNS(l,"clipPath");s.setAttribute("id","clipRepere");const n="stroke:"+this.couleur+";stroke-width:1;fill:none;",r=document.createElementNS(l,"rect");if(r.setAttribute("style",n),r.setAttribute("x",this.cadre.gauche),r.setAttribute("y",this.cadre.haut),r.setAttribute("width",i),r.setAttribute("height",e),s.appendChild(r),t.appendChild(s),this.g.appendChild(t),this.g.setAttribute("style","clip-path:url(#clipRepere)"),this.xmax-this.xmin>this.xgrad){const c=Math.floor((this.xmax-this.xmin)/this.xgrad);let a;this.ymax*this.ymin<0?a=this.mettre_y_en_pixels(0):this.ymax<0?a=this.cadre.haut:a=this.cadre.bas;const d=Jt(this.xmin,this.xmax,this.xgrad);this.tracer_abscisses(d,this.xgrad,c,a,this.cadre.haut,this.cadre.bas)}if(this.ymax-this.ymin>this.ygrad){const c=Math.floor((this.ymax-this.ymin)/this.ygrad);let a;this.xmax*this.xmin<0?a=this.mettre_x_en_pixels(0):this.xmax<0?a=this.cadre.droite:a=this.cadre.gauche;const d=Jt(this.ymin,this.ymax,this.ygrad);this.tracer_ordonnees(d,this.ygrad,c,a,this.cadre.gauche,this.cadre.droite)}const o=document.createElementNS(l,"rect");o.setAttribute("style",n),o.setAttribute("x",this.cadre.gauche),o.setAttribute("y",this.cadre.haut),o.setAttribute("width",i),o.setAttribute("height",e),this.g.appendChild(o),this.g.setAttribute("visibility","hidden")};const qe=["compas","equerre","rapporteur","regle","requerre","crayon"],ti=["Reset","PrevStep","Pause","Play","Restart","NextStep","GotoEnd","XML","Repeat"],de=800,pe=600,ei=i=>new Promise(e=>{setTimeout(()=>e(),i)});function ue(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"polygon");return o.setAttribute("points","-5,8 8,0 -5,-8"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function we(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");let o=document.createElementNS(l,"rect");return o.setAttribute("x",-6),o.setAttribute("y",-7),o.setAttribute("width",3),o.setAttribute("height",14),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"rect"),o.setAttribute("x",2),o.setAttribute("y",-7),o.setAttribute("width",3),o.setAttribute("height",14),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function ve(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"rect");o.setAttribute("x",5),o.setAttribute("y",-6),o.setAttribute("width",3),o.setAttribute("height",12),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o);const c=document.createElementNS(l,"polygon");return c.setAttribute("points","-7,6 2,0 -7,-6"),c.setAttribute("style","stroke:white;fill:white;"),c.setAttribute("transform","translate(16,16)"),s.appendChild(c),s}function Se(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"rect");o.setAttribute("x",-7),o.setAttribute("y",-6),o.setAttribute("width",3),o.setAttribute("height",12),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o);const c=document.createElementNS(l,"polygon");return c.setAttribute("points","7,6 -2,0 7,-6"),c.setAttribute("style","stroke:white;fill:white;"),c.setAttribute("transform","translate(16,16)"),s.appendChild(c),s}function Ee(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");let o=document.createElementNS(l,"polygon");return o.setAttribute("points","-6,7 1,0 -6,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"polygon"),o.setAttribute("points","3,7 10,0 3,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Ce(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");let o=document.createElementNS(l,"polygon");return o.setAttribute("points","6,7 -1,0 6,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"polygon"),o.setAttribute("points","-3,7 -10,0 -3,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Ne(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"path");return o.setAttribute("d","M 0 -8 A 8 8 -90 1 1 -8 0"),o.setAttribute("style","stroke:white;stroke-width:3;fill:none;"),o.setAttribute("marker-end","url(#markerarrow"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function ke(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"path");return o.setAttribute("d","M 0 -8 A 8 8 -90 1 1 -1 -8"),o.setAttribute("style","stroke:white;stroke-width:3;fill:none;"),o.setAttribute("marker-end","url(#markerarrow"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Pe(i,e,t){const s=document.createElementNS(l,"svg");s.setAttribute("x",i),s.setAttribute("y",e),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=t==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+t+"); filter:url(#"+r+");");const o=document.createElementNS(l,"text");return o.setAttribute("pointer-events","none"),o.appendChild(document.createTextNode("XML")),o.setAttribute("x",16),o.setAttribute("y",21),o.setAttribute("style","font-family:Arial;font-size:9pt;fill:white;text-anchor:middle"),s.appendChild(o),s}function bt(i){return i.getAttribute("id")}function nt(i){return i.getAttribute("abscisse")}function rt(i){const e=i.getAttribute("ordonnee");return e===null?i.getAttribute("ordonnée"):e}function R(i){const e=i.getAttribute("couleur");return e?Y(e):"black"}function ii(i){const e=i.getAttribute("couleur_cadre");return e?Y(e):null}function Xt(i){const e=i.getAttribute("couleur_fond");return e?Y(e):null}function T(i){const e=i.getAttribute("epaisseur");return e===null||parseInt(e)===0?"1":e}function Q(i){const e=i.getAttribute("opacite");return e===null?"100":e}function si(i){const e=i.getAttribute("opacite");return e===null?"50":e}function ot(i){const e=i.getAttribute("pointille");return e??"continu"}function gt(i){const e=i.getAttribute("style");return e??"normal"}function A(i,e,t){this.svg=i,typeof t=="boolean"?(this.autoStart=t,t={}):(typeof t!="object"&&(t={}),this.autoStart=!!t.autoStart),this.debug=!!t.debug,this.windowxml=null;let s=e;s.search(/<?xml/gi)===-1&&(s='<?xml version="1.0" encoding="UTF-8"?>'+s),s=s.replace(/<action[_]\d*/gi,"<action"),s=s.replace(/<!--.*-->/g,""),s=s.replace(/(="[^"]*")([^ ])/g,"$1 $2").replace(/--/g,""),s=s.replace(/<</g,"<").replace(/>>/g,">"),s=s.replace(/<action(\w)/gi,"<action $1"),s=s.replace(/<commentaire\s*texte\s*=/gi,"<commentaire texteCommentaire ="),s=We(s),this.codexml=s;const n=/<\s*INSTRUMENPOCHE[^>]*>(.*)<\s*\/INSTRUMENPOCHE/si.exec(s);if(!n)throw Error("script xml invalide");this.chdoc="<INSTRUMENPOCHE>"+n[1]+"</INSTRUMENPOCHE>",this.actions=[],this.elements=[],this.compasRetourne=!1,this.compasLeve=null,this.compas=new J(this),this.equerre=new Wt(this),this.rapporteur=new yt(this),this.regle=new At(this),this.requerre=new xt(this),this.crayon=new Qt(this),this.xmldoc=Ue(this.chdoc),this.tabact=this.xmldoc.getElementsByTagName("action"),this.started=!1,this.animationEnCours=!0;const r={x:0,y:0,width:de,height:pe},o=this.xmldoc.getElementsByTagName("viewBox");if(o&&o.length){o.length>1&&console.error(Error("Il y a plusieurs tags viewBox dans le script, on prend le premier"),o);const a=o[0];Object.keys(r).forEach(d=>{const p=Number(a.getAttribute(d));Number.isFinite(p)&&(d.length<2||p>0)&&(r[d]=p)})}if(window.innerHeight>r.height*.6&&r.width/r.height<window.innerWidth/window.innerHeight)try{i.parentNode.style.width=window.innerHeight/r.height*r.width+"px"}catch(a){console.error(a)}try{i.parentNode.style.minWidth=r.width/2+"px",i.parentNode.style.minHeight=r.height/2+"px"}catch(a){console.error(a)}this.initialViewBox=r,i.setAttribute("viewBox",`${r.x} ${r.y} ${r.width} ${r.height}`),i.setAttribute("preserveAspectRatio","xMinYMin meet"),this.indiceActionEnCours=0,this.creeActions();const c=this;i.addEventListener("mousemove",function(a){c.mousemoveListenerSvg(a,a.clientX,a.clientY)},!1),i.addEventListener("mouseup",function(){c.mouseupListener()},!1),i.addEventListener("mouseleave",function(){c.mouseleaveListener()},!1),i.addEventListener("touchmove",function(a){c.mousemoveListenerSvg(a,a.touches[0].pageX,a.touches[0].pageY)},!1),i.addEventListener("touchend",function(){c.mouseupListener()},!1),i.addEventListener("touchcancel",function(){c.mouseupListener()},!1),i.addEventListener("touchleave",function(){c.mouseleaveListener()},!1),this.debug&&console.debug("iepDoc instancié :",this)}A.prototype.setViewBox=function(e){if(typeof e!="object"||Object.keys(this.initialViewBox).some(c=>!Number.isFinite(e[c])))throw TypeError("paramètre invalide (il faut passer un objet { x: number, y: number, width: number, height: number })");const{x:t,y:s,width:n,height:r}=e;if(n<10||r<10)return console.error(Error("width et height doivent être supérieur à 10"));const o=this.initialViewBox.width/n;this.svg.setAttribute("viewBox",`${t} ${s} ${n} ${r}`),this.barreIcones.setAttribute("transform",`translate(${t+this.xbarre/o}, ${s+this.ybarre/o}) scale(${1/o})`)};A.prototype.zoom=function(e,t,s){if(typeof e!="number"||e<1e-6||e>1e6)throw Error(`zoomFactor invalide : ${typeof e} ${e}`);if(e===1)return this.setViewBox(this.initialViewBox);let{x:n,y:r,width:o,height:c}=this.getViewBox();Number.isFinite(t)||(t=n+o/2),Number.isFinite(s)||(s=r+c/2),o=Math.round(o/e),c=Math.round(c/e),n=t-o/2,r=s-c/2,this.setViewBox({x:n,y:r,width:o,height:c})};A.prototype.isReadyAll=function(){if(this.debug){const e=this.actions.filter(t=>!t.isReady);e.length?console.debug(`${e.length} actions pas encore prêtes (sur ${this.actions.length})`):console.debug(`Les ${this.actions.length} actions sont prêtes`)}return this.actions.every(e=>e.isReady)};A.prototype.whenReady=function(e,t=30){const s=()=>setTimeout(n,100),n=()=>{if(this.isReadyAll())return e();if(Date.now()-r<t*1e3)return s();e(Error(`Après ${t}s d’attente l’animation n’est pas prête, échec du chargement…`))},r=Date.now();n()};A.prototype.getReadyPromise=function(e=30){return this.isReadyAll()?Promise.resolve():new Promise((t,s)=>{this.whenReady(n=>{n?s(n):t(this)},e)})};A.prototype.getWidth=function(){return this.getViewBox().width};A.prototype.getHeight=function(){return this.getViewBox().height};A.prototype.getViewBox=function(){try{const e=this.svg.getAttribute("viewBox");if(e){const t=e.split(" ").map(Number).filter(s=>!Number.isNaN(s));if(t.length===4){const[s,n,r,o]=t;if(r>0&&o>0)return{x:s,y:n,width:r,height:o}}}console.error(Error("viewBox invalide"),e)}catch(e){console.error(e)}return this.svg.setAttribute("viewBox",`0 0 ${de} ${pe}`),{x:0,y:0,width:de,height:pe}};A.prototype.goFast=function(e=100,t){const s=this,n=()=>{s.nextStep(),s.indiceActionEnCours<s.actions.length?setTimeout(()=>n(),e):t&&t()};this.getReadyPromise().then(()=>s.animationEnCours?(s.pause(),ei(500)):Promise.resolve()).then(()=>{s.reset(),n()}).catch(r=>{console.error(r),alert(r.message)})};A.prototype.creeElementsGraphiques=function(){this.actions.forEach(e=>e.creegElement())};A.prototype.initialiseOutils=function(){qe.forEach(e=>{this[e].initialisePosition(),this[e].montre(!1)}),this.compas.leve=!1};A.prototype.recreeOutils=function(){qe.forEach(e=>{this[e].updateg(),this[e].montre(!1)}),this.compasLeve=null};A.prototype.init=function(){this.started=!0,this.creeElementsGraphiques(),this.recreeOutils(),this.creeIcones(),this.autoStart?(this.montreIcones(["Pause"]),this.play()):this.montreIcones(["Play"])};A.prototype.creeIcones=function(){const t=this;this.barreIcones=document.createElementNS(l,"g"),this.creeElementsPourIcones(),this.iconReset=Ce(0,0,"fonce"),this.iconResetGris=Ce(0,0,"clair"),this.iconReset.onclick=this.reset.bind(this),this.barreIcones.appendChild(this.iconReset),this.barreIcones.appendChild(this.iconResetGris),this.iconPrevStep=Se(32,0,"fonce"),this.iconPrevStepGris=Se(32,0,"clair"),this.iconPrevStep.onclick=function(){t.prevStep()},this.barreIcones.appendChild(this.iconPrevStep),this.barreIcones.appendChild(this.iconPrevStepGris),this.iconPause=we(64,0,"fonce"),this.iconPauseGris=we(64,0,"clair"),this.iconPause.onclick=this.pause.bind(this),this.barreIcones.appendChild(this.iconPause),this.barreIcones.appendChild(this.iconPauseGris),this.iconPlay=ue(96,0,"fonce"),this.iconPlayGris=ue(96,0,"clair"),this.iconPlay.onclick=this.play.bind(this),this.barreIcones.appendChild(this.iconPlay),this.iconContinue=ue(96,0,"rouge"),this.iconContinue.setAttribute("visibility","hidden"),this.iconContinue.onclick=this.continue.bind(this),this.barreIcones.appendChild(this.iconContinue),this.barreIcones.appendChild(this.iconPlayGris),this.iconRestart=Ne(128,0,"fonce"),this.iconRestartGris=Ne(128,0,"clair"),this.iconRestart.onclick=this.restart.bind(this),this.barreIcones.appendChild(this.iconRestart),this.barreIcones.appendChild(this.iconRestartGris),this.iconNextStep=ve(160,0,"fonce"),this.iconNextStepGris=ve(160,0,"clair"),this.iconNextStep.onclick=function(){t.nextStep()},this.barreIcones.appendChild(this.iconNextStep),this.barreIcones.appendChild(this.iconNextStepGris),this.iconGotoEnd=Ee(192,0,"fonce"),this.iconGotoEndGris=Ee(192,0,"clair"),this.iconGotoEnd.onclick=function(){t.gotoEnd()},this.barreIcones.appendChild(this.iconGotoEnd),this.barreIcones.appendChild(this.iconGotoEndGris),this.iconXML=Pe(224,0,"fonce"),this.iconXMLGris=Pe(224,0,"clair"),this.iconXML.onclick=function(){t.showXml()},this.barreIcones.appendChild(this.iconXML),this.barreIcones.appendChild(this.iconXMLGris),this.iconRepeat=ke(256,0,"fonce"),this.iconRepeatGris=ke(256,0,"clair"),this.iconRepeat.onclick=this.repeat.bind(this),this.barreIcones.appendChild(this.iconRepeat),this.barreIcones.appendChild(this.iconRepeatGris),this.hauteurBarre=32,this.demiLargeurBarre=128,this.xbarre=50,this.ybarre=4,this.barreIcones.setAttribute("transform",`translate(${this.xbarre}, ${this.ybarre})`),this.svg.appendChild(this.barreIcones),this.isDraggingBarre=!1,this.barreIcones.addEventListener("mousedown",function(s){t.mousedownListenerBarre(s.clientX,s.clientY)},!1),this.barreIcones.addEventListener("mousemove",function(s){t.mousemoveListenerBarre(s.clientX,s.clientY)},!1),this.barreIcones.addEventListener("touchstart",function(s){t.mousedownListenerBarre(s.touches[0].pageX,s.touches[0].pageY)},!1),this.barreIcones.addEventListener("touchmove",this.mousemoveListenerBarre.bind(this),!1),this.deltax=0,this.deltay=0};A.prototype.mousedownListenerBarre=function(e,t){this.animationEnCours||(this.isDraggingBarre=!0,this.xcapturebarre=e,this.ycapturebarre=t)};A.prototype.mousemoveListenerBarre=function(){this.animationEnCours?(this.barreIcones.style.cursor="default",this.isDraggingBarre=!1):this.barreIcones.style.cursor="pointer"};A.prototype.mousemoveListenerSvg=function(e,t,s){if(this.isDraggingBarre){const n=this.getWidth(),r=this.getHeight(),o=t-this.xcapturebarre,c=s-this.ycapturebarre,a=this.deltax+o,d=this.deltay+c,p=this.xbarre+a,b=this.ybarre+d;p<=n-2*this.demiLargeurBarre&&p>=0&&b>=0&&b<=r-this.hauteurBarre&&(this.barreIcones.setAttribute("transform","translate("+p+","+b+")"),this.deltax=a,this.deltay=d,this.xcapturebarre=t,this.ycapturebarre=s),e.preventDefault()}};A.prototype.mouseupListener=function(){this.isDraggingBarre=!1};A.prototype.mouseleaveListener=function(){this.isDraggingBarre=!1};A.prototype.showXml=function(){this.windowxml==null?this.windowxml=this.popup():this.windowxml.focus()};A.prototype.montreIcones=function(e){ti.forEach(t=>{const s=e.includes(t),n="icon"+t;this[n]?(this[n].setAttribute("visibility",s?"visible":"hidden"),this[n+"Gris"].setAttribute("visibility",s?"hidden":"visible")):console.error(`L’icone ${n} n’existe pas`)})};A.prototype.activeIconeContinuer=function(){this.montreIcones(["XML"]),this.iconPlayGris.setAttribute("visibility","hidden"),this.iconContinue.setAttribute("visibility","visible")};A.prototype.gotoEnd=function(){this.animationEnCours=!1,this.initialise(),this.montreIcones(["Reset","PrevStep","Restart","XML","Repeat"]),this.executeJusque(this.actions.length-1),this.indiceActionEnCours=this.actions.length};A.prototype.play=function(){this.animationEnCours=!0,this.montreIcones(["Pause"]),this.actions[this.indiceActionEnCours]?this.actions[this.indiceActionEnCours].execute(!1):console.error(Error(`Pas d'action ${this.indiceActionEnCours}`),this.actions)};A.prototype.continue=function(){if(this.indiceActionEnCours===this.actions.length){this.gotoEnd();return}this.iconContinue.setAttribute("visibility","hidden"),this.montreIcones(["Pause"]),this.animationEnCours=!0,this.indiceActionEnCours++,this.actions[this.indiceActionEnCours]?this.actions[this.indiceActionEnCours].execute(!1):console.error(Error(`Pas d'action ${this.indiceActionEnCours}`),this.actions)};A.prototype.reset=function(){this.animationEnCours=!1,this.initialise(),this.montreIcones(["Play","NextStep","GotoEnd","XML","Repeat"]),this.indiceActionEnCours=0,this.zoom(1)};A.prototype.restart=function(){if(this.animationEnCours){this.animationEnCours=!1,setTimeout(this.restart.bind(this),100);return}this.initialise(),this.indiceActionEnCours=0,this.zoom(1),this.play()};A.prototype.repeat=function(){if(this.animationEnCours){this.animationEnCours=!1,setTimeout(this.repeat.bind(this),100);return}this.animationEnCours=!0,this.animationEnBoucle=!0,this.initialise(),this.montreIcones(["Pause"]),this.indiceActionEnCours=0,this.zoom(1),this.actions[0].execute(!1)};A.prototype.pause=function(){this.animationEnBoucle=!1,this.animationEnCours=!1,setTimeout(()=>this.montreIcones(["Reset","PrevStep","Play","Restart","NextStep","GotoEnd","XML","Repeat"]),500)};A.prototype.nextStep=function(){const e=this.actions.length;this.animationEnCours=!1,this.indiceActionEnCours<e&&(this.actions[this.indiceActionEnCours].actionVisible()?this.indiceActionEnCours++:this.indiceActionEnCours=this.indiceProchaineActionVisible(this.indiceActionEnCours)+1,this.executeJusque(this.indiceActionEnCours-1));const t=this.indiceActionEnCours===this.actions.length,s=["Reset","PrevStep","Restart","XML","Repeat"];t?this.montreIcones(s):this.montreIcones(s.concat(["NextStep","GotoEnd","Play"]))};A.prototype.prevStep=function(){this.animationEnCours=!1,this.indiceActionEnCours=this.indicePrecedenteActionVisible(this.indiceActionEnCours-1),this.indiceActionEnCours>0&&this.executeJusque(this.indiceActionEnCours-1);const e=["Play","NextStep","GotoEnd","XML","Repeat"];this.indiceActionEnCours===0?this.montreIcones(e):this.montreIcones(e.concat(["Reset","PrevStep"]))};A.prototype.initialise=function(){let e,t;const s=this.svg;for(e=0;e<s.childNodes.length;e++)if(t=s.childNodes[e],t!==this.barreIcones)try{s.childNodes[e].setAttribute("visibility","hidden")}catch(n){console.error(n)}for(e=0;e<this.actions.length;e++){const n=this.actions[e];n instanceof _&&n.objet.initialisePosition()}this.initialiseOutils()};A.prototype.getInstrumentVisibility=function(e,t){if(t===-1)return!1;let s,n=!1;for(let r=0;r<=t;r++)s=this.actions[r],s instanceof Rt?s.instrument===e&&(n=!0):s instanceof Lt&&s.instrument===e&&(n=!1);return n};A.prototype.getObjectVisibility=function(e,t){if(t===-1)return!1;let s,n=!1;for(let r=0;r<=t;r++)s=this.actions[r],s instanceof jt?s.objet===e&&(n=!0):s instanceof Ot&&s.objet===e&&(n=!1);return n};A.prototype.getCompasStatus=function(e){if(e===-1)return"couche";let t=!0,s;for(let n=0;n<=e;n++)s=this.actions[n],s instanceof Mt?t=!0:s instanceof Ft&&(t=!1);return t?"couche":"leve"};A.prototype.indiceProchaineActionVisible=function(e){if(e>=this.actions.length)return this.actions.length-1;for(let t=e;t<this.actions.length;t++)if(this.actions[t].actionVisible())return t;return this.actions.length-1};A.prototype.indicePrecedenteActionVisible=function(e){if(e<0)return 0;e===this.actions.length&&e--;for(let t=e;t>=0;t--)if(this.actions[t].actionVisible())return t;return 0};A.prototype.montreInstrumentsEtape=function(e){let t=this.getInstrumentVisibility(this.compas,e);this.compas.leve?this.compasLeve.montre(t):this.compas.montre(t),t=this.getInstrumentVisibility(this.crayon,e),this.crayon.montre(t),t=this.getInstrumentVisibility(this.equerre,e),this.equerre.montre(t),t=this.getInstrumentVisibility(this.rapporteur,e),this.rapporteur.montre(t),t=this.getInstrumentVisibility(this.regle,e),this.regle.montre(t),t=this.getInstrumentVisibility(this.requerre,e),this.requerre.montre(t)};A.prototype.executeJusque=function(e){if(!(e>=this.actions.length)){this.initialise(),this.initialiseOutils(),this.animationEnCours=!1;for(let t=0;t<=e;t++)this.actions[t].execute(!0);this.montreInstrumentsEtape(e)}};A.prototype.addElement=function(e){const t=this.elements.findIndex(s=>s.id===e.id&&s.objet===e.objet);t!==-1?this.elements[t]=e:this.elements.push(e)};A.prototype.pushElement=function(e){if(this.elements.some(t=>t.id===e.id&&t.objet===e.objet))throw Error(`Il y a déjà un élément ${e.id} désignant le même objet`);this.elements.push(e)};A.prototype.getElement=function(e,t){return this.elements.find(n=>n.objet===t?t==="quadrillage"?!0:n.id===e:!1)||null};A.prototype.setElement=function(e,t){const s=this.elements.findIndex(n=>n.id===e);return s!==-1?(this.elements[s]=t,!0):!1};A.prototype.ajouteAction=function(e){e.indice=this.actions.length,this.actions.push(e)};A.prototype.creeActions=function(){let e,t,s,n,r,o,c,a,d,p,b,u,g,f,h,w,y,S,j,M,I,F,E;for(e=0;e<this.tabact.length;e++){t=this.tabact[e],p=bt(t),s=t.getAttribute("mouvement"),y=t.getAttribute("tempo");try{let O,G;switch(s){case"creer":if(n=t.getAttribute("objet"),this.getElement(p,n)!==null){console.error(`L'id ${p} existe déjà, action creer ignorée`,n);break}if(n!=null){switch(n){case"point":r=new st(this,p,parseFloat(nt(t)),parseFloat(rt(t)),R(t),T(t)),o=new _(this,p,r,y);break;case"angle":r=new be(this,p,nt(t),rt(t),t.getAttribute("rayon"),t.getAttribute("angle1"),t.getAttribute("angle2"),R(t),T(t),si(t),t.getAttribute("forme")),o=new _(this,p,r,y);break;case"angle_droit":r=new Ut(this,p,t.getAttribute("abscisse_sommet"),t.getAttribute("ordonnee_sommet"),t.getAttribute("abscisse_inter"),t.getAttribute("ordonnee_inter"),R(t),T(t)),o=new _(this,p,r,y);break;case"longueur":r=new $t(this,p,nt(t),rt(t),R(t),T(t),t.getAttribute("forme")),o=new _(this,p,r,y);break;case"marque":r=new Vt(this,p,t.getAttribute("idSeg"),R(t),T(t),t.getAttribute("forme"),t.getAttribute("rayon")),o=new _(this,p,r,y);break;case"texte":r=new W(this,p,nt(t),rt(t),R(t),t.getAttribute("taille")),o=new _(this,p,r,y);break;case"repere":r=new dt(this,t.getAttribute("hauteur"),t.getAttribute("largeur"),t.getAttribute("haut"),t.getAttribute("gauche"),t.getAttribute("Xgrad"),t.getAttribute("Ygrad"),t.getAttribute("Xmin"),t.getAttribute("Xmax"),t.getAttribute("Ymin"),t.getAttribute("Ymax"),R(t),t.getAttribute("grille"),t.getAttribute("axes"),t.getAttribute("etiquettes")),o=new _(this,p,r,y);break;case"quadrillage":if(O=t.getAttribute("abscisse_bas_droite"),O!=null){O=parseFloat(O)/30;const z=parseFloat(t.getAttribute("ordonnee_bas_droite"))/30,L=parseFloat(t.getAttribute("abscisse_haut_gauche"))/30,pt=parseFloat(t.getAttribute("ordonnee_haut_gauche"))/30;r=new Pt(this,t.getAttribute("quadrillage"),String(z-pt),String(O-L),pt,L,R(t)),o=new _(this,"quadrillageIEP",r,y)}else r=new Pt(this,t.getAttribute("quadrillage"),t.getAttribute("hauteur"),t.getAttribute("largeur"),t.getAttribute("haut"),t.getAttribute("gauche"),R(t));o=new _(this,"quadrillageIEP",r,y);break;case"axe":r=new ct(this,t.getAttribute("pente"),t.getAttribute("largeur"),t.getAttribute("haut"),t.getAttribute("gauche"),t.getAttribute("distanceBord"),t.getAttribute("Xgrad"),t.getAttribute("Xmin"),t.getAttribute("Xmax"),R(t)),o=new _(this,p,r,y);break;case"gabarit":G=t.getAttribute("ecart_angle"),G===null&&(G="-30"),r=new it(this,p,t.getAttribute("abscisse"),t.getAttribute("ordonnee"),t.getAttribute("rayon"),G,R(t),T(t),Xt(t),Q(t)),o=new _(this,p,r,y);break;default:console.error("objet inconnu => création ignorée"),o=null}o&&(this.ajouteAction(o),o.setReady())}break;case"montrer":n=t.getAttribute("objet"),St(n)?(f=t.getAttribute("abscisse"),h=t.getAttribute("ordonnee"),o=new Rt(this,this[n],f,h,y),(n==="crayon"||n==="compas")&&f!=null&&h!=null&&this[n].translate(parseFloat(f),parseFloat(h))):o=new jt(this,p,n,y),this.ajouteAction(o),o.setReady();break;case"masquer":n=t.getAttribute("objet"),St(n)?o=new Lt(this,this[n],y):o=new Ot(this,p,n,y),this.ajouteAction(o),o.setReady();break;case"tracer":switch(n=t.getAttribute("objet"),E=t.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),f=r.xcons,h=r.ycons):(f=parseFloat(nt(t)),h=parseFloat(rt(t))),n){case"crayon":switch(c=t.getAttribute("forme"),a=this.crayon.x,d=this.crayon.y,p=bt(t),c){case null:isNaN(f)||isNaN(h)?(r=new tt(this,p,this.crayon.x,this.crayon.y,t.getAttribute("abscisses"),t.getAttribute("ordonnees"),R(t),T(t),Q(t),ot(t),gt(t)),S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1])):(r=new kt(this,p,a,d,f,h,R(t),T(t),Q(t),ot(t),gt(t)),this.crayon.translate(f,h));break;case"droite":if(isNaN(f)||isNaN(h))break;r=new ht(this,p,a,d,f,h,R(t),T(t),Q(t),ot(t),gt(t)),this.crayon.translate(f,h);break;case"demidroite":if(isNaN(f)||isNaN(h))break;r=new ge(this,p,a,d,f,h,R(t),T(t),Q(t),ot(t),gt(t)),this.crayon.translate(f,h);break;case"polygone":if(w=t.getAttribute("cibles"),w===null)r=new et(this,p,t.getAttribute("abscisses"),t.getAttribute("ordonnees"),R(t),T(t),Xt(t),t.getAttribute("opacite"));else{let z="",L="";w.split(",").forEach((pt,vt)=>{const Tt=vt===0?"":",",qt=this.getElement(pt,"point");z+=Tt+qt.xcons,L+=Tt+qt.ycons}),r=new et(this,p,z,L,R(t),T(t),Xt(t),t.getAttribute("opacite"))}S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1]);break;case"libre":r=new tt(this,p,this.crayon.x,this.crayon.y,t.getAttribute("abscisses"),t.getAttribute("ordonnees"),R(t),T(t),Q(t),ot(t),gt(t)),S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1])}g=t.getAttribute("vitesse"),g==null&&(g="4"),o=new _(this,bt(t),r,y,g),this.ajouteAction(o),o.setReady();break;case"trait":g=t.getAttribute("vitesse"),g===null&&(g=1e4),r=new kt(this,p,t.getAttribute("abscisse1"),t.getAttribute("ordonnee1"),t.getAttribute("abscisse2"),t.getAttribute("ordonnee2"),R(t),T(t),Q(t),ot(t),gt(t)),o=new _(this,bt(t),r,y,g),this.ajouteAction(o),o.setReady();break;case"compas":r=new lt(this,p,this.compas.x,this.compas.y,this.compas.ecart,this.getAngle(t,"debut"),this.getAngle(t,"fin"),R(t),T(t),Q(t),ot(t)),g=t.getAttribute("sens"),g==null&&(g="8"),o=new _(this,bt(t),r,y,g),this.ajouteAction(o),o.setReady();break;case"angle_droit":r=new Ut(this,p,t.getAttribute("abscisse_sommet"),t.getAttribute("ordonnee_sommet"),t.getAttribute("abscisse_inter"),t.getAttribute("ordonnee_inter"),R(t),T(t)),o=new _(this,bt(t),r,y,g),this.ajouteAction(o),o.setReady();break}break;case"rotation":n=t.getAttribute("objet"),u=t.getAttribute("sens"),St(n)?(E=t.getAttribute("cible"),E!=null&&t.getAttribute("angle")===null?(r=this.getElement(E,"point"),f=r.xcons,h=r.ycons,M=new P(this[n].x,this[n].y,f,h),M.presqueNul()?b=0:b=-M.angle()):n==="compas"?b=this.getAngle(t,"angle"):b=t.getAttribute("angle"),o=new se(this,this[n],b,y,u)):this.getElement(p,n)===null?o=null:(b=t.getAttribute("angle"),o=new re(this,p,b,n,y,u)),o!==null&&(this.ajouteAction(o),o.setReady());break;case"translation":n=t.getAttribute("objet"),E=t.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),f=r.xcons,h=r.ycons):(f=parseFloat(nt(t)),h=parseFloat(rt(t))),g=t.getAttribute("vitesse"),St(n)?(this[n].x=f,this[n].y=h,o=new oe(this,this[n],f,h,y,g)):this.getElement(p,n)===null?o=null:(n==="point"&&(F=this.getElement(p,"point"),F.xcons=f,F.ycons=h),o=new ae(this,p,f,h,n,y,g)),o!==null&&(this.ajouteAction(o),(n==="crayon"||n==="compas")&&this[n].translate(f,h),o.setReady());break;case"zoom":n=t.getAttribute("objet"),g=t.getAttribute("vitesse"),St(n)?(I=t.getAttribute("echelle"),this[n].zoomfactor=parseFloat(I)/100,o=new le(this,this[n],I,y,g)):n==="texte"||n==="image"?o=new ce(this,p,t.getAttribute("echelle"),n,y,g):o=null,o!==null&&(this.ajouteAction(o),o.setReady());break;case"ecarter":E=t.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),M=new P(this.compas.x,this.compas.y,r.xcons,r.ycons),j=M.norme()):j=parseFloat(t.getAttribute("ecart"))*this.compas.zoomfactor,this.compas.ecart=j,o=new Kt(this,j,y,t.getAttribute("vitesse")),this.ajouteAction(o),o.setReady();break;case"lever":o=new Ft(this,y),this.ajouteAction(o),o.setReady();break;case"coucher":o=new Mt(this,y),this.ajouteAction(o),o.setReady();break;case"masquer_nombres":o=new Nt(this,!1,y),this.ajouteAction(o),o.setReady();break;case"montrer_nombres":o=new Nt(this,!0,y),this.ajouteAction(o),o.setReady();break;case"graduations":n=t.getAttribute("objet"),o=new Ct(this,this[n],!0,y),this.ajouteAction(o),o.setReady();break;case"vide":n=t.getAttribute("objet"),o=new Ct(this,this[n],!1,y),this.ajouteAction(o),o.setReady();break;case"retourner":this.compasRetourne=!this.compasRetourne,o=new ne(this,y),this.ajouteAction(o),o.setReady();break;case"glisser":o=new te(this,t.getAttribute("abscisse"),y,t.getAttribute("vitesse")),this.ajouteAction(o),o.setReady();break;case"chargement":r=new ut(this,p,t.getAttribute("url")),r.prepareAction();break;case"ecrire":o=new Z(this,p,R(t),t.getAttribute("taille"),t.getAttribute("texte"),t.getAttribute("style"),Xt(t),t.getAttribute("opacite_fond"),ii(t),t.getAttribute("epaisseur_cadre"),t.getAttribute("marge"),t.getAttribute("marge_gauche"),t.getAttribute("marge_droite"),t.getAttribute("marge_haut"),t.getAttribute("marge_bas"),y),this.ajouteAction(o),o.prepare();break;case"nommer":if(this.getElement(p,"point")!==null){const z=t.getAttribute("nom");z!==""&&(r=new wt(this,p,nt(t),rt(t),z,R(t)),o=new _t(this,r,y),this.ajouteAction(o),o.prepare())}break;case"pause":o=new ie(this,y),this.ajouteAction(o),o.setReady();break;case"modifier_longueur":n=t.getAttribute("objet"),o=new ee(this,this[n],t.getAttribute("longueur"),y),this.ajouteAction(o),o.setReady();break;case"modifier_rayon":n=t.getAttribute("objet"),o=new he(this,p,t.getAttribute("rayon"),n,y),this.ajouteAction(o),o.setReady();break}}catch(O){console.error(O)}}this.getReadyPromise().then(this.init.bind(this)).catch(O=>{console.error(O),window.alert(O.message)})};A.prototype.execute=function(e){this.indiceActionEnCours=0,this.actions[0].execute(e)};A.prototype.actionSuivante=function(e){if(e=!!e,!this.animationEnCours&&!e)return;const t=this.actions[this.indiceActionEnCours];t.tempo===null||e?this.passageActionSuivante(e):setTimeout(this.passageActionSuivante.bind(this,e),t.tempo)};A.prototype.passageActionSuivante=function(e){if(!(this.indiceActionEnCours>=this.actions.length))if(this.indiceActionEnCours!==this.actions.length-1)this.indiceActionEnCours++,this.actions[this.indiceActionEnCours].execute(e);else if(this.animationEnBoucle){const t=this;setTimeout(function(){t.initialise(),t.indiceActionEnCours=0,t.actions[t.indiceActionEnCours].execute(e)},3e3)}else this.indiceActionEnCours++,this.montreIcones(["Reset","PrevStep","Restart","XML","Repeat"]),this.animationEnCours=!1};A.prototype.getAngle=function(e,t){const s=e.getAttribute(t);return s==null?null:this.compasRetourne?String(parseFloat(s)+180):s};A.prototype.creeElementsPourIcones=function(){let e=document.createElementNS(l,"defs");e.appendChild(this.radialGradiant("#9999FF","#000099","radialfonce")),this.svg.appendChild(e),e=document.createElementNS(l,"defs"),e.appendChild(this.radialGradiant("#CCCCCC","#666666","radialclair")),this.svg.appendChild(e),e=document.createElementNS(l,"defs"),e.appendChild(this.radialGradiant("#FF9999","#FF0000","radialrouge")),this.svg.appendChild(e),e=document.createElementNS(l,"defs"),e.appendChild(this.markerArrow("markerarrow")),this.barreIcones.appendChild(e),e=document.createElementNS(l,"defs"),e.appendChild(this.filtreEclairageIcone("filtrebleu")),this.barreIcones.appendChild(e),e=document.createElementNS(l,"defs"),e.appendChild(this.filtreEclairageIcone("filtregris")),this.barreIcones.appendChild(e)};A.prototype.radialGradiant=function(e,t,s){const n=document.createElementNS(l,"radialGradient");n.setAttribute("id",s);let r=document.createElementNS(l,"stop");return r.setAttribute("offset","0%"),r.setAttribute("style","stop-color:"+t+";"),n.appendChild(r),r=document.createElementNS(l,"stop"),r.setAttribute("offset","80%"),r.setAttribute("style","stop-color:"+e+";"),n.appendChild(r),r=document.createElementNS(l,"stop"),r.setAttribute("offset","100%"),r.setAttribute("style","stop-color:"+t+";"),n.appendChild(r),n};A.prototype.markerArrow=function(e){const t=document.createElementNS(l,"marker");t.setAttribute("id",e),t.setAttribute("markerWidth","4"),t.setAttribute("markerHeight","4"),t.setAttribute("refX","0"),t.setAttribute("refY","2"),t.setAttribute("orient","auto");const s=document.createElementNS(l,"path");return s.setAttribute("d","M 0 0 2 2 0 4 Z"),s.setAttribute("style","fill:white;"),t.appendChild(s),t};A.prototype.filtreEclairageIcone=function(e){const t=document.createElementNS(l,"filter");t.setAttribute("x","0"),t.setAttribute("y","0"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("color-interpolation-filters","sRGB");const s=document.createElementNS(l,"feDiffuseLighting");s.setAttribute("lighting-color","white"),s.setAttribute("surfaceScale","1"),s.setAttribute("diffuseConstant","1.2"),s.setAttribute("in","SourceGraphic"),s.setAttribute("result","diffOut");const n=document.createElementNS(l,"fePointLight");n.setAttribute("x","5"),n.setAttribute("y","5"),n.setAttribute("z","15"),s.appendChild(n),t.appendChild(s);const r=document.createElementNS(l,"feComposite");return r.setAttribute("in","SourceGraphic"),r.setAttribute("in2","diffOut"),r.setAttribute("operator","arithmetic"),r.setAttribute("k1","1"),r.setAttribute("k2","0"),r.setAttribute("k3","0"),r.setAttribute("k4","0"),t.appendChild(r),t.setAttribute("id",e),t};A.prototype.popup=function(){const e=window.open("","popup","width=700,height=450,toolbar=no,scrollbars=no,resizable=yes");e.iepDoc=this;const t=e.document;t.title="Code Xml de la figure";const s=t.createElement("div"),n=t.createElement("form");s.appendChild(n),s.setAttribute("align","center"),t.body.appendChild(s);const r=t.createElement("textarea");n.appendChild(r),r.setAttribute("cols",80),r.setAttribute("rows",25),r.setAttribute("readonly",!0),r.style.fontSize="13px",r.scrollIntoView();let o=this.codexml;o=o.replace(/>\s*</g,`>
<`),r.appendChild(document.createTextNode(o)),r.select();const c=this;return e.addEventListener("unload",()=>{c.windowxml=null}),e};function Ge(i){i.docs.forEach(e=>{e.windowxml&&e.windowxml.close()})}function zt(i){this.debug=!!(i&&i.debug),this.debug&&console.debug("Mode debug activé"),this.docs=[],window.addEventListener("unload",Ge.bind(null,this))}zt.prototype.addDoc=function(e,t,s=!0){if(typeof e=="string"&&(e=document.getElementById(e)),!e)return new Error("svg manquant");if(e.localName!=="svg")return new Error("svg incorrect");const n={autoStart:s,debug:this.debug},r=new A(e,t,n);return this.docs.push(r),e.iepDoc=r,r};zt.prototype.flush=function(){Ge(this),this.docs.forEach(({svg:e})=>{e.parentNode?e.parentNode.removeChild(e):console.error("le svg",e,"n’a pas de parentNode")}),this.docs=[]};zt.prototype.getDocs=function(){return this.docs};zt.prototype.getLastDoc=function(){const e=this.docs.length;return e?this.docs[e-1]:null};const{addElement:Me,empty:ni,setStyles:Be}=Le;let Zt;function ri(i){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.classList.add("svgIep"),i.appendChild(e),Be(e,{margin:0,padding:0,width:"98%",height:"98%"}),e}function oi(i){const e=i.parentNode;e.style.resize="both",e.style.padding="0",e.style.border="1px solid black";const t={position:"absolute",zIndex:99,textAlign:"center",padding:0,width:"2.5em",height:"1.8em",left:"0.1em"};Me(e,"button",{style:{...t,top:"0.1em"}},"+").addEventListener("click",()=>i.iepDoc.zoom(1.1),!1),Me(e,"button",{style:{...t,top:"2em"}},"-").addEventListener("click",()=>i.iepDoc.zoom(.9),!1)}function ai(i){return window.location.protocol==="https:"&&i.substr(0,5)==="http:"?Promise.reject(Error(`Impossible de charger ici un script externe qui n’est pas en https (${i})`)):fetch(i,{Accept:"text/xml"}).catch(e=>{throw console.error(e),Error(`Impossible de récupérer le xml ${i}`)}).then(e=>{const{status:t,statusText:s,ok:n}=e;if(t>399)throw Error(`Impossible de récupérer le xml ${i} (erreur ${t} ${s})`);if(!n)throw Error(`Impossible de récupérer le xml ${i}`);return e.text()}).then(e=>{if(!e||!/<INSTRUMENPOCHE/.test(e))throw Error(`L’url ${i} ne retourne pas de script instrumenpoche en xml`);return e})}async function pi(i,e,t){if(typeof t!="object"&&(t={}),typeof window>"u"||!window.document)throw Error("iepLoad doit être utilisé dans un navigateur");if(typeof i=="string"&&(i=document.getElementById(i)),!(i instanceof HTMLElement))throw Error("Conteneur html manquant");if(typeof e!="string")throw Error("Script xml manquant");if(/^http/.test(e)&&(e=await ai(e)),!e||!/<INSTRUMENPOCHE/.test(e))throw Error("Ce n’est pas un script instrumenpoche valide");window.location.protocol==="https:"&&(e=e.replace(/http:\/\/([a-z]+.sesamath.net)/g,(o,c)=>`https://${c}`)),ni(i),Be(i,{position:"relative",overflow:"auto"});const s=ri(i),n={};t.debug&&(n.debug=!0),Zt||(Zt=new zt(n));const r=typeof t.autostart=="boolean"?t.autostart:!0;return Zt.addDoc(s,e,r),t.zoom&&oi(s),Zt}const Ie=60,li="https://www.mathgraph32.org/js/MathJax3/es5/tex-svg.js",Fe={tex:{inlineMath:[["$","$"],["\\(","\\)"]],packages:{"[+]":["color","unicode"]}},svg:{mtextInheritFont:!0},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},loader:{load:["[tex]/noerrors","[tex]/color","[tex]/unicode"]}};let Ht;function ci(){return Ht||(Ht=new Promise((i,e)=>{if(typeof MathJax=="object"&&/^3\./.test(MathJax.version))return MathJax.config=Fe,i();window.MathJax=Fe,MathJax.startup={ready:()=>{clearTimeout(r),MathJax.startup.defaultReady(),MathJax.startup.promise.then(()=>{i()})}};const t=document.createElement("script");t.type="text/javascript",t.crossOrigin="anonymous";const s=window.mathJax3BaseUrl?`${window.mathJax3BaseUrl}es5/tex-svg.js`:li;t.src=s,document.getElementsByTagName("head")[0].appendChild(t);const r=setTimeout(()=>{e(Error(`Mathjax non chargé après ${Ie}s d’attente (${s})`))},Ie*1e3)}),Ht)}const De=Object.freeze(Object.defineProperty({__proto__:null,default:ci},Symbol.toStringTag,{value:"Module"}));export{pi as default};
//# sourceMappingURL=instrumenpoche-Cz8xuUm-.js.map
