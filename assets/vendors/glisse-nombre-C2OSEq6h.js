const a={UNITS_WIDTH:{sm:"2em",md:"5em",lg:"6em"},UNITS_HEIGHT:{sm:"2em",md:"2em",lg:"2em"},UNITS_TEXT_SIZE:{sm:"1em",md:"0.875em",lg:"1em"},PERIODS:{sm:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""],md:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""],lg:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""]},UNITS:{sm:["C","D","U","C","D","U","d","c","m"],md:["Centaines","Dizaines","Unités","Centaines","Dizaines","Unités","Dixièmes","Centièmes","Millièmes"],lg:["Centaines","Dizaines","Unités","Centaines","Dizaines","Unités","Dixièmes","Centièmes","Millièmes"]},UNIT_DIGIT_INDEX:5,HIGHLIGHTCOLOR:{primary:"bg-coopmaths-struct",secondary:"bg-coopmaths-struct-light"}};function w(o){const{table:t,overlay:e}=o,i=t.rows[t.rows.length-1];if(!i)return 0;const s=parseFloat(e.style.left),n=v(o);return(s-i.offsetLeft+n)/i.offsetWidth}function E(o,t){const e=o.table,i=e.rows[e.rows.length-1];if(!i)return 0;const s=v(o);return t*i.offsetWidth+i.offsetLeft+s}function u(o,t={}){const{table:e,overlay:i,initialPower:s}=o,n=e.rows[e.rows.length-1];if(!n)return 0;const r=n.cells.length,l=n.cells[0],c=parseFloat(window.getComputedStyle(l).width),h=parseFloat(window.getComputedStyle(l).borderWidth),d=v(o);i.style.top=`${n.offsetTop-d-h/4}px`,i.style.width=`${i.children.length*c}px`,i.style.height=`${n.offsetHeight+h/2}px`,(t.newLeft==null||Number.isNaN(t.newLeft))&&(t.newLeft=n.offsetLeft-(r-a.UNIT_DIGIT_INDEX+s-1)*c);const m=n.offsetLeft-(r-1)*c,f=n.offsetLeft,g=Math.max(m,Math.min(t.newLeft,f))-d;i.style.left=`${g}px`;const D=Math.round((g-m)/c);o.pow=a.UNIT_DIGIT_INDEX-s-D,o.handleCalculus({moveOverlayOriginRank:!!t.moveOverlayOriginRank}),o.handleZerosOfOverlay(),o.handleCommas(),o.lastPositionRatio=w(o)}function v(o){if(!/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return 0;const e=o.table,i=e.rows[e.rows.length-1].cells[0];return parseFloat(window.getComputedStyle(i).borderWidth)/2}function R(o){let t=!1,e,i;const{overlay:s,table:n}=o,r=n.rows[n.rows.length-1],l=d=>{o.animation===0&&(d.preventDefault(),t=!0,r.classList.remove("cursor-grab"),s.classList.remove("cursor-grab"),document.body.classList.add("cursor-grabbing"),e="touches"in d?d.touches[0].clientX:d.clientX,i=parseFloat(window.getComputedStyle(s).left)||0,document.addEventListener("mousemove",c),document.addEventListener("mouseup",h),document.addEventListener("touchmove",c),document.addEventListener("touchend",h))},c=d=>{if(!t)return;const f=("touches"in d?d.touches[0].clientX:d.clientX)-e,g=i+f;u(o,{newLeft:g})},h=()=>{if(!t)return;t=!1,r.classList.add("cursor-grab"),s.classList.add("cursor-grab"),document.body.classList.remove("cursor-grabbing"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h);const d=w(o),f=Math.round(d*a.UNITS.lg.length)/a.UNITS.lg.length*r.offsetWidth+r.offsetLeft;s.style.transition="left 0.2s ease-out",u(o,{newLeft:f,moveOverlayOriginRank:!0}),s.addEventListener("transitionend",()=>{s.style.transition=""},{once:!0})};return r.classList.add("cursor-grab"),o.animation!==0&&(s.classList.remove("cursor-grab"),r.classList.remove("cursor-grab")),s.addEventListener("mousedown",l),s.addEventListener("touchstart",l,{passive:!1}),u(o,{moveOverlayOriginRank:!0}),()=>{document.body.classList.remove("cursor-grabbing"),r.classList.remove("cursor-grab"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h),r.removeEventListener("mousedown",l),r.removeEventListener("touchstart",l),s.removeEventListener("mousedown",l),s.removeEventListener("touchstart",l)}}function x(o,t){if(!o)throw new Error("Table element not found");const e=o.rows[2];if(!e)throw new Error("Editable row not found");for(const i of e.cells)i.contentEditable="true",i.classList.add("text-center","text-coopmaths","font-bold"),i.setAttribute("inputmode","numeric"),i.addEventListener("focus",()=>{var n;const s=window.getSelection();if(s){s.removeAllRanges();const r=document.createRange();i.firstChild&&i.firstChild.nodeType===Node.TEXT_NODE&&/\S/.test(((n=i.firstChild.textContent)==null?void 0:n.charAt(0))||"")&&(r.setStart(i.firstChild,0),r.setEnd(i.firstChild,1),s.addRange(r))}}),i.addEventListener("keydown",s=>{s.preventDefault();const n=i.nextElementSibling;if(s.key==="ArrowLeft"||s.key==="Tab"&&s.shiftKey){const r=i.previousElementSibling;r instanceof HTMLTableCellElement&&r.focus()}else if(s.key==="Enter"||s.key==="ArrowRight"||s.key==="Tab")n instanceof HTMLTableCellElement&&n.focus();else if(s.key==="Backspace"||s.key==="Delete"){const r=Array.from(i.childNodes).find(l=>l.nodeType===Node.TEXT_NODE);r&&(r.nodeValue=" "),t(b(o))}else if(/^[0-9]$/.test(s.key)){const r=Array.from(i.childNodes).find(l=>l.nodeType===Node.TEXT_NODE);r?r.nodeValue=s.key:i.insertBefore(document.createTextNode(s.key),i.firstChild),n instanceof HTMLTableCellElement&&n.focus(),t(b(o))}})}function b(o){var i;const t=o.rows[2];if(!t)throw new Error("Editable row not found");const e=new Array(a.UNITS.lg.length);for(let s=0;s<t.cells.length;s++){const n=(i=t.cells[s].textContent)==null?void 0:i.trim().replace(",","");n!==""&&(e[s]=Number(n))}return e}const p=1,I=5,H=7,T=1e3;function y(o){if(o.animation===0)return;const t=_(o),e=S(o);setTimeout(()=>{const{animationState:i}=o;i==="pause"?o.animationStep>I||o.animationStep<=p?o.animationStep=p:o.animationStep=I:i==="play"&&(o.animationStep===p?(L(o,t,e,3*T),o.animationStep+=1):o.animationStep===I?(L(o,e,t,T/2),o.animationStep+=1):o.animationStep>=H?o.animationStep=p:o.animationStep+=1),y(o)},T)}function O(o){u(o,{newLeft:S(o),moveOverlayOriginRank:!0}),o.animationStep=I}function U(o){u(o,{newLeft:_(o),moveOverlayOriginRank:!0}),o.animationStep=p}function _(o){const{table:t,initialPower:e}=o,i=t.rows[t.rows.length-1];if(!i)return 0;const s=i.cells.length;return i.offsetLeft-(s-a.UNIT_DIGIT_INDEX+e-1)*C(o)}function S(o){const t=C(o);return _(o)-o.animation*t}function C(o){const{table:t}=o,e=t.rows[t.rows.length-1];if(!e)return 0;const i=e.cells[0];return parseFloat(window.getComputedStyle(i).width)}function L(o,t,e,i){const s=performance.now(),n=l=>-(Math.cos(Math.PI*l)-1)/2,r=l=>{if(o.animationState==="stop")return;const c=l-s,h=Math.min(c/i,1),d=n(h),m=t+(e-t)*d;c<i?(u(o,{newLeft:m}),requestAnimationFrame(r)):u(o,{newLeft:m,moveOverlayOriginRank:!0})};requestAnimationFrame(r)}class N extends HTMLElement{constructor(){super(...arguments),this.animation=0,this.animationState="play",this.animationStep=1,this.container=document.createElement("div"),this.divCalculus=document.createElement("div"),this.editableRowDigits=[],this.hasToHandleZeros=!0,this.hasToRemoveLeftZeros=!1,this.hasToShowComma1=!0,this.hasToShowComma2=!0,this.initialPower=0,this.lastPositionRatio=0,this.number=0,this.overlay=document.createElement("div"),this.overlayDigitSpans=[],this.pow=0,this.table=document.createElement("table"),this._comma1IsVisible=!0,this._comma2IsVisible=!0,this._isCalculusVisible=!1,this._currentSize="sm",this._onResize=()=>{this._updateSizes(),this.handleCalculus()},this._loopIcon=this._buildIcon(`
    <svg width="20px" height="20px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        d="M6.67 15H5.83C4.45 15 3.33 13.88 3.33 12.5V7.5C3.33 6.12 4.45 5 5.83 5H14.17C15.55 5 16.67 6.12 16.67 7.5V12.5C16.67 13.88 15.55 15 14.17 15H10M10 15L12.5 12.5M10 15L12.5 17.5"
      />
    </svg>`),this._pauseIcon=this._buildIcon(`
    <rect x="6" y="4" width="2.5" height="12"/>
    <rect x="11.5" y="4" width="2.5" height="12"/>`)}static get observedAttributes(){return["add-zeros","remove-left-zeros","number","show-comma1","show-comma2","initial-power","animation","show-calculus","orientation"]}connectedCallback(){if(this.container=document.createElement("div"),this.container.classList.add("relative","overflow-hidden","w-fit","flex","flex-col","items-center","justify-center"),this.table=this._buildTable(),this.container.appendChild(this.table),this.overlay=this._buildOverlay(),this.table.appendChild(this.overlay),this.divCalculus=this._buildDivCalculus(),this.appendChild(this.divCalculus),this.animation!==0){const t=this._buildAnimationControlButtons();this.container.appendChild(t)}return this.appendChild(this.container),this._setInitialNumber(),x(this.table,this._setDigits.bind(this)),R(this),this._startResizeObservation(),this._startAnimation(),()=>{this._stopResizeObservation,this._stopAnimation()}}attributeChangedCallback(t,e,i){e!==i&&(t==="add-zeros"&&(this.hasToHandleZeros=i==="true",this._writeDigits()),t==="remove-left-zeros"&&(this.hasToRemoveLeftZeros=i==="true",this._writeDigits()),t==="show-comma1"&&(this.hasToShowComma1=i==="true",this.handleCommas()),t==="show-comma2"&&(this.hasToShowComma2=i==="true",this.handleCommas()),t==="initial-power"&&(this.initialPower=parseInt(i)),t==="animation"&&(this.animation=parseInt(i)),t==="show-calculus"&&(this.isCalculusVisible=i==="true"))}handleCalculus({moveOverlayOriginRank:t=!1}={}){if(this.pow<0){const e=10**-this.pow;this.divCalculus.innerHTML=`<span class="font-semibold">÷</span> ${e.toLocaleString("fr-FR")}`}else if(this.pow>0){const e=10**this.pow;this.divCalculus.innerHTML=`<span style="font-size: 0.875em">✕</span> ${e.toLocaleString("fr-FR")}`}else this.divCalculus.innerHTML="";this._clearHighlights(),this._highlightTableOriginRank(),this._highlightTableMovingRank(),t&&this._highlightOverlayOriginRank(),this._moveDivCalculus()}_clearHighlights(){for(const t of this.table.rows[0].cells)t.classList.remove("text-coopmaths-struct");for(const t of this.table.rows[1].cells)t.classList.remove(a.HIGHLIGHTCOLOR.primary,"text-white");for(const t of this.overlayDigitSpans)t.classList.remove(a.HIGHLIGHTCOLOR.secondary)}_highlightTableOriginRank(){const t=this.table.rows[1].cells[a.UNIT_DIGIT_INDEX-this.initialPower];t!=null&&t.classList.add("text-white",a.HIGHLIGHTCOLOR.secondary)}_highlightTableMovingRank(){const t=this._getMovingCell();if(!t)return;t.classList.remove(a.HIGHLIGHTCOLOR.secondary),t.classList.add("text-white",a.HIGHLIGHTCOLOR.primary),this._getPeriodCellFromUnitCell(t).classList.add("text-coopmaths-struct")}_highlightOverlayOriginRank(){const t=this.overlayDigitSpans[this.overlayUnitDigitIndex-this.initialPower+this.pow];t&&(t.classList.contains(a.HIGHLIGHTCOLOR.primary)||t.classList.add(a.HIGHLIGHTCOLOR.secondary))}_moveDivCalculus(){const t=this._getMovingCell();if(!t)return;const e=t.offsetLeft+t.offsetWidth/2;this.divCalculus.style.left=`${this.offsetLeft+this.table.offsetLeft+e}px`,this.divCalculus.style.top=`${this.offsetTop}px`,this.divCalculus.style.transform="translateX(-50%) translateY(25%)",this.divCalculus.style.width="auto"}_getMovingCell(){return this.table.rows[1].cells[a.UNIT_DIGIT_INDEX-this.pow-this.initialPower]}handleZerosOfOverlay(){this._handleZeros(this.overlayDigitSpans,this.overlayUnitDigitIndex+this.pow,this.overlayFirstSignificantDigitIndex,this.overlayLastSignificantDigitIndex)}handleCommas(){this.comma1IsVisible=this.hasToShowComma1,this.comma2IsVisible=this.hasToShowComma2}setContainerWidth(){const t=this.table.rows[this.table.rows.length-1].cells[0].offsetWidth;this.container.style.width=`${this.table.offsetWidth+2*t-2}px`}_startResizeObservation(){window.addEventListener("resize",this._onResize),this._resizeObserver=new ResizeObserver(()=>{this._onResize()}),this._resizeObserver.observe(this.table)}_stopResizeObservation(){var t;window.removeEventListener("resize",this._onResize),(t=this._resizeObserver)==null||t.disconnect()}_startAnimation(){this.animateTimeoutId===void 0&&(this.animateTimeoutId=window.setTimeout(()=>{this.animationState="play",y(this)},0))}_stopAnimation(){this.animateTimeoutId!==void 0&&(clearTimeout(this.animateTimeoutId),this.animationState="stop",this.animateTimeoutId=void 0)}_getPeriodCellFromUnitCell(t){const e=this.table.querySelector("#periods-row");if(!(e instanceof HTMLTableRowElement))throw new Error("Period row not found");let i=e.cells[0];for(const s of e.cells)t.offsetLeft>=s.offsetLeft&&(i=s);return i}_handleZerosOfEditableRow(){this.table.rows[2]&&this._handleZeros(Array.from(this.table.rows[2].cells),a.UNIT_DIGIT_INDEX,this.editableRowFirstSignificantDigitIndex,this.editableRowLastSignificantDigitIndex)}_handleZeros(t,e,i,s){if(!this.hasToHandleZeros){this._removeLeftZeros(t,e,i,s);return}for(let n=0;n<t.length;n++){const r=t[n],l=n>=i&&n<=s,c=n>=e&&n<i,h=n<=e&&n>s;l?this._isEmptyCommaSpan(r)&&(r.textContent="0",n===e&&n===a.UNIT_DIGIT_INDEX&&(r.innerHTML+=this._buildCommaSpan("red-500").outerHTML)):h||c?r.textContent="0":r.textContent=""}this._removeLeftZeros(t,e,i,s)}_removeLeftZeros(t,e,i,s){if(this.hasToRemoveLeftZeros)for(let n=0;n<s;n++){const r=t[n];if(r!=null){if(r.textContent==="0,"||r.textContent==="0")r.textContent="";else if(!this._isEmptyCommaSpan(r))break}}}_isEmptyCommaSpan(t){return t.textContent===""||t.textContent===" "||t.textContent===","||t.textContent===" ,"}_updateSizes(){const t=this._getSize();this._currentSize!==t&&(this._currentSize=t,this._setHeaders(t),this._setTableSizes(t)),this.setContainerWidth();const e=E(this,this.lastPositionRatio)-v(this);u(this,{newLeft:e,moveOverlayOriginRank:!0}),this.lastPositionRatio=w(this)}_getSize(){return window.innerWidth>1024?"lg":window.innerWidth>768?"md":"sm"}_setHeaders(t){this._setHeadersWidths(t),this._setPeriodsHeaders(t),this._setUnitsHeaders(t)}_setHeadersWidths(t){this.table.querySelectorAll("#units-row th div").forEach(e=>{if(e instanceof HTMLDivElement)switch(t){case"lg":e.style.width=a.UNITS_WIDTH.lg;break;case"md":e.style.width=a.UNITS_WIDTH.md;break;default:e.style.width=a.UNITS_WIDTH.sm;break}})}_setTableSizes(t){this.table.querySelectorAll("th div, tr td").forEach(e=>{if(e instanceof HTMLDivElement||e instanceof HTMLTableCellElement)switch(t){case"lg":e.style.lineHeight=a.UNITS_HEIGHT.lg,e.style.fontSize=a.UNITS_TEXT_SIZE.lg;break;case"md":e.style.lineHeight=a.UNITS_HEIGHT.md,e.style.fontSize=a.UNITS_TEXT_SIZE.md;break;default:e.style.lineHeight=a.UNITS_HEIGHT.sm,e.style.fontSize=a.UNITS_TEXT_SIZE.sm;break}})}_setPeriodsHeaders(t){let e=Array.from(new Set(a.PERIODS.sm));t==="lg"?e=Array.from(new Set(a.PERIODS.lg)):t==="md"&&(e=Array.from(new Set(a.PERIODS.md))),this.table.querySelectorAll("#periods-row th div").forEach((s,n)=>{s.innerHTML=e[n]})}_setUnitsHeaders(t){this.table.querySelectorAll("th div span").forEach((i,s)=>{t==="lg"?i.innerHTML=a.UNITS.lg[s]:t==="md"?i.innerHTML=a.UNITS.md[s]:i.innerHTML=a.UNITS.sm[s]})}_buildTable(){const t=document.createElement("table");t.classList.add("relative","m-auto","border-collapse"),t.style.marginTop="2.25em",t.style.marginBottom="1.25em";const e=this._buildThead();t.appendChild(e);const i=this._buildTbody();return t.appendChild(i),t.querySelectorAll("td, th").forEach(s=>{s instanceof HTMLTableCellElement&&(s.classList.add("border-coopmaths-struct"),s.style.borderWidth="0.15em")}),t}_buildThead(){const t=document.createElement("thead"),e=document.createElement("tr");e.id="periods-row";let i=document.createElement("th");for(let n=0;n<a.PERIODS.sm.length;n++){const r=a.PERIODS.sm[n];if(r===a.PERIODS.sm[n-1]){i.colSpan+=1;continue}i=document.createElement("th"),i.colSpan=1,i.classList.add("relative","h-8");const l=document.createElement("div");l.classList.add("flex","justify-center","whitespace-nowrap","font-semibold"),l.style.paddingTop="0.5em",l.style.paddingBottom="0.5em",l.innerHTML=r,i.appendChild(l),e.appendChild(i)}t.appendChild(e);const s=document.createElement("tr");return s.id="units-row",a.UNITS.sm.forEach(n=>{const r=document.createElement("th");r.classList.add("relative");const l=document.createElement("div");l.classList.add("flex","justify-center","items-center"),l.style.paddingTop="0.5em",l.style.paddingBottom="0.5em",l.style.width=a.UNITS_WIDTH.sm;const c=document.createElement("span");c.classList.add("whitespace-nowrap","font-semibold"),c.innerHTML=n,l.appendChild(c),r.appendChild(l),s.appendChild(r)}),t.appendChild(s),t}_buildTbody(){const t=document.createElement("tbody"),e=document.createElement("tr");for(let s=0;s<a.UNITS.sm.length;s++){const n=document.createElement("td");s===a.UNIT_DIGIT_INDEX&&n.classList.add("relative"),n.innerHTML="&nbsp;",n.style.paddingTop="0.25em",n.style.paddingBottom="0.25em",e.appendChild(n)}t.appendChild(e);const i=document.createElement("tr");for(let s=0;s<a.UNITS.sm.length;s++){const n=document.createElement("td");s===a.UNIT_DIGIT_INDEX?(n.id="overlay-comma-td",n.classList.add("relative"),n.innerHTML=this._buildCommaSpan("white").outerHTML):n.innerHTML="&nbsp;",n.style.paddingTop="0.25em",n.style.paddingBottom="0.25em",i.appendChild(n)}return t.appendChild(i),t}_buildOverlayDigitSpans(){const t=[];for(let i=0;i<this.overlayColumnCount;i++){const s=document.createElement("span");s.classList.add("font-semibold","text-white","flex","items-center","justify-center","w-full","h-full","border-coopmaths-struct"),s.style.borderWidth="0.075em",s.innerHTML="&nbsp;",t.push(s)}return t[this.overlayUnitDigitIndex-this.initialPower].classList.add(a.HIGHLIGHTCOLOR.primary),t}_buildOverlay(){const t=document.createElement("div");return t.classList.add("bg-coopmaths-lightest","grid","cursor-grab","items-center","justify-items-center","overflow-hidden","absolute","pointer-events-auto","border-collapse"),t.style.gridTemplateColumns=`repeat(${this.overlayColumnCount}, minmax(0, 1fr))`,this.overlayDigitSpans=this._buildOverlayDigitSpans(),this.overlayDigitSpans.forEach(e=>{t.appendChild(e)}),t}_buildDivCalculus(){const t=document.createElement("div");return t.classList.add("absolute","font-semibold","text-coopmaths-struct","text-center","whitespace-nowrap","overflow-visible"),t}_buildAnimationControlButtons(){const t=document.createElement("div");t.classList.add("flex","justify-center","items-center","gap-2");const e=this._buildPlayPauseButton(),i=this._buildPreviousButton(e),s=this._buildNextButton(e);return t.appendChild(i),t.appendChild(e),t.appendChild(s),t}_buildPreviousButton(t){return this._buildButton({hoverText:"Retourner au début de l’animation",innerSvg:`
        <polygon points="16,4 6,10 16,16" /> <!-- Reversed play arrow -->
        <rect x="3" y="4" width="2" height="12" /> <!-- Pause line on the left -->`,clickHandler:()=>{this.animationState="stop",t.title="Relancer l'animation",t.innerHTML=this._loopIcon,U(this)}})}_buildNextButton(t){return this._buildButton({hoverText:"Aller à la fin de l’animation",innerSvg:`
        <polygon points="4,4 14,10 4,16" /> <!-- Play arrow -->
        <rect x="15" y="4" width="2" height="12" /> <!-- Pause line -->`,clickHandler:()=>{this.animationState="stop",t.title="Relancer l'animation",t.innerHTML=this._loopIcon,O(this)}})}_buildPlayPauseButton(){const t=this._buildButton({hoverText:"Arrêter l'animation",innerSvg:this._pauseIcon,clickHandler:()=>{this.animationState=this.animationState==="play"?"pause":"play",t.title=this.animationState==="play"?"Arrêter l'animation":"Relancer l'animation",t.innerHTML=this.animationState==="play"?this._pauseIcon:this._loopIcon}});return t.innerHTML=this._pauseIcon,t}_buildButton(t){const e=document.createElement("button");return e.classList.add("flex","items-center","justify-center","cursor-pointer","border","rounded","text-coopmaths-action","hover:text-white","active:text-white","bg-white","hover:bg-coopmaths-action-light","active:bg-coopmaths-action","border-coopmaths-action","hover:border-coopmaths-action-light","active:border-coopmaths-action"),e.innerHTML=this._buildIcon(t.innerSvg),e.title=t.hoverText,e.addEventListener("click",t.clickHandler),e}_buildIcon(t){return`
      <svg xmlns="http://www.w3.org/2000/svg"
        class="inline"
        height="1.25em"
        width="1.25em"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        ${t}
      </svg>`}_setInitialNumber(){var s;const t=(s=this.getAttribute("number"))==null?void 0:s.replace(",",".").replace("{","").replace("}",""),e=t==null?void 0:t.split(".")[1];e!=null&&e.length>3&&console.error("Le glisse-nombre ne gère que 3 chiffres après la virgule");const i=parseFloat(t||"0");this._setDigits(this._getDigitsFromNumber(i))}_buildCommaSpan(t){const e=document.createElement("span");return e.classList.add("absolute","right-0","bottom-0","font-semibold",`text-${t}`,"z-10"),e.style.fontSize="2.25em",e.textContent=",",e}_setDigits(t){this.setAttribute("number",this._getNumberFromDigits(t).toString()),this._setEditableRowDigits(t),this._writeDigits()}_writeDigits(){this._writeDigitsInEditableRow(),this._writeDigitsInOverlay(),this._handleZerosOfEditableRow(),this.handleZerosOfOverlay(),this.handleCommas()}_setEditableRowDigits(t){this.editableRowDigits=t}_getDigitsFromNumber(t){const e=a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1,i=Math.round(t*10**e),s=[];for(let n=0;n<a.UNITS.sm.length;n++)s.push(Math.floor(i/10**(a.UNITS.sm.length-1-n))%10);return s}_getNumberFromDigits(t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];e+=s*10**(a.UNIT_DIGIT_INDEX-i)}return e}_writeDigitsInEditableRow(){var i,s;let t=this.editableRowDigits.findIndex(n=>n!==0);t>a.UNIT_DIGIT_INDEX&&(t=a.UNIT_DIGIT_INDEX);let e=this.editableRowDigits.length-1;for(let n=this.editableRowDigits.length-1;n>=t&&this.editableRowDigits[n]===0;n--)e--;for(let n=t;n<=e;n++){const r=(s=(i=this.table)==null?void 0:i.rows[2])==null?void 0:s.cells[n];r==null||this.editableRowDigits[n]==null||(r.textContent=this.editableRowDigits[n].toString(),n===a.UNIT_DIGIT_INDEX&&(r.innerHTML+=this._buildCommaSpan("red-500").outerHTML))}}_writeDigitsInOverlay(){var t;for(let e=0;e<this.overlayDigitSpans.length;e++){const i=this.overlayDigitSpans[e];i!=null&&(e<this.overlayFirstSignificantDigitIndex||e>this.overlayLastSignificantDigitIndex?i.textContent=" ":i.textContent=((t=this.overlayDigits[e])==null?void 0:t.toString())??"")}}get comma1IsVisible(){return this._comma1IsVisible}set comma1IsVisible(t){var s,n;this._comma1IsVisible=t;const e=(n=(s=this.table)==null?void 0:s.rows[2])==null?void 0:n.cells[a.UNIT_DIGIT_INDEX];if(e==null)return;const i=e.querySelector("span");i!=null&&(t&&this.editableRowLastSignificantDigitIndex>a.UNIT_DIGIT_INDEX?i.classList.remove("hidden"):i.classList.add("hidden"))}get comma2IsVisible(){return this._comma2IsVisible}set comma2IsVisible(t){var r,l;this._comma2IsVisible=t;const e=(l=(r=this.table)==null?void 0:r.rows[3])==null?void 0:l.cells[a.UNIT_DIGIT_INDEX];if(e==null)return;const i=e.querySelector("span");if(i==null)return;const s=this.overlayUnitDigitIndex+this.pow,n=this.overlayDigitSpans[s];t&&this.overlayLastSignificantDigitIndex>s&&(n.innerHTML!==""||!this.hasToRemoveLeftZeros||s>this.overlayFirstSignificantDigitIndex)?i.classList.remove("hidden"):i.classList.add("hidden")}get overlayDigits(){return[...new Array(this.overlayLeftExtraCount).fill(0),...this.editableRowDigits]}get editableRowFirstSignificantDigitIndex(){for(let t=0;t<a.UNIT_DIGIT_INDEX;t++)if(this.table.rows[2]&&parseInt(this.table.rows[2].cells[t].textContent??"")>0)return t;return a.UNIT_DIGIT_INDEX}get editableRowLastSignificantDigitIndex(){for(let t=this.editableRowDigits.length-1;t>a.UNIT_DIGIT_INDEX;t--)if(this.editableRowDigits[t]>0)return t;return a.UNIT_DIGIT_INDEX}get isCalculusVisible(){return this._isCalculusVisible}set isCalculusVisible(t){this._isCalculusVisible=t,t?this.divCalculus.classList.remove("hidden"):this.divCalculus.classList.add("hidden")}get overlayFirstSignificantDigitIndex(){return this.editableRowFirstSignificantDigitIndex+a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1+this.initialPower}get overlayLastSignificantDigitIndex(){return this.editableRowLastSignificantDigitIndex+a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1+this.initialPower}get overlayLeftExtraCount(){return a.UNITS.sm.length-(a.UNIT_DIGIT_INDEX-this.initialPower+1)}get overlayRightExtraCount(){return a.UNIT_DIGIT_INDEX-this.initialPower}get overlayColumnCount(){return this.overlayLeftExtraCount+a.UNITS.sm.length+this.overlayRightExtraCount}get overlayUnitDigitIndex(){return this.overlayLeftExtraCount+a.UNIT_DIGIT_INDEX}}export{N as G};
//# sourceMappingURL=glisse-nombre-C2OSEq6h.js.map
