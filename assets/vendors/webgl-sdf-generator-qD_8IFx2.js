function me(){var $=(function(y){function ee(v,f,e,a,c,o,t,u){var r=1-t;u.x=r*r*v+2*r*t*e+t*t*c,u.y=r*r*f+2*r*t*a+t*t*o}function re(v,f,e,a,c,o,t,u,r,n){var l=1-r;n.x=l*l*l*v+3*l*l*r*e+3*l*r*r*c+r*r*r*t,n.y=l*l*l*f+3*l*l*r*a+3*l*r*r*o+r*r*r*u}function z(v,f){for(var e=/([MLQCZ])([^MLQCZ]*)/g,a,c,o,t,u;a=e.exec(v);){var r=a[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(n){return parseFloat(n)});switch(a[1]){case"M":t=c=r[0],u=o=r[1];break;case"L":(r[0]!==t||r[1]!==u)&&f("L",t,u,t=r[0],u=r[1]);break;case"Q":{f("Q",t,u,t=r[2],u=r[3],r[0],r[1]);break}case"C":{f("C",t,u,t=r[4],u=r[5],r[0],r[1],r[2],r[3]);break}case"Z":(t!==c||u!==o)&&f("L",t,u,c,o);break}}}function x(v,f,e){e===void 0&&(e=16);var a={x:0,y:0};z(v,function(c,o,t,u,r,n,l,b,E){switch(c){case"L":f(o,t,u,r);break;case"Q":{for(var i=o,h=t,A=1;A<e;A++)ee(o,t,n,l,u,r,A/(e-1),a),f(i,h,a.x,a.y),i=a.x,h=a.y;break}case"C":{for(var g=o,m=t,s=1;s<e;s++)re(o,t,n,l,b,E,u,r,s/(e-1),a),f(g,m,a.x,a.y),g=a.x,m=a.y;break}}})}var q="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",te="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",Q=new WeakMap,ae={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function U(v,f){var e=v.getContext?v.getContext("webgl",ae):v,a=Q.get(e);if(!a){let l=function(g){var m=o[g];if(!m&&(m=o[g]=e.getExtension(g),!m))throw new Error(g+" not supported");return m},b=function(g,m){var s=e.createShader(m);return e.shaderSource(s,g),e.compileShader(s),s},E=function(g,m,s,p){if(!t[g]){var T={},d={},w=e.createProgram();e.attachShader(w,b(m,e.VERTEX_SHADER)),e.attachShader(w,b(s,e.FRAGMENT_SHADER)),e.linkProgram(w),t[g]={program:w,transaction:function(S){e.useProgram(w),S({setUniform:function(D,L){for(var G=[],F=arguments.length-2;F-- >0;)G[F]=arguments[F+2];var R=d[L]||(d[L]=e.getUniformLocation(w,L));e["uniform"+D].apply(e,[R].concat(G))},setAttribute:function(D,L,G,F,R){var _=T[D];_||(_=T[D]={buf:e.createBuffer(),loc:e.getAttribLocation(w,D),data:null}),e.bindBuffer(e.ARRAY_BUFFER,_.buf),e.vertexAttribPointer(_.loc,L,e.FLOAT,!1,0,0),e.enableVertexAttribArray(_.loc),c?e.vertexAttribDivisor(_.loc,F):l("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(_.loc,F),R!==_.data&&(e.bufferData(e.ARRAY_BUFFER,R,G),_.data=R)}})}}}t[g].transaction(p)},i=function(g,m){r++;try{e.activeTexture(e.TEXTURE0+r);var s=u[g];s||(s=u[g]=e.createTexture(),e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,s),m(s,r)}finally{r--}},h=function(g,m,s){var p=e.createFramebuffer();n.push(p),e.bindFramebuffer(e.FRAMEBUFFER,p),e.activeTexture(e.TEXTURE0+m),e.bindTexture(e.TEXTURE_2D,g),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g,0);try{s(p)}finally{e.deleteFramebuffer(p),e.bindFramebuffer(e.FRAMEBUFFER,n[--n.length-1]||null)}},A=function(){o={},t={},u={},r=-1,n.length=0};var c=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o={},t={},u={},r=-1,n=[];e.canvas.addEventListener("webglcontextlost",function(g){A(),g.preventDefault()},!1),Q.set(e,a={gl:e,isWebGL2:c,getExtension:l,withProgram:E,withTexture:i,withTextureFramebuffer:h,handleContextLoss:A})}f(a)}function M(v,f,e,a,c,o,t,u){t===void 0&&(t=15),u===void 0&&(u=null),U(v,function(r){var n=r.gl,l=r.withProgram,b=r.withTexture;b("copy",function(E,i){n.texImage2D(n.TEXTURE_2D,0,n.RGBA,c,o,0,n.RGBA,n.UNSIGNED_BYTE,f),l("copy",q,te,function(h){var A=h.setUniform,g=h.setAttribute;g("aUV",2,n.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),A("1i","image",i),n.bindFramebuffer(n.FRAMEBUFFER,u||null),n.disable(n.BLEND),n.colorMask(t&8,t&4,t&2,t&1),n.viewport(e,a,c,o),n.scissor(e,a,c,o),n.drawArrays(n.TRIANGLES,0,3)})})})}function ie(v,f,e){var a=v.width,c=v.height;U(v,function(o){var t=o.gl,u=new Uint8Array(a*c*4);t.readPixels(0,0,a,c,t.RGBA,t.UNSIGNED_BYTE,u),v.width=f,v.height=e,M(t,u,0,0,a,c)})}var ne=Object.freeze({__proto__:null,withWebGLContext:U,renderImageData:M,resizeWebGLCanvasWithoutClearing:ie});function I(v,f,e,a,c,o){o===void 0&&(o=1);var t=new Uint8Array(v*f),u=a[2]-a[0],r=a[3]-a[1],n=[];x(e,function(g,m,s,p){n.push({x1:g,y1:m,x2:s,y2:p,minX:Math.min(g,s),minY:Math.min(m,p),maxX:Math.max(g,s),maxY:Math.max(m,p)})}),n.sort(function(g,m){return g.maxX-m.maxX});for(var l=0;l<v;l++)for(var b=0;b<f;b++){var E=h(a[0]+u*(l+.5)/v,a[1]+r*(b+.5)/f),i=Math.pow(1-Math.abs(E)/c,o)/2;E<0&&(i=1-i),i=Math.max(0,Math.min(255,Math.round(i*255))),t[b*v+l]=i}return t;function h(g,m){for(var s=1/0,p=1/0,T=n.length;T--;){var d=n[T];if(d.maxX+p<=g)break;if(g+p>d.minX&&m-p<d.maxY&&m+p>d.minY){var w=oe(g,m,d.x1,d.y1,d.x2,d.y2);w<s&&(s=w,p=Math.sqrt(s))}}return A(g,m)&&(p=-p),p}function A(g,m){for(var s=0,p=n.length;p--;){var T=n[p];if(T.maxX<=g)break;var d=T.y1>m!=T.y2>m&&g<(T.x2-T.x1)*(m-T.y1)/(T.y2-T.y1)+T.x1;d&&(s+=T.y1<T.y2?1:-1)}return s!==0}}function j(v,f,e,a,c,o,t,u,r,n){o===void 0&&(o=1),u===void 0&&(u=0),r===void 0&&(r=0),n===void 0&&(n=0),Y(v,f,e,a,c,o,t,null,u,r,n)}function Y(v,f,e,a,c,o,t,u,r,n,l){o===void 0&&(o=1),r===void 0&&(r=0),n===void 0&&(n=0),l===void 0&&(l=0);for(var b=I(v,f,e,a,c,o),E=new Uint8Array(b.length*4),i=0;i<b.length;i++)E[i*4+l]=b[i];M(t,E,r,n,v,f,1<<3-l,u)}function oe(v,f,e,a,c,o){var t=c-e,u=o-a,r=t*t+u*u,n=r?Math.max(0,Math.min(1,((v-e)*t+(f-a)*u)/r)):0,l=v-(e+n*t),b=f-(a+n*u);return l*l+b*b}var N=Object.freeze({__proto__:null,generate:I,generateIntoCanvas:j,generateIntoFramebuffer:Y}),ve="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",ue="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",fe="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",Z=new Float32Array([0,0,2,0,0,2]),B=null,C=!1,le={},J=new WeakMap;function O(v){if(!C&&!H(v))throw new Error("WebGL generation not supported")}function P(v,f,e,a,c,o,t){if(o===void 0&&(o=1),t===void 0&&(t=null),!t&&(t=B,!t)){var u=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!u)throw new Error("OffscreenCanvas or DOM canvas not supported");t=B=u.getContext("webgl",{depth:!1})}O(t);var r=new Uint8Array(v*f*4);U(t,function(E){var i=E.gl,h=E.withTexture,A=E.withTextureFramebuffer;h("readable",function(g,m){i.texImage2D(i.TEXTURE_2D,0,i.RGBA,v,f,0,i.RGBA,i.UNSIGNED_BYTE,null),A(g,m,function(s){V(v,f,e,a,c,o,i,s,0,0,0),i.readPixels(0,0,v,f,i.RGBA,i.UNSIGNED_BYTE,r)})})});for(var n=new Uint8Array(v*f),l=0,b=0;l<r.length;l+=4)n[b++]=r[l];return n}function K(v,f,e,a,c,o,t,u,r,n){o===void 0&&(o=1),u===void 0&&(u=0),r===void 0&&(r=0),n===void 0&&(n=0),V(v,f,e,a,c,o,t,null,u,r,n)}function V(v,f,e,a,c,o,t,u,r,n,l){o===void 0&&(o=1),r===void 0&&(r=0),n===void 0&&(n=0),l===void 0&&(l=0),O(t);var b=[];x(e,function(E,i,h,A){b.push(E,i,h,A)}),b=new Float32Array(b),U(t,function(E){var i=E.gl,h=E.isWebGL2,A=E.getExtension,g=E.withProgram,m=E.withTexture,s=E.withTextureFramebuffer,p=E.handleContextLoss;if(m("rawDistances",function(T,d){(v!==T._lastWidth||f!==T._lastHeight)&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,T._lastWidth=v,T._lastHeight=f,0,i.RGBA,i.UNSIGNED_BYTE,null),g("main",ve,ue,function(w){var W=w.setAttribute,S=w.setUniform,k=!h&&A("ANGLE_instanced_arrays"),D=!h&&A("EXT_blend_minmax");W("aUV",2,i.STATIC_DRAW,0,Z),W("aLineSegment",4,i.DYNAMIC_DRAW,1,b),S.apply(void 0,["4f","uGlyphBounds"].concat(a)),S("1f","uMaxDistance",c),S("1f","uExponent",o),s(T,d,function(L){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,v,f),i.scissor(0,0,v,f),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,h?i.MAX:D.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),h?i.drawArraysInstanced(i.TRIANGLES,0,3,b.length/4):k.drawArraysInstancedANGLE(i.TRIANGLES,0,3,b.length/4)})}),g("post",q,fe,function(w){w.setAttribute("aUV",2,i.STATIC_DRAW,0,Z),w.setUniform("1i","tex",d),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(l===0,l===1,l===2,l===3),i.viewport(r,n,v,f),i.scissor(r,n,v,f),i.drawArrays(i.TRIANGLES,0,3)})}),i.isContextLost())throw p(),new Error("webgl context lost")})}function H(v){var f=!v||v===B?le:v.canvas||v,e=J.get(f);if(e===void 0){C=!0;var a=null;try{var c=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],o=P(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,v);e=o&&c.length===o.length&&o.every(function(t,u){return t===c[u]}),e||(a="bad trial run results",console.info(c,o))}catch(t){e=!1,a=t.message}a&&console.warn("WebGL SDF generation not supported:",a),C=!1,J.set(f,e)}return e}var X=Object.freeze({__proto__:null,generate:P,generateIntoCanvas:K,generateIntoFramebuffer:V,isSupported:H});function ce(v,f,e,a,c,o){c===void 0&&(c=Math.max(a[2]-a[0],a[3]-a[1])/2),o===void 0&&(o=1);try{return P.apply(X,arguments)}catch(t){return console.info("WebGL SDF generation failed, falling back to JS",t),I.apply(N,arguments)}}function ge(v,f,e,a,c,o,t,u,r,n){c===void 0&&(c=Math.max(a[2]-a[0],a[3]-a[1])/2),o===void 0&&(o=1),u===void 0&&(u=0),r===void 0&&(r=0),n===void 0&&(n=0);try{return K.apply(X,arguments)}catch(l){return console.info("WebGL SDF generation failed, falling back to JS",l),j.apply(N,arguments)}}return y.forEachPathCommand=z,y.generate=ce,y.generateIntoCanvas=ge,y.javascript=N,y.pathToLineSegments=x,y.webgl=X,y.webglUtils=ne,Object.defineProperty(y,"__esModule",{value:!0}),y})({});return $}export{me as S};
//# sourceMappingURL=webgl-sdf-generator-qD_8IFx2.js.map
