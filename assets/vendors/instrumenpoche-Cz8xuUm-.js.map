{"version":3,"mappings":"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","names":["svgns","caracteresGrecs","caracteresSpeciaux","convDegRad","convRadDeg","cos30","sin30","InfoBalise","bold","italic","underline","couleur","fontface","taille","carSpeMin","nom","char","zero","x","zeroAngle","a","mesurePrincDeg","ang","q","ret","parseXMLDoc","txt","parser","xmlDoc","estInstrument","ch","indiceFinBalise","bal","balf","indf","balisefont","ind","ind2","analyseExposantOuIndice","chaine","res","indvirg","indparf","indiceParentheseFermante","deb","p","somme","valeur_approchee","nombre","precision","prec","mettre_en_pixels","nbr","borne1","borne2","borne_pix1","borne_pix2","coeff_dir","ordo_orig","elimineDoublonsXML","patterns","ligne","i","pattern","r","remplaceBalises","remplaceCarSpe","newString","fragment","accoladeFermante","pdebut","contientBaliseLaTeX","getSvgColor","trad","complete","colineaires","u","v","n1","n2","colineairesMemeSens","indiceVirgule","nb","indpf","k","determiner_graduations","mini","maxi","unite","debut_trace","traiteBalise","infoBalise","debutLigne","y","stylespan","indfb","ind1","fonte","inddeb","info","tspan","ch2","necessiteLatex","code","ch1","getMaths","s","btexte","indv","indv1","indv2","indv3","car","getMathsForName","getTaille","obj","options","defaut","min","max","Vect","x1","y1","x2","y2","normeSouhaitee","norm","angle","kc","ks","InstrumentAncetre","doc","bvisible","zoomfactor","zoom","xfin","yfin","pix10","t","d","angfin","deg10","ang1","kernel.mesurePrincDeg","ang2","dis","zoomfin","vitesse","z","Compas","li","path","circ","lon","longpointe","ep","retb","rayb","epm","dlb","dlm","ylm2","dlh","ylh","dltop","g","rayx","rayy","styleli","rect","text","transX","transY","scale","ecart","ec10","ec","Equerre","hauteurint","largeurbande","l","path2","Rapporteur","rayon","rayInt","rayonInt","raytraitint","rayonMire","dep","Regle","longint","largeur","ray","line","vis","oldg","Requerre","style","ytrou","pathtrou","fakeEquerre","abs","absfin","Crayon","defs","lg","stop","rx","ry","path1","ActionAncetre","tempo","ActionCoucherCompas","immediat","compas","compasLeve","ObjetBase","id","b","Texte","ActionCreation","objet","ob","ActionEcarterCompas","ecartement","ActionEcrireTexte","texte","couleurFond","opaciteFond","couleurCadre","epaisseurCadre","marge","margeGauche","margeDroite","margeHaut","margeBas","strTraduite","bStyletTexte","latexString","self","__vitePreload","loadMathJax","loadMathJax$1","width","html","error","svg","w","h","svgVa","va","epc","height","indbalise","indexp","indind","bexp","tailleind","sp","an","dy","inf","debexp","debind","hautlig","decblp","decalage","coulFond","ActionGlisser","abscisseFin","CompasLeve","e","f","dl","dh","ActionLeverCompas","ActionMasquer","idel","nature","el","ActionMasquerInstrument","instrument","ActionModifierLongueur","longueur","ActionMontrer","ActionMontrerGraduations","bmontrer","ActionMontrerInstrument","ActionMontrerNombres","ActionNommerPoint","point","ActionPause","ActionRotationInstrument","anglefin","ActionRetourner","ActionRotationObjet","type","ActionTranslationInstrument","ActionTranslationObjet","ActionZoomInstrument","ActionZoomObjet","ActionModificationRayon","rayFin","Ligne","epaisseur","opacite","styleTrait","op","Angle","motif","direct","v2","xc1","yc1","xmilieu","ymilieu","ang3","a1","a2","u1","u2","xd","yd","xf","yf","remplis","style1","rond","uc","xc","yc","n","u3","u4","nbtraits","AngleDroit","xsommet","ysommet","xinter","yinter","v1","points","Arc","debut","fin","sens","xdeb","ydeb","Gabarit","ecartAngle","dif","Axe","pente","haut","gauche","distanceBord","xgrad","xmin","xmax","nb_grad_x","bord","debut_trace_x","kernel.determiner_graduations","unite_x","ordo_etiquettes","abscisse","stylet","debut_trace_y","unite_y","nb_grad_y","abs_etiquettes","ordonnee","kernel.mettre_en_pixels","DroiteAncetre","cray","Droite","indicePoint","xa","ya","xb","yb","DemiDroite","kernel.colineairesMemeSens","Imag","url","img","own","image","LigneContinue","ord","len","MarqueSegment","Segment","stylefleche","MarqueSeg","idSeg","demlong","dec","diam","seg","vect","xmil","ymil","setStyles","sjtDom","NomPoint","dx","xp","yp","Point","Polygone","Quadrillage","hauteur","droite","bas","ecart_x","ecart_y","debut_x","debut_y","fin_x","fin_y","pointille","alpha","Repere","ygrad","ymin","ymax","grille","axes","etiquettes","clip","rect2","outils","icons","defaultWidth","defaultHeight","waitPromise","delay","resolve","getIconPlay","teinte","filtre","pol","getIconPause","getIconNextStep","getIconPrevStep","getIconGotoEnd","getIconReset","getIconRestart","getIconRepeat","getIconXml","getId","getAbs","getOrd","getCouleur","coul","getCouleurCadre","getCouleurFond","getEpaisseur","getOpaciteTrait","getOpaciteFond","getStyleTrait","st","getStyle","IepDoc","xml","chunks","vb","viewBoxElts","xmlViewBox","attr","value","ev","viewBox","prop","zoomFactor","xCenter","yCenter","pasPretes","action","callback","maxWait","wait","check","start","reject","values","nextStep","outil","xmouse","ymouse","deltax","deltay","xpos","ypos","icones","icone","nbActions","derniereAction","iconsToShow","indaction","visible","couche","indfin","element","at","ato","forme","xcrayon","ycrayon","cibles","echelle","cible","abscisse_bas_droite","ordonnee_bas_droite","abscisse_haut_gauche","ordonnee_haut_gauche","elt","sep","nomPoint","ActionModifierRayon","me","attribute","clair","fonce","rg","marker","pathm","filter","pointLight","fc","div","form","ta","iepDoc","closeAllXMLWindows","iepApp","IepApp","autoStart","length","addElement","empty","addSvg","container","addZoom","styleBtn","loadXml","response","status","statusText","ok","iepLoadPromise","strMatched","domain","iepOptions","autostart","loadDelay","mathJaxUrl","mathJaxConfig","mathJaxLoadingPromise","timeout","eltScript"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"sources":["../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/global/constantes.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/global/InfoBalise.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/global/index.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/types/Vect.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/InstrumentAncetre.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Compas.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Equerre.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Rapporteur.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Regle.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Requerre.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/Crayon.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionAncetre.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionCoucherCompas.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/ObjetBase.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Texte.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionCreation.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionEcarterCompas.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionEcrireTexte.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionGlisser.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/instruments/CompasLeve.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionLeverCompas.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMasquer.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMasquerInstrument.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionModifierLongueur.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMontrer.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMontrerGraduations.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMontrerInstrument.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionMontrerNombres.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionNommerPoint.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionPause.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionRotationInstrument.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionRetourner.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionRotationObjet.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionTranslationInstrument.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionTranslationObjet.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionZoomInstrument.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionZoomObjet.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/actions/ActionModifierRayon.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Ligne.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Angle.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/AngleDroit.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Arc.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Gabarit.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Axe.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/DroiteAncetre.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Droite.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/DemiDroite.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Imag.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/LigneContinue.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/MarqueSegment.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Segment.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/MarqueSeg.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/NomPoint.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Point.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Polygone.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Quadrillage.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/objets/Repere.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/app/IepDoc.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/app/IepApp.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/iepLoadPromise.js","../../../node_modules/.pnpm/instrumenpoche@git+https+++git.sesamath.net+sesamath+instrumenpoche.git+04ba37b51f90cbc475afbf1e21e41c04d336cb96/node_modules/instrumenpoche/src/loadMathJax.js"],"sourcesContent":["/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\n/**\n * Le namespace svg\n * @type {string}\n */\nexport const svgns = 'http://www.w3.org/2000/svg'\n/**\n * Liste des caractres grecs (alpha: '', beta)\n * @type {Object}\n */\nexport const caracteresGrecs = {\n  alpha: '',\n  beta: '',\n  gamma: '',\n  delta: '',\n  epsilon: '',\n  zeta: '',\n  eta: '',\n  theta: '',\n  kappa: '',\n  lambda: '',\n  mu: '',\n  nu: '',\n  xi: '',\n  pi: '',\n  rho: '',\n  sigma: '',\n  tau: '',\n  phi: '',\n  chi: '', // c'est bien le  minuscule (ressemble  sa majuscule mais en plus bas)\n  psi: '',\n  omega: '',\n  Gamma: '',\n  Delta: '',\n  Xi: '',\n  Pi: '',\n  Sigma: '',\n  Phi: '',\n  Chi: '',\n  Psi: '',\n  Omega: ''\n}\n/**\n * Les caractres spciaux qui seront remplacs par leur caractre UTF8 (nom => char)\n * pour utilisation sous la forme nom dans un texte\n * @type {object}\n */\nexport const caracteresSpeciaux = {\n  alpha2: '', // quel intrt ? alpha est dj remplac par le mme caractre via caracteresGrecs\n  plus: '+',\n  moins: '-',\n  fois: '',\n  divise: '',\n  petitf: 'f',\n  petitebarre: '',\n  grandebarre: '',\n  prime: \"'\",\n  seconde: '\"',\n  puceronde: '',\n  grandC: '',\n  euler: '',\n  petitg: '',\n  petith: '',\n  Ironde: '',\n  Lronde: '',\n  lronde: '',\n  grandN: '',\n  Pronde: '',\n  grandQ: '',\n  Rronde: '',\n  grandR: '',\n  grandZ: '',\n  Eronde: '',\n  Fronde: '',\n  Nronde: '',\n  flecheG: '',\n  flecheH: '',\n  flecheD: '',\n  flecheB: '',\n  flecheDG: '',\n  flecheGD: '',\n  flecheHB: '',\n  flecheBH: '',\n  croissant: '',\n  decroissant: '',\n  alaligneadroite: '',\n  alaligneagauche: '',\n  doubleflecheG: '',\n  doubleflecheD: '',\n  doubleflecheDG: '',\n  doubleflecheGD: '',\n  flecheGbarre: '',\n  flecheDbarre: '',\n  flecheGcreuse: '',\n  flecheHcreuse: '',\n  flecheDcreuse: '',\n  flecheBcreuse: '',\n  qqsoit: '',\n  pourtout: '',\n  quelquesoit: '',\n  complement: '',\n  differentielpartiel: '',\n  ilexiste: '',\n  ilnexistepas: '',\n  vide: '',\n  nabla: '',\n  appartienta: '',\n  nappartientpasa: '',\n  contient: '',\n  petitcontient: '',\n  grandproduit: '',\n  grandcoproduit: '',\n  grandesomme: '',\n  petitebarrefine: '',\n  moinsouplus: '',\n  antislash: '\\\\',\n  asterisque: '',\n  racine: '',\n  proportionnela: '',\n  infini: '',\n  angle: '',\n  anglespherique: '',\n  // divise: '', // faudrait savoir ! dj dfini plus haut comme \n  nedivisepas: '',\n  parallelea: '//',\n  nestpasparallelea: '',\n  etlogique: '',\n  oulogique: '',\n  inter: '',\n  intersection: '',\n  union: '',\n  integrale: '',\n  doubleintegrale: '',\n  tripleintegrale: '',\n  integralecurviligne: '',\n  integralesurfacique: '',\n  integralevolumique: '',\n  egaleasymptotiquea: '',\n  environdroit: '',\n  environegala: '',\n  environ: '',\n  egalpardefinition: '',\n  differentde: '',\n  identiquea: '',\n  inferieura: '',\n  superieura: '',\n  inclusdans: '',\n  // contient: '', doublon avec  dfini plus haut\n  nestpasinclusdans: '',\n  necontientpas: '',\n  sommedirecte: '',\n  differencedirecte: '',\n  produittensoriel: '',\n  divisiondirecte: '',\n  produitdirect: '',\n  top: '',\n  perpendiculairea: '',\n  antecedentde: '',\n  imagede: '',\n  angledroitarc: '',\n  point: '',\n  pv: ';'\n}\n\n/**\n * /180\n * @type {number}\n */\nexport const convDegRad = Math.PI / 180\n/**\n * 180/\n * @type {number}\n */\nexport const convRadDeg = 180 / Math.PI\n/**\n * Valeur de cos(30)\n * @type {number}\n */\nexport const cos30 = Math.cos(30 * convDegRad)\n/**\n * Valeur de sin(30)\n * @type {number}\n */\nexport const sin30 = 0.5\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\n/**\n * Informations sur un texte contenant des balises <b> ou <i> ou <u> ou <font> (ou un mlange)\n * Utilis dans l'objet ActionEcrireTexte.\n * @constructor\n * @param {boolean} bold\n * @param {boolean} italic\n * @param {boolean} underline\n * @param {boolean} couleur\n * @param {boolean} fontface\n * @param {boolean} taille\n */\nfunction InfoBalise (bold, italic, underline, couleur, fontface, taille) {\n  this.bold = bold\n  this.italic = italic\n  this.underline = underline\n  this.couleur = couleur\n  this.fontface = fontface\n  this.taille = taille\n}\n\nexport default InfoBalise\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { caracteresSpeciaux, svgns } from './constantes.js'\nimport InfoBalise from './InfoBalise.js'\n\n// y'en a bcp trop pour tous les revoir (surtout qu'ils sont pas si problmatiques,\n// mme si on pourrait crire tout a plus simplement avec des regex)\n/* eslint-disable no-unreachable-loop */\n/**\n * idem caracteresSpeciaux mais avec toutes les proprits en minuscules\n * (remplaceCarSpe veut faire une comparaison insensible  la casse, on lui mche ici le travail)\n * @private\n * @type {object}\n */\nconst carSpeMin = {}\nObject.entries(caracteresSpeciaux).forEach(([nom, char]) => {\n  carSpeMin[nom.toLowerCase()] = char\n})\n\n/**\n * Retourne true si le nombre x a une valeur absolue infrieue  10^-9\n * @param {number} x\n * @returns {boolean}\n */\nexport const zero = (x) => Math.abs(x) < 1e-9\n/**\n * Retourne true si la valeur absolue de a est infrieure  10^-7\n * Utilis pour tester si un angle est quasi nul.\n * @param {number} a\n * @returns {boolean}\n */\nexport const zeroAngle = (a) => Math.abs(a) < 1e-7\n/**\n * Retourne la mesure principale en degrs de l'angle dont ang est une mesure\n * @param {number} ang\n * @returns {number}\n */\nexport function mesurePrincDeg (ang) {\n  const q = Math.floor((ang + 180) / 360)\n  let ret = ang - 360 * q\n  if (ret === -180) ret = 180\n  return ret\n}\n/**\n * Fonction servant  parser un fichier xml contenu dans la chane txt\n * @param {string} txt\n * @returns {DOMParser}\n */\nexport function parseXMLDoc (txt) {\n  let parser, xmlDoc\n  if (window.DOMParser) {\n    parser = new DOMParser()\n    xmlDoc = parser.parseFromString(txt, 'text/xml')\n  } else if (window.ActiveXObject) {\n    // Internet Explorer\n    /* global ActiveXObject */\n    xmlDoc = new ActiveXObject('Microsoft.XMLDOM')\n    xmlDoc.async = false\n    xmlDoc.loadXML(txt)\n  } else {\n    console.error(Error('Votre navigateur ne peut pas analyser du XML, impossible dutiliser instrumenpoche'))\n  }\n  return xmlDoc\n}\n\n/**\n * Retourne true si ch contient le nom d'un instrument.\n * @param {string} ch\n * @returns {boolean}\n */\nexport const estInstrument = (ch) => ['compas', 'compasLeve', 'crayon', 'equerre', 'rapporteur', 'regle', 'requerre'].includes(ch)\n\n/**\n * Fonction appele pour une chane qui commence par un caractre de balise ouvrante.\n * Avant appel la chane doit commencer par une balise ouvrante\n * Renvoie -1 s'il n'y a pas de balise fermante correspondante\n * @param {string} ch\n * @returns {int} Renvoie l'indice du dernier caractre de la balise fermante correspondante\n * augmente de 1\n */\nexport function indiceFinBalise (ch) {\n  let bal, balf, indf\n  let balisefont = false\n  if (ch.indexOf('<font') === 0) {\n    balf = '</font>'\n    balisefont = true\n  } else {\n    indf = ch.indexOf('>')\n    if (indf === -1) return ch.length // Erreur\n    bal = ch.substring(0, indf + 1)\n    balf = bal.substring(0, 1) + '/' + bal.substring(1)\n  }\n  const ind = ch.indexOf(balf)\n  if (ind === -1) {\n    // Il arrive que des gens oublient de fermer une baise font et en ouvrent une autre\n    if (balisefont) {\n      const ind2 = ch.indexOf('<font', 5)\n      if (ind2 !== -1) return ind2\n    }\n    return -1\n  } else {\n    // Incorrect. Balise de fn oublie ?\n    return ind + balf.length\n  }\n}\n\n/**\n * Fonction analysant une chane commenant par e( ou i(\n * et renvoyant un objet form de l'oprande et de l'exposant (ou indice)\n * @param {string} chaine\n * @return {{erreur: boolean, operande: string, exposant: string, texte: string}}\n */\nexport function analyseExposantOuIndice (chaine) {\n  const ch = chaine.trim()\n  const res = {}\n  const indvirg = ch.indexOf(',')\n  const indparf = ch.indexOf(')')\n  res.erreur = (indvirg === -1) || (indparf === -1)\n  if (res.erreur) {\n    res.texte = ''\n    return res\n  }\n  res.operande = ch.substring(3, indvirg)\n  res.exposant = ch.substring(indvirg + 1, indparf)\n  res.texte = ch.substring(indparf + 1)\n  return res\n}\n\n/**\n * Fonction appele dans le cas ou pDebut est l'indice dans chaine d'une\n * parenthse ouvrante et renvoyant l'indice de la parenthse\n * fermante correspondante dans la chane.\n * @return {number}\n */\nfunction indiceParentheseFermante (chaine, deb) {\n  let p\n  let ch\n  let somme = 1\n  p = deb + 1\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '(') { somme++ } else {\n      if (ch === ')') { somme-- }\n    }\n    if (somme === 0) break\n    p++\n  }\n  if (somme === 0) {\n    return p\n  }\n  // On renvoie -1 si pas trouv\n  return -1\n}\n\n/**\n * Retourne true si char est un chiffre\n * @param {string} char\n * @returns {boolean}\n */\nexport const estUnChiffre = (char) => typeof char === 'string' && char.length === 1 && /[0-9]/.test(char)\n\n// Fonctions reprises depuis le code source de InstrumentPoche en flash\nexport function valeur_approchee (nombre, precision) {\n  const prec = Math.pow(10, precision)\n  return Math.round(nombre / prec) * prec\n}\n\n/**\n * Fonction reprise  partir du code de la version Flash et servant pour les\n * repres et quadrillages\n * @param {number} nbr\n * @param {number} borne1\n * @param {number} borne2\n * @param {number} borne_pix1\n * @param {number} borne_pix2\n * @returns {number}\n */\nexport function mettre_en_pixels (nbr, borne1, borne2, borne_pix1, borne_pix2) {\n  const coeff_dir = (borne_pix1 - borne_pix2) / (borne1 - borne2)\n  const ordo_orig = borne_pix1 - coeff_dir * borne1\n  return coeff_dir * nbr + ordo_orig\n}\n\n/** Fonctions lminant dans le code XML contenu dans la chane ch les attributs\n * en doublon en ne gardant que le premier\n * @param {string} ch\n * @returns {string} / La chane avec les doublons d'attribut supprims.\n */\nexport function elimineDoublonsXML (ch) {\n  let res = ''\n  const patterns = ['objet', 'mouvement', 'vitesse', 'tempo', 'abscisse', 'ordonnee', 'id', 'couleur', 'pointille', 'echelle',\n    'angle', 'cible', 'texte', 'ecrire', 'rotation', 'translation', 'epaisseur', 'opacite', 'masquer', 'montrer',\n    'crayon', 'equerre', 'regle', 'compas', 'reglequerre', 'sens', 'hauteur', 'largeur', 'haut', 'gauche',\n    'Xmin', 'Ymin', 'Xmax', 'yMax', 'Xgrad', 'Ygrad', 'image', 'police', 'taille',\n    'ordonnee_bas_droite', 'abscisse_bas_droite', 'ordonnee_haut_gauche', 'abscisse_haut_gauche']\n  ch.split(/<action/gi).forEach((ligne, i) => {\n    patterns.forEach(pattern => {\n      const r = new RegExp(' ' + pattern + '[^\\\\w ]*= *\"[\\\\w]*\"', 'i')\n      const a = ligne.search(r)\n      if (a !== -1) {\n        const b = ligne.substring(a + 1).search(r)\n        if (b !== -1) ligne = ligne.replace(r, '')\n      }\n    })\n    res += (i === 0) ? ligne : '<action' + ligne\n  })\n  return res\n}\n\n/**\n * Fonction remplaant dans la chane ch les accents crits en code html par leur caractre utf8\n * @param {string} ch La chane  traiter\n * @returns {string} : La chane avec les caractres remplacs\n */\n\n/*\nremplaceAccentsHtml: function (ch) {\n  const t1 = ['&agrave;', '&acirc;', '&aelig;', '&egrave;', '&eacute;', '&ecirc;', '&icirc;', '&ocirc;',\n    '&ouml;', '&oslash;', '&Oslash;', '&ugrave;', '&ucirc;', '&apos;']\n  const t2 = ['', '', '', '', '', '', '', '',\n    '', '', '', '', '', \"'\"]\n  let i\n  for (i = 0; i < t1.length; i++) {\n    ch = ch.replace(new RegExp(t1[i], 'g'), t2[i])\n  }\n  return ch\n},\n*/\n/**\n * Fonction remplaant dans la chane ch toutes les balises crites avec des caractres spciaux \n * par des balises normales du type <...>\n * @param {string} ch La chane  traiter contenant les balises spciales\n * @returns {string} : La chane avec les balises normales\n */\nexport function remplaceBalises (ch) {\n  // Certains auteurs ont utilis les codes lt; et gt;\n  // Inutile car quand on parse avec getAttribute pour avoir le texte le balises sont dj remplaces\n  /*\n  ch = ch.replace(/lt;/gi,\"lt\");\n  ch = ch.replace(/gt;/gi,\"gt\");\n  */\n  // Par contre si elles ont dj t remplaces et utilisaient des majuscules il faut mettre des minuscules\n  ch = ch.replace(/<B>/g, '<b>')\n  ch = ch.replace(/<\\/B>/g, '</b>')\n  ch = ch.replace(/<I>/g, '<i>')\n  ch = ch.replace(/<\\/I>/g, '</i>')\n  ch = ch.replace(/<U>/g, '<u>')\n  ch = ch.replace(/<\\/U>/g, '</u>')\n\n  ch = ch.replace(/ltigt/gi, '<i>')\n  ch = ch.replace(/i/gi, '<i>')\n  ch = ch.replace(/lt\\/igt/gi, '</i>')\n  ch = ch.replace(/\\/i/gi, '</i>')\n  ch = ch.replace(/ltbgt/gi, '<b>')\n  ch = ch.replace(/b/gi, '<b>')\n  ch = ch.replace(/lt\\/bgt/gi, '</b>')\n  ch = ch.replace(/\\/b/gi, '</b>')\n  ch = ch.replace(/ltugt/gi, '<u>')\n  ch = ch.replace(/u/gi, '<u>')\n  ch = ch.replace(/lt\\/ugt/gi, '</u>')\n  ch = ch.replace(/\\/u/gi, '</u>')\n  ch = ch.replace(/ltbrgt/gi, '<br>')\n  ch = ch.replace(/ltbr\\/gt/gi, '<br>')\n  ch = ch.replace(/br/gi, '<br>')\n  ch = ch.replace(/br\\//gi, '<br>')\n  ch = ch.replace(/ltfont/gi, '<font')\n  ch = ch.replace(/lt\\/fontgt/gi, '</font>')\n  // Remplacement de balises exotiques utilises par certains\n  ch = ch.replace(/ltboldgt/gi, '<b>')\n  ch = ch.replace(/lt\\/boldgt/gi, '</b>')\n  // remplacement des lt et gt utilisscomme caractres\n  ch = ch.replace(/lt/gi, '<')\n  ch = ch.replace(/gt/gi, '>')\n  ch = ch.replace(/inferieurstrict/gi, '<')\n  ch = ch.replace(/superieurstrict/gi, '>')\n  // Remplacement des guillemets\n  ch = ch.replace(/guillemet/gi, '\"')\n  return ch\n}\n\n/**\n * Retourne une chane o les caractres spciaux de Flash de ch sont remplacs par\n * le caractre UTF8 correspondant\n * @param {string} ch La chane  traiter\n */\nexport function remplaceCarSpe (ch) {\n  if (!ch.includes('')) return ch\n  // on clate la chane sur  et on regarde les morceaux impair (0 est celui qui prcde le premier )\n  // attention, si jamais y'a un nombre impair de  faut pas ajouter de dernier \n  const newString = ch.split('').map((fragment, i) => {\n    if (i % 2) {\n      // impair, faut regarder si c'est une proprit connue (sans tenir compte de la casse)\n      const nom = fragment.toLowerCase()\n      return carSpeMin[nom] || `${fragment}`\n    }\n    return fragment\n  }).join('')\n  if ((ch.length - ch.replace(//g, '').length) % 2) {\n    console.warn(`Il y a un nombre impair de  dans cette chane : ${ch}`)\n    return newString.substr(0, newString.length - 1)\n  }\n  return newString\n  /* pour mmoire, avant on avait une boucle sur la centaine de caractres spciaux avec regex+replace  chaque fois, avec :\n  Object.entries(caracteresSpeciaux).forEach(([nom, char]) => {\n    const search = '' + nom + ''\n    if (ch.includes(search)) ch = ch.replace(new RegExp(cha, 'gi'), char)\n  })\n  return ch */\n}\n\n/**\n * Retourne l'idice dans la chane chaine de l'accolade fermante\n * correspondant  l'accolade ouvrante dont l'indice dans la chane est pdebut\n * Avant appel,l le caractre d'indice pdebut de la chane ch doit contenir\n * une parenthse ouvrante.\n * @private\n */\nfunction accoladeFermante (chaine, pdebut) {\n  let p, ch, somme\n\n  somme = 1\n  p = pdebut + 1\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '{') { somme++ } else {\n      if (ch === '}') { somme-- }\n    }\n    if (somme === 0) break\n    p++\n  }\n  if (somme === 0) {\n    return p\n  } else {\n    return -1\n  } // On renvoie -1 si pas trouv\n}\n\n/**\n * Retourne true si ch conteint une balise LaTeX : fraction, racine carre,\n * puissance, indice, chapeau, parenthses, crochets, valeur abolue, norme,\n * vecteur ou texte\n * @param {string} ch\n * @returns {Boolean}\n */\nexport function contientBaliseLaTeX (ch) {\n  return (ch.indexOf('\\\\frac') !== -1) || (ch.indexOf('\\\\sqrt') !== -1) ||\n    (ch.indexOf('}^{') !== -1) || (ch.indexOf('}_{') !== -1) ||\n    (ch.indexOf('\\\\widehat{') !== -1) || (ch.indexOf('\\\\left[') !== -1) ||\n    (ch.indexOf('\\\\left(') !== -1) || (ch.indexOf('\\\\left|') !== -1) ||\n    (ch.indexOf('\\\\left\\\\|') !== -1) || (ch.indexOf('\\\\overrightarrow{') !== -1) ||\n    (ch.indexOf('\\\\text{') !== -1)\n}\n\n/**\n * Une couleur css (sous sa forme #xxxxxx ou un nom de couleur black|red|)\n * @typedef SvgColor\n * @type {string}\n */\n/**\n * Retourne une chane de caractres reprsentant la couleur correspondant au contenu de ch (qui peut tre une couleur au format Flash ou dj une couleur css)\n * @param {string} ch\n * @returns {SvgColor}\n */\nexport function getSvgColor (ch) {\n  const trad = {\n    noir: 'black',\n    rouge: 'red',\n    vert: 'green',\n    bleu: 'blue',\n    blanc: 'white',\n    gris: 'grey',\n    darkorange: 'maroon'\n  }\n  if (ch === '0') return 'black'\n  if (trad[ch]) return trad[ch]\n\n  // complte avec des 0  gauche\n  const complete = (s) => s.length < 7 ? '#' + '0'.repeat(6 - s.length) + s : s.substr(-6)\n\n  // faut parser la chane\n  if (/^#/.test(ch)) {\n    if (ch.length === 7) return ch\n    // #f03 => #ff0033\n    if (ch.length === 4) return `#${ch[1]}${ch[1]}${ch[2]}${ch[2]}${ch[3]}${ch[3]}`\n    // a c'est pas trs catholique (ni orthodoxe)\n    console.error(Error(`couleur ${ch} invalide, on va tronquer ou complter avec des 0`))\n    return complete(ch.substring(1))\n  }\n  if (/^0x/.test(ch)) {\n    return complete(ch.substring(2))\n  }\n  if (/^[0-9]/.test(ch)) {\n    return complete(parseFloat(ch).toString(16))\n  }\n  // Sinon on suppose que c'est un nom de couleur (ou une couleur valide, comme rvb(r,v,b) ou \n  // cf https://developer.mozilla.org/fr/docs/Web/CSS/color\n  return ch\n}\n\n/**\n * Retourne true si les vecteurs u et v sont quasi colinaires\n * @param {Vect} u\n * @param {Vect} v\n * @returns {boolean}\n */\nexport function colineaires (u, v) {\n  const n1 = u.norme()\n  const n2 = v.norme()\n  if (zero(n1) || zero(n2)) return true\n  return zero((u.x * v.y - u.y * v.x) / n1 / n2)\n}\n\n/**\n * Retourne true si les vecteurs u et v sont quasi colinaires\n * de mme sens\n * @param {Vect} u\n * @param {Vect} v\n * @returns {boolean}\n */\nexport const colineairesMemeSens = (u, v) => colineaires(u, v) && (u.x * v.x + u.y * v.y >= 0)\n\n/**\n * Retourne l'indice de la nb ime virgule dans la chane ch\n *  partir de l'indice deb en sauta,t le contenu des parenthses\n * @param {string} chaine\n * @param {number} deb\n * @param {number} nb\n * @returns {number}\n */\nexport function indiceVirgule (chaine, deb, nb) {\n  let ch, indpf\n  let k = 0\n  let p = deb\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '(') {\n      indpf = indiceParentheseFermante(chaine, p)\n      if (indpf === -1) {\n        return -1\n      }\n      p = indpf\n    } else {\n      if (ch === ',') k++\n      if (k === nb) return p\n    }\n    p++\n  }\n  return -1\n}\n\n/**\n * Cette fonction permet de trouver les meilleures graduations a afficher pour un repere.\n * Elle retourne la plus petite de ces graduations, afin que des nombres \"ronds\" soient affichs.\n * Fonction reprise  partir du code de la version Flash et servant pour les\n * repres et quadrillages\n * @param {number} mini\n * @param {number} maxi\n * @param {number} unite\n * @returns {number}\n */\nexport function determiner_graduations (mini, maxi, unite) {\n  let debut_trace\n  // lorsque 0 est entre les bornes, on part de 0 et on cherche le dbut du trac\n  if (maxi * mini < 0) {\n    debut_trace = -Math.floor(-mini / unite) * unite\n  } else if (Math.ceil(Math.log(Math.abs(mini)) / Math.LN10) !== Math.ceil(Math.log(Math.abs(maxi)) / Math.LN10)) {\n    // en cas de puissance de 10 entre les bornes, on prend\n    if (mini < 0) {\n      debut_trace = -Math.pow(10, Math.floor(Math.log(Math.abs(mini)) / Math.LN10))\n    } else {\n      debut_trace = Math.pow(10, Math.ceil(Math.log(Math.abs(mini)) / Math.LN10))\n    }\n    debut_trace = debut_trace - Math.floor((debut_trace - mini) / unite) * unite\n  } else {\n    // dans tous les autres cas, on fait ce qu'on peut\n    debut_trace = valeur_approchee(mini, Math.floor(Math.log(unite) / Math.LN10))\n    if (debut_trace < mini) {\n      debut_trace += unite\n    }\n  }\n  return debut_trace\n}\n\n/**\n * Fonction rcursive appele lorsque l'affichage de texte n'utilise pas le LaTeX\n * Elle traite les balises u, i, b et font pour ajouter  txt (qui est lment\n * graphique svg text des tspans correspondants.\n * @param {String} : La chane contenant le texte avec balises ventuelles\n * @param {InfoBalise} infoBalise un objet qui contient les caractristiques du texte,  savoir\n * bold ou non, italique ou non, soulign ou non, couleur et fonte utilise\n * @param {svg.text} txt L'lment text de svg auquel seront rajouts les tspan crs\n * @param {Boolean} debutLigne true si l'affichage du prochain tspan doit se faire en dbut de ligne\n * @param {number} y le paramtre y du prochain tspan  crer\n */\nexport function traiteBalise (ch, infoBalise, txt, debutLigne, y) {\n  if (ch === '') return\n  let stylespan, indfb, ind1, ind2, fonte, couleur, taille, inddeb, info\n  const ind = ch.search(/<b>|<i>|<u>|<font/)\n  const tspan = document.createElementNS(svgns, 'tspan')\n  tspan.setAttribute('pointer-events', 'none')\n  if ((ind === -1) || (ind > 0)) { // Il y a du texte\n    stylespan = ''\n    // if (infoBalise.couleur !== \"\") stylespan += \"fill:\" + infoBalise.couleur+\";\";\n    if (infoBalise.couleur) stylespan += 'fill:' + infoBalise.couleur + ';'\n    if (infoBalise.bold) stylespan += 'font-weight:bold;'\n    if (infoBalise.italic) stylespan += 'font-style:italic;'\n    if (infoBalise.underline) stylespan += 'text-decoration:underline;'\n    if (infoBalise.fontface !== '') {\n      stylespan += 'font-family:' + infoBalise.fontface + ';'\n    } else {\n      stylespan += 'font-family: \"Times New Roman\", Times, serif;'\n    }\n    stylespan += 'font-size:' + infoBalise.taille + 'px;'\n    tspan.setAttribute('style', stylespan)\n    if (debutLigne) {\n      tspan.setAttribute('x', 0)\n      debutLigne = false\n    }\n    tspan.setAttribute('y', y)\n    const ch2 = (ind === -1) ? ch : ch.substring(0, ind)\n    tspan.appendChild(document.createTextNode(ch2))\n    txt.appendChild(tspan)\n    if (ind > 0) traiteBalise(ch.substring(ind), infoBalise, txt, debutLigne, y)\n    // else ch = \"\";\n  } else {\n    if (ch.indexOf('<b>') === 0) { // Balise bold\n      info = new InfoBalise(true, infoBalise.italic, infoBalise.underline, infoBalise.couleur, infoBalise.fontface)\n      indfb = indiceFinBalise(ch)\n      if (indfb === -1) {\n        traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n      } else {\n        traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n      }\n    } else {\n      if (ch.indexOf('<i>') === 0) { // Balise italique\n        info = new InfoBalise(infoBalise.bold, true, infoBalise.underline, infoBalise.couleur, infoBalise.fontface)\n        indfb = indiceFinBalise(ch)\n        if (indfb === -1) {\n          traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n        } else {\n          traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n        }\n      } else {\n        if (ch.indexOf('<u>') === 0) { // Balise souign\n          info = new InfoBalise(infoBalise.bold, infoBalise.italic, true, infoBalise.couleur, infoBalise.fontface)\n          indfb = indiceFinBalise(ch)\n          if (indfb === -1) {\n            traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n          } else {\n            traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n          }\n        } else {\n          if (ch.indexOf('<font') === 0) {\n            indfb = indiceFinBalise(ch)\n            if (indfb === -1) indfb = ch.length\n            ind1 = ch.indexOf('face=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 6)\n              if (ind2 !== -1) { fonte = ch.substring(ind1 + 6, ind2) } else fonte = ''\n            } else {\n              fonte = ''\n            }\n            couleur = ''\n            ind1 = ch.indexOf('couleur=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 9)\n              if (ind2 !== -1) {\n                couleur = getSvgColor(ch.substring(ind1 + 9, ind2))\n              }\n            } else {\n              ind1 = ch.indexOf('color=\"')\n              if (ind1 !== -1) {\n                ind2 = ch.indexOf('\"', ind1 + 7)\n                if (ind2 !== -1) {\n                  couleur = getSvgColor(ch.substring(ind1 + 7, ind2))\n                }\n              }\n            }\n            ind1 = ch.indexOf('size=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 6)\n              if (ind2 !== -1) { taille = ch.substring(ind1 + 6, ind2) } else taille = infoBalise.taille\n            }\n\n            info = new InfoBalise(infoBalise.bold, infoBalise.italic, infoBalise.underline, couleur, fonte, taille)\n            inddeb = ch.indexOf('>') // Recherche du > de la balise <font>\n            if ((/<\\/font>/i).test(ch)) {\n              traiteBalise(ch.substring(inddeb + 1, indfb - 7), info, txt, debutLigne, y)\n            } else {\n              traiteBalise(ch.substring(inddeb + 1), info, txt, debutLigne, y)\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Retourne true si la chane ch contient des codes spciaux de maths en flash\n * sauf les e() et i() simples.\n * Si les arguments de e() ou i() contiennent des appels  des balises ou d'autres\n * appels  e() et i() renvoie true car alors il faut utiliser le LaTeX pour reprsenter la formule.\n * Si expind est true on cherche aussi les puissances et indices\n * @param {string} ch\n * @returns {Boolean}\n */\nexport function necessiteLatex (ch) {\n  // Les codes e (exposant) et i (idice) ne ncessitent pas l'utilisation de MathJax\n  if (['a', 'c', 'd', 'f', 'g', 'n', 'p', 'r', 's', 'u', 'v'].some(code => ch.includes(`${code}(`))) return true\n  // Si la formule contient des puissances ou des indices utilisant elle-mmes des balises\n  // puissances, indices ou font il faut passer par le LaTeX donc on renvoie true\n  let ind, indparf, s\n  let ch1 = ch\n  while ((ind = ch1.search(/e\\(|i\\(/g)) !== -1) {\n    indparf = indiceParentheseFermante(ch1, ind + 3)\n    if (indparf === -1) indparf = ch1.length\n    s = ch1.substring(ind, indparf)\n    if (s.search(/e\\(|i\\(ltfont/g) !== -1) return true\n    if (indparf === ch1.length) {\n      return false\n    } else {\n      ch1 = s.substring(indparf + 1)\n    }\n  }\n  ch1 = ch\n  // Si la formule contient des balise font contenant des indices ou exposants\n  // il faut aussi passer par le LaTeX donc on renvoie true\n  while ((ind = ch1.search(/ltfont/g)) !== -1) {\n    indparf = indiceFinBalise(ch1.substring(ind))\n    if (indparf === -1) {\n      indparf = ch1.length\n    } else {\n      indparf += ind\n    }\n    s = ch1.substring(ind, indparf)\n    if (s.search(/e\\(|i\\(/g) !== -1) return true\n    if (indparf === ch1.length) {\n      return false\n    } else {\n      ch1 = s.substring(indparf + 1)\n    }\n  }\n  return false\n}\n\n/**\n * Fonction rcursive renvoyant une chane LaTeX reprsentant la chane contenue dans s\n * @param {string} s la chane  traiter (qui reprsente une ligne dans le cas de plusieurs lignes)\n * @param {boolean} btexte Si true, le contenu renvoy est encadr par une balise \\text\n */\nexport function getMaths (s, btexte) {\n  let ind, indpf, indv, ind1, ind2, inddeb, ch2, couleur, ret, indv1, indv2, indv3, car\n  const ch = s\n  if (ch === '') return ''\n  // Traitement des balises Font\n  // On ne traite que les changements de couleur\n  while ((ind = ch.indexOf('<font')) !== -1) {\n    couleur = null\n    ch2 = ch.substring(ind)\n    indpf = indiceFinBalise(ch2)\n    ind1 = ch2.indexOf('couleur=\"')\n    if (ind1 !== -1) {\n      ind2 = ch2.indexOf('\"', ind1 + 9)\n      if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 9, ind2))\n    } else {\n      ind1 = ch2.indexOf('color=\"')\n      if (ind1 !== -1) {\n        ind2 = ch2.indexOf('\"', ind1 + 7)\n        if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 7, ind2))\n      }\n    }\n    if (couleur != null) { // On ne traite que les changements de couleur\n      inddeb = ind + ch2.indexOf('>') + 1 // Pointe sur le dbut concern par la balise <font\n      if (indpf === -1) {\n        return getMaths(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb) + '}', btexte)\n      } else {\n        indpf += ind\n        return getMaths(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb, indpf - 7) + '}' + ch.substring(indpf), btexte)\n      }\n    } else {\n      inddeb = ind + ch2.indexOf('>') + 1\n      if (indpf === -1) {\n        return getMaths(ch.substring(0, ind) + ch.substring(inddeb), btexte)\n      } else {\n        indpf += ind\n        return getMaths(ch.substring(0, ind) + ch.substring(inddeb, indpf - 7) +\n          ch.substring(indpf), btexte)\n      }\n    }\n  }\n  // Traitement des caractres par code hexadcimal\n  while ((ind = ch.indexOf('u(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\unicode{x' + ch.substring(ind + 3, indpf) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des fractions\n  while ((ind = ch.indexOf('f(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    /* Modification version MathJax3 pour que les quotients utilisent display style sinon trop petits\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\frac{' +\n      getMaths(ch.substring(ind + 3, indv), false) + '}{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n      */\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\displaystyle{\\\\frac{' +\n      getMaths(ch.substring(ind + 3, indv), false) + '}{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des racines carres\n  while ((ind = ch.indexOf('r(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\sqrt{' +\n      getMaths(ch.substring(ind + 3, indpf), false) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des codes d'angle\n  while ((ind = ch.indexOf('a(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) +\n      '\\\\widehat{' + getMaths(ch.substring(ind + 3, indpf), true) + '}' +\n      getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des intgrales\n  while ((ind = ch.indexOf('g(')) !== -1) {\n    indv1 = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indv2 = indiceVirgule(ch, ind + 3, 2) // Recherche de la premire virgule\n    indv3 = indiceVirgule(ch, ind + 3, 3) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\int_{' +\n      getMaths(ch.substring(indv2 + 1, indv3), false) + '}^{' +\n      getMaths(ch.substring(indv3 + 1, indpf), false) +\n      '}' + getMaths(ch.substring(ind + 3, indv1), false) +\n      ' d' + getMaths(ch.substring(indv1 + 1, indv2), false) +\n      getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des crochets\n  while ((ind = ch.indexOf('c(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\left[' + getMaths(ch.substring(ind + 3, indpf), btexte) +\n      '\\\\right]' + getMaths(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des parenthses\n  while ((ind = ch.indexOf('p(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left(' + getMaths(ch.substring(ind + 3, indpf), btexte) +\n      '\\\\right)' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des valeurs absolues\n  while ((ind = ch.indexOf('d(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left|' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '\\\\right|' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des normes\n  while ((ind = ch.indexOf('n(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left\\\\|' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '\\\\right\\\\|' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des indices\n  while ((ind = ch.indexOf('i(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '{' + getMaths(ch.substring(ind + 3, indv), false) + '}_{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des exposants\n  while ((ind = ch.indexOf('e(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '{' + getMaths(ch.substring(ind + 3, indv), false) + '}^{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des vecteurs\n  while ((ind = ch.indexOf('v(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\overrightarrow{' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des balises <u>\n  while ((ind = ch.indexOf('<u>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return ch\n    } else {\n      indpf += ind\n    }\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\underline{' + getMaths(ch.substring(ind + 3, indpf - 4), true) +\n      '}' + getMaths(ch.substring(indpf), btexte)\n  }\n  // Traitement des balises <i>\n  while ((ind = ch.indexOf('<i>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMaths(ch.substring(0, ind), btexte) +\n        '\\\\textit{' + getMaths(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMaths(ch.substring(0, ind), btexte) + '\\\\textit{' +\n        getMaths(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMaths(ch.substring(indpf), btexte)\n    }\n  }\n  // Traitement des balises <b>\n  while ((ind = ch.indexOf('<b>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMaths(ch.substring(0, ind), btexte) +\n        '\\\\textbf{' + getMaths(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMaths(ch.substring(0, ind), btexte) + '\\\\textbf{' +\n        getMaths(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMaths(ch.substring(indpf), btexte)\n    }\n  }\n  if (btexte) {\n    car = ch.charAt(0)\n    // if ((car === \")\") || (car === \",\") || (car === \"}\")) return ch;\n    if ((car === ')') || (car === ',') || (car === '}')) {\n      return car + getMaths(ch.substring(1), btexte)\n    } else {\n      // Mme si on et en mode texte, on peut avoir au dbut de ch une balise \\textcolor incomplte\n      if (contientBaliseLaTeX(ch)) {\n        return ch\n      } else {\n        // Il faut sauter les balises \\\\textcolor en tenant compte que certaines ne sont pas fermes.\n        ind = ch.indexOf('\\\\textcolor{')\n        if (ind !== -1) {\n          ret = ''\n          ch2 = ch\n          while ((ind = ch2.indexOf('\\\\textcolor{')) !== -1) {\n            ind1 = ch2.indexOf('}{')\n            indpf = accoladeFermante(ch2, ind1 + 1)\n            if (indpf === -1) {\n              if (ind === 0) {\n                if (ind1 + 2 !== ch2.length) {\n                  ret += ch2.substring(0, ind1 + 2) + '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n                } else {\n                  ret += ch2\n                }\n                ch2 = ''\n              } else {\n                if (ind1 + 2 !== ch2.length) {\n                  ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                    '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n                } else {\n                  ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2)\n                }\n                ch2 = ''\n              }\n            } else {\n              if (ind === 0) {\n                ret += ch2.substring(0, indpf + 1)\n                if (indpf < ch2.length - 1) {\n                  ch2 = ch2.substring(indpf + 1)\n                } else {\n                  ch2 = ''\n                }\n              } else {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                  '\\\\text{' + ch2.substring(ind1 + 2, indpf + 1) + '}'\n                if (indpf < ch2.length - 1) {\n                  ch2 = ch2.substring(indpf + 1)\n                } else {\n                  ch2 = ''\n                }\n              }\n            }\n          }\n          if (ch2 === '') {\n            return ret\n          } else {\n            return ret + '\\\\text{' + ch2 + '}'\n          }\n        } else {\n          // Si la chane commence par une parenthse fermante, une accolade fermante ou une virgule\n          //  il s'agit d'une formule en cours et pas de mode texte\n          // Si le texte commence par des espaces, pour qu'ils soient pris en compte, on rajoute des espaces\n          // inscables en mode maths\n          let deb = 0\n          let k = 0\n          while (ch.charAt(k) === ' ') {\n            deb++\n            k++\n          }\n          return '~'.repeat(deb) + '\\\\text{' + ch.substring(k) + '}'\n        }\n      }\n    }\n  } else {\n    return ch\n  }\n}\n\n/**\n * Fonction rcursive renvoyant une chane LaTeX reprsentant la chane contenue dans s\n * Utilise pour les noms devant utiliser le LaTeX pour tre affichs\n * @param {string} s la chane  traiter (qui reprsente une ligne dans le cas de plusieurs lignes)\n * @param {boolean} btexte Si true, le contenut renvoy est encadr par une balise \\text Test\n */\nexport function getMathsForName (s, btexte) {\n  let ind, indpf, indv, ind1, ind2, inddeb, ch2, couleur, ret, car\n  let ch = s\n  if (ch === '') return ''\n  // Traitement des balises Font\n  // On ne traite que les changements de couleur\n  while ((ind = ch.indexOf('<font')) !== -1) {\n    couleur = null\n    ch2 = ch.substring(ind)\n    indpf = indiceFinBalise(ch2)\n    ind1 = ch2.indexOf('couleur=\"')\n    if (ind1 !== -1) {\n      ind2 = ch2.indexOf('\"', ind1 + 9)\n      if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 9, ind2))\n    } else {\n      ind1 = ch2.indexOf('color=\"')\n      if (ind1 !== -1) {\n        ind2 = ch2.indexOf('\"', ind1 + 7)\n        if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 7, ind2))\n      }\n    }\n    if (couleur !== null) { // On ne traite que les changements de couleur\n      inddeb = ind + ch2.indexOf('>') + 1 // Pointe sur le dbut concern par la balise <font\n      if (indpf === -1) {\n        return getMathsForName(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb) + '}', btexte)\n      } else {\n        indpf += ind\n        return getMathsForName(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb, indpf - 7) + '}' + ch.substring(indpf), btexte)\n      }\n    } else {\n      inddeb = ind + ch2.indexOf('>') + 1\n      if (indpf === -1) {\n        return getMathsForName(ch.substring(0, ind) + ch.substring(inddeb), btexte)\n      } else {\n        indpf += ind\n        return getMathsForName(ch.substring(0, ind) + ch.substring(inddeb, indpf - 7) +\n          ch.substring(indpf), btexte)\n      }\n    }\n  }\n  // Traitement des caractres par code hexadcimal\n  while ((ind = ch.indexOf('u(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(ch.substring(0, ind), btexte) + '\\\\unicode{x' + ch.substring(ind + 3, indpf) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des racines carres\n  while ((ind = ch.indexOf('r(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\sqrt{' +\n      getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des valeurs absolues\n  while ((ind = ch.indexOf('d(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\left|' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '\\\\right|' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des normes\n  while ((ind = ch.indexOf('n(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\left\\\\|' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '\\\\right\\\\|' + getMathsForName(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des indices\n  while ((ind = ch.indexOf('i(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    // rrue car il s'agit d'un nom : getMathsForName(ch.substring(ind+3,indv),true)\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '{' + getMathsForName(ch.substring(ind + 3, indv), true) + '}_{' +\n      getMathsForName(ch.substring(indv + 1, indpf), false) + '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des exposants\n  while ((ind = ch.indexOf('e(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la premire virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    // true car il s'agit d'un affichage de nom : getMathsForName(ch.substring(ind+3,indv),true)\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '{' + getMathsForName(ch.substring(ind + 3, indv), true) + '}^{' +\n      getMathsForName(ch.substring(indv + 1, indpf), false) + '}' + getMathsForName(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des vecteurs\n  while ((ind = ch.indexOf('v(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\overrightarrow{' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des balises <u>\n  while ((ind = ch.indexOf('<u>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return ch\n    } else {\n      indpf += ind\n    }\n    return getMathsForName(ch.substring(0, ind), btexte) + '\\\\underline{' + getMathsForName(ch.substring(ind + 3, indpf - 4), true) +\n      '}' + getMathsForName(ch.substring(indpf), btexte)\n  }\n  // Traitement des balises <i>\n  while ((ind = ch.indexOf('<i>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMathsForName(ch.substring(0, ind), btexte) +\n        '\\\\textit{' + getMathsForName(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMathsForName(ch.substring(0, ind), btexte) + '\\\\textit{' +\n        getMathsForName(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMathsForName(ch.substring(indpf), btexte)\n    }\n  }\n  // Traitement des balises <b>\n  while ((ind = ch.indexOf('<b>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMathsForName(ch.substring(0, ind), btexte) +\n        '\\\\textbf{' + getMathsForName(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMathsForName(ch.substring(0, ind), btexte) + '\\\\textbf{' +\n        getMathsForName(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMathsForName(ch.substring(indpf), btexte)\n    }\n  }\n  if (btexte) {\n    // Mme si on et en mode texte, on peut avoir au dbut de ch une balise \\textcolor incomplte\n    if (contientBaliseLaTeX(ch)) {\n      return ch\n    } else {\n      // Il faut sauter les balises \\\\textcolor en tenant compte que certaines ne sont pas fermes.\n      ind = ch.indexOf('\\\\textcolor{')\n      if (ind !== -1) {\n        ret = ''\n        ch2 = ch\n        while ((ind = ch2.indexOf('\\\\textcolor{')) !== -1) {\n          ind1 = ch2.indexOf('}{')\n          indpf = accoladeFermante(ch2, ind1 + 1)\n          if (indpf === -1) {\n            if (ind === 0) {\n              if (ind1 + 2 !== ch2.length) {\n                ret += ch2.substring(0, ind1 + 2) + '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n              } else {\n                ret += ch2\n              }\n              ch2 = ''\n            } else {\n              if (ind1 + 2 !== ch2.length) {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                  '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n              } else {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2)\n              }\n              ch2 = ''\n            }\n          } else {\n            if (ind === 0) {\n              ret += ch2.substring(0, indpf + 1)\n              if (indpf < ch2.length - 1) {\n                ch2 = ch2.substring(indpf + 1)\n              } else {\n                ch2 = ''\n              }\n            } else {\n              ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                '\\\\text{' + ch2.substring(ind1 + 2, indpf + 1) + '}'\n              if (indpf < ch2.length - 1) {\n                ch2 = ch2.substring(indpf + 1)\n              } else {\n                ch2 = ''\n              }\n            }\n          }\n        }\n        if (ch2 === '') {\n          return ret\n        } else {\n          return ret + '\\\\text{' + ch2 + '}'\n        }\n      } else {\n        // Si la chane commence par une parenthse fermante, une accolade fermante ou une virgule\n        //  il s'agit d'une formule en cours et pas de mode texte\n        car = ch.charAt(0)\n        if ((car === ')') || (car === ',') || (car === '}')) {\n          return ch\n        } else {\n          // Si on est en modetexte et que la chane commence par des espaces, pour qu'ils soient pris en compte\n          // on va, pour ces espaces, rester en mode maths et les remplacer par des ~ pour avoir des espaces inscables.\n          let deb = ''\n          while (ch.indexOf(' ') === 0) {\n            deb += '~'\n            ch = ch.substring(1)\n          }\n          return deb + '\\\\text{' + ch + '}'\n        }\n      }\n    }\n  } else {\n    return ch\n  }\n}\n\n/**\n * Retourne obj.taille sous forme d'un number garanti entre min et max,\n * renverra options.defaut si y'a un pb (obj.taille pas un nb dans l'intervalle)\n * @param {Object} obj\n * @param {Object} [options]\n * @param {Object} [options.defaut=20] La valeur qui sera renvoye si obj.taille n'est pas un entier entre min et max\n * @param {Object} [options.min=5] La taille min acceptable\n * @param {Object} [options.max=199] La taille max acceptable\n * @return {number}\n */\nexport function getTaille (obj, options = {}) {\n  if (!obj || typeof obj !== 'object') throw Error('objet invalide')\n  const defaut = options.defaut || 20\n  const min = options.min || 5\n  const max = options.max || 199 // dans devServer/fixture/0.xml on a une taille de 60\n  if (typeof defaut !== 'number' || typeof min !== 'number' || typeof max !== 'number') throw Error('options invalides')\n  const taille = Number(obj.taille)\n  if (isNaN(taille)) {\n    console.error(Error(`taille invalide (${obj.taille}) => ${defaut}`))\n    return defaut\n  }\n  if (taille < min) {\n    console.error(Error(`taille trop petite (${obj.taille} < ${min}) => ${defaut}`))\n    return defaut\n  }\n  if (taille > max) {\n    console.error(Error(`taille trop grande (${obj.taille} > ${max}) => ${defaut}`))\n    return defaut\n  }\n  return taille\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\nimport { zero } from '../global/index.js'\nimport { convDegRad, convRadDeg } from '../global/constantes.js'\nexport default Vect\n\n/**\n * Classe vecteur\n * Peut tre initialis par les coordonnes de l'origine et de l'extrmit ou\n * par deux coordonnes\n * @constructor\n * @param {number} x1 Abscisse de l'origine ou premire coordonne si deux paramtres\n * @param {number} y1 Ordonne de l'origine ou premire coordonne si deux paramtres\n * @param {number} x2 Abscisse de l'extrmit si quatre paramtres\n * @param {number} y2 Ordonne de l'extrmit si quatre paramtres\n */\nfunction Vect (x1, y1, x2, y2) {\n  if (arguments.length > 2) {\n    this.x = x2 - x1\n    this.y = y2 - y1\n  } else {\n    this.x = x1\n    this.y = y1\n  }\n}\n/**\n * Retourne true si la norme du vecteur est infrieur oue gale  10^-9\n * @returns {boolean}\n */\nVect.prototype.presqueNul = function () {\n  return zero(this.x) && zero(this.y)\n}\n/**\n * Retourne la norme du vecteur\n * @returns {number}\n */\nVect.prototype.norme = function () {\n  return Math.sqrt(this.x * this.x + this.y * this.y)\n}\n/**\n * Renvoie un vecteur de norme norme, colinaire  v et de mme sens\n * @param {number} normeSouhaitee  la norme du vecteur renvoy\n * @returns {Vect}\n */\nVect.prototype.vecteurColineaire = function (normeSouhaitee) {\n  const norm = this.norme()\n  return new Vect(this.x / norm * normeSouhaitee, this.y / norm * normeSouhaitee)\n}\n/**\n * Fonction faisiant tourner un vecteur de l'angle ang et renvoyant un nouveua vecteur\n * correspondant  cette transformation\n * @param {number} angle L'ange de rotation en degrs\n */\nVect.prototype.tourne = function (angle) {\n  const kc = Math.cos(angle * convDegRad)\n  const ks = Math.sin(angle * convDegRad)\n  return new Vect(kc * this.x - ks * this.y, kc * this.y + ks * this.x)\n}\n/**\n * Renvoie la mesure en degrs de l'angle polaire d'un vecteur non nul\n * Le nombre renvoy est entre 0 et 380 (exclu)\n * @returns {number}\n */\nVect.prototype.angle = function () {\n  let angle\n  if ((this.x === 0) && (this.y === 0)) return 0\n  else {\n    if (this.x === 0) {\n      if (this.y > 0) { angle = 3 * Math.PI / 2 } else angle = Math.PI / 2\n    } else {\n      if (this.x >= 0) { angle = Math.atan(-this.y / this.x) } else {\n        angle = Math.PI - Math.atan(this.y / this.x)\n      }\n      if (angle < 0) angle = angle + 2 * Math.PI\n    }\n  }\n  return angle * convRadDeg\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global/index.js'\nimport Vect from '../types/Vect.js'\nexport default InstrumentAncetre\n/**\n * Classe anctre de tous les instruments.\n * Contient deux membres this.x et this.y contenant les coordonnes de l'instrument\n * un membre this.angle contenant l'angle de l'instrument avec l'ohorizontale\n * et un membre this.zoomfactor contenant le facteur d'agrandissement de l'instrument.\n * @constructor\n * @param {IepDoc} doc le document contenant la figure et les instruments\n */\nfunction InstrumentAncetre (doc) {\n  this.doc = doc\n  this.x = 200\n  this.y = 400\n  this.angle = 0 // Sera modifi au dpart seulement pour le crayon\n  this.zoomfactor = 1\n  this.visible = false\n}\n/**\n * Fonction mettant l'instrument en position visible et montrant l'lement\n * graphique le reprsentant dans le DOM du svg de la figure\n * @param {boolean} bvisible\n */\nInstrumentAncetre.prototype.montre = function (bvisible) {\n  this.visible = bvisible\n  this.g.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n/**\n * Fonction retirant du DOM du svg de la figure l'lment graphique reprsentant\n * l'instrument, le recrant et le rajoutant ensuite de faon que l'instrument\n * soit aprs les lments graphiques reprsentant les objets de la figure et ne\n * soit pas recouvert par eux.\n * @returns {undefined}\n */\nInstrumentAncetre.prototype.updateg = function () {\n  this.initialisePosition()\n  this.doc.svg.removeChild(this.g)\n  this.doc.svg.appendChild(this.g)\n}\n/**\n * Fonction amenant l'instruemnt aux coordonnes (x,y) sans changer l'angle\n * ni le rapport de zoom.\n * @param {number} x La nouvelle abscisse\n * @param {number} y La nouvelle ordonne\n * @returns {undefined}\n */\nInstrumentAncetre.prototype.translate = function (x, y) {\n  this.setPosition(x, y, this.angle, this.zoomfactor)\n}\n/**\n * Fonction envoayan l'angle initial de l'instruement.\n * Sera redfini pour le crayon  -40\n * @returns {number}\n */\nInstrumentAncetre.prototype.angleInit = function () {\n  return 0\n}\n/**\n * Fonction modifiant la position relative du g element reprsentant l'instrument\n * dans le svg de la figure pour qu'i soit  la bonne position, bon angle et bon zoom\n * Sera redfini pour le compas et le compas lev.\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n * @param {number} zoomfactor\n */\nInstrumentAncetre.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  let zoom\n  this.x = x\n  this.y = y\n  this.angle = angle\n  if (arguments.length >= 4) {\n    zoom = zoomfactor\n    this.zoomfactor = zoom\n  } else zoom = this.zoomfactor\n  this.g.setAttribute('transform', 'scale(' + zoom + ') translate(' +\n    String(x / zoom) + ',' + String(y / zoom) + ') rotate(' + angle + ')')\n}\n/**\n * Fonction initialisant la position de l'instrument\n */\nInstrumentAncetre.prototype.initialisePosition = function () {\n  this.setPosition(200, 400, this.angleInit(), 1)\n}\n/**\n * Fonction lanant une animation de l'instrument par translation\n * @param {number} xfin l'abscisse de l'instrument  la fin de la translation\n * @param {number} yfin l'ordonne de l'instrument  la fin de la translation\n * @param {number} pix Le nombre de pixels de la translation  chaque dixime de seconde\n */\nInstrumentAncetre.prototype.lanceAnimationTranslation = function (xfin, yfin, pix10) {\n  this.xfin = xfin\n  this.yfin = yfin\n  this.pix = Math.abs(pix10 / 2) // Dans la version JavaScript on quadruple la frquence\n  // en divisant le pas par 4\n  // (en fait on corrige par car la rapidit semble double de celle annonce dans le mode d'emploi)\n  const v = new Vect(this.x, this.y, xfin, yfin)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  if (this.dist === 0) {\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.pix)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourTranslation() }, 25)\n}\n// On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n// est infrieure  la distance prcdente\n/**\n * Fonction appele par un timer lors de l'animation de translation de l'instrument\n */\nInstrumentAncetre.prototype.actionPourTranslation = function () {\n  const x = this.x + this.vect.x\n  const y = this.y + this.vect.y\n  const u = new Vect(x, y, this.xfin, this.yfin)\n  const d = u.norme()\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.setPosition(this.xfin, this.yfin, this.angle)\n    if (this === this.doc.compas) {\n      if ((this.doc.compasLeve != null) && (this.doc.compasLeve.visible)) { this.doc.compasLeve.setPosition(this.xfin, this.yfin, this.angle) }\n    }\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = d\n    this.setPosition(x, y, this.angle)\n    if (this === this.doc.compas) {\n      if ((this.doc.compasLeve != null) && (this.doc.compasLeve.visible)) { this.doc.compasLeve.setPosition(x, y, this.angle) }\n    }\n  }\n}\n/**\n * Fonction lanant une animation de l'instrument par rotation\n * @param {number} l'angle de fin de l'objet avec l'horizontale aprs la rotation\n * @param {number} deg10 le nombre de degrs dont on tounre  chaque\n * dixime de seconde\n */\nInstrumentAncetre.prototype.lanceAnimationRotation = function (angfin, deg10) {\n  // Il faut choisir le dplacement \"le plus court\"\n  const ang1 = kernel.mesurePrincDeg(this.angle)\n  let ang2 = kernel.mesurePrincDeg(angfin)\n  if (Math.abs(ang2 - ang1) > 180) {\n    if (ang2 > ang1) ang2 = ang2 - 360\n    else ang2 = ang2 + 360\n  }\n  this.anglefin = ang2\n  this.angle = ang1\n  // Contraiement  ce qui est dit dans la doc d'instrumenpoche il semble que le pas par dfaut soit de 16 \n  // et mme un peu plus\n  this.pasdeg = deg10 / 3 // Dans la version JavaScript on quadruple la frquence\n  // En divisant le pas par 4\n  // Mais en fait par deux pour compatibilit observe\n  this.pasdeg *= (ang2 >= ang1) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(ang2 - this.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourRotation() }, 25)\n}\n/**\n * Fonction appele par un timer lors de l'animation de rotation de l'instrument\n */\nInstrumentAncetre.prototype.actionPourRotation = function () {\n  const ang = parseFloat(this.angle) + parseFloat(this.pasdeg)\n  const dis = Math.abs(ang - this.anglefin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.setPosition(this.x, this.y, this.anglefin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.setPosition(this.x, this.y, ang)\n  }\n}\n/**\n * Fonction lanant une animation de l'instrument par zoom\n * @param {number} zoomfin le zoom final quand l'animation est finie\n * @param {number} vitesse paramtre reprsentant la vitesse d'animation\n */\nInstrumentAncetre.prototype.lanceAnimationZoom = function (zoomfin, vitesse) {\n  this.zoomfin = zoomfin\n  this.vitesse = parseInt(vitesse)\n  this.pas = this.vitesse * 0.05 * (this.zoomfin - this.zoomfactor) // On augmente\n  // par dfaut de 5% de vitesse tous les diximes de seconde\n  this.senspos = (this.pas >= 0)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourZoom() }, 100)\n}\n/**\n * Fonction appele par un timer lors de l'animation de zoom de l'instrument\n */\nInstrumentAncetre.prototype.actionPourZoom = function () {\n  const z = this.zoomfactor + this.pas\n  if (this.doc.animationEnCours && ((this.senspos && (z < this.zoomfin)) || (!this.senspos && (z > this.zoomfin)))) { this.setPosition(this.x, this.y, this.angle, z) } else {\n    this.zoomfactor = this.zoomfin\n    this.positionne()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  }\n}\n/**\n * Fonction recalculant l'lment graphique reprsentant l'instrument et\n * remettant son lment grapique en accord avec cette position\n */\nInstrumentAncetre.prototype.positionne = function () {\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default Compas\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Objet Compas contenu dans une animation InstrumenPche\n * @param {IepDoc} doc le document propritaire\n * la variable this.leve contient true si une action ActionLeverCompas a t\n * prcdemment excute. Dans ce as c'est un autre objet iep.compasLeve qui sera cr\n * La variable this.bretourne contient true si une action ActionRetourner a t\n * excute prcdemment.\n * et utilis dans la figure.\n */\nfunction Compas (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.ecart = 0\n  this.bretourne = false\n  this.leve = false\n  this.lon = 185 // Longueur intrieure des deux branches des compas\n  this.longpointe = 18\n  const d = this.lon + this.longpointe\n  this.alp = Math.asin(this.ecart / (2 * d)) / Math.PI * 180 // Le demi-angle que font les deux branches du compas\n  this.decbh = 30 // Dcalage vers le bas de la partie haute\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle, 1)\n  // Ajout de d'lment graphique reprsentnant le compas dans le SVG contenant la figure\n  doc.svg.appendChild(this.g)\n}\nCompas.prototype = new InstrumentAncetre()\n/**\n * Fonction initialisant la position du compas\n */\nCompas.prototype.initialisePosition = function () {\n  InstrumentAncetre.prototype.initialisePosition.call(this)\n  this.ecart = 0\n  this.positionne()\n}\n/**\n * Cre l'lment graphique reprsentant le compas\n * @returns {SVGElement}\n */\nCompas.prototype.creeg = function () {\n  let li, p, path, circ\n  const lon = this.lon // Longueur intrieure des deux branches des compas\n  const longpointe = this.longpointe // Longueur de la pointe et de la mine\n  const ep = 7 // Epaisseur des branches\n  const retb = 20 // Retrait du bouton de gauche sur la branche;\n  const rayb = 6 // Le rayon des boutons\n  const epm = 3.5 // Epaisseur de la mine\n  const dlb = 3 // la demi-largeur basse de la partie fixe\n  const dlm = 12 // La demi-largeur moyenne de la partie fixe\n  const ylm = 24 // L'ordonne correspondante\n  const ylm2 = 35 // Ordonne de la partie moyenne haute\n  const dlh = 6 // La demi-largeur haute de la partie fixe\n  const ylh = 50 // L'ordonne correspondante\n  const dltop = 3 // La demi-largeur de la partie suprieure du chpeau\n  const ytop = 70 // L'ordonne correspondante\n  const g = document.createElementNS(svgns, 'g')\n  this.bg = document.createElementNS(svgns, 'g') // La branche de gauche\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', 0)\n  li.setAttribute('y2', -longpointe)\n  li.setAttribute('style', 'stroke: black; stroke-width:1.5;')\n  this.bg.appendChild(li)\n  p = document.createElementNS(svgns, 'path')\n  path = 'M0 ' + String(-longpointe) + 'L 0 ' + String(-longpointe - lon) + ' ' +\n          String(-ep) + ' ' + String(-longpointe - lon) + ' ' + String(-ep) + ' ' +\n          String(-longpointe) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(p)\n  // On rajoute le bouton de gauche\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep / 2)\n  circ.setAttribute('cy', -longpointe - retb)\n  circ.setAttribute('r', rayb)\n  circ.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(circ)\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep / 2)\n  circ.setAttribute('cy', -longpointe - retb)\n  circ.setAttribute('r', 2)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(circ)\n  g.appendChild(this.bg)\n  // La branche de droite\n  this.bd = document.createElementNS(svgns, 'g') // La branche de gauche\n  // La mine\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L0' + ' ' + String(-longpointe) + ' ' + epm + ' ' + String(-longpointe - epm) + ' ' +\n          epm + ' ' + String(-epm - 3) + 'Z'\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: blck; fill-opacity: 1')\n  p.setAttribute('d', path)\n  this.bd.appendChild(p)\n  p = document.createElementNS(svgns, 'path')\n  path = 'M0 ' + String(-longpointe) + 'L 0 ' + String(-longpointe - lon) + ' ' +\n          ep + ' ' + String(-longpointe - lon) + ' ' + ep + ' ' +\n          String(-longpointe) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bd.appendChild(p)\n  // Le petit bout de bouton  droite\n  p = document.createElementNS(svgns, 'path')\n  const rayx = rayb / 4 * 3\n  const rayy = rayb / 2\n  path = 'M' + ep + ' ' + String(-longpointe - retb + rayx) + 'A ' + rayx + ' ' + rayy + ' -90 0 0 ' +\n       ep + ' ' + String(-longpointe - retb - rayx) + 'Z'\n  p.setAttribute('style', 'stroke:black;stroke-width:1; fill: silver; fill-opacity: 1')\n  p.setAttribute('d', path)\n  this.bd.appendChild(p)\n  // Ligne en biais sur la branche droite\n  const styleli = 'stroke: black; stroke-width:1;'\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', -100)\n  li.setAttribute('x2', ep)\n  li.setAttribute('y2', -100 + ep)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  // Autres lignes branche de droite\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', -50)\n  li.setAttribute('x2', ep)\n  li.setAttribute('y2', -50)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', ep / 2)\n  li.setAttribute('y1', -50)\n  li.setAttribute('x2', ep / 2)\n  li.setAttribute('y2', -73)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  // Le bouton vu de ct\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', ep)\n  rect.setAttribute('y', -68)\n  rect.setAttribute('width', 4)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bd.appendChild(rect)\n  g.appendChild(this.bd)\n  // La partie fixe du haut\n  this.haut = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L' + dlb + ' 0 ' + dlm + ' ' + String(-ylm) + ' ' + dlm + ' ' + String(-ylm2) +\n          'A' + String(ylh - ylm2) + ' ' + String(dlm - dlh) + ' -90 0 1 ' + dlh + ' ' + String(-ylh) +\n          'L' + dltop + ' ' + String(-ytop) + ' ' + String(-dltop) + ' ' + String(-ytop) +\n          'L' + String(-dlh) + ' ' + String(-ylh) + 'A' + String(ylh - ylm2) + ' ' + String(dlm - dlh) +\n          ' 90 0 1 ' + String(-dlm) + ' ' + String(-ylm2) + ' L ' +\n          String(-dlm) + ' ' + String(-ylm) + ' ' + String(-dlb) + ' 0Z'\n\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  // this.haut.setAttribute(\"transform\",\"translate(0,30)\");\n  this.haut.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', dlh)\n  li.setAttribute('y1', -ylh)\n  li.setAttribute('x2', -dlh)\n  li.setAttribute('y2', -ylh)\n  li.setAttribute('style', 'stroke: black; stroke-width:1;')\n  this.haut.appendChild(li)\n  // On ajoute le logo Sesamath\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Ssamath'))\n  text.setAttribute('x', 0)\n  text.setAttribute('y', 0)\n  text.setAttribute('style', 'font-family: Arial;font-size: 5pt;fill: white')\n  text.setAttribute('transform', 'rotate(-90) translate(4,2.5)')\n  this.haut.appendChild(text)\n\n  // On rajoute les deux petits ronds blancs (rivets)  chaque branche\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep + 1)\n  circ.setAttribute('cy', -this.decbh)\n  circ.setAttribute('r', 3)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: white; fill-opacity: 1')\n  this.haut.appendChild(circ)\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', ep - 1)\n  circ.setAttribute('cy', -this.decbh)\n  circ.setAttribute('r', 3)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: white; fill-opacity: 1')\n  this.haut.appendChild(circ)\n\n  g.appendChild(this.haut)\n  this.g = g\n}\n/**\n * Fonction calculant les lments graphiques du compas et modifiant le svg element\n * en consquence.\n * @param {number} x l'abscisse de la point du compas\n * @param {number} y l'ordonne de la pointe du compas\n * @param {number} angle l'angle en degrs que fait le compas avec l'horizontale\n * @param {number} zoomfactor le zoom initialis au dpart  1 et qui peut tre\n * modifi par une action ActionZoomInstrument\n */\nCompas.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  let zoom\n  if (arguments.length >= 4) {\n    zoom = zoomfactor\n    this.zoomfactor = zoom\n  } else {\n    zoom = this.zoomfactor\n  }\n  this.x = x\n  this.y = y\n  this.angle = angle\n  const d = this.lon + this.longpointe\n  // Le demi-angle que font les deux branches du compas\n  let nb = this.ecart / (2 * d * zoom)\n  if (nb > 1) nb = 1 // Si on demande un cartement de compas irraliste ...\n  this.alp = Math.asin(nb) / Math.PI * 180\n  if (isNaN(this.alp)) {\n    console.error(Error('dans compas.setPosition on a alp qui est NaN'))\n    if (this.doc.debug) console.debug(`avec x=${x}, y=${y}, angle=${angle} et zoom=${zoom} on a d=${d} et ecart=${this.ecart} asin(${this.ecart}/${2 * d * zoom}/*180) donne NaN`)\n  } else {\n    this.bg.setAttribute('transform', `rotate(${this.alp})`)\n    this.bd.setAttribute('transform', `translate(${this.ecart / zoom}, 0) rotate(${-this.alp})`)\n    const ang = this.alp / 180 * Math.PI\n    const transX = this.ecart / 2 / zoom\n    const transY = (-d) * Math.cos(ang) + this.decbh\n    this.haut.setAttribute('transform', `translate(${transX},${transY})`)\n    const scale = this.bretourne ? `scale(${zoom},${-zoom})` : `scale(${zoom})`\n    this.g.setAttribute('transform', `${scale} translate(${x / zoom},${y / zoom}) rotate(${angle})`)\n  }\n}\n/**\n * Fonction utilise pour mettre le compas en position retourne par rapport\n *  la position prcdente.\n */\nCompas.prototype.retourne = function () {\n  this.bretourne = !this.bretourne\n  this.setPosition(this.x, this.y, this.angle)\n}\n/**\n * Fonction recalculant les lments du Compas et mettant en consquence  jour\n * l'lment graphique qui le reprsente.\n */\nCompas.prototype.positionne = function () {\n  InstrumentAncetre.prototype.positionne.call(this)\n  if (this.leve && (this.doc.compasLeve != null)) InstrumentAncetre.prototype.positionne.call(this.doc.compasLeve)\n}\n/**\n * Fonction translatant le compas au point de coordonnes (x;y)\n * @param {number} x l'abscisse du point de destination\n * @param {number} y l'ordonne du point de destination\n */\nCompas.prototype.translate = function (x, y) {\n  InstrumentAncetre.prototype.translate.call(this, x, y)\n  if (this.leve && (this.doc.compasLeve != null)) InstrumentAncetre.prototype.translate.call(this.doc.compasLeve, x, y)\n}\n/**\n * Fonction lanant une animation d'cartement de compas pour une action ActionEcaterCompas\n * @param {number} ecart l la valeur de l'cartement final (en units de longueur)\n * @param {number} ec10 le pas d'incrmentation pour l'cart  chaque dixime de seconde\n */\nCompas.prototype.lanceAnimationEcartement = function (ecart, ec10) {\n  this.ecartfin = parseFloat(ecart)\n  // Dans la version JavaScript on pourra rajouter un paramtre donnant le pas\n  // d'cartement par dixime de seconde\n  this.pasecart = ec10 / 4\n  this.pasecart *= (ecart >= this.ecart) ? 1 : -1 // 1 pour le sens direct svg\n  this.distecart = Math.abs(ecart - this.ecart)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourEcartement() }, 25)\n}\n// On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n// est infrieure  la distance prcdente\n/**\n * Fonction appele par un timer lors d'une aniamtion d'cartement de compas\n * On poursuit l'animation tant que la distance entre la position actuelle et\n * la position de fin de n raugmente pas\n */\nCompas.prototype.actionPourEcartement = function () {\n  const ec = this.ecart + this.pasecart\n  const dis = Math.abs(ec - this.ecartfin)\n  if ((dis > this.distecart) || !this.doc.animationEnCours) {\n    this.ecart = this.ecartfin\n    this.setPosition(this.x, this.y, this.angle)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distecart = dis\n    this.ecart = ec\n    this.setPosition(this.x, this.y, this.angle)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default Equerre\n/**\n * Objet reprsentant l'querre de la figure.\n * @constructor\n * @extends InstrumentAncetre\n * (this.x,this.y)  sont les coordonnes du sommet de l'querre\n * this.angle est l'angle que fait l'querre avec l'horizontale.\n * @param {IepDoc} doc le document propritaire de la figure\n */\nfunction Equerre (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nEquerre.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'querre\n * dans le DOM du svg qui contient la figure\n * @returns {g}\n */\nEquerre.prototype.creeg = function () {\n  let p, path\n  const largeur = 131\n  const hauteur = 223\n  const largeurbas = 31\n  const largeurgauche = 24\n  const largeurint = 61\n  const hauteurint = largeurint * hauteur / largeur\n  const largeurbande = 16 // pour la partie plus claire en bas et  gauche.\n  const h = hauteur / largeur * (largeur - largeurbande) // Hauteur basse de la partie plus claire\n  const l = largeur / hauteur * (hauteur - largeurbande)\n\n  const g = document.createElementNS(svgns, 'g')\n  // D'abord le pourtour\n  p = document.createElementNS(svgns, 'path')\n  // Pourtour exterieur\n  path = 'M 0 0 L ' + largeur + ' 0 L 0 ' + String(-hauteur) + ' Z'\n  // Pourtout intrieur qui doit tre parcouru dans l'autre sens pour le remplissage\n  const path2 = 'M ' + largeurgauche + ' ' + String(-largeurbas) + ' L ' + largeurgauche + ' ' +\n          String(-largeurbas - hauteurint) + ' L ' + String(largeurgauche + largeurint) +\n          ' ' + String(-largeurbas) + ' Z'\n  path += path2\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // On repasse l'intrieur pour laisser une bande plus claire sur les cts\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + largeurbande + ' ' + String(-largeurbande) + ' L ' + l + ' ' +\n          String(-largeurbande) + ' L ' + largeurbande + ' ' + (-h) + ' Z'\n  path += path2\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke-width:0; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // On rajoute le texte Sesamath dans la barre du bas\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Ssamath'))\n  text.setAttribute('x', largeurgauche)\n  text.setAttribute('y', -largeurbande / 2 - 5)\n  text.setAttribute('style', 'font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon')\n  g.appendChild(text)\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default Rapporteur\n\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe reprsentant le rapporteur de la figure.\n * @param {IepDoc} doc\n */\nfunction Rapporteur (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.graduationExterneVisible = true\n  this.graduationInterneVisible = true\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\n\nRapporteur.prototype = new InstrumentAncetre()\n\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant le rapporteur dans\n * le DOM du svg de la figure\n */\nRapporteur.prototype.creeg = function () {\n  let path, p, li, i, text\n  const hauteurPolice = 10\n  const hauteurPoliceInterne = 9\n  const largeurBarre = '13'\n  const ray = 156\n  const rayon = String(ray) // Le rayon extrieur\n  const rayInt = 89\n  const rayonInt = String(rayInt) // Le rayon intrieur\n  const raytraitint = '116' // Le rayon du trait interne\n  const rayonMire = '7'\n  const g = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  // Le pourtour\n  path = 'M ' + rayon + ' 0 A ' + rayon + ' ' + rayon + ' 0 0 0 -' + rayon + ' 0 L ' +\n          '-' + rayon + ' ' + largeurBarre + ' L ' + rayon + ' ' + largeurBarre +\n          ' L ' + rayon + ' 0'\n  // L'intrieur qui doit tre tac dans l'autre sens\n  path += 'M 0 0 L -' + rayonInt + ' 0 A ' + rayonInt + ' ' + rayonInt + ' 0 0 1 ' +\n          rayonInt + ' 0 Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:#999999;stroke-width:1; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // La mire\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + rayonMire + ' 0 A ' + rayonMire + ' ' + rayonMire + ' 0 0 0 ' +\n          '-' + rayonMire + ' 0 M 0 0 L 0 -' + rayonMire\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke: #666666;stroke-width:1; fill: none')\n  g.appendChild(p)\n  // Les graduations externes\n  for (i = 0; i <= 180; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', rayon)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', i % 10 === 0 ? ray - 20 : (i % 5 === 0 ? ray - 10 : ray - 5))\n    li.setAttribute('y2', 0)\n    li.setAttribute('transform', 'rotate(-' + i + ')')\n    li.setAttribute('style', 'stroke: #333333;stroke-width:0.7;')\n    g.appendChild(li)\n  }\n  // Les nombres de la graduation externe\n  this.gradext = document.createElementNS(svgns, 'g')\n  for (i = 0; i <= 180; i++) {\n    if (i % 10 === 0) {\n      text = document.createElementNS(svgns, 'text')\n      text.setAttribute('pointer-events', 'none')\n      text.appendChild(document.createTextNode(i))\n      text.setAttribute('x', 0)\n      text.setAttribute('y', 0)\n      text.setAttribute('style', 'font-family: arial;font-size: ' + hauteurPolice +\n              'px;text-anchor: middle; fill: black')\n      text.setAttribute('transform', ' scale(-1) rotate(' + String(-i - 90) + ') translate(0,' +\n              String(-ray + 22 + hauteurPolice) + ')')\n      this.gradext.appendChild(text)\n    }\n  }\n  g.appendChild(this.gradext)\n  // On rajoute le trait interne sparat les graduatiosn externes et internes\n  const dep = ray - 26 - hauteurPolice\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + String(dep) + ' 0 L ' + raytraitint + ' 0 A ' +\n          raytraitint + ' ' + raytraitint + ' 0 0 0 -' + raytraitint + ' 0 L ' +\n          String(-dep) + ' 0'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke: #666666;stroke-width:1; fill: none')\n  g.appendChild(p)\n  // On rajoute les graduatiions internes\n  for (i = 0; i <= 18; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', rayInt)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', rayInt + 10)\n    li.setAttribute('y2', 0)\n    li.setAttribute('transform', 'rotate(-' + String(10 * i) + ')')\n    li.setAttribute('style', 'stroke: #333333;stroke-width:0.7;')\n    g.appendChild(li)\n  }\n  // Les nombres de la graduation interne\n  this.gradint = document.createElementNS(svgns, 'g')\n  for (i = 0; i <= 18; i++) {\n    text = document.createElementNS(svgns, 'text')\n    text.setAttribute('pointer-events', 'none')\n    text.appendChild(document.createTextNode(180 - 10 * i))\n    text.setAttribute('x', 0)\n    text.setAttribute('y', 0)\n    text.setAttribute('style', 'font-family: arial;font-size: ' + hauteurPoliceInterne +\n              'px;text-anchor: middle; fill: black')\n    text.setAttribute('transform', 'scale(-1) rotate(' + String(-10 * i - 90) + ') translate(0,' +\n              String(-rayInt - 14) + ')')\n    // text.setAttribute(\"transform\", \"rotate(\" + String(-10*i+1) + \")\");\n    this.gradint.appendChild(text)\n  }\n  g.appendChild(this.gradint)\n  // On matrialise le centre par un petit rond (n'existait pas).\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', 0)\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('r', 2)\n  circ.setAttribute('style', 'stroke: black; stroke-width: 1;fill: none')\n  g.appendChild(circ)\n  // On rajoute le texte Sesamath dans la barre du bas\n  text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Ssamath'))\n  text.setAttribute('x', 0)\n  text.setAttribute('y', largeurBarre - 2)\n  text.setAttribute('style', 'font-family: sans-serif;font-size: 7pt;font-weight:bold;text-anchor: middle; fill: maroon')\n  g.appendChild(text)\n  this.g = g\n}\n\n/**\n * Fonction montrant ou affichant les nombres de la graduation externe\n * @param {boolean} [bvisible=false] Nombres affichs si true\n */\nRapporteur.prototype.montreGraduations = function (bvisible) {\n  this.graduationInterneVisible = true\n  if (this.visible) this.gradint.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n/**\n * Fonction montrant ou affichant les nombres de la graduation interne du rapporteur\n * @param {boolean} [bvisible=false]Nombres affichs si true\n */\nRapporteur.prototype.montreGraduationsExternes = function (bvisible) {\n  this.graduationExterneVisible = true\n  if (this.visible) this.gradext.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n/**\n * Fonction mettant le rapporteur en position visible ou cach suivant la\n * valeur de bvisible\n * @param {boolean} [bvisible=false]\n */\nRapporteur.prototype.montre = function (bvisible) {\n  InstrumentAncetre.prototype.montre.call(this, bvisible)\n  if (bvisible) {\n    this.gradint.setAttribute('visibility', this.graduationInterneVisible ? 'visible' : 'hidden')\n    this.gradext.setAttribute('visibility', this.graduationExterneVisible ? 'visible' : 'hidden')\n  } else {\n    this.gradint.setAttribute('visibility', 'hidden')\n    this.gradext.setAttribute('visibility', 'hidden')\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default Regle\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe reprsentant la rgle de la figure\n * @param {IepDoc} doc le document propritaire de la figure\n */\nfunction Regle (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.x = 100\n  this.y = 400\n  this.angle = 0\n  this.longueur = 15 // Longueur en cm. Peut tre modifier par actionModifierLongueur\n  // 30 pixels par cm\n  this.graduationVisible = true\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nRegle.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant la rgle\n * dans le DOM du svg de la figure\n */\nRegle.prototype.creeg = function () {\n  let li, text\n  const hauteurPolice = 9\n  const longint = this.longueur * 30 + 15\n  const larg = 57\n  const largeur = String(larg)\n  const ray = 6 // Rayon de courbure des coins\n  const rayon = String(ray)\n  const g = document.createElementNS(svgns, 'g')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -rayon - 1)\n  rect.setAttribute('y', 0)\n  rect.setAttribute('width', String(longint + ray + 1))\n  rect.setAttribute('height', largeur)\n  rect.setAttribute('rx', rayon)\n  rect.setAttribute('ry', rayon)\n  rect.setAttribute('style', 'stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5;')\n  g.appendChild(rect)\n  const line = document.createElementNS(svgns, 'line')\n  line.setAttribute('x1', -rayon)\n  line.setAttribute('y1', 27)\n  line.setAttribute('x2', longint)\n  line.setAttribute('y2', 27)\n  line.setAttribute('style', 'stroke:#999999;stroke-width:2;')\n  g.appendChild(line)\n  // On cre les graduations\n  this.graduations = document.createElementNS(svgns, 'g')\n  for (let i = 0; i <= this.longueur * 10; i++) {\n    li = document.createElementNS(svgns, 'line')\n    const x = 3 * i\n    li.setAttribute('x1', x)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', x)\n    li.setAttribute('y2', i % 10 === 0 ? 12 : (i % 5 === 0 ? 9 : 6))\n    if (i % 10 === 0) {\n      text = document.createElementNS(svgns, 'text')\n      text.setAttribute('pointer-events', 'none')\n      text.appendChild(document.createTextNode(String(i / 10)))\n      text.setAttribute('x', x)\n      text.setAttribute('y', 12 + hauteurPolice)\n      text.setAttribute('style', 'font-family: monospace;font-size: ' + hauteurPolice + 'pt;text-anchor:middle')\n      this.graduations.appendChild(text)\n    }\n    li.setAttribute('style', 'stroke:black;stroke-width:0.7;')\n    this.graduations.appendChild(li)\n  }\n  // On rajoute le texte Sesamath\n  text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Ssamath'))\n  text.setAttribute('x', longint / 2 - ray - 3)\n  text.setAttribute('y', largeur - 5)\n  text.setAttribute('style', 'font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon;text-anchor:middle;')\n  g.appendChild(text)\n  g.appendChild(this.graduations)\n  this.g = g\n}\n/**\n * Fonction mettant les graduations de la rgle en mode visible\n * et les endnt visibles dans le svg si l'instrument y est visible\n * @param {boolean} bvisible\n */\nRegle.prototype.montreGraduations = function (bvisible) {\n  this.graduationVisible = bvisible\n  this.graduations.setAttribute('visibility', this.visible ? (bvisible ? 'visible' : 'hidden') : 'hidden')\n}\n/**\n * Fonction montrant la rgle ou la cachant suivant la valeur de bvisible\n * @param {boolean} bvisible\n */\nRegle.prototype.montre = function (bvisible) {\n  InstrumentAncetre.prototype.montre.call(this, bvisible)\n  if (bvisible) { this.graduations.setAttribute('visibility', this.graduationVisible ? 'visble' : 'hidden') } else {\n    this.graduations.setAttribute('visibility', 'hidden')\n  }\n}\n/**\n * Fonction initialisant la position de la rgle.\n * Si la longueur de la rgle a t modifie il faut la rinitialiser\n */\nRegle.prototype.initialisePosition = function () {\n  if (this.longueur !== 15) {\n    this.longueur = 15\n    const vis = this.visible\n    const oldg = this.g\n    this.creeg()\n    this.g.setAttribute('visibility', vis ? 'visible' : 'hidden')\n    this.doc.svg.replaceChild(this.g, oldg)\n  }\n  InstrumentAncetre.prototype.initialisePosition.call(this)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nimport Equerre from '../instruments/Equerre.js'\nexport default Requerre\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe reprsentant la rgle-equerre dans la figure InstrumenPoche\n * @param {IepDoc} doc le document propritaire de la figure\n */\nfunction Requerre (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.x = 200\n  this.y = 400\n  this.angle = 0\n  this.zoomfactor = 1\n  this.abscisse = 0 // L'abscisse au coin de l'querre sur la rgle\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nRequerre.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant la rgle-querre\n * dans le DOM du svg de la figure\n */\nRequerre.prototype.creeg = function () {\n  let p, path\n  const longd = 172 // Longueur de la partie droite  partir de l'origine\n  const longg = 256 // Longueur de la partie gauche  partir de l'origine\n  const larg = 57 // La largeur\n  const ray = 5 // Rayon de courbure des coins\n  const largeurbande = 16 // Largeur des bandes plus claires\n  const dectroud = 20\n  const dectroub = 15\n  const raytrou = 6\n  const style = 'stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5'\n\n  // Ici on ne peut pas faire un rectangle aux bords arrondis si on veut le petit cercle\n  // ajour en bas et  droite\n\n  const g = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L ' + String(longd - ray) + ' 0 A ' +\n          ray + ' ' + ray + ' 0 0 1 ' + String(longd) + ' ' + ray +\n          ' L ' + String(longd) + ' ' + String(larg - ray) + ' A ' +\n          ray + ' ' + ray + ' 90 0 1 ' + String(longd - ray) + ' ' + String(larg) +\n          ' L ' + String(-longg + ray) + ' ' + larg + ' A ' + ray + ' ' + ray + ' 180 0 1 ' + '-' + longg + ' ' +\n          String(larg - ray) + ' L ' + String(-longg) + ' ' + ray + ' A ' + ray + ' ' + ray +\n          ' -90 0 1 ' + String(-longg + ray) + ' 0Z'\n  // On rajoute le trou parcouru dans le sens inverse pour qu'il ne soit pas rempli\n  // Forcment deux demi-cercles. Un cercle entier ne semble pas possible.\n  const ytrou = larg - dectroub\n  const pathtrou = 'M' + String(longd - dectroud + raytrou) + ' ' + ytrou + 'A ' +\n          raytrou + ' ' + raytrou + ' 180 0 0 ' + String(longd - dectroud - raytrou) + ' ' + String(ytrou) +\n          'A ' + raytrou + ' ' + raytrou + ' 180 0 0 ' + String(longd - dectroud + raytrou) + ' ' + String(ytrou)\n\n  path += pathtrou\n  p.setAttribute('d', path)\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  // On rajoute l'intrieur pour les bords soient plus clairs\n  p = document.createElementNS(svgns, 'path')\n  path = 'M' + String(longd) + ' ' + String(largeurbande) + 'L' +\n          String(longd) + ' ' + String(larg - ray) + ' A ' +\n          ray + ' ' + ray + ' 90 0 1 ' + String(longd - ray) + ' ' + String(larg) +\n          ' L ' + String(-longg + ray) + ' ' + larg + ' A ' + ray + ' ' + ray + ' 180 0 1 ' + '-' + longg + ' ' +\n          String(larg - ray) + ' L ' + String(-longg) + ' ' + String(largeurbande) + 'Z' + pathtrou\n  p.setAttribute('d', path)\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  // Un trait de rappel pour l'origine\n  const line = document.createElementNS(svgns, 'line')\n  line.setAttribute('x1', 0)\n  line.setAttribute('y1', 8)\n  line.setAttribute('x2', 0)\n  line.setAttribute('y2', 0)\n  line.setAttribute('style', 'stroke: black')\n  g.appendChild(line)\n  // on utilise Equerre.prototype.creeg pour rcuprer le svg d'une equerre,\n  // sans passer par un new Equerre car on veut juste le svg\n  // => on lui file un objet vide pour son this\n  const fakeEquerre = {}\n  Equerre.prototype.creeg.call(fakeEquerre)\n  this.gequerre = fakeEquerre.g\n  this.gequerre.setAttribute('transform', 'scale(0.7)')\n  g.appendChild(this.gequerre)\n  this.setAbs(this.abscisse)\n  this.g = g\n}\n/**\n * Fonction faisant glisser l'querre sur la rgle jusqu' l'abscisse abs\n * L'abscisse 0 est reprsente par le petit trait sur la rgle\n * @param {number} abs\n */\nRequerre.prototype.setAbs = function (abs) {\n  this.abscisse = abs\n  this.gequerre.setAttribute('transform', 'translate(' + abs + ',0)')\n}\n/**\n * Fonction lanant une animation de glissement de l'querre sur la rgle\n * La rgle querre est le seul instrument  voir un mouvement autre que translation et rotation : Le glissement.\n * @param {number} absfin l'abscisse de l'querre  la fin du glissement\n * @param {number} pix10 le nombre de pixels dont gilsse l'querre\n *  chaque dixime de seconde.\n */\nRequerre.prototype.lanceAnimationGlissement = function (absfin, pix10) {\n  this.absfin = absfin\n  this.pix = (absfin >= this.abscisse) ? pix10 / 4 : -pix10 / 4 // Dans la version JavaScript on quadruple la frquence\n  this.dist = Math.abs(absfin - this.abscisse)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourGlissement() }, 25)\n}\n/**\n * Fonction appele par un timer lors de l'aniamtion de glissement de l'querre\n * sur la rgle\n */\nRequerre.prototype.actionPourGlissement = function () {\n  const abs = this.abscisse + this.pix\n  const dis = Math.abs(this.absfin - abs)\n  if ((dis > this.dist) || !this.doc.animationEnCours) {\n    this.setAbs(this.absfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = dis\n    this.setAbs(abs)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default Crayon\n/**\n * Classe reprsentant le crayon de la figure.\n * (this.x,this.y) sont les coordonnes de la pointe de la mine\n * this.angle est l'angle du corps du crayon par rapport  l'horizontale.\n * @constructor\n * @extends InstrumentAncetre\n * @param {IepDoc} doc le document propritaire de la figure\n */\nfunction Crayon (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.angle = this.angleInit()\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nCrayon.prototype = new InstrumentAncetre()\n\n/**\n * extends iep.instruementAncetre\n */\nCrayon.prototype.angleInit = function () {\n  return -40\n}\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant le crayon\n * dans le DOM du svg de la figure\n */\nCrayon.prototype.creeg = function () {\n  let defs, p, path, lg, stop\n  const lon = 97 // La longueur totale (sans le demi-cercle final)\n  const longpointe = 15 // La longueur de la mine\n  const demlarg = 4.5 // La demi-largeur du crayon\n  const longmine = 3\n  const demlargmine = longmine / longpointe * demlarg\n\n  const g = document.createElementNS(svgns, 'g')\n  // On cre un gradiant linaire pour la mine\n  // Il est ncessaire d'englober le gradient dans un defs pour pouvoir l'utiliser via url(#grad) plus tard\n  defs = document.createElementNS(svgns, 'defs')\n  lg = document.createElementNS(svgns, 'linearGradient')\n  lg.setAttribute('id', 'gradpointe')\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color: #f00000;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '50%')\n  stop.setAttribute('style', 'stop-color: #eeb444;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-color: #f00000')\n  lg.appendChild(stop)\n  lg.setAttribute('x1', '0%')\n  lg.setAttribute('y1', '0%')\n  lg.setAttribute('x2', '0%')\n  lg.setAttribute('y2', '100%')\n  defs.appendChild(lg)\n  g.appendChild(defs)\n  // Un autre gradiant pour le corps du crayon\n  defs = document.createElementNS(svgns, 'defs')\n  lg = document.createElementNS(svgns, 'linearGradient')\n  lg.setAttribute('id', 'gradcorps')\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color: #810216;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '25%')\n  stop.setAttribute('style', 'stop-color: #c64f00;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '50%')\n  stop.setAttribute('style', 'stop-color: #ab4a36')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '75%')\n  stop.setAttribute('style', 'stop-color: #c64f00;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-colr: #810216;')\n  lg.appendChild(stop)\n  lg.setAttribute('x1', '0%')\n  lg.setAttribute('y1', '0%')\n  lg.setAttribute('x2', '0%')\n  lg.setAttribute('y2', '100%')\n  defs.appendChild(lg)\n  g.appendChild(defs)\n\n  // D'abord la mine\n  p = document.createElementNS(svgns, 'path')\n  const rx = demlarg / 3\n  const ry = rx * 3 / 4\n  const path1 = 'A' + rx + ' ' + ry + ' -90 0 0 ' +\n          longpointe + ' ' + String(rx) + 'A' + rx + ' ' + ry + ' -90 0 1 ' +\n          +longpointe + ' ' + String(-rx) + 'A' + rx + ' ' + ry + ' -90 0 0 ' +\n          +longpointe + ' ' + String(-demlarg)\n  path = 'M 0 0 L' + longpointe + ' ' + demlarg + path1 + 'Z'\n\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: url(#gradpointe); fill-opacity: 1;')\n  g.appendChild(p)\n  // La pointe noire\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L ' + longmine + ' ' + demlargmine + ' ' + longmine + ' ' +\n          String(-demlargmine) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: black; fill-opacity: 1;')\n  g.appendChild(p)\n  // Le corps du crayon\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + longpointe + ' ' + demlarg + path1 + ' L ' + lon + ' ' + String(-demlarg) +\n          ' L ' + lon + ' ' + String(demlarg) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: url(#gradcorps); fill-opacity: 1;')\n  g.appendChild(p)\n  // Le cercle bleu du bout\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('r', demlarg)\n  circ.setAttribute('cx', lon)\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('style', 'stroke:blue; stroke-width:0.5; fill: blue; fill-opacity: 1;')\n  g.appendChild(circ)\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nexport default ActionAncetre\n/**\n * Action ancetre de toutes les actions de la figure\n * @constructor\n * @param {IepDoc} doc le document contenant les objets\n * @param {string|number} [tempo] Le dlai d'attente  la fin de l'action en diximes de seconde, sinon on passe directement  l'action suivante.\n */\nfunction ActionAncetre (doc, tempo) {\n  if (arguments.length === 0) return\n  /** @type {IepDoc} */\n  this.doc = doc\n  if (typeof tempo === 'string') tempo = Number(tempo)\n  /** @type {number} */\n  this.tempo = (typeof tempo === 'number' && tempo > 0 && Number.isFinite(tempo)) ? tempo * 100 : null\n  /** @type {boolean} */\n  this.isReady = false // Sera mis  true une fois qu'on est sr que l'lment est bien charg et prt.\n}\n/**\n * Retourne lorsque l'action a t charg et prte.\n * Est redfini pour les actions dont le chargement est asynchrone : images et actions\n * d'criture de texte ncessitant l'utilisation du LaTeX.\n */\nActionAncetre.prototype.setReady = function () {\n  this.isReady = true\n}\n/**\n * Fonction qui n'aura une action que pour les actions de cration d'objet et crera l'lment graphique\n * du DOM associ Sera redfini pour les actions de cration d'objet\n */\nActionAncetre.prototype.creegElement = function () {\n}\n/**\n * Retourne true seulement si l'action a une action visible sur la figure.\n * Lors de l'appel de iepDoc.ajouteAction, chaque action se voit attribuer un membre indice\n * qui est son indice dans la liste des actions cres..\n * Renvoie true par dfaut.\n * @returns {boolean}\n */\nActionAncetre.prototype.actionVisible = function () {\n  return true\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionCoucherCompas\n/**\n * Action couchant le compas.\n * @extends ActionAncetre\n * @constructor\n * @param {iepDoc} doc\n */\nfunction ActionCoucherCompas (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionCoucherCompas.prototype = new ActionAncetre()\n\n/**\n * Fonction couchant le compas et le montrant si immediat est false\n * @param {boolean} immediat\n */\nActionCoucherCompas.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  const compasLeve = this.doc.compasLeve\n  if (compas.leve) {\n    compasLeve.montre(false)\n    compas.setPosition(compasLeve.x, compasLeve.y, compasLeve.angle)\n  }\n  if (!immediat && compas.visible) compas.montre(true)\n  compas.leve = false\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionCoucherCompas.prototype.actionVisible = function () {\n  const visible = this.doc.getInstrumentVisibility(this.doc.compas.compas, this.indice - 1)\n  if (!visible) return false\n  else return this.doc.getCompasStatus(this.indice - 1) === 'leve'\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport Vect from '../types/Vect.js'\nimport * as kernel from '../global/index.js'\nexport default ObjetBase\n/**\n * Objet anctre de tous les objets graphiques\n * Le prototype de chaque descendant de cet objet devra comprendre une fonction creeg qui crera\n * le svg lment associ et l'affectera  this.g\n * @constructor\n * @param {IepDoc} doc Le document propritaire de l'objet\n * @param {string} id Le numro de l'objet dans le document\n */\nfunction ObjetBase (doc, id, couleur) {\n  this.doc = doc\n  this.id = id\n  this.couleur = couleur\n  this.zoomfactor = 1 // Pour les images\n  this.visible = false\n  this.objet = 'trait' // Ne sera redfini que pour les points, textes, les angles et le gabarits\n}\n/**\n * Cette fonction est appele lors de la cration d'objets.\n * par dfaut elle ne fait rien;\n * Elle sera redfinie pour les objets qui peuvent tre translats : points, marques de segments, textes, images\n */\nObjetBase.prototype.positionne = function () {\n}\n/**\n * Fonction qui rinitialisera la psoition des objets lorsqu'on retrace la figure\n * Ne sera redfinie que pour les objets dont la position peut tre modifiee par translation, rotation ou zoom\n */\nObjetBase.prototype.initialisePosition = function () {\n}\n/**\n * Fonction translatant l'objet aux coordonnes (ab)\n * @param {number} a\n * @param {number} b\n */\nObjetBase.prototype.translate = function (a, b) {\n  this.setPosition(a, b, this.angle, this.zoomfactor)\n}\n/**\n * Fonction donnant au membre angle de l'objet la valeur ang\n * @param {number} ang\n */\nObjetBase.prototype.tourne = function (ang) {\n  this.setPosition(this.x, this.y, ang, this.zoomfactor)\n}\n/**\n * Fonction donnant au membre zoom de l'objet la valeur rap\n * @param {number} zoomfactor\n */\nObjetBase.prototype.zoom = function (zoomfactor) {\n  this.zoomfactor = zoomfactor\n  this.setPosition(this.x, this.y, this.angle, zoomfactor)\n}\n/**\n * Fonction rendant l'objet visible ou invisible suivant la valeur de bvisible\n * Modifie en consequence la valeur de bvisible\n * @param {boolean} bvisible\n */\nObjetBase.prototype.montre = function (bvisible) {\n  this.visible = bvisible\n  if (this.g) this.g.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n// Les fonctions suivantes ne serviront que pour les points, marques de segment et affichages de texte\n// et d'images\n// Ces objets doivent possder une fonction setPosition(x,y)\n/**\n * Fonction ne servant que pour les points, marques de segment, affichages de texte et images\n * Lance une aniamtion de translation de l'objet via un timer et une fonction de callBack\n * Ces objets doivent possder une fonction setPosition(x,y)\n * @param {number} xfin abscisse de la position finale de l'objet\n * @param {number} yfin ordonne de la position finale de l'objet\n * @param {number} pix10 Nombre de pixels pour le dplacement par dixime de seconde\n */\nObjetBase.prototype.lanceAnimationTranslation = function (xfin, yfin, pix10) {\n  // this.g.setAttribute(\"visibility\",\"visible\");\n  this.xfin = xfin\n  this.yfin = yfin\n  this.pix = Math.abs(pix10 / 4) // Dans la version JavaScript on quadruple la frquence\n  // en divisant le pas par 4\n  // (en fait par deux car la rapidit semble double de celle annonce dans le mode d'emploi)\n  const v = new Vect(this.x, this.y, xfin, yfin)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  // Cas o l'objet est dj  la bonne position\n  if (this.dist === 0) {\n    this.translate(this.xfin, this.yfin)\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.pix)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourTranslation() }, 25)\n}\n/**\n * Fonction de callBack appele par un timer lors de l'animation de translation\n * On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n * est infrieure  la distance prcdente\n */\nObjetBase.prototype.actionPourTranslation = function () {\n  const x = this.x + this.vect.x\n  const y = this.y + this.vect.y\n  const u = new Vect(x, y, this.xfin, this.yfin)\n  const d = u.norme()\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.translate(this.xfin, this.yfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = d\n    this.translate(x, y)\n  }\n}\n/**\n * Fonction ne servant que pour les points, marques de segment, affichages de texte et images\n * Lance une animation de rotation de l'objet via un timer et une fonction de callBack\n * Ces objets doivent possder une fonction setPosition(x,y)\n * @param {number} angfin l'angle de fin de l'objet\n * @param {number} deg10 le nombre de degrs dont on tourne par dixime de seconde\n */\nObjetBase.prototype.lanceAnimationRotation = function (angfin, deg10) {\n  // Il faut choisir le dplacement \"le plus court\"\n  const ang1 = kernel.mesurePrincDeg(this.angle)\n  let ang2 = kernel.mesurePrincDeg(angfin)\n  if (Math.abs(ang2 - ang1) > 180) {\n    if (ang2 > ang1) ang2 = ang2 - 360\n    else ang2 = ang2 + 360\n  }\n  this.anglefin = ang2\n  this.angle = ang1\n\n  this.pasdeg = deg10 * 2 / 3 // Dans la version JavaScript on quadruple la frquence\n  // en divisant le pas par 4\n  // (en fait on corrige par *2/3 car la rapidit semble double de celle annonce dans le mode d'emploi)\n  this.pasdeg *= (angfin >= this.angle) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(angfin - this.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourRotation() }, 25)\n}\n/**\n * Fonction de callBack appele par un timer lors de l'animation de rotation\n */\nObjetBase.prototype.actionPourRotation = function () {\n  const ang = parseFloat(this.angle) + parseFloat(this.pasdeg)\n  const dis = Math.abs(ang - this.anglefin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.tourne(this.anglefin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.tourne(ang)\n  }\n}\n/**\n * Fonction ne servant que pour les affichages de texte et images\n * Lance une aniamtion de zoom de l'objet via un timer et une fonction de callBack\n * @param {number} zoomfin la valeur de fin du zoomfactor de l'objet\n * @param {number} vitesse pour la vitesse d'animation\n */\nObjetBase.prototype.lanceAnimationZoom = function (zoomfin, vitesse) {\n  this.zoomfin = zoomfin\n  this.vitesse = parseInt(vitesse)\n  this.pas = this.vitesse * 0.05 * (this.zoomfin - this.zoomfactor) // On augmente\n  // par dfaut de 5% de vitesse tous les diximes de seconde\n  this.senspos = (this.pas >= 0)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourZoom() }, 100)\n}\n/**\n * Fonction de callBack appele par un timer lors de l'animation de zoom\n */\nObjetBase.prototype.actionPourZoom = function () {\n  const z = this.zoomfactor + this.pas\n  if (this.doc.animationEnCours && ((this.senspos && (z < this.zoomfin)) || (!this.senspos && (z > this.zoomfin)))) { this.zoom(z) } else {\n    this.zoom(this.zoomfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  }\n}\n/**\n * Fonction qui devra tre appele pour remettre  jour le g lment reprsentant\n * l'objet dans le DOM du svg de la figure\n * Appel quand on recalcule la figure ou lors des animations\n * Par dfaut on reconstruit le svg lment pour mettre  jour l'objet\n * Pour certains objets (point par exemple) ce sera inutile\n * @retursn {undefined}\n */\nObjetBase.prototype.updateg = function () {\n  const oldg = this.g\n  this.creeg()\n  this.doc.svg.replaceChild(this.g, oldg)\n  this.doc.setElement(this.id, this)\n  this.g.setAttribute('visibility', 'visible')\n}\n/**\n * Fonction qui renverra true lorsque la cration de l'objet donne lieu  une animation\n * par exemple pour les segments, droites. Sera donc redfini dans droiteAncetre\n * Dans ce cas, l'objet devra avoir deux fonctions : lanceAnimation et actionPourAnimation\n * @returns {boolean}\n */\nObjetBase.prototype.creationAnimee = function () {\n  return false\n}\n/**\n * Fonction qui devra tre redfinie pour les objets crs avec une animation\n * appele  la fin d'une animation ou lors de la visualisation immdiate de l'objet\n * lors du click sur une icne stepNext ou stepPrev\n */\nObjetBase.prototype.finAction = function () {\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { getTaille } from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Texte\n/**\n * Classe reprsentant un texte.\n * L'criture dans le texte se fait via des actionEcrireTexte\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le docmument propritaire\n * @param {string} id L'id du texte\n * @param {string} x L'asbsisse d'affichage\n * @param {string} y L'ordonne d'affichage\n */\nfunction Texte (doc, id, x, y) {\n  ObjetBase.call(this, doc, id, 'black')\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  // Il faut mmoriser la position initiale du texte car il peut avoir t traslat ar l'animation\n  // et quand on la relance il doit remprendre sa place initiale\n  this.xinit = this.x\n  this.yinit = this.y\n\n  this.taille = 20\n  this.angle = 0 // Possibilit de tourner un etxte (pas donne avec la version Flash)\n  this.texte = ''\n  this.objet = 'texte'\n}\nTexte.prototype = new ObjetBase()\n\n// Attention : POur un affichage de texte, il faut dcaler vers le bas de la hauteur de la police pour\n// garder la compatibilit avec le flash\nTexte.prototype.positionne = function () {\n  // var y = this.y + parseFloat(this.taille);\n  // this.g.setAttribute(\"transform\",\"translate(\" + this.x + \",\" + y + \")\");\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\n}\nTexte.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n/** @inheritDoc */\nTexte.prototype.updateg = function (g) {\n  const oldg = this.g\n  if (!oldg) return console.error('Il faut appeler creeg avant updateg')\n  this.doc.svg.replaceChild(g, oldg)\n  this.g = g\n  g.setAttribute('visibility', 'visible')\n}\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nTexte.prototype.creeg = function () {\n  this.g = document.createElementNS(svgns, 'g')\n}\n/**\n * Fonction mettant le texte aux coordonnes (x,y) avec un angle angle et\n * un coefficient de zoom zoomfactor et modifiant la spoition du svg element qui\n * le reprsente dans le DOM du svg.\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n * @param {integer} zoomfactor\n * @returns {undefined}\n */\nTexte.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.zoomfactor = zoomfactor\n  const taille = getTaille(this)\n  const y2 = y + taille\n  this.g.setAttribute('transform', 'scale(' + zoomfactor + ') translate(' +\n    String(x / zoomfactor) + ',' + String(y2 / zoomfactor) + ') rotate(' + angle + ')')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nimport Texte from '../objets/Texte.js'\nexport default ActionCreation\n/**\n * Action de cration de l'objet objet d'id id dans le document doc\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {string} id\n * @param {ObjetBase} objet\n */\nfunction ActionCreation (doc, id, objet, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  /** @type {string} */\n  this.id = id\n  const ob = this.doc.getElement(id, objet.objet)\n  this.objetRemplace = (ob === null) ? null : ob\n  /** @type {ObjetBase} */\n  this.objet = objet\n  // Ci-dessous un parseFloat car dans certains scripts j'ai vu des sens = \"-0.3\"\n  /** @type {number} */\n  this.vitesse = (arguments.length >= 5 && vitesse != null) ? Math.abs(parseFloat(vitesse)) : 8\n  if (this.objetRemplace !== null) this.doc.addElement(this.objet)\n  else this.doc.pushElement(this.objet)\n}\nActionCreation.prototype = new ActionAncetre()\n/**\n * Fonction lanant l'animation de cration de l'objet objet si la cration de l'objet ncessite une animation\n * et si immediat est  false et sinon affichant immdiatement l'objet\n * @param {boolean} [immediat=false]\n */\nActionCreation.prototype.execute = function (immediat) {\n  // Pour un texte on a mmoris sa position initiale car il peut avoir t translat.\n  // et quand on relance la figure il doit remprendre sa place initiale\n\n  if (this.objet instanceof Texte) {\n    this.objet.x = this.objet.xinit\n    this.objet.y = this.objet.yinit\n  }\n  // this.doc.svg.appendChild(this.objet.g);\n  if (this.objetRemplace !== null) {\n    this.objetRemplace.montre(false)\n    // this.doc.svg.replaceChild(this.objet.g,this.objetRemplace.g);\n  }\n  if (this.objet.creationAnimee() && !immediat) {\n    this.objet.lanceAnimation(this.vitesse)\n  } else {\n    this.objet.montre(true)\n    if (immediat) this.objet.finAction()\n    else this.doc.actionSuivante()\n  }\n}\n/**\n * Cre l'lment graphique du DOM associ  une action de cration d'objet\n * L'objet est calcul par positionne() et cach\n */\nActionCreation.prototype.creegElement = function () {\n  const doc = this.doc\n  const objet = this.objet\n  objet.creeg()\n  objet.positionne()\n  objet.g.setAttribute('visibility', 'hidden')\n  doc.svg.appendChild(objet.g)\n}\n/** @inheritDoc */\nActionCreation.prototype.actionVisible = function () {\n  return !(this.objet instanceof Texte)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\n\nexport default ActionEcarterCompas\n\n/**\n * carte le compas\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param ecartement\n * @param tempo\n * @param ec10\n */\nfunction ActionEcarterCompas (doc, ecartement, tempo, ec10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.ecartement = ecartement\n  this.ec10 = (ec10 === null) ? 16 : parseFloat(ec10)\n}\n\nActionEcarterCompas.prototype = new ActionAncetre()\n\nActionEcarterCompas.prototype.execute = function (immediat) {\n  if (!immediat) {\n    this.doc.compas.lanceAnimationEcartement(this.ecartement, this.ec10)\n  } else {\n    this.doc.compas.ecart = this.ecartement\n    this.doc.compas.positionne()\n  }\n}\n\nActionEcarterCompas.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { analyseExposantOuIndice, getTaille, getMaths, indiceFinBalise, necessiteLatex, remplaceBalises, remplaceCarSpe, traiteBalise } from '../global/index.js'\nimport { caracteresGrecs, svgns } from '../global/constantes.js'\nimport InfoBalise from '../global/InfoBalise.js'\nimport ActionAncetre from '../actions/ActionAncetre.js'\n\nexport default ActionEcrireTexte\n\n// Modification version MathJax3 : plus besoin de crer un div auxiliaire (cf rev477 pour la version prcdente)\n\n/**\n * Action d'criture d'un texte. Le texte doit avoir t cr auparavant.\n * @constructor\n * @extends ActionAncetre\n * @param {iepDoc} doc            le document propritaire\n * @param {string} id             l'id du texte sur lequel crire\n * @param {string} couleur        la couleur du texte\n * @param {string} taille         la taille du texte\n * @param {string} texte          Le texte  afficher\n * @param {string} style          'texte' si non fourni\n * @param {string} couleurFond\n * @param {number} opaciteFond\n * @param {string} couleurCadre\n * @param {number} epaisseurCadre\n * @param {string} marge          la marge ventuelle\n * @param {string} margeGauche    la marge gauche ventuelle\n * @param {string} margeDroite    la marge droite ventuelle\n * @param {string} margeHaut      la marge haute ventuelle\n * @param {string} margeBas       la marge basse ventuelle\n * @param {string} tempo          le tempo\n */\nfunction ActionEcrireTexte (doc, id, couleur, taille, texte, style, couleurFond,\n  opaciteFond, couleurCadre, epaisseurCadre, marge, margeGauche, margeDroite, margeHaut, margeBas, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.txt = this.doc.getElement(id, 'texte')\n  this.id = id\n  this.couleur = couleur\n  // On remplace dans la taille les lettres O mises par les tourdis  la place de 0\n  this.taille = (taille == null) ? '20' : taille.replace(/O/g, '0')\n  /* @todo voir si on peut pas caster this.taille en number ici avec getTaille (pour imposer un min/max) */\n\n  // Traitement des accents plus ncessaire avec version MathJax 3\n  // this.texte = kernel.remplaceAccentsHtml(kernel.remplaceBalises(kernel.remplaceCarSpe(texte)))\n  this.style = (style === null) ? 'texte' : style\n  this.couleurFond = couleurFond\n  this.opaciteFond = (opaciteFond == null) ? '0.6' : parseFloat(opaciteFond) / 100\n  // Modification version 5.0.2. Causait des problmes avec explorer\n  // this.couleurCadre = (couleurCadre == null) ? couleur : couleurCadre\n  this.couleurCadre = couleurCadre\n  if ((epaisseurCadre !== null) && (couleurCadre === null)) this.couleurCadre = couleur\n  //\n  this.epaisseurCadre = (epaisseurCadre != null) ? epaisseurCadre : ((couleurCadre == null) ? 0 : 1)\n  this.marge = (marge == null) ? 0 : parseFloat(marge)\n  this.margeGauche = (margeGauche == null) ? 0 : parseFloat(margeGauche)\n  this.margeDroite = (margeDroite == null) ? 0 : parseFloat(margeDroite)\n  this.margeHaut = (margeHaut == null) ? 0 : parseFloat(margeHaut)\n  this.margeBas = (margeBas == null) ? 0 : parseFloat(margeBas)\n  this.texte = texte\n  this.estLatex = this.estAffichageLatex()\n  // si c'est du LaTeX demand par l'utilisateur on y touche pas\n  if (!this.estLatex) {\n    // mais sinon on fait les remplacements\n    this.texte = remplaceBalises(remplaceCarSpe(this.texte))\n    this.texte = this.traduitCaracteresGrecs(this.texte)\n    // et on regarde si y'a pas besoin de LaTeX quand mme\n    this.texte = this.texte.replace(/\\*/g, '')\n    if (necessiteLatex(texte)) {\n      // faut mettre les $ pour que prepare charge MathJax (il les vire avant de filer la string  MathJax)\n      this.texte = '$' + this.traiteMaths(this.texte) + '$'\n      this.estLatex = true\n    }\n  }\n  // console.log(`constructeur ActionEcrireTexte avec \\n${texte}\\n =>\\n ${this.texte}`)\n}\n\nActionEcrireTexte.prototype = new ActionAncetre()\n/**\n * Action crivant le contenu du texte sur la figure\n * @param {Boolean} immediat\n * @returns {undefined}\n */\nActionEcrireTexte.prototype.execute = function (immediat) {\n  if (this.txt != null) { // Pour viter les erreurs des auteurs\n    this.angle = 0 // Car on peut dans la version js faire tourner un texte\n    const txt = this.txt\n    txt.couleur = this.couleur\n    txt.taille = this.taille\n    txt.texte = this.texte\n    txt.couleurFond = this.couleurFond\n    txt.couleurCadre = this.couleurCadre\n    txt.epaisseurCadre = this.epaisseurCadre\n    txt.updateg(this.g)\n    txt.positionne()\n  }\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n\n/**\n * Retourne true si l'affichage de texte utilise le LaTeX de faon dlibre\n * en encadrant alors le code LaTeX par deux caractres $\n * @returns {boolean}\n */\nActionEcrireTexte.prototype.estAffichageLatex = function () {\n  return ((this.texte.charAt(0) === '$') && (this.texte.charAt(this.texte.length - 1) === '$'))\n}\n\n/**\n * Fonction remplaant les codes du type ... reprsentant des caractres grecs\n * par les caractres UTF8 correspondants\n * @param {string} ch\n * @returns {string}\n */\nActionEcrireTexte.prototype.traduitCaracteresGrecs = function (text) {\n  if (!text.includes('')) return text\n  // on clate la chane sur  et on regarde les morceaux impair (0 est celui qui prcde le premier )\n  // Attention, par rapport au traitement prcdent qui passaient toutes les regex pattern,\n  // avec ce fonctionnement si jamais on a un nb impair de ,\n  // le dernier morceau va se retrouver ferm avec le  manquant\n  // 'bla bla pi bla bla portnawak' => 'bla bla  bla bla portnawak'\n  const strTraduite = text.split('').map((fragment, i) => {\n    // si impair, faut regarder si c'est un caractre connu\n    if (i % 2) return caracteresGrecs[fragment] || `${fragment}`\n    return fragment\n  }).join('')\n  // on vire le dernier  si on l'a ajout\n  if ((text.length - text.replace(//g, '').length) % 2) {\n    console.warn(`Il y a un nombre impair de  dans cette chane : ${text}`)\n    return strTraduite.substr(0, strTraduite.length - 1)\n  }\n  return strTraduite\n}\n/**\n * Fonction traitant la chane ch pour la transcrire en code LaTeX\n * Renvoie la chane LaTeX correspondante.\n * Si la chane contient des balises <br>, un tableau LaTeX est utilis pour rendre le contenu\n * @param {string} ch la chane  traiter\n * @returns {string} la chane LaTeX correpondante une fois ch traduite\n */\nActionEcrireTexte.prototype.traiteMaths = function (ch) {\n  let i\n  const ch2 = ch\n  const bStyletTexte = this.style === 'texte'\n  // On recherche les codes <br> et on remplace les lignes par une matrice\n  // avant c'tait new RegExp('<br>|</br>', 'gi'),\n  // donc on laisse le cas </br> compltement invalide en html,\n  // mais on gre le bon qui est <br/> ou <br />\n  const a = ch2.split(/<\\/?br *\\/?>/gi)\n  // if (a.length <= 1) return traiteAccents(getMaths(ch, bStyletTexte)) // True pour mode texte par dfaut\n  // Modif version MathJax 3\n  if (a.length <= 1) return getMaths(ch, bStyletTexte) // True pour mode texte par dfaut\n  let res = '\\\\begin{array}{l}'\n  for (i = 0; i < a.length; i++) {\n    if (i !== 0) res += '\\\\\\\\'\n    // Modif version MathJax 3\n    // res += traiteAccents(getMaths(a[i], bStyletTexte)) // true pour mode texte par dfaut\n    res += getMaths(a[i], bStyletTexte) // true pour mode texte par dfaut\n  }\n  res += '\\\\end{array}'\n  return res\n}\n\n/**\n * Fonction appele lors de l'appel de iepDoc.creeActions()\n * Si l'criture du texte ne ncessite pas l'emploi du LaTeX, on cre l'lment grapique qui sera\n * dmasqu quand l'action sera excute\n * Sinon, on charge mathjax si besoin et on demande  MathJax via sa pile d'appels\n * de traiter le texte pour en faire du svg et appeler setReady quand ce sera termin\n */\nActionEcrireTexte.prototype.prepare = function () {\n  let latexString\n  if (this.estLatex) {\n    latexString = this.texte.replace(/^\\$(.*)\\$$/, '$1')\n    if (!latexString) {\n      console.error(Error('texte latex mais pas envelopp de $, ignor'), this.texte)\n      this.estLatex = false\n    }\n  }\n  if (this.estLatex) {\n    const self = this\n    import('../loadMathJax.js')\n      .then(({ default: loadMathJax }) => loadMathJax())\n      .then(() => {\n        /* global MathJax */\n        const width = self.doc.getWidth()\n        // const taille = getTaille(self) - 2\n        const taille = self.taille\n        const ch = self.prelatex() + latexString\n        // self.ex = taille / 2\n        self.ex = taille * 0.45\n        const options = {\n          em: taille,\n          ex: self.ex,\n          containerWidth: width,\n          display: false\n        }\n        if (self.doc.debug) console.debug('On passe  MathJax la string', ch)\n        return MathJax.tex2svgPromise(ch, options)\n      }).then((html) => {\n      // MathJax retourne du html avec un svg dedans, du genre\n      // <mjx-container ><svg xmlns=\"http://www.w3.org/2000/svg\" ></svg></mjx-container>\n      // console.log('MathJax retourne ce svg', html)\n        self.html = html\n        self.creegLatex()\n        self.setReady()\n      }).catch(error => {\n        console.error(error)\n        // eslint-disable-next-line no-alert\n        alert('Pb Mathjax, impossible dafficher le LaTeX correctement')\n      })\n  } else {\n    this.creeg()\n    this.setReady()\n  }\n}\n\n/**\n * Retourne l'en-tte  rajouter pour que, dans le cas d'utilisation du\n * LaTeX, l'affichage soit de la bonne couleur.\n */\nActionEcrireTexte.prototype.prelatex = function () {\n  return '\\\\color{' + this.couleur + '}'\n}\n\n/**\n * Fonction appele par prepare() qui rcupre l'lement svg reprsentant\n * la formule dans la proprit html (car y'a un conteneur html <mjx-container>)\n * Rajoute les lments graphiques correspondant  un cadre si une couleur de fond\n * et un cadre ont t demands\n */\nActionEcrireTexte.prototype.creegLatex = function () {\n  try {\n    const s = this.html.firstChild\n    // clonage profond du svg cr par MathJax dans le html,\n    // a vire les attributs non standard qu'il ajoute (<g data-mml-node=\"\" par ex)\n    const svg = s.cloneNode(true)\n    // on wrap le svg dans un tag g\n    const g = document.createElementNS(svgns, 'g')\n    g.appendChild(svg)\n\n    // on lui ajoute les attributs imposs par l'action courante, MathJax donne des attributs width et height  ses svg\n    const w = parseFloat(s.getAttribute('width')) * this.ex\n    const h = parseFloat(s.getAttribute('height')) * this.ex\n    const svgVa = svg.style['vertical-align']\n    const va = (svgVa ? parseFloat(svgVa) || 1 : 1) * this.ex\n    svg.setAttribute('width', w + 'px')\n    svg.setAttribute('height', h + 'px')\n    svg.style['vertical-align'] = `${va}px`\n    svg.setAttribute('x', '0')\n    const taille = getTaille(this)\n    svg.setAttribute('y', String(-taille)) // Diffrent de MathGraph32\n    g.setAttribute('visibility', 'hidden') // A revoir version MathJax 3\n    // g.setAttribute(\"id\",this.id)\n    if ((this.couleurFond !== null) || (this.couleurCadre !== null)) {\n      g.setAttribute('visibility', 'hidden')\n      this.doc.svg.appendChild(g)\n      this.rectAff = {}\n      const epc = parseFloat(this.epaisseurCadre)\n      const { x, y, width, height } = g.getBBox()\n      this.rectAff.height = height + 2 * epc + 4 + 2 * this.marge + this.margeHaut + this.margeBas\n      this.rectAff.width = width + 2 * epc + 2 + 2 * this.marge + this.margeGauche + this.margeDroite\n      this.rectAff.x = x - epc - 1 - this.marge - this.margeGauche\n      this.rectAff.y = y - epc - 1 - this.marge - this.margeHaut\n      g.setAttribute('visibility', 'visible')\n      this.doc.svg.removeChild(g)\n      this.creeRectangle(g, (this.couleurFond == null) ? 'white' : this.couleurFond)\n    }\n    // et on affecte a  la proprit g\n    this.g = g\n  } catch (error) {\n    console.error('Erreur dans ActionEcrireTexte.creegLatex (on remplace par un <g> vide) :', error)\n    this.g = document.createElementNS(svgns, 'g') // Cre un g vide en cas de problme\n  }\n}\n\n/**\n * Retourne l'lment graphique associ dans le cas o l'affichage n'utilise pas le LaTeX\n * Avant appel, this.text doit voir t affect\n */\nActionEcrireTexte.prototype.creeg = function () {\n  let indbalise, tspan, ch, ch2, style, txt, ind, indexp, indind, mini, bexp, tailleind, stylespan,\n    y, sp, i, debutLigne, an\n  let dy = 0 // Le baselineshift de chaque tspan\n  const inf = '<' // Equivalent du symbole <\n  const debexp = 'e('\n  const debind = 'i('\n  const g = document.createElementNS(svgns, 'g')\n  const taille = getTaille(this)\n  const hautlig = taille + 2\n  let decblp = 0 // Dcalage vers le bas de la ligne prcdente\n  const decalage = taille * 0.4 // Dcalage vers le bas ou le haut en cas d'indice ou d'exposant\n\n  if (this.texte !== '') {\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('pointer-events', 'none')\n    txt.setAttribute('x', 0)\n    txt.setAttribute('y', 0)\n    style = 'text-anchor:left;font-size:' + taille + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', style)\n    // On remplace les espaces par des espaces inscables\n    ch2 = this.texte.replace(/ /g, '\\u00A0')\n    // Affecter une longueur ne peut tre efficace que pour du texte simpel sans balise\n    if ((this.texte.indexOf(inf) === -1) && (this.texte.indexOf(debexp) === -1) && (this.texte.indexOf(debind) === -1) &&\n      (this.texte.indexOf('<br>') === -1)) {\n      txt.appendChild(document.createTextNode(ch2))\n    } else {\n      sp = ch2.split(/<br>/gi)\n      y = -hautlig\n      for (i = 0; i < sp.length; i++) {\n        debutLigne = true\n        ch = sp[i]\n        while (ch !== '') {\n          indbalise = ch.indexOf(inf)\n          indexp = ch.indexOf(debexp)\n          indind = ch.indexOf(debind)\n          if (debutLigne) y += hautlig + decblp\n          if (indexp !== -1) y += decalage\n          if ((indbalise === -1) && (indexp === -1) && (indind === -1)) {\n            // txt.appendChild(document.createTextNode(this.texte))\n            tspan = document.createElementNS(svgns, 'tspan')\n            tspan.setAttribute('pointer-events', 'none')\n            tspan.setAttribute('dy', dy)\n            if (debutLigne) {\n              tspan.setAttribute('x', 0)\n              tspan.setAttribute('y', y)\n              debutLigne = false\n            }\n            dy = 0 // On est revenu au niveau 0\n            tspan.appendChild(document.createTextNode(ch))\n            txt.appendChild(tspan)\n            break\n          } else {\n            while ((ch.indexOf(inf) !== -1) || (ch.indexOf(debexp) !== -1) ||\n                    (ch.indexOf(debind) !== -1)) {\n              indbalise = ch.indexOf(inf)\n              indexp = ch.indexOf(debexp)\n              indind = ch.indexOf(debind)\n              if (indbalise === -1) {\n                if (indexp === -1) mini = indind\n                else mini = (indind === -1) ? indexp : Math.min(indind, indexp)\n              } else {\n                if (indexp === -1) mini = (indind === -1) ? indbalise : Math.min(indbalise, indind)\n                else {\n                  if (indind === -1) mini = Math.min(indbalise, indexp)\n                  else mini = Math.min(indbalise, indind, indexp)\n                }\n              }\n              if (mini > 0) { // Il y a du texte avant les balises\n                tspan = document.createElementNS(svgns, 'tspan')\n                tspan.setAttribute('pointer-events', 'none')\n                tspan.setAttribute('dy', dy)\n                if (debutLigne) {\n                  tspan.setAttribute('x', 0)\n                  tspan.setAttribute('y', y)\n                  debutLigne = false\n                }\n                dy = 0 // On est revenu au niveau 0\n                tspan.appendChild(document.createTextNode(ch.substring(0, mini)))\n                txt.appendChild(tspan)\n                ch = ch.substring(mini)\n              } else {\n                if (indbalise === 0) {\n                  const infoBalise = new InfoBalise(false, false, false, this.couleur, '', taille)\n                  ind = indiceFinBalise(ch)\n                  if (ind === -1) traiteBalise(ch, infoBalise, txt, debutLigne, y)\n                  else traiteBalise(ch.substring(0, ind), infoBalise, txt, debutLigne, y)\n                  debutLigne = false\n                  if (ind !== -1) ch = ch.substring(ind); else ch = ''\n                  dy = 0 // On est revenu au niveau 0\n                } else { // mini est gal  0\n                  bexp = mini === indexp\n                  an = analyseExposantOuIndice(ch)\n                  tspan = document.createElementNS(svgns, 'tspan')\n                  tspan.setAttribute('pointer-events', 'none')\n                  tspan.setAttribute('dy', dy + 'px')\n                  if (debutLigne) {\n                    tspan.setAttribute('x', 0)\n                    tspan.setAttribute('y', y)\n                    debutLigne = false\n                  }\n                  if (an.erreur) tspan.appendChild(document.createTextNode(ch))\n                  else {\n                    tspan.appendChild(document.createTextNode(an.operande))\n                    txt.appendChild(tspan)\n                    tspan = document.createElementNS(svgns, 'tspan')\n                    tspan.setAttribute('pointer-events', 'none')\n                    tspan.appendChild(document.createTextNode(an.exposant))\n                    dy = decalage\n                    if (bexp) dy = -dy\n                    else decblp = dy\n                    tspan.setAttribute('dy', dy + 'px')\n                    tailleind = taille * 0.6\n                    stylespan = 'font-size:' + tailleind + 'px;'\n                    tspan.setAttribute('style', stylespan)\n                    txt.appendChild(tspan)\n                    dy = -dy // Car sinon la suite sera dcale aussi en hauteur\n                  }\n                  ch = an.texte\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    g.appendChild(txt)\n  }\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id)\n  if ((this.couleurFond != null) || (this.couleurCadre != null)) {\n    g.setAttribute('visibility', 'hidden')\n    this.doc.svg.appendChild(g)\n    this.rectAff = {}\n    const epc = parseFloat(this.epaisseurCadre)\n    this.rectAff.height = g.getBBox().height + 2 * epc + 3 + 2 * this.marge + this.margeHaut + this.margeBas\n    this.rectAff.width = g.getBBox().width + 2 * epc + 2 + 2 * this.marge + this.margeGauche + this.margeDroite\n    this.rectAff.x = g.getBBox().x - epc - 1 - this.marge - this.margeGauche\n    this.rectAff.y = g.getBBox().y - epc - 1 - this.marge - this.margeHaut\n    g.setAttribute('visibility', 'visible')\n    this.doc.svg.removeChild(g)\n    this.creeRectangle(g, (this.couleurFond == null) ? 'white' : this.couleurFond)\n  }\n  this.g = g\n}\n\n/**\n * Renvoie true si la chane ch contient des balises &lt;u\\> ou \\<i\\>\n * @param {string} ch\n * @returns {boolean}\n */\nActionEcrireTexte.prototype.contientBalisesItaliqueOuUnderlineOuFontOuBold = function (ch) {\n  return (/<(u|b|i|font[^>]+)>/gi).test(ch)\n}\n\n/**\n * Fonction appele dans le cas o l'affihcage de texte a une couleur de fond ou doit tre encadre.\n * Elle rajoute le rectangle au g lment avant l'affichage correspondant au texte (de faon  pouvoir\n * le cas chant effacer le fond avant l'affichage du texte)\n * @param {SVGGElement} g l'lment g qui contient l'affichage de texte (<g> normal ou <svg> dans le cas du LaTeX)\n */\nActionEcrireTexte.prototype.creeRectangle = function (g, coulFond) {\n  const r = document.createElementNS(svgns, 'rect')\n  const style = 'stroke-width:' + this.epaisseurCadre + 'px;' + 'stroke:' + this.couleurCadre + ';' +\n    'fill:' + coulFond + ';fill-opacity:' + this.opaciteFond + ';'\n  r.setAttribute('style', style)\n  r.setAttribute('x', this.rectAff.x)\n  r.setAttribute('y', this.rectAff.y)\n  r.setAttribute('width', this.rectAff.width)\n  r.setAttribute('height', this.rectAff.height)\n  r.setAttribute('pointer-events', 'none')\n  g.insertBefore(r, g.childNodes[0])\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionGlisser\n/**\n * Action faisant glisser l'querre de la rgle querre\n * @constructor\n * @extends ActionAncetre\n * @param {IepDoc} doc le document propritaire\n * @param {int} abscisseFin l'abscisse de fin de dplacement\n * @param {string} tempo le tempo en dixime de seconde (ou null)\n * @param {string} pix10 le nombre de pixels de dplacement  chaque dixime de seconde\n */\nfunction ActionGlisser (doc, abscisseFin, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.abscisseFin = parseFloat(abscisseFin)\n  this.pix10 = (pix10 === null) ? 8 : String(Math.abs(pix10))\n}\nActionGlisser.prototype = new ActionAncetre()\n/**\n * Fonction lanant une animation de glissement de la rgle querre sauf si immediat est true\n * @param {boolean} [immediat=false]\n */\nActionGlisser.prototype.execute = function (immediat) {\n  if (!immediat) this.doc.requerre.lanceAnimationGlissement(this.abscisseFin, this.pix10)\n  else {\n    this.doc.requerre.setAbs(this.abscisseFin)\n    this.doc.requerre.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionGlisser.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.requerre, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport InstrumentAncetre from './InstrumentAncetre.js'\nexport default CompasLeve\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe reprsentant le compas vu du dessus.\n * Attention : Contrairement au compas normal, le compas lev doit tre reconstruit   chaque fois\n * que son cartement est modifi.\n */\nfunction CompasLeve (doc, x, y, angle, ecart) {\n  InstrumentAncetre.call(this, doc)\n  const oldg = (doc.compasLeve == null) ? null : doc.compasLeve.g\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.ecart = ecart\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(x, y, angle)\n  if (oldg == null) doc.svg.appendChild(this.g)\n  else doc.svg.replaceChild(this.g, oldg)\n}\nCompasLeve.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant le compas\n * lev dans le DOM du svg contenant la figure.\n */\nCompasLeve.prototype.creeg = function () {\n  let rect, li, p\n  const ep = 7 // Epaisseur des branches. La mme que dans compas.\n  const longpointe = 8 // Longueur de la pointe et des mines\n  const ecart = this.ecart\n\n  const g = document.createElementNS(svgns, 'g')\n  if (this.ecart > 2 * longpointe) {\n    rect = document.createElementNS(svgns, 'rect')\n    rect.setAttribute('x', longpointe)\n    rect.setAttribute('y', -ep / 2)\n    rect.setAttribute('width', this.ecart - 2 * longpointe)\n    rect.setAttribute('height', ep)\n    rect.setAttribute('rx', 1)\n    rect.setAttribute('ry', 1)\n    rect.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:silver;fill-opacity:1')\n    g.appendChild(rect)\n  }\n  p = document.createElementNS(svgns, 'path')\n  p.setAttribute('d', 'M0 0 L' + longpointe + ' 1 ' + longpointe + ' -1Z')\n  p.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:black;fill-opacity:1')\n  g.appendChild(p)\n  const d = ecart - 2 * longpointe\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', longpointe)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', longpointe + d / 8)\n  li.setAttribute('y2', 0)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  p = document.createElementNS(svgns, 'path')\n  const e = String(ecart - longpointe)\n  p.setAttribute('d', 'M' + ecart + ' 0 L' + e + ' 1.5 ' + e + ' -1.5Z')\n  p.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:black;fill-opacity:1')\n  g.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', e)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', String(ecart - longpointe - d / 8))\n  li.setAttribute('y2', 0)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  let f = String(ecart - longpointe - d / 8 - 2)\n  li.setAttribute('x1', f)\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', f)\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  f = String(ecart - longpointe - d / 3 - 2)\n  li.setAttribute('x1', f)\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', f)\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  // Les boutons vus en perspective\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(longpointe + d / 8 - 5))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 8)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(ecart - longpointe - d / 8 - 4))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 8)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n\n  // Le dessus\n  const dl = 12 // Demi-largeur de la partie centrale grise\n  const dh = 4 // Demi-hauteur de la partie centrale grise\n  p = document.createElementNS(svgns, 'path')\n  const path = 'M' + String(ecart / 2 + dl) + ' ' + String(-dh) + ' A ' + String(dl) +\n          ' 2 180 0 0 ' + String(ecart / 2 - dl) + ' ' + String(-dh) + 'A' +\n          String(dh) + ' 2 90 0 1 ' + String(ecart / 2 - dl) + ' ' + String(dh) + 'A' +\n          String(dl) + ' 2 0 0 0 ' + String(ecart / 2 + dl) + ' ' + String(dh) + 'A' +\n          String(dh) + ' 2 -90 0 1 ' + String(ecart / 2 + dl) + ' ' + String(-dh)\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  g.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', String(ecart / 2 + dl))\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', String(ecart / 2 - dl))\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', String(ecart / 2 - dl))\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', String(ecart / 2 + dl))\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', String(ecart / 2))\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('r', 5)\n  circ.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  g.appendChild(circ)\n  // Les boutons vus en perspective\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(longpointe + d / 8 - 5))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 7)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(ecart - longpointe - d / 8 - 4))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 7)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  this.g = g\n}\n/**\n * Fonction mettant le svg element reprsentant le compas lev  la position (x,y)\n * avec un angle avce l'horizontale gal  angle\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n */\nCompasLeve.prototype.setPosition = function (x, y, angle) {\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.g.setAttribute('transform', 'translate(' + x + ',' + y + ') rotate(' + angle + ')')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nimport CompasLeve from '../instruments/CompasLeve.js'\nexport default ActionLeverCompas\n/**\n * Action levant le compas\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n */\nfunction ActionLeverCompas (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionLeverCompas.prototype = new ActionAncetre()\n\n/**\n * Fonction cachant le compas normal et crant un compas couch qui est ensuite affich\n * si le compas est visible\n * @param {string} immediat true dans le cas d'une excution sans passage  l'action suivante\n */\nActionLeverCompas.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  if (compas.visible) {\n    compas.montre(false)\n    compas.visible = true // Car a t modifi par montre()\n  }\n  this.doc.compasLeve = new CompasLeve(this.doc, compas.x, compas.y,\n    compas.angle, compas.ecart)\n  if (!immediat && compas.visible) this.doc.compasLeve.montre(true)\n  compas.leve = true\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionLeverCompas.prototype.actionVisible = function () {\n  const visible = this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n  if (!visible) return false\n  else return this.doc.getCompasStatus(this.indice - 1) === 'couche'\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMasquer\n/**\n * Action masquant un objet.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {ObjetBase} objet l'objet  masquer\n */\nfunction ActionMasquer (doc, idel, nature, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, nature)\n}\nActionMasquer.prototype = new ActionAncetre()\n/**\n * Fonction excutant le masque de l'objet objet\n * @param {boolean} immediat true en cas d'excution immdiate sans passage\n *  l'action suivante\n */\nActionMasquer.prototype.execute = function (immediat) {\n  const el = this.objet\n  if (el != null) el.montre(false)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMasquer.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMasquerInstrument\n/**\n * Action masquant un instrument.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {InstrumentAncetre} instrument l'instrument  masquer\n */\nfunction ActionMasquerInstrument (doc, instrument, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n}\nActionMasquerInstrument.prototype = new ActionAncetre()\n/**\n * Fonction excutant l'action et masquanf l'instrument instrument\n * @param {boolean} [immediat=false]\n */\nActionMasquerInstrument.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  this.instrument.montre(false)\n  if (compas.leve) this.doc.compasLeve.montre(false)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMasquerInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionModifierLongueur\n/*\n * Action modifiant la longueur d'un instrument.\n * Pour le moment seulement implment pour la rgle.\n */\n\n/**\n * Action modifiant la longueur d'un instrument.\n * Pour le moment seulement implment pour la rgle.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} Le document propritaire\n * @param {InstrumentAncetre} instrument L'istrument sur lequel a lieu l'action\n * @param {string} longueur La nouvelle longueur\n * @param {string} tempo Le tempo de temporisation\n */\nfunction ActionModifierLongueur (doc, instrument, longueur, tempo) {\n  ActionAncetre.call(this, doc, tempo) // null car action immdiate\n  this.instrument = instrument\n  this.longueur = longueur\n}\nActionModifierLongueur.prototype = new ActionAncetre()\n/**\n * Fonction excutant l'action et modifiant la longueur de l'instrument\n * @param {boolean} immediat true si l'action est immdiate et on ne passe\n * pas ensuite  l'action suivante\n */\nActionModifierLongueur.prototype.execute = function (immediat) {\n  if (this.instrument === this.doc.regle) {\n    const vis = this.instrument.visible\n    this.instrument.longueur = this.longueur\n    const oldg = this.instrument.g\n    this.instrument.creeg()\n    this.instrument.g.setAttribute('visibility', vis ? 'visible' : 'hidden')\n    this.doc.svg.replaceChild(this.instrument.g, oldg)\n    this.instrument.translate(this.instrument.x, this.instrument.y)\n  }\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionModifierLongueur.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMontrer\n/**\n * Action montrant un objet.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {ObjetBase} objet l'objet  dmasquer\n */\nfunction ActionMontrer (doc, idel, nature, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, nature)\n}\nActionMontrer.prototype = new ActionAncetre()\n/**\n * Fonction dmasquant l'lment graphique de l'objet objet\n * @param {boolean} [immediat=false]\n */\nActionMontrer.prototype.execute = function (immediat) {\n  const el = this.objet\n  if (el !== null) el.montre(true)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrer.prototype.actionVisible = function () {\n  return !this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMontrerGraduations\n/**\n * Action montrant ou masquant les graduations de l'instrument instrument\n * Attention : Pour la rle, cette action s'exerce sur la graduation\n * et pour le rapporteur, sur la graduation interne\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {InstrumentAncetre} instrument l'instrument possdant les graduations\n * @param {boolean} bmontrer true pour montrer les graduations, false pour les cacher\n * @param {number} tempo\n */\nfunction ActionMontrerGraduations (doc, instrument, bmontrer, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.bmontrer = bmontrer\n}\nActionMontrerGraduations.prototype = new ActionAncetre()\n/**\n * Fonction excutant l'action donc montrant ou masquant les graduations de instrument\n * @param {boolean} immediat Si true,pas de passage  l'action suivante\n */\nActionMontrerGraduations.prototype.execute = function (immediat) {\n  this.instrument.montreGraduations(this.bmontrer)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerGraduations.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMontrerInstrument\n/**\n * Action montrant un instrument.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {InstrumentAncetre} instrument l'instrument  montrer\n */\nfunction ActionMontrerInstrument (doc, instrument, x, y, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.x = (x === null) ? null : parseFloat(x)\n  this.y = (y === null) ? null : parseFloat(y)\n  this.instrument = instrument\n}\nActionMontrerInstrument.prototype = new ActionAncetre()\n/**\n * Fonction montrant l'instrument instrument\n * @param {boolean} immediat si rrue on ne passe pas  l'action suivante\n */\nActionMontrerInstrument.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  if ((this.x !== null) && (this.y !== null)) this.instrument.translate(this.x, this.y)\n  if ((this.instrument === compas) && !immediat) {\n    if (!compas.leve) compas.montre(true)\n    else this.doc.compasLeve.montre(true)\n    compas.visible = true\n  } else this.instrument.montre(true)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerInstrument.prototype.actionVisible = function () {\n  return !this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionMontrerNombres\n// Cette action agit sur les graduations externes du rapporteur\n/**\n * Action montrant changeant le statut des gradiations externes du rapporteur\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {boolean} bmontrer true si on montre les graduations, false sinon\n * @param {number} tempo\n */\nfunction ActionMontrerNombres (doc, bmontrer, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.bmontrer = bmontrer\n}\nActionMontrerNombres.prototype = new ActionAncetre()\n/**\n * Excution de l'action changeant le statut des gradiations externes du rapporteur\n * @param {boolean} immediat si true on ne passe pas  l'action suivante\n */\nActionMontrerNombres.prototype.execute = function (immediat) {\n  this.doc.rapporteur.montreGraduationsExternes(this.bmontrer)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerNombres.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.rapporteur, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { getTaille } from '../global/index.js'\nimport ActionAncetre from '../actions/ActionAncetre.js'\n\n// Modification version MathJax3 : plus besoin de crer un div auxiliaire (cf rev477 pour la version prcdente)\n\nexport default ActionNommerPoint\n\n/**\n * Action donnant un nom  un point\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le doculent propritaire\n * @param {NomPoint} objet  l'objet reprsentant le nom\n * @param {string} tempo le tempk en diximes de seconde (ou null)\n */\nfunction ActionNommerPoint (doc, objet, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.nomPoint = objet\n}\nActionNommerPoint.prototype = new ActionAncetre()\n\n/**\n * Appele par creeActions, prcharge Mathjax si besoin et prpare son div de rendu\n */\nActionNommerPoint.prototype.prepare = function () {\n  if (this.nomPoint.estLatex) {\n    const self = this\n    const width = this.doc.getWidth()\n    const taille = getTaille(this.nomPoint) - 2\n    const ch = this.nomPoint.nom.substring(1)\n    this.ex = taille / 2\n    const options = {\n      em: taille,\n      ex: this.ex,\n      containerWidth: width,\n      display: false\n    }\n    /* global MathJax */\n    if (this.doc.debug) console.debug('chargement MathJax dans ActionNommerPoint')\n    import('../loadMathJax.js')\n      .then(({ default: loadMathJax }) => loadMathJax())\n      .then(() => MathJax.tex2svgPromise(ch, options))\n      .then((html) => {\n        // html est ici du svg, mais on l'ajoute d'abord dans nomPoint.html\n        self.nomPoint.html = html\n        // et creegLatex va le rcuprer pour affecter les bons attributs et mettre a dans nomPoint.g\n        self.nomPoint.creegLatex()\n        self.setReady()\n      }).catch(error => {\n        console.error(error)\n        // eslint-disable-next-line no-alert\n        alert('Pb Mathjax, impossible dafficher le point en LaTeX')\n      })\n  } else {\n    this.nomPoint.creeg()\n    this.setReady()\n  }\n}\n\n/**\n * Excutant de l'action donnant un nom au point\n * @param {boolean} immediat Si true pas de passage  l'action suivante\n */\nActionNommerPoint.prototype.execute = function (immediat) {\n  // if ((this.nomPoint.objet === \"point\") && !this.nomPoint.nomCree) {\n  if (this.nomPoint.objet === 'point') {\n    // this.nomPoint.creeg()\n    this.nomPoint.positionne()\n    const point = this.nomPoint.point\n    if (point.nom !== null) {\n      this.doc.svg.replaceChild(this.nomPoint.g, point.nom.g)\n    } else {\n      this.doc.svg.appendChild(this.nomPoint.g)\n    }\n    point.nom = this.nomPoint\n  }\n  this.nomPoint.g.setAttribute('visibility', 'visible')\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n\n/** @inheritDoc */\nActionNommerPoint.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.nomPoint.point, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionPause\n/**\n * Action faisant une pause dans l'animation de la figure\n * Pour continuer l'action  l'utilisation doit cliquer sur le bouton rouge dans\n * la barre d'icnes\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {string} tempo le tempo de temporisation (ou null)\n */\nfunction ActionPause (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionPause.prototype = new ActionAncetre()\n/**\n * Excute l'action en suspendant l'animation en cours.\n * Pour continuer, l'utilisateur doit cliquer sur le bouton roouge.\n * @param {boolean} [immediat=false]\n */\nActionPause.prototype.execute = function (immediat) {\n  if (!immediat) {\n    this.doc.activeIconeContinuer()\n    this.doc.animationEnCours = false\n  }\n}\n/** @inheritDoc */\nActionPause.prototype.actionVisible = function () {\n  return false\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionRotationInstrument\n/**\n * Action de rotation d'un instrument\n * A noter que le paramtre correspondant  la vitesse s'appelle sens\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {InstrumentAncetre} instrument l'instrument  tourner\n * @param {string} anglefin l'angle de fin\n * @param {string} tempo  le tempo de temporisation (ou null)\n * @param {string} deg10 le nombre de degrs  tourner  chaque dizime de seconde\n * ou null( sera alors de 8)\n */\nfunction ActionRotationInstrument (doc, instrument, anglefin, tempo, deg10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.anglefin = parseFloat(anglefin)\n  this.deg10 = (deg10 == null) ? 8 : Math.abs(parseFloat(deg10))\n}\n\nActionRotationInstrument.prototype = new ActionAncetre()\n/**\n * Fonction lanant l'animation de rotation de l'instrument si immediat est false\n * @param {boolean} immediat\n */\nActionRotationInstrument.prototype.execute = function (immediat) {\n  if (!immediat) this.instrument.lanceAnimationRotation(this.anglefin, this.deg10)\n  else {\n    this.instrument.angle = this.anglefin\n    this.instrument.positionne()\n    if (!immediat) this.doc.actionSuivante(immediat)\n  }\n}\n/** @inheritDoc */\nActionRotationInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionRetourner\n/**\n * Action de retournement du compas\n * @extends ActionAncetre\n * @constructor\n * @param {iepDoc} doc\n * @param {number} tempo\n */\nfunction ActionRetourner (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionRetourner.prototype = new ActionAncetre()\n\n/**\n * Excution de l'action de retournement du compas\n * @param {boolean} immediat Si true on ne passe pas  l'action suivante\n */\nActionRetourner.prototype.execute = function (immediat) {\n  this.doc.compas.retourne()\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionRetourner.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionRotationObjet\n/**\n * Action de rotation d'un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document proprtaire\n * @param {string} idel l'id de l'objet  faire tourner\n * @param {string} anglefin l'angle de fin de rotation\n * @param {string} type le type de l'objet  faire tourner \"image\"\n * ou \"texte\" (la possibilit de tourner un texte n'tait pas prsnete\n * dans la version Flash)\n * car seules les images ont des objets que l'on peut faire tourner)\n * @param {string} tempo  le tempo de temporisation (peut tre null)\n * @param {string} deg10 Le pas d'incrmentation de l'angle par dixime de seconde\n * Vaudra 8 si  null\n */\nfunction ActionRotationObjet (doc, idel, anglefin, type, tempo, deg10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.anglefin = parseFloat(anglefin)\n  this.deg10 = (deg10 == null) ? 8 : Math.abs(parseFloat(deg10))\n  this.objet = this.doc.getElement(idel, type)\n}\nActionRotationObjet.prototype = new ActionAncetre()\n\n/**\n * Fonction lanant l'animation de l'objet seulement si immediat est false;\n * @param {boolean} immediat\n */\nActionRotationObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    if (!immediat) this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationRotation(this.anglefin, this.deg10, this.tempo)\n  else {\n    objet.angle = this.anglefin\n    objet.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionRotationObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionTranslationInstrument\n/**\n * Action de translation d'un instrument\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {InstrumentAncetre} instrument l'instrument  translater\n * @param {string} xfin l'abscisse de fin de translation\n * @param {string} yfin l'ordonne de fin de translation\n * @param {number} tempo le tempo (peut tre null)\n * @param {number} pix10 Le nombre de pixels par dixime de seconde pour la translation\n * Sera\n */\nfunction ActionTranslationInstrument (doc, instrument, xfin, yfin, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.xfin = parseFloat(xfin)\n  this.yfin = parseFloat(yfin)\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\n}\nActionTranslationInstrument.prototype = new ActionAncetre()\n\nActionTranslationInstrument.prototype.execute = function (immediat) {\n  if (isNaN(this.xfin) || isNaN(this.yfin)) this.doc.actionSuivante(immediat)\n  else {\n    if (immediat) this.instrument.translate(this.xfin, this.yfin)\n    else this.instrument.lanceAnimationTranslation(this.xfin, this.yfin, this.pix10)\n  }\n}\n/** @inheritDoc */\nActionTranslationInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionTranslationObjet\n/**\n * Action translatant un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {string} idel L'id de l'objet  translater\n * @param {string} xfin l'abscisse de fin de translation\n * @param {string} yfin L'ordonne de fin de translation\n * @param {string} type le type de l'objet\n * @param {string} tempo Le tempo de temporisation\n * @param {string} pix10 Le nombre de pixels pour la translation par dixime de seconde. Peut tre null\n */\nfunction ActionTranslationObjet (doc, idel, xfin, yfin, type, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.xfin = parseFloat(xfin)\n  this.yfin = parseFloat(yfin)\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\n  this.type = type\n  this.objet = this.doc.getElement(idel, type)\n}\nActionTranslationObjet.prototype = new ActionAncetre()\n\n/**\n * Fonction lanant la translation de objet sauf si immediat est false\n * @param {boolean} [immediat=false]\n */\nActionTranslationObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationTranslation(this.xfin, this.yfin, this.pix10)\n  else {\n    objet.translate(this.xfin, this.yfin)\n  }\n}\n/** @inheritDoc */\nActionTranslationObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionZoomInstrument\n/**\n * Action zoomant sur un instrument\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {InstrumentAncetre} instrument\n * @param {string} zoomfin Le zoom de fin (de 0  100)\n * @param {string} tempo Le tempo de factorisation\n * @param {string} vitesse Facteur de rapidit de l'animation\n */\nfunction ActionZoomInstrument (doc, instrument, zoomfin, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.zoomfin = parseFloat(zoomfin) / 100\n  this.vitesse = parseInt(vitesse)\n}\nActionZoomInstrument.prototype = new ActionAncetre()\n\nActionZoomInstrument.prototype.execute = function (immediat) {\n  if (!immediat) this.instrument.lanceAnimationZoom(this.zoomfin, this.vitesse)\n  else {\n    this.instrument.zoomfactor = this.zoomfin\n    this.instrument.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionZoomInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre.js'\nexport default ActionZoomObjet\n/**\n * Action zoomant sur un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc Le document propritaire\n * @param {Stirng} idel\n * @param {string} zoomfin L'id de l'objet sur lequel on zoome\n * @param {string} type Le type de l'objet\n * @param {string} tempo Le tempo de factorisation\n * @param {string} vitesse Facteur de vitesse pour l'animation\n */\nfunction ActionZoomObjet (doc, idel, zoomfin, type, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, type)\n  this.zoomfin = parseFloat(zoomfin) / 100\n  this.vitesse = vitesse\n  this.type = type\n}\nActionZoomObjet.prototype = new ActionAncetre()\n/**\n * Fonction lanant l'animation de zoom de l'objet sauf si immediat est false\n * @param {boolean} [immediat=false]\n */\nActionZoomObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationZoom(this.zoomfin, this.vitesse)\n  else {\n    objet.zoomfactor = this.zoomfin\n    objet.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionZoomObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @author Yves Biton <yves.biton@sesamath.net>\r\n * @licence AGPL-3.0-or-later\r\n */\r\nimport ActionAncetre from '../actions/ActionAncetre.js'\r\nexport default ActionModificationRayon\r\n\r\n/**\r\n * Action modifiant le rayon d'un arc de cercle.\r\n * A ma connaissance n'a t utilis que pour l'objet Gabarit\r\n * @param {IepDoc} doc\r\n * @param {string} idel L'id de l'objet dont il faut modifier le rayon\r\n * @param {string} rayFin Le rayon  la fin de l'animation\r\n * @param {string} type le type de l'objet\r\n * @param {string} tempo Le tempo de temporisation\r\n * @param {string} pix10 Le nombre de pixels pour la translation par dixime de seconde. Peut tre null\r\n * @constructor\r\n */\r\nfunction ActionModificationRayon (doc, idel, rayFin, type, tempo, pix10) {\r\n  ActionAncetre.call(this, doc, tempo)\r\n  this.rayFin = parseFloat(rayFin)\r\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\r\n  this.type = type\r\n  this.objet = this.doc.getElement(idel, type)\r\n}\r\nActionModificationRayon.prototype = new ActionAncetre()\r\n\r\n/**\r\n * Fonction lanant la translation de objet sauf si immediat est false\r\n * @param {boolean} [immediat=false]\r\n */\r\nActionModificationRayon.prototype.execute = function (immediat) {\r\n  const objet = this.objet\r\n  if (objet == null) {\r\n    this.doc.actionSuivante(immediat)\r\n    return\r\n  }\r\n  if (!immediat) objet.lanceAnimationModificationRayon(this.rayFin, this.pix10)\r\n  else {\r\n    objet.donneRayon(this.rayFin)\r\n  }\r\n}\r\n/** @inheritDoc */\r\nActionModificationRayon.prototype.actionVisible = function () {\r\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\r\n}\r\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Ligne\n/**\n * Classe anctre de tous les objets de type ligne\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propritaire de l'objet\n * @param {string} id l'id de l'objet dans le fichier XML de la figure\n * @param {string} couleur la couleur de l'objet\n * @param {string} epaisseur l'paisseur de trait\n * @param {string} opacite l'opacit du trait\n * @param {string} styleTrait \"tiret\" pour avoir des pointills\n */\nfunction Ligne (doc, id, couleur, epaisseur, opacite, styleTrait) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.epaisseur = epaisseur\n  this.opacite = (arguments.length >= 5) ? opacite : '100'\n  this.styleTrait = (arguments.length >= 6) ? styleTrait : 'continu'\n  const op = parseFloat(this.opacite / 100)\n  this.style = 'stroke:' + couleur + ';stroke-width:' + epaisseur +\n          ';stroke-opacity:' + op + ';stroke-linecap:round;'\n  if (this.styleTrait === 'tiret') this.style += 'stroke-dasharray:10 8 10;' // Pointills\n}\nLigne.prototype = new ObjetBase()\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { mesurePrincDeg, zeroAngle } from '../global/index.js'\nimport { convDegRad, svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport Vect from '../types/Vect.js'\nexport default Angle\n/**\n * Classe reprsentant une marque d'angle sur la figure\n * @extends ObjetBase\n * @constructor\n * @param {number} x  : abscisse du centre\n * @param {number} y ordonne du centre\n * @param {number} ray le rayon\n * @param {number} ang1 angle de dpart (en degrs)\n * @param {number} ang2 angle de fin (en degrs)\n * @param {string} couleur la couleur\n * @param {string} epaisseur paisseur du trait\n * @param {string} opacite chaine de caractre pour l'opacit (0  100)\n * @param {string} motif ; chane de caractres. Si elle commence par plein la marque doit tre remplie.\n * Si elle finit par un, deux ou trois slashes, elle a des traits de marque\n * d'angle (autant que de /)\n */\nfunction Angle (doc, id, x, y, ray, ang1, ang2, couleur, epaisseur, opacite, motif) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.ray = parseFloat(ray)\n  this.ang1 = parseFloat(ang1)\n  this.ang2 = parseFloat(ang2)\n  this.motif = (motif == null) ? 'simple' : motif\n  // Pas d'opacit pour le trait\n  Ligne.call(this, doc, id, couleur, epaisseur, 1)\n  this.opaciteRemplissage = (opacite == null) ? 0.7 : parseFloat(opacite) / 100\n  this.objet = 'angle'\n}\nAngle.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nAngle.prototype.creeg = function () {\n  let direct, path, line, v2, xc1, yc1, xmilieu, ymilieu, ang2, ang3\n  const demilong = 5 // Demi-longueur des traits de marque\n  const motif = this.motif\n  const ray = this.ray\n  const a1 = this.ang1\n  const a2 = this.ang2\n  const d = a2 - a1\n  const ang = mesurePrincDeg(d)\n  // var direct = (ang>0) && !iep.zeroAngle(d+180); // Direct dans le sens du repre du svg\n  if (zeroAngle(Math.abs(d) - 180)) direct = (this.ang1 <= this.ang2)\n  else direct = ang > 0\n  const u1 = (new Vect(this.x, this.y, this.x + Math.cos(a1 * convDegRad), this.y + Math.sin(a1 * convDegRad)))\n    .vecteurColineaire(ray)\n  const u2 = (new Vect(this.x, this.y, this.x + Math.cos(a2 * convDegRad), this.y + Math.sin(a2 * convDegRad)))\n    .vecteurColineaire(ray)\n  // Dbut de l'arc\n  let xd = this.x + u1.x\n  let yd = this.y + u1.y\n  // Fin de l'arc\n  let xf = this.x + u2.x\n  let yf = this.y + u2.y\n  const g = document.createElementNS(svgns, 'g')\n  let p = document.createElementNS(svgns, 'path')\n  const remplis = (motif.indexOf('plein') !== -1) ? this.couleur : 'none'\n  if (remplis !== 'none') {\n    path = 'M' + this.x + ' ' + this.y + 'L' + xd + ' ' + yd + 'A' + ray + ' ' + ray + ' ' +\n            this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf + ' Z'\n  } else {\n    path = 'M' + xd + ' ' + yd + 'A' + ray + ' ' + ray + ' ' +\n            this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf\n  }\n\n  p.setAttribute('d', path)\n  const style1 = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur + ';'\n  const style = style1 + 'fill:' + remplis + ';fill-opacity:' + this.opaciteRemplissage + ';'\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  const rond = (motif.indexOf('O') !== -1)\n  const uc = u1.tourne(ang / 2) // Vecteur du centre vers le milieu de l'arc\n  const xc = this.x + uc.x // Abscisse du centre de l'arc\n  const yc = this.y + uc.y // Ordonne du centre de l'arc\n  if (rond) {\n    const circ = document.createElementNS(svgns, 'circle')\n    circ.setAttribute('r', 5) // Rayon de 5 pixels pour le petir rond de marque\n    circ.setAttribute('cx', xc)\n    circ.setAttribute('cy', yc)\n    circ.setAttribute('style', style1 + 'fill:none;')\n    g.appendChild(circ)\n  }\n  // On regarde s'il y a un, deux ou trois arcs de cercle  tracer\n  const n = (motif.indexOf('triple') !== -1) ? 2 : ((motif.indexOf('double') !== -1) ? 1 : 0)\n  for (let i = 1; i <= n; i++) {\n    p = document.createElementNS(svgns, 'path')\n    const r = ray - i * 5\n    const u3 = u1.vecteurColineaire(r)\n    const u4 = u2.vecteurColineaire(r)\n    xd = this.x + u3.x\n    yd = this.y + u3.y\n    xf = this.x + u4.x\n    yf = this.y + u4.y\n    path = 'M' + xd + ' ' + yd + 'A' + r + ' ' + r + ' ' +\n          this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf\n    p.setAttribute('d', path)\n    p.setAttribute('style', style1 + 'fill:none;')\n    g.appendChild(p)\n  }\n  // On rajoute les ventuels traits (de 1  3)\n  const nbtraits = (motif.indexOf('///') !== -1) ? 3 : ((motif.indexOf('//') !== -1) ? 2 : ((motif.indexOf('/') !== -1) ? 1 : 0))\n  if (nbtraits === 0) {\n    this.g = g\n    return\n  }\n  const n1 = n + 1\n  const v = uc.vecteurColineaire(1) // Vecteur de longueur 1\n  switch (nbtraits) {\n    case 1 :\n      xmilieu = this.x + v.x * ray\n      ymilieu = this.y + v.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xmilieu - v.x * demilong * n1)\n      line.setAttribute('y1', ymilieu - v.y * demilong * n1)\n      line.setAttribute('x2', xmilieu + v.x * demilong)\n      line.setAttribute('y2', ymilieu + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n    case 2 :\n      ang2 = ang / 6\n      ang3 = 6\n      if (Math.abs(ang2) >= Math.abs(ang3)) ang2 = ang3\n      v2 = v.tourne(ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      v2 = v.tourne(-ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n    case 3 :\n      xmilieu = this.x + v.x * ray\n      ymilieu = this.y + v.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xmilieu - v.x * demilong * n1)\n      line.setAttribute('y1', ymilieu - v.y * demilong * n1)\n      line.setAttribute('x2', xmilieu + v.x * demilong)\n      line.setAttribute('y2', ymilieu + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      ang2 = ang / 4\n      ang3 = 9\n      if (Math.abs(ang2) >= Math.abs(ang3)) ang2 = ang3\n      v2 = v.tourne(ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      v2 = v.tourne(-ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n  }\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport Vect from '../types/Vect.js'\nexport default AngleDroit\n/**\n * Classe reprsentant une marque d'angle droit de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propitaire de la figure\n * @param {string} id id de l'objet dans le xml de la figure\n * @param {number} xsommet absisse du sommet de l'angle droit\n * @param {number} ysommet ordonne du sommet de l'angle droit\n * @param {number} xinter abscisse du sommet de la marque d'angle\n * @param {number} yinter ordonne du sommet de la marque d'angle\n * @param {SvgColor} couleur couleur de la marque\n * @param {number} epaisseur\n */\nfunction AngleDroit (doc, id, xsommet, ysommet, xinter, yinter, couleur, epaisseur) {\n  this.xsommet = parseFloat(xsommet)\n  this.ysommet = parseFloat(ysommet)\n  this.xinter = parseFloat(xinter)\n  this.yinter = parseFloat(yinter)\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'angle_droit'\n}\nAngleDroit.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nAngleDroit.prototype.creeg = function () {\n  let v1 = new Vect(this.xsommet, this.ysommet, this.xinter, this.yinter)\n  const n = v1.norme()\n  v1 = v1.vecteurColineaire(n / Math.sqrt(2))\n  v1 = v1.tourne(45)\n  const v2 = v1.tourne(-90)\n  const p = document.createElementNS(svgns, 'polyline')\n  const points = String(this.xsommet + v1.x) + ' ' + String(this.ysommet + v1.y) + ' ' +\n    this.xsommet + ' ' + this.ysommet + ' ' + String(this.xsommet + v2.x) + ' ' + String(this.ysommet + v2.y)\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style + 'fill:none;')\n  this.g = p\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { convDegRad, svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport CompasLeve from '../instruments/CompasLeve.js'\nimport Vect from '../types/Vect.js'\nexport default Arc\n/**\n * Classe arc de cercle (servant aussi  tracer les cercles)\n * extends iep.objetBase\n * @constructor\n * @param {number} x abscisse du centre\n * @param {number} y Ordonne du centre\n * @param {number} ray Le rayon\n * @param {number} debut L'angle de dbut de trac\n * @param {number} fin L'angle de fin de trac\n * @param {SvgColor} couleur La couleur\n * @param {number} epaisseur L'paisseur du trait\n * @param {number} opacite L'opacit du trac\n * @param {string} styleTrait \"tiret\" pour avoir des pointills\n * Si debut < angle, l'arc est trac dans le sens des ailluilles d'une montre, sinon dans le sens inverse\n */\n// Important : l'objet graphque (g element) sera initialis avec comme centre l'origine\nfunction Arc (doc, id, x, y, ray, debut, fin, couleur, epaisseur, opacite, styleTrait) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.ray = parseFloat(ray)\n  this.debut = parseFloat(debut)\n  this.fin = parseFloat(fin)\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n}\nArc.prototype = new Ligne()\n\nArc.prototype.creeg = function () {\n  const deb = this.debut\n  const fin = this.fin\n  const ray = this.ray\n  const sens = (deb < fin) ? '1' : '0' // 1 pour le sens des aiguilles d'une montre (direct pour le SVG)\n  const ecart = Math.abs(fin - deb)\n  const g = document.createElementNS(svgns, 'g')\n  if (ecart >= 359.9) { // Cas d'un cercle ou presque\n    const circ = document.createElementNS(svgns, 'circle')\n    circ.setAttribute('r', ray)\n    circ.setAttribute('cx', 0)\n    circ.setAttribute('cy', 0)\n    circ.setAttribute('style', this.style + ';fill:none;')\n    g.appendChild(circ)\n  } else {\n    const p = document.createElementNS(svgns, 'path')\n    const u1 = new Vect(Math.cos(deb * convDegRad) * ray, Math.sin(deb * convDegRad) * ray)\n    const u2 = new Vect(Math.cos(fin * convDegRad) * ray, Math.sin(fin * convDegRad) * ray)\n    const xdeb = u1.x\n    const ydeb = u1.y\n    const xfin = u2.x\n    const yfin = u2.y\n    const path = 'M' + xdeb + ' ' + ydeb + 'A' + ray + ' ' + ray + ' ' + deb + ' ' +\n      ((ecart > 180) ? '1' : '0') + ' ' + sens + ' ' + xfin + ' ' + yfin\n    p.setAttribute('d', path)\n    p.setAttribute('style', this.style + ';fill:none')\n    g.appendChild(p)\n  }\n  g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n  // g.setAttribute(\"id\",this.id);\n  g.setAttribute('visibility', 'hidden')\n  this.g = g\n}\n\nArc.prototype.creationAnimee = function () {\n  return true\n}\nArc.prototype.lanceAnimation = function (vitesse) {\n  const compas = this.doc.compas\n  if (this.doc.compasLeve == null) {\n    this.doc.compasLeve = new CompasLeve(this.doc, compas.x, compas.y,\n      compas.angle, compas.ecart)\n  }\n  const compasLeve = this.doc.compasLeve\n  this.ray = this.doc.compas.ecart // Le rayon ne peut etre connu qu'au mancement de l'animation\n  this.angfin = this.fin\n  this.pasdeg = vitesse / 2 // Dans la version JavaScript on quadruple la frquence mais on la double par rapport aux autres animations\n  this.pasdeg *= (this.fin >= this.debut) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(this.fin - this.debut)\n  this.fin = this.debut\n  compas.setPosition(this.x, this.y, this.debut)\n  compasLeve.setPosition(this.x, this.y, this.debut)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\nArc.prototype.actionPourAnimation = function () {\n  const compas = this.doc.compas\n  const compasLeve = this.doc.compasLeve\n  this.fin += this.pasdeg\n  const dis = Math.abs(this.angfin - this.fin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.fin = this.angfin\n    this.updateg()\n    // compas.setPosition(this.x,this.y,this.fin);\n    this.finAction()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.updateg()\n    compas.setPosition(this.x, this.y, this.fin)\n    if (compasLeve !== null) compasLeve.setPosition(this.x, this.y, this.fin)\n  }\n}\n\nArc.prototype.finAction = function () {\n  this.doc.compas.setPosition(this.x, this.y, this.fin)\n  if (this.doc.compasLeve !== null) this.doc.compasLeve.setPosition(this.x, this.y, this.fin)\n}\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @author Yves Biton <yves.biton@sesamath.net>\r\n * @licence AGPL-3.0-or-later\r\n */\r\nimport { convDegRad, svgns } from '../global/constantes.js'\r\nimport Ligne from '../objets/Ligne.js'\r\nimport Vect from '../types/Vect.js'\r\nexport default Gabarit\r\n\r\n/**\r\n * Classe Gabarit de cercle (servant aussi  tracer les cercles)\r\n * L'objet gabarit va hriter de cet objet (secteur circulaire)\r\n * extends iep.objetBase\r\n * @constructor\r\n * @param {number} x abscisse du centre\r\n * @param {number} y Ordonne du centre\r\n * @param {number} ray Le rayon\r\n * @param {number} debut L'angle de dbut de trac\r\n * @param {number} fin L'angle de fin de trac\r\n * @param {SvgColor} couleur La couleur\r\n * @param {number} epaisseur L'paisseur du trait\r\n * @param {number} opacite L'opacit du trac\r\n * @param {string} styleTrait \"tiret\" pour avoir des pointills\r\n * Si debut < angle, l'arc est trac dans le sens des ailluilles d'une montre, sinon dans le sens inverse\r\n */\r\n// Important : l'objet graphique (g element) sera initialis avec comme centre l'origine\r\nfunction Gabarit (doc, id, x, y, ray, ecartAngle, couleur, epaisseur, couleurFond, opacite) {\r\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, 'continu')\r\n  this.x = parseFloat(x)\r\n  this.y = parseFloat(y)\r\n  this.ray = (ray === null) ? 10 : parseFloat(ray)\r\n  this.ecartAngle = parseFloat(ecartAngle)\r\n  this.couleur = couleur\r\n  this.couleurFond = (couleurFond === null) ? couleur : couleurFond\r\n  this.angle = 0 // On peut appliquer une rotation  cet objet\r\n  this.objet = 'gabarit'\r\n}\r\n\r\nGabarit.prototype = new Ligne()\r\n\r\n// Le gabarit n'a pas d'animation quand on le cre contrairement  l'arc de cercle\r\nGabarit.prototype.creationAnimee = function () {\r\n  return false\r\n}\r\n\r\nGabarit.prototype.creeg = function () {\r\n  const fin = this.ecartAngle\r\n  const ray = this.ray\r\n  const sens = (fin >= 0) ? '1' : '0' // 1 pour le sens des aiguilles d'une montre (direct pour le SVG)\r\n  const ecart = Math.abs(fin)\r\n  const g = document.createElementNS(svgns, 'g')\r\n\r\n  const p = document.createElementNS(svgns, 'path')\r\n  const u2 = new Vect(Math.cos(fin * convDegRad) * ray, Math.sin(fin * convDegRad) * ray)\r\n  const xdeb = ray\r\n  const ydeb = 0\r\n  const xfin = u2.x\r\n  const yfin = u2.y\r\n  const path = 'M 0 0 L ' + xdeb + ' ' + ydeb + ' A ' + ray + ' ' + ray + ' 0 ' +\r\n    ((ecart > 180) ? '1' : '0') + ' ' + sens + ' ' + xfin + ' ' + yfin + ' Z'\r\n  p.setAttribute('d', path)\r\n  const op = parseFloat(this.opacite / 100)\r\n  const style = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur + ';' + 'fill:' + this.couleurFond + ';fill-opacity:' + op + ';'\r\n  p.setAttribute('style', style)\r\n  g.appendChild(p)\r\n  g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ') rotate(' + this.angle + ')')\r\n  // g.setAttribute(\"id\",this.id);\r\n  g.setAttribute('visibility', 'hidden')\r\n  this.g = g\r\n}\r\n\r\nGabarit.prototype.donneRayon = function (ray) {\r\n  this.ray = ray\r\n  this.updateg()\r\n  this.setPosition(this.x, this.y, this.angle)\r\n}\r\n\r\nGabarit.prototype.setPosition = function (x, y, angle) {\r\n  this.x = x\r\n  this.y = y\r\n  this.angle = angle\r\n  this.g.setAttribute('transform', 'translate(' + x + ',' + y + ') rotate(' + angle + ')')\r\n}\r\n\r\nGabarit.prototype.lanceAnimationModificationRayon = function (rayFin, pix10) {\r\n  this.rayFin = rayFin\r\n  this.rayInit = this.ray\r\n  const dif = rayFin - this.ray\r\n  this.dist = Math.abs(dif) // La distance entre la position actuelle et la position finale\r\n  this.dray = Math.sign(dif) * Math.abs(pix10 / 4) // Dans la version JavaScript on quadruple la frquence;\r\n  // en divisant le pas par 4\r\n  // (en fait par deux car la rapidit semble double de celle annonce dans le mode d'emploi)\r\n  // Cas o l'objet est dj  la bonne position\r\n  if (this.dist === 0) return\r\n  // this.vect = v.vecteurColineaire(this.pix);\r\n  const t = this\r\n  this.timer = setInterval(function () { t.actionPourModificationRayon() }, 25)\r\n}\r\n\r\nGabarit.prototype.actionPourModificationRayon = function () {\r\n  const r = this.ray + this.dray\r\n  const d = Math.abs(r - this.rayInit)\r\n  if ((d > this.dist) || !this.doc.animationEnCours) {\r\n    this.donneRayon(this.rayFin)\r\n    clearInterval(this.timer)\r\n    this.doc.actionSuivante()\r\n  } else {\r\n    this.dist = d\r\n    this.donneRayon(r)\r\n  }\r\n}\r\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Axe\n/**\n * Classe reprsentant un axe dans une figure InstrumenPoche\n * Repris  partir du code Flash\n * @extends ObjetBase\n * @constructor\n * @param {ie.iepDoc} doc le document propritaire\n * @param {string} pente \"horizontal\" pour un axe horizontal, sinon vertical\n * @param {string} largeur\n * @param {string} haut\n * @param {string} gauche\n * @param {string} distanceBord\n * @param {string} xgrad\n * @param {string} xmin\n * @param {string} xmax\n * @param {string} couleur la couleur de l'axe\n */\nfunction Axe (doc, pente, largeur, haut, gauche, distanceBord, xgrad, xmin, xmax, couleur) {\n  ObjetBase.call(this, doc, 'axeIEP', couleur) // Le repre aura pour Id axeIEP\n  this.pente = (pente == null) ? 'horizontal' : pente\n  this.largeur = largeur\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.distanceBord = parseFloat(distanceBord)\n  this.xgrad = xgrad\n  this.xmin = xmin\n  this.xmax = xmax\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.width = 30 * largeur\n  this.cadre.droite = this.gauche + this.width\n  this.cadre.bas = this.haut + this.width\n}\nAxe.prototype = new ObjetBase()\n\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nAxe.prototype.creeg = function () {\n  let li, nb_grad_x, bord, debut_trace_x\n  this.g = document.createElementNS(svgns, 'g')\n  const style = 'stroke:black;stroke-width:1;'\n  // Si besoin, on trace des graduations pour les abscisses\n  if (this.pente === 'horizontal' && (this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui apparaitront\n    nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonne de l'axe horizontal\n     */\n    bord = this.distanceBord * 30\n\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n\n    this.tracer_abscisses(debut_trace_x, this.xgrad, nb_grad_x, bord)\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', this.cadre.gauche)\n    li.setAttribute('y1', bord)\n    li.setAttribute('x2', this.cadre.droite)\n    li.setAttribute('y2', bord)\n    this.g.appendChild(li)\n    /*\n     FIN ABSCISSES\n     */\n  } else if ((this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui apparaitront\n    nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonne de l'axe horizontal\n     */\n    bord = Number(this.distanceBord) * 30\n\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n\n    this.tracer_ordonnees(debut_trace_x, this.xgrad, nb_grad_x, bord)\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', bord)\n    li.setAttribute('y1', this.cadre.bas)\n    li.setAttribute('x2', bord)\n    li.setAttribute('y2', this.cadre.haut)\n    this.g.appendChild(li)\n\n    /*\n     FIN ABSCISSES\n     */\n  }\n}\n/**\n * Fonction reprise du code Flash, utiilise dans creeg()\n */\nAxe.prototype.tracer_abscisses = function (debut_trace_x, unite_x, nb_grad_x, ordo_etiquettes) {\n  let li, txt, abscisse, i\n  const tailleEtiquettes = 12 // Taille de la police utilise pour les tiquettes\n  const style = 'stroke:black;stroke-width:1.5;'\n\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('style', style)\n  li.setAttribute('x1', this.cadre.gauche)\n  li.setAttribute('y1', ordo_etiquettes)\n  li.setAttribute('x2', this.cadre.droite)\n  li.setAttribute('y2', ordo_etiquettes)\n  this.g.appendChild(li)\n  for (i = 0; i <= nb_grad_x; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    abscisse = this.mettre_x_en_pixels(debut_trace_x + i * unite_x)\n    li.setAttribute('x1', abscisse)\n    li.setAttribute('y1', String(ordo_etiquettes - 5))\n    li.setAttribute('x2', abscisse)\n    li.setAttribute('y2', String(ordo_etiquettes + 5))\n    this.g.appendChild(li)\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('x', abscisse)\n    txt.setAttribute('y', ordo_etiquettes + tailleEtiquettes + 5)\n    const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', stylet)\n    txt.appendChild(document.createTextNode(String(debut_trace_x + i * unite_x)))\n    this.g.appendChild(txt)\n  }\n}\n/**\n * Fonction reprise du code Flash, utiilise dans creeg()\n */\nAxe.prototype.tracer_ordonnees = function (debut_trace_y, unite_y, nb_grad_y, abs_etiquettes) {\n  let li, txt, i\n  const tailleEtiquettes = 12 // Taille de la police utilise pour les tiquettes\n  const style = 'stroke:black;stroke-width:1.5;'\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('style', style)\n  li.setAttribute('x1', abs_etiquettes)\n  li.setAttribute('y1', this.cadre.haut)\n  li.setAttribute('x2', abs_etiquettes)\n  li.setAttribute('y2', this.cadre.bas)\n  this.g.appendChild(li)\n  for (i = 0; i <= nb_grad_y; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    const ordonnee = this.mettre_y_en_pixels(debut_trace_y + i * unite_y)\n    li.setAttribute('x1', String(abs_etiquettes - 5))\n    li.setAttribute('y1', ordonnee)\n    li.setAttribute('x2', String(abs_etiquettes + 5))\n    li.setAttribute('y2', ordonnee)\n    this.g.appendChild(li)\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('x', abs_etiquettes + 10)\n    txt.setAttribute('y', ordonnee + 2)\n    const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', stylet)\n    txt.appendChild(document.createTextNode(String(debut_trace_y + i * unite_y)))\n    this.g.appendChild(txt)\n  }\n}\n/**\n * Fonction utilise dans iep.axe\n * @param {number} nbr\n * @returns {number}\n */\nAxe.prototype.mettre_x_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmin, this.xmax, this.cadre.gauche, this.cadre.droite)\n}\n/**\n * Fonction utilise dans iep.axe\n * @param {number} nbr\n * @returns {number}\n */\nAxe.prototype.mettre_y_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmax, this.xmin, this.cadre.haut, this.cadre.bas)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { zero } from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport Vect from '../types/Vect.js'\nexport default DroiteAncetre\n/**\n * La classe reprsentant l'anctre des droites, segments, demi-droites\n * @extends ObjetBase\n * @constructor\n * @param {number} x1 Abscisse du premier point\n * @param {number} y1 Ordonne du deuime point\n * @param {number} x2 Abscisse du deuxime point\n * @param {number} y2 Ordonne du deuxime point\n * @param {SvgColor} couleur La couleur\n * @param {number} epaisseur L'paisseur de trait\n * @param {number} opacite L'opacit du trac\n * @param {string} styleTrait \"tiret\" pour un trait pointill\n * @param {boolean} vecteur Si true une flche est trace\n */\nfunction DroiteAncetre (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  this.x1 = parseFloat(x1)\n  this.y1 = parseFloat(y1)\n  this.x2 = parseFloat(x2)\n  this.y2 = parseFloat(y2)\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n}\nDroiteAncetre.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nDroiteAncetre.prototype.creeg = function () {\n  const g = document.createElementNS(svgns, 'g')\n  const li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', this.x1)\n  li.setAttribute('y1', this.y1)\n  li.setAttribute('x2', this.x2)\n  li.setAttribute('y2', this.y2)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id);\n  this.g = g\n}\n\nDroiteAncetre.prototype.creationAnimee = function () {\n  return true\n}\nDroiteAncetre.prototype.lanceAnimation = function (vitesse) {\n  this.vitesse = vitesse / 4\n  const v = new Vect(this.x1, this.y1, this.x2, this.y2)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  if (zero(this.dist)) {\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.vitesse * 1.8) //* 1.8 car dans la ralit c'est plus rapide\n  this.xfin = this.x2\n  this.yfin = this.y2\n  this.x2 = this.x1\n  this.y2 = this.y1\n  const cray = this.doc.crayon\n  cray.setPosition(this.x1, this.y1, cray.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation(t) }, 25)\n}\nDroiteAncetre.prototype.actionPourAnimation = function () {\n  this.x2 += this.vect.x\n  this.y2 += this.vect.y\n  const u = new Vect(this.x1, this.y1, this.x2, this.y2)\n  const d = u.norme()\n  const cray = this.doc.crayon\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.x2 = this.xfin\n    this.y2 = this.yfin\n    this.finAction()\n    this.updateg()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    cray.translate(this.x2, this.y2)\n    this.updateg()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nDroiteAncetre.prototype.finAction = function () {\n  this.doc.crayon.translate(this.x2, this.y2)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport DroiteAncetre from '../objets/DroiteAncetre.js'\nexport default Droite\n/**\n * Classe reprsentant une droite donne par les coordonnes de ses deux points\n * @constructor\n * @extends ObjetBase\n * @param {number} x1 Abscisse du premier point\n * @param {number} y1 Ordonne du deuime point\n * @param {number} x2 Abscisse du deuxime point\n * @param {number} y2 Ordonne du deuxime point\n * @param {string} couleur La couleur\n * @param {string} epaisseur L'paisseur de trait\n * @param {string} opacite L'opacit du trac\n * @param {string} styleTrait \"tiret\" pour un trait pointill\n */\nfunction Droite (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  DroiteAncetre.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n}\nDroite.prototype = new DroiteAncetre()\n\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nDroite.prototype.creeg = function () {\n  this.calcule()\n  if (!this.horsFenetre) {\n    const li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', this.xext1)\n    li.setAttribute('y1', this.yext1)\n    li.setAttribute('x2', this.xext2)\n    li.setAttribute('y2', this.yext2)\n    li.setAttribute('style', this.style)\n    this.g = li\n  } else {\n    this.g = document.createElementNS(svgns, 'g')\n  }\n  this.g.setAttribute('visibility', 'hidden')\n  // this.g.setAttribute(\"id\",this.id);\n}\n/**\n * Calcul des coordonnes des points d'intersection de la droite avec les bords de la fentre\n * Si la droite est hors de la fentre, this.horsFenetre est mis  false, sinon true\n * Au retour, (this.xext1, this.yext1) et (this.xext2, this.yext2) sont les coodonnes des points au bord\n */\nDroite.prototype.calcule = function () {\n  const { x1, y1, x2, y2 } = this\n  if ((x1 === x2) && (y1 === y2)) {\n    this.horsFenetre = true\n    return\n  }\n  this.horsFenetre = false\n  const width = this.doc.getWidth()\n  const height = this.doc.getHeight()\n  if (x1 === x2) {\n    this.xext1 = x1\n    this.yext1 = 0\n    this.xext2 = x1\n    this.yext2 = height\n    if ((x1 < 0) || (x1 > width)) {\n      this.horsFenetre = true\n      return\n    }\n    this.xext1 = x1\n    this.yext1 = 0\n    this.xext2 = x1\n    this.yext2 = height\n    return\n  }\n  if (y1 === y2) {\n    this.xext1 = 0\n    this.yext1 = y1\n    this.xext2 = width\n    this.yext2 = y1\n    if ((y1 < 0) || (y1 > height)) {\n      this.horsFenetre = true\n      return\n    }\n    this.xext1 = 0\n    this.yext1 = y1\n    this.xext2 = width\n    this.yext2 = y1\n    return\n  }\n  let indicePoint = 0\n  const a = (y2 - y1) / (x2 - x1)\n  const xa = 0\n  const ya = this.y1 + a * (xa - x1)\n  if ((ya >= 0) && (ya <= height)) {\n    indicePoint++\n    this.xext1 = xa\n    this.yext1 = ya\n  }\n  const xb = width\n  const yb = a * (xb - x1) + y1\n  if ((yb >= 0) && (yb <= height)) {\n    indicePoint++\n    if (indicePoint === 1) {\n      this.xext1 = xb\n      this.yext1 = yb\n    } else {\n      this.xext2 = xb\n      this.yext2 = yb\n      return\n    }\n  }\n  const yc = 0\n  const xc = (yc - y1) / a + x1\n  if ((xc > 0) && (xc < width)) {\n    indicePoint++\n    if (indicePoint === 1) {\n      this.xext1 = xc\n      this.yext1 = yc\n    } else {\n      this.xext2 = xc\n      this.yext2 = yc\n      return\n    }\n  }\n  const yd = height\n  const xd = (yd - y1) / a + x1\n  if ((xd > 0) && (xd <= width)) {\n    indicePoint++\n    if (indicePoint === 2) {\n      this.xext2 = xd\n      this.yext2 = yd\n    } else {\n      this.horsFenetre = true\n    }\n  } else this.horsFenetre = true\n  if (this.horsFenetre) {\n    this.xext1 = 0\n    this.yext1 = ya\n    this.xext2 = xb\n    this.yext2 = yb\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global/index.js'\nimport Droite from '../objets/Droite.js'\nimport Vect from '../types/Vect.js'\nexport default DemiDroite\n\n/**\n * Classe reprsentant une demi-droite dans la figure InstrumenPoche\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propritaire de la figure\n * @param {string} id id de l'objet dans le fichier XML\n * @param {number} x1 abscisse du premier point\n * @param {number} y1 ordonne du premier point\n * @param {number} x2 abscisse du second point\n * @param {number} y2 ordonne du premier point\n * @param {string} couleur couelur de la demi-droite\n * @param {string} epaisseur Epaisseur du trait\n * @param {string} opacite Opacit du trait\n * @param {string} styleTrait \"tiret\" pour avoir des pointills\n */\nfunction DemiDroite (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  Droite.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n}\nDemiDroite.prototype = new Droite()\n// Inutile de redfinir creeg()\n/**\n * Fonction calculant les coordonnes des points  la limite de la figure\n * (xext1,yext1) et (xext2,yext2) pour le trac rel\n */\nDemiDroite.prototype.calcule = function () {\n  Droite.prototype.calcule.call(this)\n  const v1 = new Vect(this.x1, this.y1, this.x2, this.y2) // Vecteur directeur de la demi-droite\n  // Si la droite est hors-fentre, la demi-droite l'est aussi\n  if (this.horsFenetre) return\n  // Dans IEP l'origine est toujours dans la fentre\n  const u = new Vect(this.x1, this.y1, this.xext1, this.yext1)\n  if (u.presqueNul()) {\n    const v = new Vect(this.x1, this.y1, this.xext2, this.yext2)\n    if (kernel.colineairesMemeSens(v, v1)) {\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    } else {\n      this.xext2 = this.xext1\n      this.yext2 = this.yext1\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    }\n  } else {\n    if (kernel.colineairesMemeSens(u, v1)) {\n      this.xext2 = this.xext1\n      this.yext2 = this.yext1\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    } else {\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    }\n  }\n}\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @Author Yves Biton (yves.biton@sesamath.net)\r\n * @License: GNU AGPLv3 https://www.gnu.org/licenses/agpl-3.0.html\r\n * Attention : Ne pas appeler cet objet Imag car entre en conflit avec l'objet Imag du JS\r\n */\r\nimport { svgns } from '../global/constantes.js'\r\nimport ObjetBase from '../objets/ObjetBase.js'\r\nimport ActionCreation from '../actions/ActionCreation.js'\r\nexport default Imag\r\n/**\r\n * Classe reprsentant une image incluse dans la figure InstrumenPoche\r\n * @extends ObjetBase\r\n * @constructor\r\n * @param {IepDoc} doc le document propritaire\r\n * @param {string} id id de l'objet cr dans le fichier XML de la figure\r\n * @param {string} url l'url de la figure\r\n */\r\nfunction Imag (doc, id, url) {\r\n  this.doc = doc\r\n  this.id = id\r\n  this.url = url\r\n  this.x = 0\r\n  this.y = 0\r\n  this.angle = 0\r\n  this.objet = 'image'\r\n  this.zoomfactor = 1\r\n}\r\nImag.prototype = new ObjetBase()\r\n/** @inheritDoc */\r\nImag.prototype.initialisePosition = function () {\r\n  this.x = 0\r\n  this.y = 0\r\n  this.angle = 0\r\n  this.zoomfactor = 1\r\n  this.positionne()\r\n}\r\n/**\r\n * Fonction appele dans iepDoc.creeActions\r\n * cre une image avec l'url url de faon  rcuprer ses dimensions\r\n * Lorsque l'image est charge, une fonction de callBack cre l'lment graphique\r\n * image dans le DOM du svg contenant la igure\r\n */\r\nImag.prototype.prepareAction = function () {\r\n  const img = new Image()\r\n  img.owner = this\r\n  this.action = new ActionCreation(this.doc, this.id, this)\r\n  this.action.isReady = false\r\n  this.doc.ajouteAction(this.action)\r\n  img.onload = function () {\r\n    const own = this.owner\r\n    own.width = this.width\r\n    own.height = this.height\r\n    own.action.isReady = true\r\n  }\r\n  img.src = this.url // Provoque le chargement de l'image\r\n}\r\n/**\r\n * Fonction mettant dans this.g l'lment graphique svg reprsentant l'objet dans\r\n * le DOM du svg de la figure\r\n */\r\nImag.prototype.creeg = function () {\r\n  const image = document.createElementNS(svgns, 'image')\r\n  image.setAttribute('width', this.width)\r\n  image.setAttribute('height', this.height)\r\n  image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', this.url)\r\n  image.setAttribute('x', this.x)\r\n  image.setAttribute('y', this.y)\r\n  image.setAttribute('visibility', 'hidden')\r\n  this.g = image\r\n  // image.setAttribute(\"id\",this.id);\r\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\r\n  this.doc.svg.appendChild(image)\r\n}\r\n/**\r\n * Fonction mettant l'image aux coordonnes (x,y) avec un angle angle et\r\n * un coefficient de zoom zoomfactor et modifiant la position du svg element qui\r\n * le reprsente dans le DOM du svg.\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} angle\r\n * @param {integer} zoomfactor\r\n * @returns {undefined}\r\n */\r\n\r\nImag.prototype.setPosition = function (x, y, angle, zoomfactor) {\r\n  this.x = x\r\n  this.y = y\r\n  this.angle = angle\r\n  this.zoomfactor = zoomfactor\r\n  if (this.g) {\r\n    this.g.setAttribute('transform', 'scale(' + zoomfactor + ') translate(' +\r\n      String(x / zoomfactor) + ',' + String(y / zoomfactor) + ') rotate(' + angle + ')')\r\n  } else {\r\n    console.error('Il faut appeler imag.creeg avant imag.setPosition')\r\n  }\r\n}\r\n/**\r\n * Fonction mettant  jour l'lment graphique image dans le DOM du svg de la figure\r\n */\r\nImag.prototype.positionne = function () {\r\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\r\n}\r\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nexport default LigneContinue\n/**\n * Classe reprsentant une ligne continue de la figure\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc Le document propritaire\n * @param {number} id L'id de l'objet dans le fichier XML de la figure\n * @param {string} abs Une chane contenant les abscisses spares par des virgules\n * @param {string} ord Une chane contenant les ordonnes spares par des virgules\n * @param{number} xdeb : abscisse de dbut (en fait l'abscisse actuelle du crayon)\n * @param{number} ydeb : ordone de dbut (en fait l'ordonne actuelle du crayon)\n * @param {string} couleur La couleur\n * @param {string} epaisseur L'paisseur de trait\n * @param {string} opacite L'opacit du trait\n * @param {string} styleTrait tiret pour avoir des pointills\n */\nfunction LigneContinue (doc, id, xdeb, ydeb, abs, ord, couleur, epaisseur, opacite, styleTrait) {\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n  this.xdeb = xdeb\n  this.ydeb = ydeb\n  this.abs = abs.split(',')\n  this.ord = ord.split(',')\n  this.objet = 'trait'\n}\nLigneContinue.prototype = new Ligne()\n\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nLigneContinue.prototype.creeg = function () {\n  let points, i\n  const p = document.createElementNS(svgns, 'polyline')\n  points = this.xdeb + ' ' + this.ydeb\n  for (i = 0; i < this.abs.length; i++) {\n    points += ' ' + this.abs[i] + ' ' + this.ord[i]\n  }\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style + 'fill:none;')\n  p.setAttribute('visibility', 'hidden')\n  // p.setAttribute(\"id\",this.id);\n  this.g = p\n}\n/** @inheritDoc */\nLigneContinue.prototype.creationAnimee = function () {\n  return true\n}\n/**\n * Fonction lanant l'animation de visualisation de la ligne continue\n * Utilise un timer et une fonction de callBack\n */\nLigneContinue.prototype.lanceAnimation = function () {\n  this.sauveabs = this.abs\n  this.sauveord = this.ord\n  this.abs = []\n  this.ord = []\n  this.ind = -1 // L'indice dans le tableau des coordonnes\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\n/**\n * Fonction de callBack appele par un timer pour l'animation du trac\n */\nLigneContinue.prototype.actionPourAnimation = function () {\n  this.ind++\n  const cray = this.doc.crayon\n  if (this.ind >= this.sauveabs.length) {\n    this.abs = this.sauveabs\n    this.ord = this.sauveord\n    this.updateg()\n    clearInterval(this.timer)\n    this.finAction()\n    this.doc.actionSuivante()\n  } else {\n    const x = this.sauveabs[this.ind]\n    const y = this.sauveord[this.ind]\n    this.abs.push(x)\n    this.ord.push(y)\n    this.updateg()\n    cray.setPosition(parseFloat(x), parseFloat(y), cray.angle)\n    this.updateg()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nLigneContinue.prototype.finAction = function () {\n  const len = this.abs.length\n  this.doc.crayon.translate(parseFloat(this.abs[len - 1]), parseFloat(this.ord[len - 1]))\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nexport default MarqueSegment\n/**\n * Objet reprsentant une marque de segment\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propritaire\n * @param {string} id L'id de l'objet\n * @param {string} x L'abscisse\n * @param {string} y L'ordonne\n * @param {string} couleur La couleur de trac\n * @param {string} epaisseur L'paisseur de trac\n * @param {string} motif Donne le motif de la marque\n */\nfunction MarqueSegment (doc, id, x, y, couleur, epaisseur, motif) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.motif = motif\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'longueur'\n}\nMarqueSegment.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nMarqueSegment.prototype.creeg = function () {\n  let g, li, k\n  const demlong = 5\n  const ec = 5 // demi cart horizontal entre deux traits\n  const dec = ec / 2\n  const diam = 5 // Diamtre du rond dans le cas o style == O\n  switch (this.motif) {\n    case '/' :\n      g = document.createElementNS(svgns, 'line')\n      g.setAttribute('x1', demlong)\n      g.setAttribute('y1', -demlong)\n      g.setAttribute('x2', -demlong)\n      g.setAttribute('y2', demlong)\n      g.setAttribute('style', this.style)\n      break\n    case '\\\\' :\n      g = document.createElementNS(svgns, 'line')\n      g.setAttribute('x1', -demlong)\n      g.setAttribute('y1', -demlong)\n      g.setAttribute('x2', demlong)\n      g.setAttribute('y2', demlong)\n      g.setAttribute('style', this.style)\n      break\n    case '//':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k += 2) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * dec + demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * dec - demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '///':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k++) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * ec + demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * ec - demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '\\\\\\\\':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k += 2) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * dec - demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * dec + demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '\\\\\\\\\\\\':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k++) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * ec - demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * ec + demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case 'X': // Croix\n      g = document.createElementNS(svgns, 'g')\n      li = document.createElementNS(svgns, 'line')\n      li.setAttribute('x1', -demlong)\n      li.setAttribute('y1', -demlong)\n      li.setAttribute('x2', demlong)\n      li.setAttribute('y2', demlong)\n      li.setAttribute('style', this.style)\n      g.appendChild(li)\n      li = document.createElementNS(svgns, 'line')\n      li.setAttribute('x1', demlong)\n      li.setAttribute('y1', -demlong)\n      li.setAttribute('x2', -demlong)\n      li.setAttribute('y2', demlong)\n      li.setAttribute('style', this.style)\n      g.appendChild(li)\n      break\n    case 'O': // Rond\n      g = document.createElementNS(svgns, 'circle')\n      g.setAttribute('cx', 0)\n      g.setAttribute('cy', 0)\n      g.setAttribute('r', diam)\n      g.setAttribute('style', this.style + 'fill:none;')\n      break\n    default :\n      g = document.createElementNS(svgns, 'g') // Vide en cas d'erreur\n  }\n  this.g = g\n}\n/** @inheritDoc */\nMarqueSegment.prototype.positionne = function () {\n  this.g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n}\n/** @inheritDoc */\nMarqueSegment.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { cos30, sin30, svgns } from '../global/constantes.js'\nimport DroiteAncetre from '../objets/DroiteAncetre.js'\nimport Vect from '../types/Vect.js'\nexport default Segment\n\n/**\n * Classe reprsentant un segment qui peut tre affubl d'une flche\n * @extends ObjetBase\n * @constructor\n * @param {number} x1 Abscisse de l'origine\n * @param {integre} y1 Ordonne de l'origine\n * @param {number} x2 Abscisse de l'extrmit\n * @param {interger} y2 Ordonne de l'extrmit\n * @param {string} couleur couleur\n * @param {number} epaisseur paiseur du trait\n * @param {string} opacite transparence du trait (de 0  100)\n * @param {string} styleTrait Si \"tiret\" pointills sinon trait continu\n * @param {boolean} vecteur Si true on rajoute une flcce\n */\nfunction Segment (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait, stylefleche) {\n  DroiteAncetre.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n  this.stylefleche = stylefleche\n}\n\nSegment.prototype = new DroiteAncetre()\n\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n * Si le segment est en fait un vecteur on cre d'abord le svg lment du segment\n * et on lui rajoute une flche\n */\nSegment.prototype.creeg = function () {\n  DroiteAncetre.prototype.creeg.call(this)\n  if (this.stylefleche === 'vecteur') {\n    const longFleche = 12\n    const x1 = this.x1\n    const x2 = this.x2\n    const y1 = this.y1\n    const y2 = this.y2\n    const u0 = new Vect(x2, y2, x1, y1)\n    const u1 = u0.vecteurColineaire(longFleche)\n    const u2 = new Vect(u1.x * cos30 - u1.y * sin30,\n      u1.x * sin30 + u1.y * cos30)\n    const u3 = new Vect(u1.x * cos30 + u1.y * sin30,\n      -u1.x * sin30 + u1.y * cos30)\n    const points = String(x2 + u2.x) + ' ' + String(y2 + u2.y) +\n      ',' + x2 + ' ' + y2 + ',' + String(x2 + u3.x) + ' ' + String(y2 + u3.y)\n    const g = document.createElementNS(svgns, 'polyline')\n    g.setAttribute('points', points)\n    const style = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur +\n          ';stroke-opacity:' + this.opacite + ';fill:none'\n    g.setAttribute('style', style)\n    this.g.appendChild(g)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport Vect from '../types/Vect.js'\nimport Segment from './Segment.js'\nexport default MarqueSeg\n/**\n * Objet reprsentant une marque de segment\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propritaire\n * @param {string} id L'id de l'objet\n * @param {string} idSeg L'id du segment parnet\n * @param {string} couleur La couleur de trac\n * @param {string} epaisseur L'paisseur de trac\n * @param {string} motif Donne le motif de la marque\n * @param {null|string} rayon Donne le rayon (demi-longueur de la marque). \"5\" si paramtre omis.\n */\nfunction MarqueSeg (doc, id, idSeg, couleur, epaisseur, motif, rayon) {\n  this.idSeg = idSeg\n  this.motif = motif\n  this.rayon = (rayon !== null) ? rayon : '5'\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'marque'\n}\nMarqueSeg.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nMarqueSeg.prototype.creeg = function () {\n  let g, li, k\n  const seg = this.doc.getElement(this.idSeg, 'trait')\n  if (seg instanceof Segment) {\n    const demlong = this.rayon\n    const ec = 5 // demi cart horizontal entre deux traits\n    const dec = ec / 2\n    const diam = 5 // Diamtre du rond dans le cas o style == O\n    switch (this.motif) {\n      case '/' :\n        g = document.createElementNS(svgns, 'line')\n        g.setAttribute('x1', demlong)\n        g.setAttribute('y1', -demlong)\n        g.setAttribute('x2', -demlong)\n        g.setAttribute('y2', demlong)\n        g.setAttribute('style', this.style)\n        break\n      case '\\\\' :\n        g = document.createElementNS(svgns, 'line')\n        g.setAttribute('x1', -demlong)\n        g.setAttribute('y1', -demlong)\n        g.setAttribute('x2', demlong)\n        g.setAttribute('y2', demlong)\n        g.setAttribute('style', this.style)\n        break\n      case '//':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k += 2) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * dec + demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * dec - demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '///':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k++) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * ec + demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * ec - demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '\\\\\\\\':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k += 2) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * dec - demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * dec + demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '\\\\\\\\\\\\':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k++) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * ec - demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * ec + demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case 'X': // Croix\n        g = document.createElementNS(svgns, 'g')\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', -demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', -demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n        break\n      case 'O': // Rond\n        g = document.createElementNS(svgns, 'circle')\n        g.setAttribute('cx', 0)\n        g.setAttribute('cy', 0)\n        g.setAttribute('r', diam)\n        g.setAttribute('style', this.style + 'fill:none;')\n        break\n      default :\n        g = document.createElementNS(svgns, 'g') // Vide en cas d'erreur\n    }\n  } else {\n    console.warn('Marque de segment non associe  un objet segment')\n    g = document.createElementNS(svgns, 'g')\n  }\n  this.g = g\n}\n\n/** @inheritDoc */\nMarqueSeg.prototype.positionne = function () {\n  const seg = this.doc.getElement(this.idSeg, 'trait')\n  const vect = new Vect(seg.x1, seg.y1, seg.x2, seg.y2)\n  const xmil = (seg.x1 + seg.x2) / 2\n  const ymil = (seg.y1 + seg.y2) / 2\n  const ang = -vect.angle()\n  this.g.setAttribute('transform', 'translate(' + xmil + ',' + ymil + ') rotate(' + ang + ') ')\n}\n\n/** @inheritDoc */\nMarqueSeg.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { analyseExposantOuIndice, getMathsForName, getTaille, indiceFinBalise, necessiteLatex, remplaceBalises, remplaceCarSpe, traiteBalise } from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport InfoBalise from '../global/InfoBalise.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nimport sjtDom from 'sesajstools/dom/index.js'\n\nconst { setStyles } = sjtDom\n\nexport default NomPoint\n/**\n * Objet servant  nommer un point\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc le document propritaire\n * @param {string} id l'id du point auquel le nom est attribu\n * @param {string} dx le dcalage en abscisses du nom par rapport au point (haut-gauche de la matrice du nom)\n * @param {string} dy le dcalage en ordonnes du nom par rapport au point (haut-gauche de la matrice du nom)\n * @param {string} couleur la couleur du nom\n */\nfunction NomPoint (doc, id, dx, dy, nom, couleur) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.dx = (dx == null) ? 2 : parseFloat(dx)\n  this.dy = (dy == null) ? 4 : parseFloat(dy)\n  // Traitement des accents plus ncessaire avec la version MathJax 3\n  // this.nom = kernel.remplaceAccentsHtml(kernel.remplaceBalises(kernel.remplaceCarSpe(nom)))\n  this.nom = remplaceBalises(remplaceCarSpe(nom))\n  this.taille = 20\n  this.point = this.doc.getElement(this.id, 'point')\n  this.objet = 'point'\n  this.nom = this.nom.replace(/\\*/g, '')\n  if (necessiteLatex(nom)) {\n    this.nom = '$' + this.traiteMaths(this.nom) + '$'\n    this.estLatex = true\n  } else {\n    // this.nom = traiteAccents(this.nom) PLus utile version MathJax 3\n    this.estLatex = false\n  }\n}\nNomPoint.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nNomPoint.prototype.creeg = function () {\n  let indbalise, tspan, ch, ch2, style, txt, ind, indexp, indind, mini, bexp, tailleind, stylespan,\n    y, sp, i, debutLigne, an\n  let dy = 0 // Le baselineshift de chaque tspan\n  const inf = '<' // Equivalent du symbole <\n  const debexp = 'e('\n  const debind = 'i('\n  const g = document.createElementNS(svgns, 'g')\n  const taille = getTaille(this)\n  const hautlig = taille + 2\n  let decblp = 0 // Dcalage vers le bas de la ligne prcdente\n  const decalage = taille * 0.4 // Dcalage vers le bas ou le haut en cas d'indice ou d'exposant\n\n  if (this.nom.length !== 0) {\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('pointer-events', 'none')\n    txt.setAttribute('x', 0)\n    txt.setAttribute('y', 0)\n    style = 'text-anchor:left;font-size:' + taille + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', style)\n    // On remplace les espaces par des espaces inscables\n    ch2 = this.nom.replace(/ /g, '\\u00A0')\n    // Affecter une longueur ne peut tre efficace que pour du texte simpel sans balise\n    if ((this.nom.indexOf(inf) === -1) && (this.nom.indexOf(debexp) === -1) && (this.nom.indexOf(debind) === -1) &&\n      (this.nom.indexOf('<br>') === -1)) {\n      txt.appendChild(document.createTextNode(ch2))\n    } else {\n      sp = ch2.split(/<br>/gi)\n      y = -hautlig\n      for (i = 0; i < sp.length; i++) {\n        debutLigne = true\n        ch = sp[i]\n        while (ch.length !== 0) {\n          indbalise = ch.indexOf(inf)\n          indexp = ch.indexOf(debexp)\n          indind = ch.indexOf(debind)\n          if (debutLigne) y += hautlig + decblp\n          if (indexp !== -1) y += decalage\n          if ((indbalise === -1) && (indexp === -1) && (indind === -1)) {\n            tspan = document.createElementNS(svgns, 'tspan')\n            tspan.setAttribute('pointer-events', 'none')\n            tspan.setAttribute('dy', dy)\n            if (debutLigne) {\n              tspan.setAttribute('x', 0)\n              tspan.setAttribute('y', y)\n              debutLigne = false\n            }\n            dy = 0 // On est revenu au niveau 0\n            tspan.appendChild(document.createTextNode(ch))\n            txt.appendChild(tspan)\n            break\n          } else {\n            while ((ch.indexOf(inf) !== -1) || (ch.indexOf(debexp) !== -1) ||\n                    (ch.indexOf(debind) !== -1)) {\n              indbalise = ch.indexOf(inf)\n              indexp = ch.indexOf(debexp)\n              indind = ch.indexOf(debind)\n              if (indbalise === -1) {\n                if (indexp === -1) mini = indind\n                else mini = (indind === -1) ? indexp : Math.min(indind, indexp)\n              } else {\n                if (indexp === -1) mini = (indind === -1) ? indbalise : Math.min(indbalise, indind)\n                else {\n                  if (indind === -1) mini = Math.min(indbalise, indexp)\n                  else mini = Math.min(indbalise, indind, indexp)\n                }\n              }\n              if (mini > 0) { // Il y a du texte avant les balises\n                tspan = document.createElementNS(svgns, 'tspan')\n                tspan.setAttribute('pointer-events', 'none')\n                tspan.setAttribute('dy', dy)\n                if (debutLigne) {\n                  tspan.setAttribute('x', 0)\n                  tspan.setAttribute('y', y)\n                  debutLigne = false\n                }\n                dy = 0 // On est revenu au niveau 0\n                tspan.appendChild(document.createTextNode(ch.substring(0, mini)))\n                txt.appendChild(tspan)\n                ch = ch.substring(mini)\n              } else {\n                if (indbalise === 0) {\n                  const infoBalise = new InfoBalise(false, false, false, this.couleur, '', taille)\n                  ind = indiceFinBalise(ch)\n                  if (ind === -1) traiteBalise(ch, infoBalise, txt, debutLigne, y)\n                  else traiteBalise(ch.substring(0, ind), infoBalise, txt, debutLigne, y)\n                  debutLigne = false\n                  if (ind !== -1) ch = ch.substring(ind); else ch = ''\n                  dy = 0 // On est revenu au niveau 0\n                } else { // mini est gal  0\n                  bexp = mini === indexp\n                  an = analyseExposantOuIndice(ch)\n                  tspan = document.createElementNS(svgns, 'tspan')\n                  tspan.setAttribute('pointer-events', 'none')\n                  tspan.setAttribute('dy', dy + 'px')\n                  if (debutLigne) {\n                    tspan.setAttribute('x', 0)\n                    tspan.setAttribute('y', y)\n                    debutLigne = false\n                  }\n                  if (an.erreur) tspan.appendChild(document.createTextNode(ch))\n                  else {\n                    tspan.appendChild(document.createTextNode(an.operande))\n                    txt.appendChild(tspan)\n                    tspan = document.createElementNS(svgns, 'tspan')\n                    tspan.setAttribute('pointer-events', 'none')\n                    tspan.appendChild(document.createTextNode(an.exposant))\n                    dy = decalage\n                    if (bexp) dy = -dy\n                    else decblp = dy\n                    tspan.setAttribute('dy', dy + 'px')\n                    tailleind = taille * 0.6\n                    stylespan = 'font-size:' + tailleind + 'px;'\n                    tspan.setAttribute('style', stylespan)\n                    txt.appendChild(tspan)\n                    dy = -dy // Car sinon la suite sera dcale aussi en hauteur\n                  }\n                  ch = an.texte\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    g.appendChild(txt)\n    this.g = g\n  }\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id);\n}\n/*\nNomPoint.prototype.creegLatex = function () {\n  let w, h, ratio\n  try {\n    const g = document.createElementNS(svgns, 'g')\n    const c1 = this.div.childNodes[1]\n    if (c1 === undefined) return document.createElementNS(svgns, 'g')\n    const c2 = c1.childNodes[0]\n    if (c2 === undefined) return document.createElementNS(svgns, 'g')\n    let s = c2.childNodes[0]\n    if (s === undefined) return document.createElementNS(svgns, 'g')\n    // Pour grer Chrome\n    while (s.tagName === 'SPAN') s = s.childNodes[0]\n    // Le test suivant est du  la compatibilit avec l'explorer\n    if ((s.clientWidth !== 0) && (s.clientHeight !== 0)) {\n      w = s.clientWidth\n      h = s.clientHeight\n    } else {\n      const b = s.getBBox()\n      ratio = b.height / b.width\n      w = this.div.clientWidth\n      h = w * ratio\n    }\n    const t = this.taille\n    if (h < t) h = t\n    s.setAttribute('x', '0')\n    s.setAttribute('y', String(-this.taille)) // Diffrent de MathGraph32\n    s.setAttribute('width', w + 'px')\n    s.setAttribute('height', h + 'px')\n    g.appendChild(s.parentNode.removeChild(s))\n    document.body.removeChild(this.div)\n    g.setAttribute('visibility', 'hidden')\n    // g.setAttribute(\"id\",this.id);\n    this.g = g\n  } catch (e) {\n    if (this.div != null) document.body.removeChild(this.div)\n    this.g = document.createElementNS(svgns, 'g') // Cre un g vide en cas de problme\n  }\n}\n*/\n/**\n * Fonction appele par prepare() qui rcupre l'lement svg graphique reprsentant\n * la formule dans this.html (cr par MathJax.tex2svgPromise), le modifie pour lui\n * donner les bons attributs et l'affecte  this.g\n * Rajoute les lments graphiques correspondant  un cadre si une couleur de fond\n * et un cadre ont t demands\n */\nNomPoint.prototype.creegLatex = function () {\n  try {\n    const g = document.createElementNS(svgns, 'g')\n    // on rcupre le svg de creeg mis dans this.html (ventuellement par MathJax.tex2svgPromise)\n    const s = this.html.firstChild\n    const svg = s.cloneNode(true)\n    g.appendChild(svg)\n    // le svg de MathJax a ces attributs\n    const w = parseFloat(s.getAttribute('width')) * this.ex\n    const h = parseFloat(s.getAttribute('height')) * this.ex\n    const svgVa = svg.style['vertical-align']\n    const va = (svgVa ? parseFloat(svgVa) || 1 : 1) * this.ex\n    svg.setAttribute('width', w + 'px')\n    svg.setAttribute('height', h + 'px')\n    setStyles(svg, 'vertical-align', va + 'px')\n\n    svg.setAttribute('x', '0')\n    const taille = getTaille(this)\n    svg.setAttribute('y', String(-taille)) // Diffrent de MathGraph32\n    svg.setAttribute('visibility', 'hidden')\n    // g.setAttribute(\"id\",this.id);\n    this.g = g\n  } catch (error) {\n    console.error(error, 'on remplace par un <g> vide')\n    this.g = document.createElementNS(svgns, 'g') // Cre un g vide en cas de problme\n  }\n}\n\n/** @inheritDoc */\nNomPoint.prototype.positionne = function () {\n  // Il arrive que des gens aient mis l'action de nommer le point avant la cration du point lui-mme\n  // d'o le test suivant :\n  if (this.point === null) this.point = this.doc.getElement(this.id, 'point')\n  const xp = this.point.x\n  const yp = this.point.y\n  const taille = getTaille(this)\n  this.g.setAttribute('transform', 'translate(' + String(xp + this.dx) + ',' + String(yp + this.dy + taille) + ')')\n}\n\n/**\n * Fonction traitant la chane ch pour la transcrire en code LaTeX\n * Renvoie la chane LaTeX correspondante.\n * Si la chane contient des balises <br>, un tableau LaTeX est utilis pour rendre le contenu\n * @param {string} ch la chane  traiter\n * @returns {string} la chane LaTeX correpondante une fois ch traduite\n */\nNomPoint.prototype.traiteMaths = function (ch) {\n  // Modifi version MathJax 3\n  // return traiteAccents(getMathsForName(ch, true)) // True pour mode texte\n  return getMathsForName(ch, true)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport Ligne from '../objets/Ligne.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Point\n/**\n * Classe reprsentant un objet de type point\n * A noter que point possdera deux champs supplmentaires xcons et ycons\n * qui contiendront les coordones du point au cours de la construction des autres objets\n * xcons et ycons seront modifis lors d'une action de translation du point\n * pour que les objets l'utilisant comme cible soient correctement initialiss.\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc le document propritaire\n * @param {string} id L'id de l'objet\n * @param {string} x l'abscisse initiale\n * @param {string} y l'ordonne initiale\n * @param {string} couleur\n * @param {string} epaisseur\n */\nfunction Point (doc, id, x, y, couleur, epaisseur) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  // Les deux variables suivantes servent  rtablir la figure dans son tat initial quand on revien au dbut de la figure\n  this.xinit = this.x\n  this.yinit = this.y\n  //\n  this.xcons = this.x\n  this.ycons = this.y\n  Ligne.call(this, doc, id, couleur, epaisseur)\n  this.style += 'stroke-linecap:round;' // Des bouts de croix arrondis\n  this.nom = null // Un nom peut tre affect ultrieurement par une action nommer\n  this.objet = 'point'\n}\nPoint.prototype = new Ligne()\n/** @inheritDoc */\nPoint.prototype.initialisePosition = function () {\n  this.x = this.xinit\n  this.y = this.yinit\n  this.positionne()\n}\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nPoint.prototype.creeg = function () {\n  const lon = 5 // Longuueur en pixels d'un demi-trait\n  const g = document.createElementNS(svgns, 'g')\n  let li\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', -lon)\n  li.setAttribute('y1', lon)\n  li.setAttribute('x2', lon)\n  li.setAttribute('y2', -lon)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', -lon)\n  li.setAttribute('y1', -lon)\n  li.setAttribute('x2', lon)\n  li.setAttribute('y2', lon)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  // g.setAttribute(\"id\",this.id);\n  this.g = g\n}\n/** @inheritDoc */\nPoint.prototype.positionne = function () {\n  this.g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n}\n/** @inheritDoc */\nPoint.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n  if (this.nom !== null) this.nom.positionne()\n}\n/** @inheritDoc */\nPoint.prototype.updateg = function () {\n  this.setPosition(this.x, this.y)\n}\n// Ncessaire de redfinir montre car il peut y avoir un nom attach au point\nPoint.prototype.montre = function (bvisible) {\n  ObjetBase.prototype.montre.call(this, bvisible)\n  if (this.nom !== null) if (this.nom.g) this.nom.montre(bvisible)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nimport Vect from '../types/Vect.js'\nexport default Polygone\n/**\n * Classe reprsentant un polygone de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propritaire\n * @param {string} id l'id de l'objet dans le fichier XML de la figure\n * @param {string[]} abs un tableau contenant les abscisses des sommets\n * @param {string[]} ord : un tableau contenant les ordonnes des sommets\n * @param {string} couleur la couleur du polygone\n * @param {number} epaisseur l'paisseur du trac\n * @param {string} couleurFond la couelur de onc de l'intrieur du polygone\n * @param {string} opacite l'opacit du remplissage (de 0  100)\n */\nfunction Polygone (doc, id, abs, ord, couleur, epaisseur, couleurFond, opacite) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.abs = abs.split(',')\n  this.ord = ord.split(',')\n  this.sauveabs = this.abs\n  this.sauveord = this.ord\n  this.epaisseur = epaisseur\n  this.opacite = (opacite == null) ? '60' : opacite\n  const op = parseFloat(this.opacite / 100)\n  if (couleurFond == null) this.couleurFond = this.couleur; else this.couleurFond = couleurFond\n  this.style = 'stroke:' + couleur + ';stroke-width:' + epaisseur +\n          ';fill:' + this.couleurFond + ';'\n  this.style += 'fill-opacity:' + op + ';'\n  this.objet = 'trait'\n}\nPolygone.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nPolygone.prototype.creeg = function () {\n  let points, i\n  const p = document.createElementNS(svgns, 'polygon')\n  points = ''\n  for (i = 0; i < this.abs.length; i++) {\n    points += ' ' + this.abs[i] + ' ' + this.ord[i]\n  }\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style)\n  p.setAttribute('visibility', 'hidden')\n  // p.setAttribute(\"id\",this.id);\n  this.g = p\n}\n/** @inheritDoc */\nPolygone.prototype.creationAnimee = function () {\n  return true\n}\n/**\n * Fonction lanant l'animation de visualisation de la ligne continue\n * Utilise un timer et une fonction de callBack\n * Vitesse est le nombre de pixels  parcourir  chaque dixime de seconde\n * @param {number} vitesse\n */\nPolygone.prototype.lanceAnimation = function (vitesse) {\n  // Dans la version flash, la vitesse n'est pas le nombre de pixels par dixime de seconde\n  // mais le nombre de pixlels par seconde semble le double\n  this.pix = parseFloat(vitesse / 2)\n  this.abs = []\n  this.abs[0] = this.sauveabs[0]\n  this.ord = []\n  this.ord[0] = this.sauveord[0]\n  this.ind = 0 // L'indice du sommet en cours dans le tableau des coordonnes\n  this.n = 0 // L'indice du pas sur le segment en cours\n  const cray = this.doc.crayon\n  const v = new Vect(parseFloat(this.sauveabs[0]), parseFloat(this.sauveord[0]),\n    parseFloat(this.sauveabs[1]), parseFloat(this.sauveord[1]))\n  this.longcote = v.norme() // Longueur du ct en cours\n  this.vect = v.vecteurColineaire(this.pix)\n  cray.setPosition(parseFloat(this.abs[0]), parseFloat(this.ord[0]), cray.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\n/**\n * Fonction de callBack appele par un timer pour l'animation du trac\n */\nPolygone.prototype.actionPourAnimation = function () {\n  const cray = this.doc.crayon\n  let ind = this.ind\n  const x = parseFloat(this.abs[ind])\n  const y = parseFloat(this.ord[ind])\n  this.n++\n  if (this.doc.animationEnCours) {\n    if (this.n * this.pix <= this.longcote) {\n      const x1 = x + this.n * this.vect.x\n      const y1 = y + this.n * this.vect.y\n      this.abs[ind + 1] = String(x1)\n      this.ord[ind + 1] = String(y1)\n      cray.translate(x1, y1)\n      this.updateg()\n    } else {\n      this.ind++\n      ind++\n      if (ind === this.sauveabs.length - 1) {\n        clearInterval(this.timer)\n        this.finAction()\n        this.doc.actionSuivante()\n      } else { // On passe au ct suivant\n        this.abs[ind] = this.sauveabs[ind]\n        this.ord[ind] = this.sauveord[ind]\n        cray.translate(parseFloat(this.abs[ind]), parseFloat(this.ord[ind]))\n        const v = new Vect(parseFloat(this.sauveabs[ind]), parseFloat(this.sauveord[ind]),\n          parseFloat(this.sauveabs[ind + 1]), parseFloat(this.sauveord[ind + 1]))\n        this.longcote = v.norme() // Longueur du ct en cours\n        this.vect = v.vecteurColineaire(this.pix)\n        this.n = 0\n      }\n    }\n  } else {\n    clearInterval(this.timer)\n    this.finAction()\n    this.doc.actionSuivante()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nPolygone.prototype.finAction = function () {\n  this.abs = this.sauveabs\n  this.ord = this.sauveord\n  const len = this.abs.length\n  this.updateg()\n  this.doc.crayon.translate(parseFloat(this.abs[len - 1]), parseFloat(this.ord[len - 1]))\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Quadrillage\n/**\n * Classe reprsentant un quadrillage de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propritaire\n * @param {string} type Le type de quadrillage : \"quadrillage\",\"seyes\",\"5x5\",\"10x10\",\"millimetre\"\n * @param {string} hauteur La hauteur du cadre en cm (1 cm = 30 pixels)\n * @param {string} largeur La largeur du cadre en cm (1 cm = 30 pixels)\n * @param {string} haut La position en ordonnes du cadre dans la fentre\n * @param {string} gauche La position en abscisses du cadre dans la fentre\n * @param {string} couleur La couleur du quadrillage\n * Attention : Un quadrillage n'a pas d'id et il ne peut y en avoir qu'un dans une figure.\n */\nfunction Quadrillage (doc, type, hauteur, largeur, haut, gauche, couleur) {\n  ObjetBase.call(this, doc, 'quadrillageIEP', couleur) // Le repre aura pour Id quadrillageIEP\n  this.hauteur = parseFloat(hauteur)\n  this.largeur = parseFloat(largeur)\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.type = type\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.cadre.droite = this.cadre.gauche + this.largeur * 30\n  this.cadre.bas = this.cadre.haut + this.hauteur * 30\n  this.objet = 'quadrillage'\n}\n\nQuadrillage.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nQuadrillage.prototype.creeg = function () {\n  const gauche = this.cadre.gauche\n  const droite = this.cadre.droite\n  const haut = this.cadre.haut\n  const bas = this.cadre.bas\n  const couleur = this.couleur\n  this.g = document.createElementNS(svgns, 'g')\n  // Un seul quadrillage sur une figure.\n  const oldg = this.doc.svg.getElementById('quadrillageIEP')\n  if (oldg != null) this.doc.svg.removeChild(oldg)\n  switch (this.type) {\n    case 'seyes':\n      this.tracer_grille(couleur, 24, 6, gauche, haut, droite, bas, false, 1) // 1 est l'opacit\n      this.tracer_grille(couleur, 24, 24, gauche, haut, droite, bas, false, 1)\n      break\n    case 'millimetre':\n      this.tracer_grille(couleur, 3, 3, gauche, haut, droite, bas, false, 0.6)\n      this.tracer_grille(couleur, 30, 30, gauche, haut, droite, bas, false, 0.8)\n      this.tracer_grille(couleur, 150, 150, gauche, haut, droite, bas, false, 1)\n      break\n    case '10x10':\n    case '10x':\n      this.tracer_grille(couleur, 30, 30, gauche, haut, droite, bas, false, 1)\n      break\n    case '5x5':\n    case '5x':\n    default:\n      this.tracer_grille(couleur, 15, 15, gauche, haut, droite, bas, false, 1)\n      break\n  }\n}\n/**\n * Fonction reprise  partir du code de la version Flash\n * @param {string} epaisseur\n * @param {string} couleur\n * @param {number} ecart_x\n * @param {number} ecart_y\n * @param {number} debut_x\n * @param {number} debut_y\n * @param {number} fin_x\n * @param {number} fin_y\n * @param {number} pointille\n * @param {number} alpha\n */\nQuadrillage.prototype.tracer_grille = function (couleur, ecart_x, ecart_y, debut_x, debut_y, fin_x, fin_y, pointille, alpha) {\n  let li, i\n  const style = 'stroke:' + couleur + ';stroke-width:0.5;' + 'stroke-opacity:' + alpha + ';'\n  if (pointille) this.style += 'stroke-dasharray:2 2;' // Pointills\n  let nb = Math.ceil(Math.abs(fin_x - debut_x) / ecart_x)\n  for (i = 0; i < nb; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', debut_x + i * ecart_x)\n    li.setAttribute('y1', debut_y)\n    li.setAttribute('x2', debut_x + i * ecart_x)\n    li.setAttribute('y2', fin_y)\n    li.setAttribute('style', style)\n    this.g.appendChild(li)\n  }\n  nb = Math.ceil(Math.abs(fin_y - debut_y) / ecart_y)\n  for (i = 0; i < nb; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', debut_x)\n    li.setAttribute('y1', debut_y + i * ecart_y)\n    li.setAttribute('x2', fin_x)\n    li.setAttribute('y2', debut_y + i * ecart_y)\n    li.setAttribute('style', style)\n    this.g.appendChild(li)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport ObjetBase from '../objets/ObjetBase.js'\nexport default Repere\n/**\n * Classe reprsentant un repre de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le docmument propritaire\n * @param {string} hauteur Hauteur du cadre contenant le repre, exprimes en centimtres\n * @param {string} largeur Largeur du cadre contenant le repre, exprimes en centimtres\n * @param {string} haut abscisse de ce cadre relativement au bord haut et au\n * bord gauche de la zone de dessin, en centimtres\n * @param {string} gauche Ordonne de ce cadre relativement au bord haut et\n * au bord gauche de la zone de dessin, en centimtres\n * @param {string} xgrad donne les units de graduations : si Xgrad est gal  5,\n *  le repre va tre gradu de 5 en 5\n * @param {string} ygrad donne les units de graduations : si Ygrad est gal  5, le repre va tre gradu de 5 en 5\n * @param {string} xmin valeur mini des abscisses dans le repre\n * @param {string} xmax valeur maxi des abscisses dans le repre\n * @param {string} ymin valeur mini des ordonnes dans le repre\n * @param {string} ymax valeur maxi des ordonnes dans le repre\n * @param {SvgColor} couleur Couleur du trac\n * @param {string} grille \"invisible si on souhaite que le quadrillage soit masqu\n * @param {string} axes invisible si on souhaite que les axes soient masqu\n * @param {string} etiquettes invisible si on souhaite que les tiquettes des axes soient masques\n */\nfunction Repere (doc, hauteur, largeur, haut, gauche, xgrad, ygrad, xmin, xmax,\n  ymin, ymax, couleur, grille, axes, etiquettes) {\n  ObjetBase.call(this, doc, 'repereIEP', couleur) // Le repre aura pour Id repereIEP\n  this.hauteur = hauteur\n  this.largeur = largeur\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.xgrad = parseFloat(xgrad)\n  this.ygrad = parseFloat(ygrad)\n  this.xmin = parseFloat(xmin)\n  this.xmax = parseFloat(xmax)\n  this.ymin = parseFloat(ymin)\n  this.ymax = parseFloat(ymax)\n  this.grille = (grille == null) ? 'visible' : grille\n  this.axes = (axes == null) ? 'visible' : axes\n  this.etiquettes = (etiquettes == null) ? 'visible' : etiquettes\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.cadre.droite = this.cadre.gauche + this.largeur * 30\n  this.cadre.bas = this.cadre.haut + this.hauteur * 30\n}\nRepere.prototype = new ObjetBase()\n/**\n *\n * @param {number} nbr\n * @returns {number}\n */\nRepere.prototype.mettre_x_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmin, this.xmax, this.cadre.gauche, this.cadre.droite)\n}\n/**\n * Fonction utilise dans l'objet repere. Repris du code Flash\n */\nRepere.prototype.mettre_y_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.ymax, this.ymin, this.cadre.haut, this.cadre.bas)\n}\n/**\n *\n * @param {number} debut_trace_x\n * @param {number} unite_x\n * @param {number} nb_grad_x\n * @param {number} ordo_etiquettes\n * @param {number} haut\n * @param {number} bas\n */\nRepere.prototype.tracer_abscisses = function (debut_trace_x, unite_x, nb_grad_x, ordo_etiquettes, haut, bas) {\n  let li, txt, abscisse, i\n  const tailleEtiquettes = 12 // Taille de la police utilise pour les tiquettes\n  const style = 'stroke:black;stroke-width:0.5;'\n\n  if (this.grille === 'invisible' && this.axes !== 'invisible') {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', this.cadre.gauche)\n    li.setAttribute('y1', ordo_etiquettes)\n    li.setAttribute('x2', this.cadre.droite)\n    li.setAttribute('y2', ordo_etiquettes)\n    this.g.appendChild(li)\n  }\n  for (i = 0; i <= nb_grad_x; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    abscisse = this.mettre_x_en_pixels(debut_trace_x + i * unite_x)\n    if (this.grille === 'invisible') {\n      if (this.axes !== 'invisible') {\n        li.setAttribute('x1', abscisse)\n        li.setAttribute('y1', String(ordo_etiquettes - 5))\n        li.setAttribute('x2', abscisse)\n        li.setAttribute('y2', String(ordo_etiquettes + 5))\n        this.g.appendChild(li)\n      }\n    } else {\n      li.setAttribute('x1', abscisse)\n      li.setAttribute('y1', haut)\n      li.setAttribute('x2', abscisse)\n      li.setAttribute('y2', bas)\n      this.g.appendChild(li)\n    }\n    if (this.etiquettes !== 'invisible' && this.axes !== 'invisible') {\n      txt = document.createElementNS(svgns, 'text')\n      txt.setAttribute('x', abscisse + 2)\n      txt.setAttribute('y', ordo_etiquettes + tailleEtiquettes)\n      const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n      txt.setAttribute('style', stylet)\n      txt.appendChild(document.createTextNode(String(debut_trace_x + i * unite_x)))\n      this.g.appendChild(txt)\n    }\n  }\n}\n/**\n *\n * @param {number} debut_trace_y\n * @param {number} unite_y\n * @param {number} nb_grad_y\n * @param {number} abs_etiquettes\n * @param {number} gauche\n * @param {number} droite\n */\nRepere.prototype.tracer_ordonnees = function (debut_trace_y, unite_y, nb_grad_y, abs_etiquettes, gauche, droite) {\n  let li, txt, ordonnee, i\n  const tailleEtiquettes = 12 // Taille de la police utilise pour les tiquettes\n  const style = 'stroke:black;stroke-width:0.5;'\n  if (this.grille === 'invisible' && this.axes !== 'invisible') {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', abs_etiquettes)\n    li.setAttribute('y1', this.cadre.haut)\n    li.setAttribute('x2', abs_etiquettes)\n    li.setAttribute('y2', this.cadre.bas)\n    this.g.appendChild(li)\n  }\n  for (i = 0; i <= nb_grad_y; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    ordonnee = this.mettre_y_en_pixels(debut_trace_y + i * unite_y)\n    if (this.grille === 'invisible') {\n      if (this.axes !== 'invisible') {\n        li.setAttribute('x1', String(abs_etiquettes - 5))\n        li.setAttribute('y1', ordonnee)\n        li.setAttribute('x2', String(abs_etiquettes + 5))\n        li.setAttribute('y2', ordonnee)\n        this.g.appendChild(li)\n      }\n    } else {\n      li.setAttribute('x1', gauche)\n      li.setAttribute('y1', ordonnee)\n      li.setAttribute('x2', droite)\n      li.setAttribute('y2', ordonnee)\n      this.g.appendChild(li)\n    }\n    if (this.etiquettes !== 'invisible' && this.axes !== 'invisible') {\n      txt = document.createElementNS(svgns, 'text')\n      txt.setAttribute('x', abs_etiquettes + 2)\n      txt.setAttribute('y', ordonnee + tailleEtiquettes)\n      const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n      txt.setAttribute('style', stylet)\n      txt.appendChild(document.createTextNode(String(debut_trace_y + i * unite_y)))\n      this.g.appendChild(txt)\n    }\n  }\n}\n/**\n * Fonction mettant dans this.g l'lment graphique reprsentant l'objet dans\n * le DOM du svg de la figure\n */\nRepere.prototype.creeg = function () {\n  const width = this.cadre.droite - this.cadre.gauche\n  const height = this.cadre.bas - this.cadre.haut\n  this.g = document.createElementNS(svgns, 'g')\n  const defs = document.createElementNS(svgns, 'defs')\n  const clip = document.createElementNS(svgns, 'clipPath')\n  clip.setAttribute('id', 'clipRepere')\n  const style = 'stroke:' + this.couleur + ';stroke-width:1;fill:none;'\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('style', style)\n  rect.setAttribute('x', this.cadre.gauche)\n  rect.setAttribute('y', this.cadre.haut)\n  rect.setAttribute('width', width)\n  rect.setAttribute('height', height)\n  clip.appendChild(rect)\n  defs.appendChild(clip)\n  this.g.appendChild(defs)\n  this.g.setAttribute('style', 'clip-path:url(#clipRepere)')\n\n  // Si besoin, on trace des graduations pour les abscisses\n  if ((this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui appraitront\n    const nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonne des tiquettes pour les abscisses\n     */\n    let ordo_etiquettes\n    if (this.ymax * this.ymin < 0) {\n      ordo_etiquettes = this.mettre_y_en_pixels(0)\n    } else if (this.ymax < 0) {\n      ordo_etiquettes = this.cadre.haut\n    } else {\n      ordo_etiquettes = this.cadre.bas\n    }\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    const debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n    this.tracer_abscisses(debut_trace_x, this.xgrad, nb_grad_x, ordo_etiquettes, this.cadre.haut, this.cadre.bas)\n    /*\n     FIN ABSCISSES\n     */\n  }\n  if ((this.ymax - this.ymin) > this.ygrad) {\n    const nb_grad_y = Math.floor((this.ymax - this.ymin) / this.ygrad)\n    /*\n     determination de l'abscisse des tiquettes pour les ordonnes\n     */\n    let abs_etiquettes\n    if (this.xmax * this.xmin < 0) {\n      abs_etiquettes = this.mettre_x_en_pixels(0)\n    } else if (this.xmax < 0) {\n      abs_etiquettes = this.cadre.droite\n    } else {\n      abs_etiquettes = this.cadre.gauche\n    }\n    const debut_trace_y = kernel.determiner_graduations(this.ymin, this.ymax, this.ygrad)\n    this.tracer_ordonnees(debut_trace_y, this.ygrad, nb_grad_y, abs_etiquettes, this.cadre.gauche, this.cadre.droite)\n  }\n  // tracer_les_fonctions();\n  const rect2 = document.createElementNS(svgns, 'rect')\n  rect2.setAttribute('style', style)\n  rect2.setAttribute('x', this.cadre.gauche)\n  rect2.setAttribute('y', this.cadre.haut)\n  rect2.setAttribute('width', width)\n  rect2.setAttribute('height', height)\n  this.g.appendChild(rect2)\n  this.g.setAttribute('visibility', 'hidden')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { elimineDoublonsXML, estInstrument, getSvgColor, parseXMLDoc } from '../global/index.js'\nimport { svgns } from '../global/constantes.js'\nimport Vect from '../types/Vect.js'\nimport Compas from '../instruments/Compas.js'\nimport Equerre from '../instruments/Equerre.js'\nimport Rapporteur from '../instruments/Rapporteur.js'\nimport Regle from '../instruments/Regle.js'\nimport Requerre from '../instruments/Requerre.js'\nimport Crayon from '../instruments/Crayon.js'\nimport ActionCoucherCompas from '../actions/ActionCoucherCompas.js'\nimport ActionCreation from '../actions/ActionCreation.js'\nimport ActionEcarterCompas from '../actions/ActionEcarterCompas.js'\nimport ActionEcrireTexte from '../actions/ActionEcrireTexte.js'\nimport ActionGlisser from '../actions/ActionGlisser.js'\nimport ActionLeverCompas from '../actions/ActionLeverCompas.js'\nimport ActionMasquer from '../actions/ActionMasquer.js'\nimport ActionMasquerInstrument from '../actions/ActionMasquerInstrument.js'\nimport ActionModifierLongueur from '../actions/ActionModifierLongueur.js'\nimport ActionMontrer from '../actions/ActionMontrer.js'\nimport ActionMontrerGraduations from '../actions/ActionMontrerGraduations.js'\nimport ActionMontrerInstrument from '../actions/ActionMontrerInstrument.js'\nimport ActionMontrerNombres from '../actions/ActionMontrerNombres.js'\nimport ActionNommerPoint from '../actions/ActionNommerPoint.js'\nimport ActionPause from '../actions/ActionPause.js'\nimport ActionRotationInstrument from '../actions/ActionRotationInstrument.js'\nimport ActionRetourner from '../actions/ActionRetourner.js'\nimport ActionRotationObjet from '../actions/ActionRotationObjet.js'\nimport ActionTranslationInstrument from '../actions/ActionTranslationInstrument.js'\nimport ActionTranslationObjet from '../actions/ActionTranslationObjet.js'\nimport ActionZoomInstrument from '../actions/ActionZoomInstrument.js'\nimport ActionZoomObjet from '../actions/ActionZoomObjet.js'\nimport ActionModifierRayon from '../actions/ActionModifierRayon.js'\nimport Angle from '../objets/Angle.js'\nimport AngleDroit from '../objets/AngleDroit.js'\nimport Arc from '../objets/Arc.js'\nimport Gabarit from '../objets/Gabarit.js'\nimport Axe from '../objets/Axe.js'\nimport DemiDroite from '../objets/DemiDroite.js'\nimport Droite from '../objets/Droite.js'\nimport Imag from '../objets/Imag.js'\nimport LigneContinue from '../objets/LigneContinue.js'\nimport MarqueSegment from '../objets/MarqueSegment.js'\nimport MarqueSeg from '../objets/MarqueSeg.js'\nimport NomPoint from '../objets/NomPoint.js'\nimport Point from '../objets/Point.js'\nimport Polygone from '../objets/Polygone.js'\nimport Quadrillage from '../objets/Quadrillage.js'\nimport Repere from '../objets/Repere.js'\nimport Segment from '../objets/Segment.js'\nimport Texte from '../objets/Texte.js'\n\nexport default IepDoc\n\n// la liste des outils\nconst outils = ['compas', 'equerre', 'rapporteur', 'regle', 'requerre', 'crayon']\n// la liste des icones\nconst icons = ['Reset', 'PrevStep', 'Pause', 'Play', 'Restart', 'NextStep', 'GotoEnd', 'XML', 'Repeat']\n\nconst defaultWidth = 800\nconst defaultHeight = 600\n\n/**\n * Retourne une promesse qui sera rsolue dans delay (ms)\n * @private\n * @param {number} delay\n * @return {Promise<undefined>}\n */\nconst waitPromise = (delay) => {\n  return new Promise((resolve) => {\n    setTimeout(() => resolve(), delay)\n  })\n}\n\n// des fonctions pour construire du svg (hors prototype car indpendantes de lui)\n\n/**\n * Retourne le svg de l'icne play de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconPlay (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-5,8 8,0 -5,-8')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icne pause de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n */\nfunction getIconPause (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -6)\n  rect.setAttribute('y', -7)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 14)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', 2)\n  rect.setAttribute('y', -7)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 14)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  // svg.setAttribute(\"transform\",\"translate(16,16)\");\n  return svg\n}\n\n/**\n * retourne l'icne stepNext de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconNextStep (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', 5)\n  rect.setAttribute('y', -6)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-7,6 2,0 -7,-6')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne l'icne stepPrev de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconPrevStep (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -7)\n  rect.setAttribute('y', -6)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '7,6 -2,0 7,-6')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icne goEnd de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconGotoEnd (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-6,7 1,0 -6,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '3,7 10,0 3,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne l'icne goBegin de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconReset (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '6,7 -1,0 6,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-3,7 -10,0 -3,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icne restart de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconRestart (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const path = document.createElementNS(svgns, 'path')\n  path.setAttribute('d', 'M 0 -8 A 8 8 -90 1 1 -8 0')\n  path.setAttribute('style', 'stroke:white;stroke-width:3;fill:none;')\n  path.setAttribute('marker-end', 'url(#markerarrow')\n  path.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(path)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icne restart de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconRepeat (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const path = document.createElementNS(svgns, 'path')\n  path.setAttribute('d', 'M 0 -8 A 8 8 -90 1 1 -1 -8')\n  path.setAttribute('style', 'stroke:white;stroke-width:3;fill:none;')\n  path.setAttribute('marker-end', 'url(#markerarrow')\n  path.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(path)\n  return svg\n}\n/**\n * Retourne le svg de l'icne XML de la figure\n * Si teinte == \"fonce\", la couleur bleu fonce est employe\n * Si \"teinte == \"clair\", la couleur gris clair est employe\n * @private\n * @param {number} x l'abscisse de l'icne relative  la barre d'icnes\n * @param {number} y l'ordonne de l'icne relative  la barre d'icnes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconXml (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icne\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('XML'))\n  text.setAttribute('x', 16)\n  text.setAttribute('y', 21)\n  text.setAttribute('style', 'font-family:Arial;font-size:9pt;fill:white;text-anchor:middle')\n  svg.appendChild(text)\n  return svg\n}\n\n// fonctions pour rcuprer des attributs\n\n/**\n * Retourne l'attribut id d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getId (el) {\n  return el.getAttribute('id')\n}\n\n/**\n * Retourne l'attribut abscisse de trait d'une action\n * @private\n * @param {Element} el un des elements retourn par this.xmldoc.getElementsByTagName(\"action\")\n * @returns {string}\n */\nfunction getAbs (el) {\n  return el.getAttribute('abscisse')\n}\n\n/**\n * Retourne l'attribut ordonne de trait d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getOrd (el) {\n  const ord = el.getAttribute('ordonnee')\n  return (ord === null) ? el.getAttribute('ordonne') : ord\n}\n\n/**\n * Retourne l'attribut couleur d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {SvgColor} (si l'lment n'avait pas l'attribut couleur ce sera black)\n */\nfunction getCouleur (el) {\n  const coul = el.getAttribute('couleur')\n  return coul ? getSvgColor(coul) : 'black'\n}\n/**\n * Retourne l'attribut couleur_cadre de l'action\n * @private\n * @param {Element} el\n * @return {null|SvgColor}\n */\nfunction getCouleurCadre (el) {\n  const coul = el.getAttribute('couleur_cadre')\n  return coul ? getSvgColor(coul) : null\n}\n\n/**\n * Retourne l'attribut couleur_fond d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {SvgColor|null}\n */\nfunction getCouleurFond (el) {\n  const coul = el.getAttribute('couleur_fond')\n  return coul ? getSvgColor(coul) : null\n}\n\n/**\n * Retourne l'attribut paisseur d'une action (1 si y'en avait pas)\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getEpaisseur (el) {\n  const ep = el.getAttribute('epaisseur')\n  return (ep === null || parseInt(ep) === 0) ? '1' : ep\n}\n\n/**\n * Retourne l'attribut opacit de trait d'une action (100 si y'en avait pas)\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string} opacit ('100' par dfaut)\n */\nfunction getOpaciteTrait (el) {\n  const op = el.getAttribute('opacite')\n  return (op === null) ? '100' : op\n}\n\n/**\n * Retourne l'attribut opacit de fond d'une action\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getOpaciteFond (el) {\n  const op = el.getAttribute('opacite')\n  if (op === null) return '50'\n  return op\n}\n\n/**\n * Retourne l'attribut le style de trait d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getStyleTrait (el) {\n  const st = el.getAttribute('pointille')\n  return (st == null) ? 'continu' : st\n}\n\n/**\n * Retourne l'attribut style de flce d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getStyle (el) {\n  const st = el.getAttribute('style')\n  return (st == null) ? 'normal' : st\n}\n\n/**\n * Animation InstrumenPoche (avec son svg associ)\n * @constructor\n * @param {SVGElement} svg  Le SVG contenant la figure\n * @param {string} xml La chane contenant le code XML dcrivant la figure.\n * @param {Object} [options]\n * @param {boolean} [options.debug=false] passer true pour avoir des infos de debug en console\n * @param {boolean} [options.autoStart=false] passer true pour dmarrer l'animation ds le chargement\n */\nfunction IepDoc (svg, xml, options) {\n  /**\n   * L'lment svg du DOM\n   * @type {SVGElement}\n   */\n  this.svg = svg\n  // pour la compatibilit ascendante, on traite le 3e argument boolen comme autostart\n  if (typeof options === 'boolean') {\n    /** @type {boolean} */\n    this.autoStart = options\n    options = {}\n  } else {\n    if (typeof options !== 'object') options = {}\n    this.autoStart = Boolean(options.autoStart)\n  }\n  /** @type {boolean} */\n  this.debug = Boolean(options.debug)\n  /**\n   * Pointera sur la fentre contenant le code xml\n   * @type {Window}\n   */\n  this.windowxml = null\n  let ch = xml\n  // On ajoute l'en-tte xml si elle a t ommise.\n  if (ch.search(/<?xml/gi) === -1) ch = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' + ch\n  // On limine les <action_ suivis de chiffres\n  ch = ch.replace(/<action[_]\\d*/gi, '<action')\n  // On limine les remarques html\n  ch = ch.replace(/<!--.*-->/g, '')\n  // On corrige les oublis d'espaces et les -- dans les attributs\n  ch = ch.replace(/(=\"[^\"]*\")([^ ])/g, '$1 $2').replace(/--/g, '')\n  // On corrige les ventuels << ou >>\n  ch = ch.replace(/<</g, '<').replace(/>>/g, '>')\n  // Certains auteurs ont mis des <actiontempo= sans espace ou autre\n  ch = ch.replace(/<action(\\w)/gi, '<action $1')\n  // Les commentaires peuvent un attribut texte ce qui pose des problmes dans elimineDoublonsXML\n  // On les remplace par un attribut texteCommentaire\n  ch = ch.replace(/<commentaire\\s*texte\\s*=/gi, '<commentaire texteCommentaire =')\n  // On corrige les attributs en doublon\n  ch = elimineDoublonsXML(ch)\n  // On limine l'en-tte qui contient parfois des caractres bizarres\n  /**\n   * La string xml du doc\n   * @type {string}\n   */\n  this.codexml = ch // Mmoris pour pouvoir tre affiche quand on clique sur le bouton XML\n  // (on veut la version avant le nettoyage qui suit pour conserver la dclaration xml et les attributs du tag INSTRUMENPOCHE)\n\n  // on corrige le tag ouvrant et fermant, parfois folklorique dans les scripts existants\n  // Pas de > dans la recherche sur le tag fermant car certains auteurs se sont tromps sur la balise de fin\n  const chunks = (/<\\s*INSTRUMENPOCHE[^>]*>(.*)<\\s*\\/INSTRUMENPOCHE/si).exec(ch)\n  if (!chunks) throw Error('script xml invalide')\n  /**\n   * Le doc xml sans l'en-tte <?xml > et avec les tags INSTRUMENPOCHE ouvrant / fermant nettoys\n   * @type {string}\n   */\n  this.chdoc = '<INSTRUMENPOCHE>' + chunks[1] + '</INSTRUMENPOCHE>'\n\n  /**\n   * La liste des actions (initialise par creeActions)\n   * @type {ActionCreation[]}\n   * @private\n   */\n  this.actions = [] // Un tableau qui contiendra toutes les actions de la figure.\n  /**\n   * Une liste des lments graphiques de type objet graphique traits par la figure.\n   * Chaque lment sera identifi par un n d'id et par son type.\n   * Lorsqu'un lment de mme id et de mme nature qu'un lment dj existant est cr,\n   * lors de l'excution de l'action de cration, son lment graphique remplacera celui\n   * de l'lement dj existant dans le DOM du svg de la figure\n   * @type {ObjetBase[]}\n   * @private\n   */\n  this.elements = []\n  /** @type {boolean} */\n  this.compasRetourne = false\n  // On cre les instruments ds le dbut car certains objet crs ont besoin de connatre\n  // l'tat des instruments lors de leur cration\n  /**\n   * @type {CompasLeve}\n   * @private\n   */\n  this.compasLeve = null\n  /**\n   * @type {Compas}\n   * @private\n   */\n  this.compas = new Compas(this)\n  /**\n   * @type {Equerre}\n   * @private\n   */\n  this.equerre = new Equerre(this)\n  /**\n   * @type {Rapporteur}\n   * @private\n   */\n  this.rapporteur = new Rapporteur(this)\n  /**\n   * @type {Regle}\n   * @private\n   */\n  this.regle = new Regle(this)\n  /**\n   * @type {Requerre}\n   * @private\n   */\n  this.requerre = new Requerre(this)\n  /**\n   * @type {Crayon}\n   * @private\n   */\n  this.crayon = new Crayon(this)\n  /**\n   * Le script xml pars\n   * @type {XMLDocument}\n   */\n  this.xmldoc = parseXMLDoc(this.chdoc)\n  /**\n   * Liste des lments action du xml\n   * @type {Element[]}\n   * @private\n   */\n  this.tabact = this.xmldoc.getElementsByTagName('action')\n  /** @type {boolean} */\n  this.started = false\n  /** @type {boolean} */\n  this.animationEnCours = true // Sera mis  false pour le pas  pas\n\n  // viewBox, on regarde si on trouve un tag <viewBox> dans le xml,\n  // si oui on prend les valeurs qu'il prcise (si elles sont valides)\n  // sinon nos valeurs par dfaut\n  const vb = {\n    x: 0,\n    y: 0,\n    width: defaultWidth,\n    height: defaultHeight\n  }\n  //  propos de viewbox & viewport\n  // https://la-cascade.io/comprendre-svg-viewbox-et-viewport/\n  // https://developer.mozilla.org/fr/docs/Web/SVG/Attribute/viewBox\n  // https://la-cascade.io/comprendre-svg-viewbox/\n  // https://la-cascade.io/comprendre-svg-preserveaspectratio/\n  const viewBoxElts = this.xmldoc.getElementsByTagName('viewBox')\n  if (viewBoxElts && viewBoxElts.length) {\n    if (viewBoxElts.length > 1) console.error(Error('Il y a plusieurs tags viewBox dans le script, on prend le premier'), viewBoxElts)\n    const xmlViewBox = viewBoxElts[0]\n    // et pour chaque attribut on regarde si il est prcis\n    Object.keys(vb).forEach(attr => {\n      const value = Number(xmlViewBox.getAttribute(attr))\n      // pour x & y on tolre les ngatifs, mais pas pour width et height\n      if (Number.isFinite(value) && (attr.length < 2 || value > 0)) vb[attr] = value\n    })\n  }\n  // sur un cran trs large, on rduit la largeur initiale du div conteneur pour essayer de tout faire rentrer dans l'cran\n  // (sinon avec le preserveAspectRatio et 98% en largeur et hauteur, a aligne le svg sur largeur et ajoute du scroll vertical)\n  if (\n    window.innerHeight > vb.height * 0.6 && // tout pourrait rentrer en hauteur (avec un zoom de 0.6 a reste acceptable)\n    (vb.width / vb.height) < (window.innerWidth / window.innerHeight) // l'cran est plus large (en format) que l'animation\n  ) {\n    // on rduit le div parent en largeur pour que l'animation puisse rentrer entirement  l'cran,\n    // et viter de trop l'agrandir en largeur\n    // try/catch au cas o parentNode serait pas trs catholique\n    try {\n      svg.parentNode.style.width = (window.innerHeight / vb.height * vb.width) + 'px'\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  // on ajoute une taille minimale au conteneur (qui fera apparatre des ascenseur si on rduit trop)\n  try {\n    svg.parentNode.style.minWidth = (vb.width / 2) + 'px'\n    svg.parentNode.style.minHeight = (vb.height / 2) + 'px'\n  } catch (error) {\n    console.error(error)\n  }\n  // on mmorise le viewBox initial\n  this.initialViewBox = vb\n  svg.setAttribute('viewBox', `${vb.x} ${vb.y} ${vb.width} ${vb.height}`)\n  svg.setAttribute('preserveAspectRatio', 'xMinYMin meet')\n\n  /**\n   * indice de la premire action qui sera excute\n   * @type {number}\n   */\n  this.indiceActionEnCours = 0\n  this.creeActions()\n\n  // Les vnements souris pour pouvoir grer les dplacements de la barre d'icnes\n  const t = this\n  svg.addEventListener('mousemove', function (ev) { t.mousemoveListenerSvg(ev, ev.clientX, ev.clientY) }, false)\n  svg.addEventListener('mouseup', function () { t.mouseupListener() }, false)\n  svg.addEventListener('mouseleave', function () { t.mouseleaveListener() }, false)\n  svg.addEventListener('touchmove', function (ev) { t.mousemoveListenerSvg(ev, ev.touches[0].pageX, ev.touches[0].pageY) }, false)\n  svg.addEventListener('touchend', function () { t.mouseupListener() }, false)\n  svg.addEventListener('touchcancel', function () { t.mouseupListener() }, false)\n  svg.addEventListener('touchleave', function () { t.mouseleaveListener() }, false)\n  if (this.debug) console.debug('iepDoc instanci :', this)\n}\n\n/**\n * Change la viewBox du svg\n * @param {Object} viewBox\n * @param {number} viewBox.x\n * @param {number} viewBox.y\n * @param {number} viewBox.width\n * @param {number} viewBox.height\n * @throws {TypeError} s'il manque l'une des 4 proprits\n */\nIepDoc.prototype.setViewBox = function setViewBox (viewBox) {\n  if (typeof viewBox !== 'object' || Object.keys(this.initialViewBox).some(prop => !Number.isFinite(viewBox[prop]))) {\n    throw TypeError('paramtre invalide (il faut passer un objet { x: number, y: number, width: number, height: number })')\n  }\n  const { x, y, width, height } = viewBox\n  // on limite le zoom, mais on ne throw pas d'erreur (sinon  force de cliquer sur + on arrive  descendre sous les 10 et a gnre un rapport bugsnag)\n  if (width < 10 || height < 10) return console.error(Error('width et height doivent tre suprieur  10'))\n  // facteur de zoom absolu\n  const zoomFactor = this.initialViewBox.width / width\n  this.svg.setAttribute('viewBox', `${x} ${y} ${width} ${height}`)\n  this.barreIcones.setAttribute('transform', `translate(${x + this.xbarre / zoomFactor}, ${y + this.ybarre / zoomFactor}) scale(${1 / zoomFactor})`)\n}\n\n/**\n * Zoom (in ou out) dans le svg\n * @param {number} zoomFactor Facteur de zoom relatif  l'tat actuel (1.5 grossi de 50%, et 0.8 rduit de 20%), sauf pour 1 o l'animation est remise dans son tat initial (du chargement)\n * @param {number} [xCenter] Abscisse du centre du zoom (si non fourni ce sera le milieu de l'affichage actuel)\n * @param {number} [yCenter] Ordonne du centre du zoom (si non fourni ce sera le milieu de l'affichage actuel)\n */\nIepDoc.prototype.zoom = function zoom (zoomFactor, xCenter, yCenter) {\n  if (typeof zoomFactor !== 'number' || zoomFactor < 1e-6 || zoomFactor > 1e6) throw Error(`zoomFactor invalide : ${typeof zoomFactor} ${zoomFactor}`)\n  // on reset si on passe un zoomFactor de 1\n  if (zoomFactor === 1) return this.setViewBox(this.initialViewBox)\n  // sinon faut faire des calculs\n  let { x, y, width, height } = this.getViewBox()\n  if (!Number.isFinite(xCenter)) xCenter = x + width / 2\n  if (!Number.isFinite(yCenter)) yCenter = y + height / 2\n  width = Math.round(width / zoomFactor)\n  height = Math.round(height / zoomFactor)\n  x = xCenter - width / 2\n  y = yCenter - height / 2\n  this.setViewBox({ x, y, width, height })\n}\n\n/**\n * Retourne true seulement si tous les objets de la figure sont bien chargs\n * @returns {boolean}\n */\nIepDoc.prototype.isReadyAll = function isReadyAll () {\n  if (this.debug) {\n    const pasPretes = this.actions.filter(action => !action.isReady)\n    if (pasPretes.length) console.debug(`${pasPretes.length} actions pas encore prtes (sur ${this.actions.length})`)\n    else console.debug(`Les ${this.actions.length} actions sont prtes`)\n  }\n  return this.actions.every(action => action.isReady)\n}\n\n/**\n * Rappellera callback quand tout sera prt ou qu'on aura attendu maxWait ms\n * @param {function} callback Sera appele avec une erreur si maxWait est atteint\n * @param {number} maxWait dlai max  attendre, en s\n */\nIepDoc.prototype.whenReady = function whenReady (callback, maxWait = 30) {\n  const wait = () => setTimeout(check, 100)\n  const check = () => {\n    // on teste toutes les 100ms, jusqu' ce que ce soit prt ou que maxWait soit atteint\n    if (this.isReadyAll()) return callback()\n    if ((Date.now() - start) < maxWait * 1000) return wait()\n    callback(Error(`Aprs ${maxWait}s dattente lanimation nest pas prte, chec du chargement`))\n  }\n  const start = Date.now()\n  check()\n}\n\n/**\n * Retourne une promesse qui sera rsolue quand le doc sera prt ou qu'on aura attendu maxWait (dans ce cas rejet avec l'erreur)\n * @param {number} maxWait dlai max  attendre, en s\n * @return {Promise<undefined>}\n */\nIepDoc.prototype.getReadyPromise = function getReadyPromise (maxWait = 30) {\n  if (this.isReadyAll()) return Promise.resolve()\n  return new Promise((resolve, reject) => {\n    this.whenReady((error) => {\n      if (error) reject(error)\n      else resolve(this)\n    }, maxWait)\n  })\n}\n\n/**\n * Retourne la largeur en pixel du svg (dans son systme de coordonnes, pas ce qu'il occupe  l'cran)\n * @return {number}\n */\nIepDoc.prototype.getWidth = function getWidth () {\n  return this.getViewBox().width\n}\n/**\n * Retourne la hauteur en pixel du svg (dans son systme de coordonnes, pas ce qu'il occupe  l'cran)\n * @return {number}\n */\nIepDoc.prototype.getHeight = function getHeight () {\n  return this.getViewBox().height\n}\n/**\n * Retourne les 4 valeurs de la viewBox du svg (toutes en number).\n * Si y'a pas de viewBox ou une viewBox invalide a impose la viewBox par dfaut (et retourne ses valeurs)\n * @return {{x: number, width: number, y: number, height: number}}\n */\nIepDoc.prototype.getViewBox = function getViewBox () {\n  try {\n    const viewBox = this.svg.getAttribute('viewBox')\n    if (viewBox) {\n      // on cast en Number et vrifie qu'on a aucun NaN\n      const values = viewBox.split(' ').map(Number).filter(n => !Number.isNaN(n))\n      if (values.length === 4) {\n        const [x, y, width, height] = values\n        // on vrifie quand mme que width et height sont valides\n        if (width > 0 && height > 0) return { x, y, width, height }\n      }\n    }\n    console.error(Error('viewBox invalide'), viewBox)\n  } catch (error) {\n    console.error(error)\n  }\n  // on rectifie les conneries pour que ce qu'on retourne corresponde  la ralit\n  this.svg.setAttribute('viewBox', `0 0 ${defaultWidth} ${defaultHeight}`)\n  return {\n    x: 0,\n    y: 0,\n    width: defaultWidth,\n    height: defaultHeight\n  }\n}\n\n/**\n * Retourne au dbut et joue l'animation en acclr (pas  pas avec delay ms entre chaque pas)\n * @param delay\n * @param callback\n */\nIepDoc.prototype.goFast = function goFast (delay = 100, callback) {\n  const self = this\n  const nextStep = () => {\n    self.nextStep()\n    if (self.indiceActionEnCours < self.actions.length) {\n      setTimeout(() => nextStep(), delay)\n    } else if (callback) {\n      callback()\n    }\n  }\n  this.getReadyPromise().then(() => {\n    if (self.animationEnCours) {\n      self.pause()\n      return waitPromise(500)\n    }\n    return Promise.resolve()\n  }).then(() => {\n    self.reset()\n    nextStep()\n  }).catch(error => {\n    console.error(error)\n    // eslint-disable-next-line no-alert\n    alert(error.message)\n  })\n}\n\n/**\n * Cre tous les lments graphiques des aactions de cration de la figure.\n * Seules les actions de crations d'objets ont une fonction creegElement faisant quelquechose\n * @private\n */\nIepDoc.prototype.creeElementsGraphiques = function creeElementsGraphiques () {\n  this.actions.forEach(action => action.creegElement())\n}\n\n/**\n * Rinitilise la position de tous les instruments et les cache\n * @private\n */\nIepDoc.prototype.initialiseOutils = function initialiseOutils () {\n  outils.forEach(outil => {\n    this[outil].initialisePosition()\n    this[outil].montre(false)\n  })\n  this.compas.leve = false\n}\n\n/**\n * Retire du DOM les lments graphiques des outils et les recre de faon  ce que les outils\n * soient dans le DOM aprs les lments graphiques des objets de la figure.\n * @private\n */\nIepDoc.prototype.recreeOutils = function recreeOutils () {\n  outils.forEach(outil => {\n    this[outil].updateg()\n    this[outil].montre(false)\n  })\n  this.compasLeve = null\n}\n\n/**\n * Fonction lance aprs le chargement complet de la figure.\n * Toutes les actions de cration d'objet de la figure crent leur propre lment graphique dans le DOM du svg\n * qu'elles stockent dans une variable this.g. Ces lments sont initialeent tous cachs.\n * Ensuite on recre dans le DOM les lments graphiques des outils pour qu'ils soient situs aprs les objets crs.\n * Puis on cre les icnes et on les initialise  leur tat initial  pour le dmarrage de la figure.\n * @private\n */\nIepDoc.prototype.init = function init () {\n  this.started = true\n  this.creeElementsGraphiques()\n  this.recreeOutils()\n  this.creeIcones()\n  if (this.autoStart) {\n    this.montreIcones(['Pause'])\n    this.play()\n  } else {\n    this.montreIcones(['Play'])\n  }\n}\n\n/**\n * Cre les icnes de la figure.\n * @private\n */\nIepDoc.prototype.creeIcones = function creeIcones () {\n  // Toutes les images seront contenues dans un g element appel barreIcones\n  const nbIcones = 8\n  const t = this\n  this.barreIcones = document.createElementNS(svgns, 'g')\n  this.creeElementsPourIcones()\n  // reset\n  this.iconReset = getIconReset(0, 0, 'fonce')\n  this.iconResetGris = getIconReset(0, 0, 'clair')\n  this.iconReset.onclick = this.reset.bind(this)\n  this.barreIcones.appendChild(this.iconReset)\n  this.barreIcones.appendChild(this.iconResetGris)\n  // prevStep\n  this.iconPrevStep = getIconPrevStep(32, 0, 'fonce')\n  this.iconPrevStepGris = getIconPrevStep(32, 0, 'clair')\n  this.iconPrevStep.onclick = function () { t.prevStep() }\n  this.barreIcones.appendChild(this.iconPrevStep)\n  this.barreIcones.appendChild(this.iconPrevStepGris)\n  // pause\n  this.iconPause = getIconPause(64, 0, 'fonce')\n  this.iconPauseGris = getIconPause(64, 0, 'clair')\n  this.iconPause.onclick = this.pause.bind(this)\n  this.barreIcones.appendChild(this.iconPause)\n  this.barreIcones.appendChild(this.iconPauseGris)\n  // play\n  this.iconPlay = getIconPlay(96, 0, 'fonce')\n  this.iconPlayGris = getIconPlay(96, 0, 'clair')\n  this.iconPlay.onclick = this.play.bind(this)\n  this.barreIcones.appendChild(this.iconPlay)\n  // continue, icne rouge  activer quand on rencontre une pause\n  // Cette icne ne sera visible et active que quand on rencontre une action de pause\n  this.iconContinue = getIconPlay(96, 0, 'rouge')\n  this.iconContinue.setAttribute('visibility', 'hidden')\n  this.iconContinue.onclick = this.continue.bind(this)\n  this.barreIcones.appendChild(this.iconContinue)\n  this.barreIcones.appendChild(this.iconPlayGris)\n  // restart\n  this.iconRestart = getIconRestart(128, 0, 'fonce')\n  this.iconRestartGris = getIconRestart(128, 0, 'clair')\n  this.iconRestart.onclick = this.restart.bind(this)\n  this.barreIcones.appendChild(this.iconRestart)\n  this.barreIcones.appendChild(this.iconRestartGris)\n  // nextStep\n  this.iconNextStep = getIconNextStep(160, 0, 'fonce')\n  this.iconNextStepGris = getIconNextStep(160, 0, 'clair')\n  this.iconNextStep.onclick = function () { t.nextStep() }\n  this.barreIcones.appendChild(this.iconNextStep)\n  this.barreIcones.appendChild(this.iconNextStepGris)\n  // gotoEnd\n  this.iconGotoEnd = getIconGotoEnd(192, 0, 'fonce')\n  this.iconGotoEndGris = getIconGotoEnd(192, 0, 'clair')\n  this.iconGotoEnd.onclick = function () { t.gotoEnd() }\n  this.barreIcones.appendChild(this.iconGotoEnd)\n  this.barreIcones.appendChild(this.iconGotoEndGris)\n  // xml\n  this.iconXML = getIconXml(224, 0, 'fonce')\n  this.iconXMLGris = getIconXml(224, 0, 'clair')\n  this.iconXML.onclick = function () { t.showXml() }\n  this.barreIcones.appendChild(this.iconXML)\n  this.barreIcones.appendChild(this.iconXMLGris)\n  // Repeat\n  this.iconRepeat = getIconRepeat(256, 0, 'fonce')\n  this.iconRepeatGris = getIconRepeat(256, 0, 'clair')\n  this.iconRepeat.onclick = this.repeat.bind(this)\n  this.barreIcones.appendChild(this.iconRepeat)\n  this.barreIcones.appendChild(this.iconRepeatGris)\n\n  this.hauteurBarre = 32\n  this.demiLargeurBarre = nbIcones * 16\n  // this.xbarre et this.ybarre contiennent les coordonnes initiales de la barre d'outils dans le SVG\n  this.xbarre = 50 // pas trop  gauche  cause des boutons de zoom ventuels\n  this.ybarre = 4\n  this.barreIcones.setAttribute('transform', `translate(${this.xbarre}, ${this.ybarre})`)\n  this.svg.appendChild(this.barreIcones)\n  // Ajout des listeners de souris sur la barre d'icnes (pour grer son dplacement)\n  this.isDraggingBarre = false // flag mis  true au mousedown|touch et lu au move\n  this.barreIcones.addEventListener('mousedown', function (ev) { t.mousedownListenerBarre(ev.clientX, ev.clientY) }, false)\n  this.barreIcones.addEventListener('mousemove', function (ev) { t.mousemoveListenerBarre(ev.clientX, ev.clientY) }, false)\n  // C'est le SVG qui gre les vnements mouseup\n  this.barreIcones.addEventListener('touchstart', function (ev) { t.mousedownListenerBarre(ev.touches[0].pageX, ev.touches[0].pageY) }, false)\n  this.barreIcones.addEventListener('touchmove', this.mousemoveListenerBarre.bind(this), false)\n  // C'est le svg qui gre les vnements touhcancel et touchend\n  // this.barreIcones.addEventListener(\"touchcancel\",function() {t.onmouseupbarre()},false);\n  // Initialisation de la position relative de la barre d'outils\n  // this.deltax et this.deltay contiendront de dcalage relatif de la barre d'outils par rapport\n  //  sa position initiale lorsqu'on la fait glisser.\n  this.deltax = 0\n  this.deltay = 0\n}\n\n/**\n * Fonction appele quand on clique ou fait un appui tactile sur la barre d'icnes de la figure\n * @param {number} xmouse l'abscisse du point cliqu par la souris\n * @param {number} ymouse l'ordonne du point cliqu par la souris\n * @private\n */\nIepDoc.prototype.mousedownListenerBarre = function mousedownListenerBarre (xmouse, ymouse) {\n  if (this.animationEnCours) return\n  this.isDraggingBarre = true\n  this.xcapturebarre = xmouse\n  this.ycapturebarre = ymouse\n}\n\n/**\n * Fonction appele au survol de la barre d'icnes par la souris ou du pointeur tactive\n * @private\n */\nIepDoc.prototype.mousemoveListenerBarre = function mousemoveListenerBarre () {\n  if (this.animationEnCours) {\n    this.barreIcones.style.cursor = 'default'\n    this.isDraggingBarre = false\n  } else {\n    this.barreIcones.style.cursor = 'pointer'\n  }\n}\n\n/**\n * Appel au survol du svg par la souris ou au dplacement d'un pointeur tactile\n * @private\n * @param {event} ev\n * @param {number} xmouse l'abscisse pointe par la souris\n * @param {number} ymouse l'ordonne pointe par la souris\n */\nIepDoc.prototype.mousemoveListenerSvg = function mousemoveListenerSvg (ev, xmouse, ymouse) {\n  if (this.isDraggingBarre) {\n    const w = this.getWidth()\n    const h = this.getHeight()\n    const dx = xmouse - this.xcapturebarre\n    const dy = ymouse - this.ycapturebarre\n    const deltax = this.deltax + dx\n    const deltay = this.deltay + dy\n    const xpos = this.xbarre + deltax\n    const ypos = this.ybarre + deltay\n    if ((xpos <= w - 2 * this.demiLargeurBarre) && (xpos >= 0) &&\n            (ypos >= 0) && (ypos <= h - this.hauteurBarre)) {\n      this.barreIcones.setAttribute('transform', 'translate(' + xpos + ',' + ypos + ')')\n      this.deltax = deltax\n      this.deltay = deltay\n      this.xcapturebarre = xmouse\n      this.ycapturebarre = ymouse\n    }\n    ev.preventDefault() // Pour viter que des lments texte soient slectionns en bougeant la souris\n  }\n  // ev.preventDefault(); // Pour viter que des lments texte soient slectionns en bougeant la souris\n  // Abandonn car alors on e peut pls zoomer ou dzoomer sur priphrique mobile\n}\n\n/**\n * Fonction appele lorsque le bouton de la souris est relch sur le svg\n * @private\n */\nIepDoc.prototype.mouseupListener = function mouseupListener () {\n  this.isDraggingBarre = false\n}\n\n/**\n * Fonction appele quand on relche le bouton de la souris sur la figure\n * @private\n */\nIepDoc.prototype.mouseleaveListener = function mouseleaveListener () {\n  this.isDraggingBarre = false\n}\n\n/**\n * Ouvre une fentre (ou onglet) affichant le code XML de la figure\n */\nIepDoc.prototype.showXml = function showXml () {\n  if (this.windowxml == null) this.windowxml = this.popup()\n  else this.windowxml.focus()\n}\n\n/**\n * Montre les icones passes en argument et grise les autres\n * @param {string[]} icones\n */\nIepDoc.prototype.montreIcones = function montreIcones (icones) {\n  icons.forEach(icone => {\n    const bvisible = icones.includes(icone)\n    const nom = 'icon' + icone\n    if (this[nom]) {\n      this[nom].setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n      this[nom + 'Gris'].setAttribute('visibility', bvisible ? 'hidden' : 'visible')\n    } else {\n      console.error(`Licone ${nom} nexiste pas`)\n    }\n  })\n}\n\n/**\n * Active l'icne rouge Continuer et dsactive les autres\n * @private\n */\nIepDoc.prototype.activeIconeContinuer = function activeIconeContinuer () {\n  this.montreIcones(['XML'])\n  // et on vire le play gris pour mettre continuer  sa place\n  this.iconPlayGris.setAttribute('visibility', 'hidden')\n  this.iconContinue.setAttribute('visibility', 'visible')\n}\n\n/**\n * Saute  la fin de l'animation\n */\nIepDoc.prototype.gotoEnd = function gotoEnd () {\n  this.animationEnCours = false\n  this.initialise()\n  this.montreIcones(['Reset', 'PrevStep', 'Restart', 'XML', 'Repeat'])\n  this.executeJusque(this.actions.length - 1)\n  this.indiceActionEnCours = this.actions.length\n}\n\n/**\n * Lance la lecture de l'animation\n */\nIepDoc.prototype.play = function play () {\n  this.animationEnCours = true\n  this.montreIcones(['Pause'])\n  if (this.actions[this.indiceActionEnCours]) {\n    this.actions[this.indiceActionEnCours].execute(false)\n  } else {\n    console.error(Error(`Pas d'action ${this.indiceActionEnCours}`), this.actions)\n  }\n}\n\n/**\n * Reprend la lecture de l'animation (aprs une action de pause contenue dans l'animation, pas un clic sur pause,  play)\n */\nIepDoc.prototype.continue = function continueAnimation () {\n  if (this.indiceActionEnCours === this.actions.length) {\n    this.gotoEnd()\n    return\n  }\n  this.iconContinue.setAttribute('visibility', 'hidden')\n  this.montreIcones(['Pause'])\n  this.animationEnCours = true\n  this.indiceActionEnCours++\n  if (this.actions[this.indiceActionEnCours]) {\n    this.actions[this.indiceActionEnCours].execute(false)\n  } else {\n    console.error(Error(`Pas d'action ${this.indiceActionEnCours}`), this.actions)\n  }\n}\n\n/**\n * Rinitialise l'animation (la remet au dbut en mode pause, utiliser restart pour rejouer du dbut), et son zoom\n */\nIepDoc.prototype.reset = function reset () {\n  this.animationEnCours = false\n  this.initialise()\n  this.montreIcones(['Play', 'NextStep', 'GotoEnd', 'XML', 'Repeat'])\n  this.indiceActionEnCours = 0\n  this.zoom(1)\n}\n\n/**\n * Redmarre l'animation  partir du dbut\n */\nIepDoc.prototype.restart = function restart () {\n  if (this.animationEnCours) {\n    this.animationEnCours = false\n    // on attend un peu pour que l'animation en cours se termine ? pourquoi 100ms ?\n    setTimeout(this.restart.bind(this), 100)\n    return\n  }\n  this.initialise()\n  this.indiceActionEnCours = 0\n  this.zoom(1)\n  this.play()\n}\n\nIepDoc.prototype.repeat = function repeat () {\n  if (this.animationEnCours) {\n    this.animationEnCours = false\n    // on attend un peu pour que l'animation en cours se termine ? pourquoi 100ms ?\n    setTimeout(this.repeat.bind(this), 100)\n    return\n  }\n  this.animationEnCours = true\n  this.animationEnBoucle = true\n  this.initialise()\n  this.montreIcones(['Pause'])\n  this.indiceActionEnCours = 0\n  this.zoom(1)\n  this.actions[0].execute(false)\n}\n\n/**\n * Met la lecture de l'animation en pause\n */\nIepDoc.prototype.pause = function pause () {\n  this.animationEnBoucle = false\n  this.animationEnCours = false\n  // On laisse 500ms pour finir l'animation en cours.\n  setTimeout(() => this.montreIcones(['Reset', 'PrevStep', 'Play', 'Restart', 'NextStep', 'GotoEnd', 'XML', 'Repeat']), 500)\n}\n\n/**\n * Passe au pas suivant (en mode pas  pas)\n */\nIepDoc.prototype.nextStep = function nextStep () {\n  const nbActions = this.actions.length\n  this.animationEnCours = false\n  if (this.indiceActionEnCours < nbActions) {\n    if (this.actions[this.indiceActionEnCours].actionVisible()) this.indiceActionEnCours++\n    else this.indiceActionEnCours = this.indiceProchaineActionVisible(this.indiceActionEnCours) + 1\n    this.executeJusque(this.indiceActionEnCours - 1)\n  }\n  const derniereAction = this.indiceActionEnCours === this.actions.length\n  const iconsToShow = ['Reset', 'PrevStep', 'Restart', 'XML', 'Repeat']\n  if (derniereAction) this.montreIcones(iconsToShow)\n  else this.montreIcones(iconsToShow.concat(['NextStep', 'GotoEnd', 'Play']))\n}\n\n/**\n * Passe au pas prcdent (en mode pas  pas)\n */\nIepDoc.prototype.prevStep = function prevStep () {\n  this.animationEnCours = false\n  // this.indiceActionEnCours--;\n  this.indiceActionEnCours = this.indicePrecedenteActionVisible(this.indiceActionEnCours - 1)\n  if (this.indiceActionEnCours > 0) this.executeJusque(this.indiceActionEnCours - 1)\n  const iconsToShow = ['Play', 'NextStep', 'GotoEnd', 'XML', 'Repeat']\n  const premiereAction = this.indiceActionEnCours === 0\n  if (premiereAction) this.montreIcones(iconsToShow)\n  else this.montreIcones(iconsToShow.concat(['Reset', 'PrevStep']))\n}\n\n/**\n * Rinitialise l'animation :\n * - cache tous les lments graphiques de la figure,\n * - rinitialise tous les outils\n * - rinitialise la position de tous les objets ou instruments qui peuvent tre translats, tourns ou zooms (points et images)\n * @private\n */\nIepDoc.prototype.initialise = function initialise () {\n  let i, el\n  const svg = this.svg\n  for (i = 0; i < svg.childNodes.length; i++) {\n    el = svg.childNodes[i]\n    if (el !== this.barreIcones) {\n      try { // Pour compatibilit avec explorer\n        svg.childNodes[i].setAttribute('visibility', 'hidden')\n      } catch (error) {\n        console.error(error)\n      }\n    }\n  }\n  for (i = 0; i < this.actions.length; i++) {\n    const action = this.actions[i]\n    if (action instanceof ActionCreation) action.objet.initialisePosition()\n  }\n  this.initialiseOutils()\n}\n\n/**\n * Retourne la visibilit de l'instrument aprs l'excution de l'action d'indice indaction\n * @private\n * @param {InstrumentAncetre} instrument\n * @param {number} indaction\n * @returns {boolean}\n */\nIepDoc.prototype.getInstrumentVisibility = function getInstrumentVisibility (instrument, indaction) {\n  if (indaction === -1) return false\n  let action\n  let visible = false\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionMontrerInstrument) {\n      if (action.instrument === instrument) visible = true\n    } else if (action instanceof ActionMasquerInstrument) {\n      if (action.instrument === instrument) visible = false\n    }\n  }\n  return visible\n}\n\n/**\n * Retourne la visibilit de l'objet aprs l'excution de l'action d'indice indaction\n * @private\n * @param {ObjetBase} objet\n * @param {number} indaction\n * @returns {boolean}\n */\nIepDoc.prototype.getObjectVisibility = function getObjectVisibility (objet, indaction) {\n  if (indaction === -1) return false\n  let action\n  let visible = false\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionMontrer) {\n      if (action.objet === objet) visible = true\n    } else if (action instanceof ActionMasquer) {\n      if (action.objet === objet) visible = false\n    }\n  }\n  return visible\n}\n\n/**\n * Fonction donnant l'tat du compas (lev ou couch) aprs l'excution\n * de l'action d'indice indaction.\n * Si le compas est couch, renvoie \"couche\", s'il est leve, renvoie \"leve\"\n * @private\n * @param {number} indaction\n * @returns {string}\n */\nIepDoc.prototype.getCompasStatus = function getCompasStatus (indaction) {\n  if (indaction === -1) return 'couche'\n  let couche = true\n  let action\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionCoucherCompas) {\n      couche = true\n    } else if (action instanceof ActionLeverCompas) {\n      couche = false\n    }\n  }\n  return couche ? 'couche' : 'leve'\n}\n\n/**\n * Retourne l'indice de la prochaine action qui aura une action visible sur la figure\n *  partir de l'indice ind\n * Si aucune action visible ne figure aprs ind, renvoie this.actions.length\n * @private\n * @param {number} ind\n * @returns {number}\n */\nIepDoc.prototype.indiceProchaineActionVisible = function indiceProchaineActionVisible (ind) {\n  if (ind >= this.actions.length) return this.actions.length - 1\n  for (let i = ind; i < this.actions.length; i++) {\n    if (this.actions[i].actionVisible()) return i\n  }\n  return this.actions.length - 1\n}\n\n/**\n * Retourne l'indice de la prcdene action qui aura une action visible sur la figure\n *  partir de l'indice ind\n * Si aucune action visible ne figure avant ind, renvoie 0\n * @private\n * @param {number} ind\n * @returns {number}\n */\nIepDoc.prototype.indicePrecedenteActionVisible = function indicePrecedenteActionVisible (ind) {\n  if (ind < 0) return 0\n  if (ind === this.actions.length) ind--\n  for (let i = ind; i >= 0; i--) {\n    if (this.actions[i].actionVisible()) return i\n  }\n  return 0\n}\n\n/**\n * Fonction montrant les instruments  leur tape de visibilit  l'tape n\n * @private\n * @param {number} n indice de la dernire action excute\n */\nIepDoc.prototype.montreInstrumentsEtape = function montreInstrumentsEtape (n) {\n  let visible = this.getInstrumentVisibility(this.compas, n)\n  if (this.compas.leve) this.compasLeve.montre(visible)\n  else this.compas.montre(visible)\n  visible = this.getInstrumentVisibility(this.crayon, n)\n  this.crayon.montre(visible)\n  visible = this.getInstrumentVisibility(this.equerre, n)\n  this.equerre.montre(visible)\n  visible = this.getInstrumentVisibility(this.rapporteur, n)\n  this.rapporteur.montre(visible)\n  visible = this.getInstrumentVisibility(this.regle, n)\n  this.regle.montre(visible)\n  visible = this.getInstrumentVisibility(this.requerre, n)\n  this.requerre.montre(visible)\n}\n\n/**\n * Excute sans animation toutes les actions de la figure jusqu' l'indice indfin compris\n * @private\n * @param {number} indfin\n */\nIepDoc.prototype.executeJusque = function executeJusque (indfin) {\n  if (indfin >= this.actions.length) return\n  this.initialise()\n  this.initialiseOutils()\n  this.animationEnCours = false\n  for (let i = 0; i <= indfin; i++) {\n    this.actions[i].execute(true) // true pour que l'excution soit immdiate\n  }\n  this.montreInstrumentsEtape(indfin)\n}\n\n/**\n * Ajoute un lment, s'il y a dj un lment avec cet id et cet objet on le remplace\n * @private\n * @param {ObjetBase} element\n */\nIepDoc.prototype.addElement = function addElement (element) {\n  const i = this.elements.findIndex(el => el.id === element.id && el.objet === element.objet)\n  if (i !== -1) this.elements[i] = element\n  else this.elements.push(element)\n}\n\n/**\n * Fonction appele dans le cas o on est sr que la liste doc.elements ne contient pas\n * dj un lment de mme id et de mme nature que element\n * @private\n * @param {ObjetBase} element\n * @throws {Error} si y'en avait un\n */\nIepDoc.prototype.pushElement = function pushElement (element) {\n  if (this.elements.some(el => el.id === element.id && el.objet === element.objet)) throw Error(`Il y a dj un lment ${element.id} dsignant le mme objet`)\n  this.elements.push(element)\n}\n\n/**\n * Retourne l'objet de elements d'id gale  id s'il y en a une et sinon null\n * Attention : Le quadrillage est le seul objet a ne pas avoir d'id et il ne peut y en avoir qu'un par figure\n * @private\n * @param {string} id\n * @param {string} nature\n * @returns {ObjetBase|null}\n */\nIepDoc.prototype.getElement = function getElement (id, nature) {\n  const found = this.elements.find(el => {\n    if (el.objet === nature) {\n      if (nature === 'quadrillage') return true // on regarde pas l'id dans ce cas\n      return el.id === id\n    }\n    return false\n  })\n  // found peut tre undefined, on veut retourner null dans ce cas\n  return found || null\n}\n\n/**\n * Remplae l'lment d'id id par e s'il y en a un, sinon retourne false\n * S'il n'y a pas dlment d'id id renvoie false\n * @private\n * @param {string} id\n * @param {ObjetBase} e\n * @returns {boolean}\n */\nIepDoc.prototype.setElement = function setElement (id, e) {\n  const i = this.elements.findIndex(el => el.id === id)\n  if (i !== -1) {\n    this.elements[i] = e\n    return true\n  }\n  return false\n}\n\n/**\n * Ajoute l'action  la liste\n * @private\n * @private\n * @param {ActionCreation} action\n */\nIepDoc.prototype.ajouteAction = function ajouteAction (action) {\n  // On donne  action un indice pour qu'elle sache quelle est son rang dans la liste\n  // Elle pourra alors indiquer si son action sur la figure est visible ou non\n  action.indice = this.actions.length\n  this.actions.push(action)\n}\n\n/**\n * Cre toutes les actions de la figure\n * @private\n */\nIepDoc.prototype.creeActions = function creeActions () {\n  let ind, el, at, ato, objet, action, forme, xcrayon, ycrayon, id,\n    angle, sens, vitesse, abs, ord, cibles, tempo, len, ecart, v1, echelle, point, cible\n  for (ind = 0; ind < this.tabact.length; ind++) {\n    el = this.tabact[ind]\n    id = getId(el)\n    at = el.getAttribute('mouvement')\n    tempo = el.getAttribute('tempo')\n    try {\n      let abscisse_bas_droite, ecartAngle // faut viter de dclarer dans un case directement, on le fait dans le bloc parent (eslint no-case-declarations)\n      switch (at) {\n        case 'creer':\n          ato = el.getAttribute('objet')\n          // Si on a dj cr un objet avec le mme id c'est une erreur et on saute la cration\n          if (this.getElement(id, ato) !== null) {\n            console.error(`L'id ${id} existe dj, action creer ignore`, ato)\n            break\n          }\n\n          if (ato != null) {\n            switch (ato) {\n              case 'point':\n                objet = new Point(this, id, parseFloat(getAbs(el)), parseFloat(getOrd(el)),\n                  getCouleur(el), getEpaisseur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'angle':\n                objet = new Angle(this, id, getAbs(el), getOrd(el), el.getAttribute('rayon'),\n                  el.getAttribute('angle1'), el.getAttribute('angle2'), getCouleur(el), getEpaisseur(el),\n                  getOpaciteFond(el), el.getAttribute('forme'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'angle_droit':\n                objet = new AngleDroit(this, id, el.getAttribute('abscisse_sommet'), el.getAttribute('ordonnee_sommet'),\n                  el.getAttribute('abscisse_inter'), el.getAttribute('ordonnee_inter'), getCouleur(el), getEpaisseur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'longueur':\n                objet = new MarqueSegment(this, id, getAbs(el), getOrd(el),\n                  getCouleur(el), getEpaisseur(el),\n                  el.getAttribute('forme'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'marque':\n                objet = new MarqueSeg(this, id, el.getAttribute('idSeg'),\n                  getCouleur(el), getEpaisseur(el),\n                  el.getAttribute('forme'), el.getAttribute('rayon'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'texte':\n                objet = new Texte(this, id, getAbs(el), getOrd(el), getCouleur(el), el.getAttribute('taille'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'repere':\n                objet = new Repere(this, el.getAttribute('hauteur'), el.getAttribute('largeur'),\n                  el.getAttribute('haut'), el.getAttribute('gauche'), el.getAttribute('Xgrad'),\n                  el.getAttribute('Ygrad'), el.getAttribute('Xmin'), el.getAttribute('Xmax'),\n                  el.getAttribute('Ymin'), el.getAttribute('Ymax'), getCouleur(el),\n                  el.getAttribute('grille'), el.getAttribute('axes'), el.getAttribute('etiquettes'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'quadrillage':\n                abscisse_bas_droite = el.getAttribute('abscisse_bas_droite')\n                if (abscisse_bas_droite != null) { // Syntaxe non documente dans la doc\n                  abscisse_bas_droite = parseFloat(abscisse_bas_droite) / 30\n                  const ordonnee_bas_droite = parseFloat(el.getAttribute('ordonnee_bas_droite')) / 30\n                  const abscisse_haut_gauche = parseFloat(el.getAttribute('abscisse_haut_gauche')) / 30\n                  const ordonnee_haut_gauche = parseFloat(el.getAttribute('ordonnee_haut_gauche')) / 30\n                  objet = new Quadrillage(\n                    this,\n                    el.getAttribute('quadrillage'),\n                    String(ordonnee_bas_droite - ordonnee_haut_gauche),\n                    String(abscisse_bas_droite - abscisse_haut_gauche),\n                    ordonnee_haut_gauche,\n                    abscisse_haut_gauche,\n                    getCouleur(el)\n                  )\n                  action = new ActionCreation(this, 'quadrillageIEP', objet, tempo)\n                } else {\n                  objet = new Quadrillage(this, el.getAttribute('quadrillage'), el.getAttribute('hauteur'),\n                    el.getAttribute('largeur'), el.getAttribute('haut'), el.getAttribute('gauche'), getCouleur(el))\n                }\n                action = new ActionCreation(this, 'quadrillageIEP', objet, tempo)\n                break\n\n              case 'axe':\n                objet = new Axe(this, el.getAttribute('pente'), el.getAttribute('largeur'),\n                  el.getAttribute('haut'), el.getAttribute('gauche'), el.getAttribute('distanceBord'),\n                  el.getAttribute('Xgrad'), el.getAttribute('Xmin'), el.getAttribute('Xmax'), getCouleur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'gabarit':\n                ecartAngle = el.getAttribute('ecart_angle')\n                if (ecartAngle === null) ecartAngle = '-30'\n                objet = new Gabarit(this, id, el.getAttribute('abscisse'), el.getAttribute('ordonnee'), el.getAttribute('rayon'),\n                  ecartAngle, getCouleur(el), getEpaisseur(el), getCouleurFond(el), getOpaciteTrait(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              default:\n                // Pour ce que j'aurais oubli d'implmenter\n                console.error('objet inconnu => cration ignore')\n                action = null\n            }\n\n            if (action) {\n              this.ajouteAction(action)\n              action.setReady()\n            }\n          }\n          break\n        case 'montrer':\n          ato = el.getAttribute('objet')\n          if (estInstrument(ato)) {\n            abs = el.getAttribute('abscisse')\n            ord = el.getAttribute('ordonnee')\n            action = new ActionMontrerInstrument(this, this[ato], abs, ord, tempo)\n            if (((ato === 'crayon') || (ato === 'compas')) && (abs != null) && (ord != null)) this[ato].translate(parseFloat(abs), parseFloat(ord))\n          } else action = new ActionMontrer(this, id, ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'masquer':\n          ato = el.getAttribute('objet')\n          if (estInstrument(ato)) action = new ActionMasquerInstrument(this, this[ato], tempo)\n          else action = new ActionMasquer(this, id, ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'tracer':\n          ato = el.getAttribute('objet')\n          cible = el.getAttribute('cible')\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            abs = objet.xcons\n            ord = objet.ycons\n          } else {\n            abs = parseFloat(getAbs(el))\n            ord = parseFloat(getOrd(el))\n          }\n          switch (ato) {\n            case 'crayon':\n              forme = el.getAttribute('forme')\n              xcrayon = this.crayon.x\n              ycrayon = this.crayon.y\n              id = getId(el)\n              switch (forme) {\n                case null: // Cas d'un segment\n                  if (isNaN(abs) || isNaN(ord)) { // Cas d'une forme libre pas dclare\n                    objet = new LigneContinue(this, id, this.crayon.x, this.crayon.y, el.getAttribute('abscisses'),\n                      el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                      getStyleTrait(el), getStyle(el))\n                    len = objet.abs.length\n                    this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n                  } else {\n                    objet = new Segment(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                      getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                    this.crayon.translate(abs, ord)\n                  }\n                  break\n                case 'droite': // Cas d'une droite\n                  if (isNaN(abs) || isNaN(ord)) break\n                  objet = new Droite(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                    getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                  this.crayon.translate(abs, ord)\n                  break\n                case 'demidroite': // Cas d'une demi-droite\n                  if (isNaN(abs) || isNaN(ord)) break\n                  objet = new DemiDroite(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                    getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                  this.crayon.translate(abs, ord)\n                  break\n                case 'polygone':\n                  cibles = el.getAttribute('cibles')\n                  if (cibles === null) {\n                    objet = new Polygone(this, id, el.getAttribute('abscisses'),\n                      el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el),\n                      getCouleurFond(el), el.getAttribute('opacite'))\n                  } else {\n                    let abs = ''\n                    let ord = ''\n                    cibles.split(',').forEach((elt, i) => {\n                      const sep = (i === 0) ? '' : ','\n                      const obj = this.getElement(elt, 'point')\n                      abs += sep + obj.xcons\n                      ord += sep + obj.ycons\n                    })\n                    objet = new Polygone(this, id, abs, ord,\n                      getCouleur(el), getEpaisseur(el),\n                      getCouleurFond(el), el.getAttribute('opacite'))\n                  }\n                  len = objet.abs.length\n                  this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n                  break\n                case 'libre':\n                  objet = new LigneContinue(this, id, this.crayon.x, this.crayon.y, el.getAttribute('abscisses'),\n                    el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                    getStyleTrait(el), getStyle(el))\n                  len = objet.abs.length\n                  this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n              }\n              vitesse = el.getAttribute('vitesse')\n              if (vitesse == null) vitesse = '4'\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'trait':\n              vitesse = el.getAttribute('vitesse')\n              if (vitesse === null) vitesse = 10000 // Instantan si vitesse pas prcis\n              objet = new Segment(this, id, el.getAttribute('abscisse1'), el.getAttribute('ordonnee1'),\n                el.getAttribute('abscisse2'), el.getAttribute('ordonnee2'), getCouleur(el),\n                getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse) // Pas d'animation pour les traits\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'compas':\n              objet = new Arc(this, id, this.compas.x, this.compas.y, this.compas.ecart,\n                this.getAngle(el, 'debut'), this.getAngle(el, 'fin'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                getStyleTrait(el))\n              vitesse = el.getAttribute('sens')\n              if (vitesse == null) vitesse = '8'\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'angle_droit': // Certains scripts utilisent tracer au lieu de crer pour les angles droits ...\n              objet = new AngleDroit(this, id, el.getAttribute('abscisse_sommet'), el.getAttribute('ordonnee_sommet'),\n                el.getAttribute('abscisse_inter'), el.getAttribute('ordonnee_inter'), getCouleur(el), getEpaisseur(el))\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n          }\n          break\n        case 'rotation':\n          ato = el.getAttribute('objet')\n          sens = el.getAttribute('sens')\n          if (estInstrument(ato)) {\n            cible = el.getAttribute('cible')\n            // Au cas ou un auteur a mis  la fois un attribut cible et un attribut angle,\n            // C'est l'attribut angle qui semble l'emporter (constat par des tests).\n            if ((cible != null) && (el.getAttribute('angle') === null)) {\n              objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n              abs = objet.xcons\n              ord = objet.ycons\n              v1 = new Vect(this[ato].x, this[ato].y, abs, ord)\n              if (v1.presqueNul()) angle = 0\n              else angle = -v1.angle()\n            } else {\n              if (ato === 'compas') angle = this.getAngle(el, 'angle')\n              else angle = el.getAttribute('angle')\n            }\n            action = new ActionRotationInstrument(this, this[ato], angle, tempo, sens)\n          } else {\n            // On vrifie que l'action est cohrente (que l'objet cible existe)\n            if (this.getElement(id, ato) === null) action = null\n            else {\n              angle = el.getAttribute('angle')\n              action = new ActionRotationObjet(this, id, angle, ato, tempo, sens)\n            }\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            action.setReady()\n          }\n          break\n        case 'translation':\n          ato = el.getAttribute('objet')\n          cible = el.getAttribute('cible')\n          // Au cas o on a spcifi abscisse et ordonne et cible, cible aa priorit\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            abs = objet.xcons\n            ord = objet.ycons\n          } else {\n            abs = parseFloat(getAbs(el))\n            ord = parseFloat(getOrd(el))\n          }\n          vitesse = el.getAttribute('vitesse')\n          if (estInstrument(ato)) {\n            this[ato].x = abs\n            this[ato].y = ord\n            action = new ActionTranslationInstrument(this, this[ato], abs, ord, tempo, vitesse)\n          } else {\n            // On vrifie que l'action est cohrente\n            if (this.getElement(id, ato) === null) action = null\n            else {\n              // Dans le cas o on translate un point il faut modifier ses champs xcons et ycons\n              // pour que tout objet ultrieur l'utilisant comme cible soit correctement initialis\n              if (ato === 'point') {\n                point = this.getElement(id, 'point')\n                point.xcons = abs\n                point.ycons = ord\n              }\n              action = new ActionTranslationObjet(this, id, abs, ord, ato, tempo, vitesse)\n            }\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            if ((ato === 'crayon') || (ato === 'compas')) { this[ato].translate(abs, ord) }\n            action.setReady()\n          }\n          break\n        case 'zoom':\n          ato = el.getAttribute('objet')\n          vitesse = el.getAttribute('vitesse')\n          if (estInstrument(ato)) {\n            echelle = el.getAttribute('echelle')\n            this[ato].zoomfactor = parseFloat(echelle) / 100\n            action = new ActionZoomInstrument(this, this[ato], echelle, tempo, vitesse)\n          } else {\n            // On ne peut zoomer que sur un texte ou une image\n            if ((ato === 'texte' || (ato === 'image'))) action = new ActionZoomObjet(this, id, el.getAttribute('echelle'), ato, tempo, vitesse)\n            else action = null\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            action.setReady()\n          }\n          break\n        case 'ecarter':\n          cible = el.getAttribute('cible')\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            v1 = new Vect(this.compas.x, this.compas.y, objet.xcons, objet.ycons)\n            ecart = v1.norme()\n          } else ecart = parseFloat(el.getAttribute('ecart')) * this.compas.zoomfactor\n          this.compas.ecart = ecart\n          action = new ActionEcarterCompas(this, ecart, tempo, el.getAttribute('vitesse'))\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'lever':\n          action = new ActionLeverCompas(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'coucher':\n          action = new ActionCoucherCompas(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n\n        case 'masquer_nombres':\n          action = new ActionMontrerNombres(this, false, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'montrer_nombres':\n          action = new ActionMontrerNombres(this, true, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'graduations':\n          ato = el.getAttribute('objet')\n          action = new ActionMontrerGraduations(this, this[ato], true, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'vide':\n          ato = el.getAttribute('objet')\n          action = new ActionMontrerGraduations(this, this[ato], false, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'retourner':\n          this.compasRetourne = !this.compasRetourne\n          action = new ActionRetourner(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'glisser':\n          action = new ActionGlisser(this, el.getAttribute('abscisse'), tempo, el.getAttribute('vitesse'))\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'chargement':\n          // Attention, pour l'image, pas d'appel de creeAction(ind+1)\n          // car c'est une fonction de callBack qui s'en charge une fois l'image charge\n          objet = new Imag(this, id, el.getAttribute('url'))\n          objet.prepareAction()\n          // Pas de action.setReady car il faut attendre que la figure soit charge\n          break\n        case 'ecrire': // Texte\n          action = new ActionEcrireTexte(\n            this,\n            id,\n            getCouleur(el),\n            el.getAttribute('taille'),\n            el.getAttribute('texte'),\n            el.getAttribute('style'),\n            getCouleurFond(el),\n            el.getAttribute('opacite_fond'),\n            getCouleurCadre(el),\n            el.getAttribute('epaisseur_cadre'),\n            el.getAttribute('marge'),\n            el.getAttribute('marge_gauche'),\n            el.getAttribute('marge_droite'),\n            el.getAttribute('marge_haut'),\n            el.getAttribute('marge_bas'),\n            tempo\n          )\n          this.ajouteAction(action)\n          action.prepare()\n          break\n        case 'nommer':\n          // on regarde si le point  nommer a t cr sinon erreur de script\n          if (this.getElement(id, 'point') !== null) {\n            // Dans certains script on nommait un point avec une chane vide ce qui n'a pas de sens.\n            const nomPoint = el.getAttribute('nom')\n            if (nomPoint !== '') {\n              objet = new NomPoint(this, id, getAbs(el), getOrd(el),\n                nomPoint, getCouleur(el))\n              action = new ActionNommerPoint(this, objet, tempo)\n              this.ajouteAction(action)\n              action.prepare()\n            }\n          }\n          break\n        case 'pause':\n          action = new ActionPause(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'modifier_longueur':\n          ato = el.getAttribute('objet')\n          action = new ActionModifierLongueur(this, this[ato], el.getAttribute('longueur'), tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n          // Modification du rayon d'un gabarit\n        case 'modifier_rayon':\n          ato = el.getAttribute('objet')\n          action = new ActionModifierRayon(this, id, el.getAttribute('rayon'), ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n      }\n    } catch (error) {\n      console.error(error)\n      // On ne fait rien si xml incorrect\n    }\n  }\n  // Une fois les actions cres on attend que les lments asynchrones soient prts pour continuer\n  this.getReadyPromise()\n    .then(this.init.bind(this))\n    .catch(error => {\n      console.error(error)\n      // eslint-disable-next-line no-alert\n      window.alert(error.message)\n    })\n}\n\n/**\n * Si immediat est true, les actions sont excutes immdiatement, sans animation et sans temporisation\n * @private\n * @param {boolean} immediat\n */\nIepDoc.prototype.execute = function execute (immediat) {\n  this.indiceActionEnCours = 0\n  this.actions[0].execute(immediat)\n}\n\n/**\n * Fonction appele lorsqu'une action a t excute pour passer  l'excution suivante.\n * Si immediat est true, on retourne sans rien faire\n * Si animationECours en false, on revient sans rien faire (pour arrter une animation en cours)\n * Si l'action.tempo n'est pas nul, on attend action.tempo millimes de seconde avant de passer  l'action suivante\n * indiceActionEnCours est l'indice de la prochaine action  excuter\n * @private\n * @param {boolean} [immediat=false]\n */\nIepDoc.prototype.actionSuivante = function actionSuivante (immediat) {\n  immediat = Boolean(immediat)\n  if (!this.animationEnCours && !immediat) {\n    // if (this.indiceActionEnCours != this.actions.length-1) this.indiceActionEnCours++;\n    return\n  } // Pas de passage  l'action suivante pour le mode pas  pas.\n  const action = this.actions[this.indiceActionEnCours]\n  if ((action.tempo === null) || immediat) {\n    this.passageActionSuivante(immediat)\n  } else {\n    setTimeout(this.passageActionSuivante.bind(this, immediat), action.tempo)\n  }\n}\n\n/**\n * Fonction appele par actionSuivante pour passer  l'action suivante\n * indiceActionEnCours est l'indice de la prochaine action  excuter\n * @private\n * @param {boolean} [immediat=false]\n */\nIepDoc.prototype.passageActionSuivante = function passageActionSuivante (immediat) {\n  // IL peut arriver qu'on arrive ici alors qu'on a cliqu pour arrter une animation, cliqu rapidement\n  // pour aller  la fin alors que l'animation n'tait pas finie...\n  if (this.indiceActionEnCours >= this.actions.length) return\n  if (this.indiceActionEnCours !== this.actions.length - 1) {\n    this.indiceActionEnCours++\n    this.actions[this.indiceActionEnCours].execute(immediat)\n  } else {\n    if (this.animationEnBoucle) {\n      const me = this\n      setTimeout(function () {\n        me.initialise()\n        me.indiceActionEnCours = 0\n        me.actions[me.indiceActionEnCours].execute(immediat)\n      }, 3000) // On attend 3 secondes avant de reboucler\n    } else {\n      this.indiceActionEnCours++\n      this.montreIcones(['Reset', 'PrevStep', 'Restart', 'XML', 'Repeat'])\n      this.animationEnCours = false\n    }\n  }\n}\n\n/**\n * Retourne l'attribut angle d'une action\n * @private\n * @param {Element} el element retourn par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nIepDoc.prototype.getAngle = function getAngle (el, attribute) {\n  const a = el.getAttribute(attribute)\n  if (a == null) return null\n  if (this.compasRetourne) return String(parseFloat(a) + 180)\n  return a\n}\n\n/**\n * Fonction rajoutant dans le svg parent des dfinitions defs qui serot utilises\n * plusieurs fois dans les icnes (radialGradiant et marker pour la flche de l'icne restart.\n * On les mets dans le svg barreIcones pour qu'il ne soient pas effacs lors de initialise()\n * @private\n */\nIepDoc.prototype.creeElementsPourIcones = function creeElementsPourIcones () {\n  let defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#9999FF', '#000099', 'radialfonce'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#CCCCCC', '#666666', 'radialclair'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#FF9999', '#FF0000', 'radialrouge'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.markerArrow('markerarrow'))\n  this.barreIcones.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.filtreEclairageIcone('filtrebleu'))\n  this.barreIcones.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.filtreEclairageIcone('filtregris'))\n  this.barreIcones.appendChild(defs)\n}\n\n/**\n * Retourne un radialGradiant utilis pour le dessin des icnes\n * @param {string} clair la couleur claire de gradiant\n * @param {string} fonce  la couleur foce du gradiant\n * @param {string} id l'id du gradiant\n * @private\n * @returns {SVGRadialGradientElement}\n */\nIepDoc.prototype.radialGradiant = function radialGradiant (clair, fonce, id) {\n  const rg = document.createElementNS(svgns, 'radialGradient')\n  rg.setAttribute('id', id)\n  let stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color:' + fonce + ';')\n  rg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '80%')\n  stop.setAttribute('style', 'stop-color:' + clair + ';')\n  rg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-color:' + fonce + ';')\n  rg.appendChild(stop)\n  return rg\n}\n\n/**\n * Retourne un marker qui sera utilis pour la flche de l'icne restart\n * @private\n * @param {string} id L'id du marker\n * @returns {SVGMarkerElement}\n */\nIepDoc.prototype.markerArrow = function markerArrow (id) {\n  const marker = document.createElementNS(svgns, 'marker')\n  marker.setAttribute('id', id)\n  marker.setAttribute('markerWidth', '4')\n  marker.setAttribute('markerHeight', '4')\n  marker.setAttribute('refX', '0')\n  marker.setAttribute('refY', '2')\n  marker.setAttribute('orient', 'auto')\n  const pathm = document.createElementNS(svgns, 'path')\n  pathm.setAttribute('d', 'M 0 0 2 2 0 4 Z')\n  pathm.setAttribute('style', 'fill:white;')\n  marker.appendChild(pathm)\n  return marker\n}\n\n/**\n * Foncion renvoyant un filtre qui sera utilis pour donner un aspect de relief aux icnes\n * creeElementsPourIcones\n * @private\n * @param {string} id L'id du filtre\n * @returns {SVGFilterElement}\n */\nIepDoc.prototype.filtreEclairageIcone = function filtreEclairageIcone (id) {\n  const filter = document.createElementNS(svgns, 'filter')\n  filter.setAttribute('x', '0')\n  filter.setAttribute('y', '0')\n  filter.setAttribute('width', '100%')\n  filter.setAttribute('height', '100%')\n  filter.setAttribute('color-interpolation-filters', 'sRGB')\n  const dl = document.createElementNS(svgns, 'feDiffuseLighting')\n  dl.setAttribute('lighting-color', 'white')\n  dl.setAttribute('surfaceScale', '1')\n  dl.setAttribute('diffuseConstant', '1.2')\n  dl.setAttribute('in', 'SourceGraphic')\n  dl.setAttribute('result', 'diffOut')\n  const pointLight = document.createElementNS(svgns, 'fePointLight')\n  pointLight.setAttribute('x', '5')\n  pointLight.setAttribute('y', '5')\n  pointLight.setAttribute('z', '15')\n  dl.appendChild(pointLight)\n  filter.appendChild(dl)\n  const fc = document.createElementNS(svgns, 'feComposite')\n  fc.setAttribute('in', 'SourceGraphic')\n  fc.setAttribute('in2', 'diffOut')\n  fc.setAttribute('operator', 'arithmetic')\n  fc.setAttribute('k1', '1')\n  fc.setAttribute('k2', '0')\n  fc.setAttribute('k3', '0')\n  fc.setAttribute('k4', '0')\n  filter.appendChild(fc)\n  filter.setAttribute('id', id)\n  return filter\n}\n\n/**\n * Retourne une fentre contenant le code XML de la figure\n * @private\n * @return {Window}\n */\nIepDoc.prototype.popup = function popup () {\n  // ouvre une fenetre sans barre d'etat, ni d'ascenceur\n  const w = window.open('', 'popup', 'width=700,height=450,toolbar=no,scrollbars=no,resizable=yes')\n  w.iepDoc = this\n  const doc = w.document\n  doc.title = 'Code Xml de la figure'\n  const div = doc.createElement('div')\n  const form = doc.createElement('form')\n  div.appendChild(form)\n  div.setAttribute('align', 'center')\n  doc.body.appendChild(div)\n  const ta = doc.createElement('textarea')\n  form.appendChild(ta)\n  ta.setAttribute('cols', 80)\n  ta.setAttribute('rows', 25)\n  ta.setAttribute('readonly', true)\n  ta.style.fontSize = '13px'\n  ta.scrollIntoView()\n  // Si le script ne comporte pas de retours  la ligne (une seule ligne), on en rajoute\n  let ch = this.codexml\n  ch = ch.replace(/>\\s*</g, '>\\n<')\n  ta.appendChild(document.createTextNode(ch))\n  ta.select()\n  // w.onbeforeunload = function(){this.iepDoc.windowxml = null;};\n  const iepDoc = this\n  w.addEventListener('unload', () => { iepDoc.windowxml = null })\n  return w\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport IepDoc from './IepDoc.js'\nexport default IepApp\n\n/**\n * Provoque la fermeture des ventuelles fentres popup ( priori onglets du navigateur)\n * contenant le code XML d'une figure (obtenues en cliquant sur l'icne XML)\n * Appel  la fermeture d'une fentre contenant un lecteur\n * @private\n */\nfunction closeAllXMLWindows (iepApp) {\n  iepApp.docs.forEach(doc => {\n    if (doc.windowxml) doc.windowxml.close()\n  })\n}\n\n/**\n * Lecteur d'animations, qui peut grer plusieurs figures instrumenPoche dans des svg diffrents\n * @param {Object} [options]\n * @param {boolean} [options.debug] passer true pour avoir des infos de debug en console\n * @constructor\n */\nfunction IepApp (options) {\n  this.debug = Boolean(options && options.debug)\n  if (this.debug) console.debug('Mode debug activ')\n  this.docs = []\n  window.addEventListener('unload', closeAllXMLWindows.bind(null, this))\n}\n\n/**\n * Ajoute une animation au lecteur\n * @param {string|Element} svg Le svg (l'lment du dom ou son id) dans lequel va se jouer l'animation\n * @param {string} xml La chane XML du script de l'animation\n * @param {boolean} [autoStart=true] Passer false pour ne pas dmarrer l'animation ds le chargement\n */\nIepApp.prototype.addDoc = function addDoc (svg, xml, autoStart = true) {\n  if (typeof svg === 'string') svg = document.getElementById(svg)\n  if (!svg) return new Error('svg manquant')\n  if (svg.localName !== 'svg') return new Error('svg incorrect')\n  const options = {\n    autoStart,\n    debug: this.debug\n  }\n  const doc = new IepDoc(svg, xml, options)\n  this.docs.push(doc)\n  svg.iepDoc = doc // Pour que les boutons accdent au document.\n  return doc\n}\n\n/**\n * Supprime toutes les animations passes au lecteur\n */\nIepApp.prototype.flush = function flush () {\n  // on ferme les fentres xml ventuelles\n  closeAllXMLWindows(this)\n  // on vire tous les svg du dom\n  this.docs.forEach(({ svg }) => {\n    if (svg.parentNode) svg.parentNode.removeChild(svg)\n    else console.error('le svg', svg, 'na pas de parentNode')\n  })\n  // et on vire les docs de iepApp\n  this.docs = []\n}\n\n/**\n * Retourne les animations du lecteur\n * @return {IepDoc[]}\n */\nIepApp.prototype.getDocs = function getDocs () {\n  return this.docs\n}\n/**\n * Retourne la dernire animation ajoute (null si addDoc n'a pas t appel, depuis sa cration ou le dernier flush)\n * @return {IepDoc}\n */\nIepApp.prototype.getLastDoc = function getLastDoc () {\n  const length = this.docs.length\n  if (!length) return null\n  return this.docs[length - 1]\n}\n","/* Loader qui retourne une promesse\n *\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Association Ssamath\n * @licence AGPL-3.0-or-later\n */\nimport IepApp from './app/IepApp.js'\nimport sjtDom from 'sesajstools/dom/index.js'\n\nimport '../styles/iep.css'\n\nconst { addElement, empty, setStyles } = sjtDom\n\n// pour avoir un singleton sur l'appli\nlet iepApp\n\n//  propos de viewbox & viewport\n// https://la-cascade.io/comprendre-svg-viewbox-et-viewport/\n// https://developer.mozilla.org/fr/docs/Web/SVG/Attribute/viewBox\n// https://la-cascade.io/comprendre-svg-viewbox/\n// https://la-cascade.io/comprendre-svg-preserveaspectratio/\n// attention aussi  svg.style.width qui prend le pas sur svg.width\n// c'est le constructeur IepDoc qui va set le viewBox\n\n// il y a eu une version avec du resize auto dans le commit 8a3db59\n// https://framagit.org/Sesamath/instrumenpoche/-/blob/8a3db5973b1e517316e63d0790f14d7a8abe0cfe/sources/iepLoaderPromise.js\n// (voir aussi cette version pour l'usage de https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver sur le svg)\n// a donnait des rsultats rigolos par ex avec http://localhost:8081/#xml1 (aprs avoir lanc `pnpm start`)\n// et a montre qu'il y a plein d'animations iep existantes avec du monde cach hors du viewport\n// Il y a aussi parfois la rgle qui sort du cadre, et on ne veut pas rduire l'animation pour la voir en entier.\n// => on abandonne cette ide de resize auto d'aprs svg.getBBox()\n\n/**\n * Retourne le svg cr avec les bonnes options\n * @private\n * @param {HTMLElement} container\n * @return {SVGElement} le svg\n */\nfunction addSvg (container) {\n  // pour crer le svg, addElement marche pas (il reste  0 de hauteur), il faut passer par createElementNS\n  // et surtout pas mettre de https sur le ns !\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n  // faut viter d'utiliser la proprit className avec du svg (https://developer.mozilla.org/fr/docs/Web/API/Element/className#Notes)\n  // mais y'a pas de pb avec https://developer.mozilla.org/fr/docs/Web/API/Element/classList\n  svg.classList.add('svgIep')\n  container.appendChild(svg)\n\n  // au resize du conteneur faut resize le svg, mais l'vnement resize n'existe que sur window\n  // (y'a bien Resize Observer mais c'est pas encore dans la spec, trop frais)\n  // => on met le svg en 100% et il suivra le div tout seul (c'est IepDoc qui fixe la viewBox)\n  // et on a plus besoin de listener sur le resize\n  setStyles(svg, {\n    margin: 0,\n    padding: 0,\n    // avec 100% on a des pbs de clignotement des ascenseurs,  98% jamais d'ascenseur et a ajoute un peu de marge, pas plus mal\n    width: '98%',\n    height: '98%'\n  })\n\n  return svg\n}\n\n/**\n * Ajoute les boutons de zoom\n * @private\n * @param {HTMLElement} svg\n * @return {Promise<HTMLElement>}\n */\nfunction addZoom (svg) {\n  const container = svg.parentNode\n  // on le rend resizable (cf https://developer.mozilla.org/en-US/docs/Web/CSS/resize et https://caniuse.com/#feat=css-resize)\n  container.style.resize = 'both'\n  container.style.padding = '0'\n  container.style.border = '1px solid black'\n\n  const styleBtn = {\n    position: 'absolute',\n    zIndex: 99,\n    textAlign: 'center',\n    padding: 0,\n    width: '2.5em',\n    height: '1.8em',\n    left: '0.1em'\n  }\n  const buttonZoomIn = addElement(container, 'button', { style: { ...styleBtn, top: '0.1em' } }, '+')\n  buttonZoomIn.addEventListener('click', () => svg.iepDoc.zoom(1.1), false)\n  const buttonZoomOut = addElement(container, 'button', { style: { ...styleBtn, top: '2em' } }, '-')\n  buttonZoomOut.addEventListener('click', () => svg.iepDoc.zoom(0.9), false)\n  // const buttonZoomNone = addElement(container, 'button', { style: { ...styleBtn, top: '4em' } }, '=')\n  // buttonZoomNone.addEventListener('click', () => svg.iepDoc.zoom(1), false)\n}\n\n//  priori plus besoin\n// function getSize (elt) {\n//   const st = getComputedStyle(elt)\n//   const width = Math.max(100, parseInt(st.width, 10) || 800)\n//   const height = Math.max(0.5 * width, parseInt(st.height, 10) || 600)\n//   return { width, height }\n// }\n\nfunction loadXml (url) {\n  // faut charger le xml externe, on check que c'est faisable\n  if (window.location.protocol === 'https:' && url.substr(0, 5) === 'http:') {\n    return Promise.reject(Error(`Impossible de charger ici un script externe qui nest pas en https (${url})`))\n  }\n  return fetch(url, { Accept: 'text/xml' }).catch(error => {\n    // on catch les erreurs rseau (pas de rseau, pb de cross domain, etc.)\n    // pour renvoyer une erreur plus comprhensible\n    console.error(error)\n    throw Error(`Impossible de rcuprer le xml ${url}`)\n  }).then(response => {\n    const { status, statusText, ok } = response\n    if (status > 399) throw Error(`Impossible de rcuprer le xml ${url} (erreur ${status} ${statusText})`)\n    if (!ok) throw Error(`Impossible de rcuprer le xml ${url}`)\n    return response.text()\n  }).then(xml => {\n    if (!xml || !/<INSTRUMENPOCHE/.test(xml)) throw Error(`Lurl ${url} ne retourne pas de script instrumenpoche en xml`)\n    return xml\n  })\n}\n\n/**\n * @typedef iepLoadOptions\n * @property {boolean} [autostart=true] Passer false pour que l'animation ne dmarre pas ds son chargement\n * @property {boolean} [debug=false] Passer true pour voir passer les infos de debug en console\n * @property {boolean} [zoom=false] Passer true pour ajouter les boutons de zoom (dans le parent du svg)\n */\n\n/**\n * Charge une animation iep et retourne une promesse\n * @module\n * @param {HTMLElement} container\n * @param {string} xml Le script xml ou son url (absolue !)\n * @param {iepLoadOptions} [options]\n * @return {Promise<IepApp>} Promesse rejete en cas de problme (container ou xml invalide par ex)\n */\nasync function iepLoadPromise (container, xml, options) {\n  if (typeof options !== 'object') options = {}\n\n  if (typeof window === 'undefined' || !window.document) throw Error('iepLoad doit tre utilis dans un navigateur')\n  if (typeof container === 'string') container = document.getElementById(container)\n  if (!(container instanceof HTMLElement)) throw Error('Conteneur html manquant')\n  if (typeof xml !== 'string') throw Error('Script xml manquant')\n  if (/^http/.test(xml)) {\n    xml = await loadXml(xml)\n  }\n  if (!xml || !/<INSTRUMENPOCHE/.test(xml)) throw Error('Ce nest pas un script instrumenpoche valide')\n  // Il y a bcp de scripts existants contenant des images en http://*.sesamath.net/\n  // pour ceux-l on passe en https\n  if (window.location.protocol === 'https:') {\n    xml = xml.replace(/http:\\/\\/([a-z]+.sesamath.net)/g, (strMatched, domain) => `https://${domain}`)\n  }\n  // tant pis pour les autres, a se chargera pas\n\n  // on ne fixe plus de taille (ni div ni svg, le svg va s'adapter)\n  // const width = options.width || container.offsetWidth || 800\n  // const height = options.height || width * 0.75 || 600\n\n  // On rinitialise le conteneur\n  empty(container)\n  // que l'on positionne (pour que le absolute des enfants se fasse par rapport  lui), avec d'ventuels scroll\n  // (Il y avait avant 'font-weight': 'normal', 'font-family': '\"Times New Roman\", Times, serif' qui a t vir pour utilisation MathJax 3\n  setStyles(container, { position: 'relative', overflow: 'auto' })\n\n  const svg = addSvg(container)\n  const iepOptions = {}\n  if (options.debug) iepOptions.debug = true\n  if (!iepApp) iepApp = new IepApp(iepOptions)\n  const autostart = typeof options.autostart === 'boolean' ? options.autostart : true\n  iepApp.addDoc(svg, xml, autostart)\n  // il faut ajouter le zoom aprs le script iep, car il utilise la viewBox mise par IepDoc sur le svg\n  if (options.zoom) addZoom(svg)\n  return iepApp\n}\n\nexport default iepLoadPromise\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Association Ssamath\n * @licence AGPL-3.0-or-later\n */\n\nconst loadDelay = 60 // en s\n\n// On charge le mme MathJax que mathgraph32\nconst mathJaxUrl = 'https://www.mathgraph32.org/js/MathJax3/es5/tex-svg.js'\n\n/* la config, on avait en v2 le js\nhttps://www.mathgraph32.org/ftp/js/MathJax/MathJax.js?config=TeX-AMS-MML_SVG-full\navec la config :\n MathJax.Hub.Config({\n  tex2jax: {\n    inlineMath: [\n      ['$', '$'],\n      ['\\\\(', '\\\\)']\n    ]\n  },\n  SVG: {\n    mtextFontInherit: false\n  },\n  jax: ['input/TeX', 'output/SVG'],\n  TeX: {\n    extensions: ['color.js']\n  },\n  messageStyle: 'none'\n})\nqui donne, via https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html\ncette conf v3\n */\nconst mathJaxConfig = {\n  tex: {\n    inlineMath: [\n      ['$', '$'],\n      ['\\\\(', '\\\\)']\n    ],\n    // packages: {'[+]': ['noerrors', 'color']}\n    packages: { '[+]': ['color', 'unicode'] }\n  },\n  svg: {\n    // cf http://docs.mathjax.org/en/latest/options/output/svg.html#the-configuration-block\n    mtextInheritFont: true\n  },\n  options: {\n    ignoreHtmlClass: 'tex2jax_ignore',\n    processHtmlClass: 'tex2jax_process'\n  },\n  loader: {\n    // la conversion donnait a\n    // load: ['input/tex', 'output/svg']\n    // mais a marchait pas, c'est bcp mieux avec\n    load: ['[tex]/noerrors', '[tex]/color', '[tex]/unicode']\n  }\n}\n\n// si on fait deux appels trs rapprochs  loadMathJax,\n// on peut se retrouver dans le cas o le 2e retourne Promise.resolve() alors que MathJax n'est pas encore ready\nlet mathJaxLoadingPromise\n\n/**\n * Charge mathjax dans le <head> de la page courante\n * (appel par le prepare de ActionEcrireTexte et ActionNommerPoint,\n * donc dclenche le chargement ds que le tableau des actions est construit,\n * seulement si l'une des actions a besoin de Mathjax)\n * @return {Promise}\n */\nexport default function loadMathJax () {\n  // si on a dj t appel y'a rien  faire (c'est peut-tre encore en cours ou dj rsolu)\n  if (mathJaxLoadingPromise) return mathJaxLoadingPromise\n\n  // faut le charger\n  mathJaxLoadingPromise = new Promise((resolve, reject) => {\n    // si qqun d'autre a dj charg MathJax (iep dans un nud j3p prcdent par ex),\n    // pas la peine de le refaire si c'est la bonne version\n    if (typeof MathJax === 'object' && /^3\\./.test(MathJax.version)) {\n      // on force notre config, au cas o qqun l'aurait configur diffremment\n      // cf http://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded\n      MathJax.config = mathJaxConfig\n      // c'est tout bon\n      return resolve()\n    }\n\n    // faut charger MathJax\n    window.MathJax = mathJaxConfig\n    /* global MathJax */\n    // on ajoute la rsolution de la promesse quand il sera prt\n    // cf http://docs.mathjax.org/en/latest/web/configuration.html#performing-actions-during-startup\n    MathJax.startup = {\n      ready: () => {\n        // on vire le timeout\n        clearTimeout(timeout)\n        MathJax.startup.defaultReady()\n        MathJax.startup.promise.then(() => {\n          // on rsoud la promesse que retourne loadMathJax maintenant que MathJax est ready\n          resolve()\n        })\n      } // ready\n    } // window.MathJax.startup\n\n    // chargement mathjax\n    const eltScript = document.createElement('script')\n    eltScript.type = 'text/javascript'\n    // sinon ff rle avec du :\n    // La demande daccs aux cookies ou au stockage sur  https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/noerrors.js  a t bloque parce que nous bloquons toutes les demandes daccs au stockage par des sites tiers et que le blocage de contenu est activ.\n    // ce qui est curieux car il n'y a aucune demande\n    eltScript.crossOrigin = 'anonymous'\n    const url = window.mathJax3BaseUrl\n      ? `${window.mathJax3BaseUrl}es5/tex-svg.js`\n      : mathJaxUrl\n    eltScript.src = url\n    const head = document.getElementsByTagName('head')[0]\n    head.appendChild(eltScript)\n    // on ajoute un timeout de chargement\n    const timeout = setTimeout(() => {\n      reject(Error(`Mathjax non charg aprs ${loadDelay}s dattente (${url})`))\n    }, loadDelay * 1000)\n  })\n\n  return mathJaxLoadingPromise\n} // loadMathJax\n"],"file":"instrumenpoche-Cz8xuUm-.js"}