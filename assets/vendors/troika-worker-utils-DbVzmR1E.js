function b(){var e=Object.create(null);function t(n,r){var a=n.id,l=n.name,u=n.dependencies;u===void 0&&(u=[]);var i=n.init;i===void 0&&(i=function(){});var o=n.getTransferables;if(o===void 0&&(o=null),!e[a])try{u=u.map(function(s){return s&&s.isWorkerModule&&(t(s,function(v){if(v instanceof Error)throw v}),s=e[s.id].value),s}),i=d("<"+l+">.init",i),o&&(o=d("<"+l+">.getTransferables",o));var f=null;typeof i=="function"?f=i.apply(void 0,u):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:f,getTransferables:o},r(f)}catch(s){s&&s.noLog||console.error(s),r(s)}}function c(n,r){var a,l=n.id,u=n.args;(!e[l]||typeof e[l].value!="function")&&r(new Error("Worker module "+l+": not found or its 'init' did not return a function"));try{var i=(a=e[l]).value.apply(a,u);i&&typeof i.then=="function"?i.then(o,function(f){return r(f instanceof Error?f:new Error(""+f))}):o(i)}catch(f){r(f)}function o(f){try{var s=e[l].getTransferables&&e[l].getTransferables(f);(!s||!Array.isArray(s)||!s.length)&&(s=void 0),r(f,s)}catch(v){console.error(v),r(v)}}}function d(n,r){var a=void 0;self.troikaDefine=function(u){return a=u};var l=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+r+`
)`],{type:"application/javascript"}));try{importScripts(l)}catch(u){console.error(u)}return URL.revokeObjectURL(l),delete self.troikaDefine,a}self.addEventListener("message",function(n){var r=n.data,a=r.messageId,l=r.action,u=r.data;try{l==="registerModule"&&t(u,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),l==="callModule"&&c(u,function(i,o){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},o||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function W(e){var t=function(){for(var c=[],d=arguments.length;d--;)c[d]=arguments[d];return t._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var c=e.dependencies,d=e.init;c=Array.isArray(c)?c.map(function(r){return r&&(r=r.onMainThread||r,r._getInitResult&&(r=r._getInitResult())),r}):[];var n=Promise.all(c).then(function(r){return d.apply(null,r)});return t._getInitResult=function(){return n},n},t}var M=function(){var e=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),e=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return M=function(){return e},e},E=0,R=0,y=!1,g=Object.create(null),m=Object.create(null),h=Object.create(null);function T(e){if((!e||typeof e.init!="function")&&!y)throw new Error("requires `options.init` function");var t=e.dependencies,c=e.init,d=e.getTransferables,n=e.workerId,r=W(e);n==null&&(n="#default");var a="workerModule"+ ++E,l=e.name||a,u=null;t=t&&t.map(function(o){return typeof o=="function"&&!o.workerModuleData&&(y=!0,o=T({workerId:n,name:"<"+l+"> function dependency: "+o.name,init:`function(){return (
`+w(o)+`
)}`}),y=!1),o&&o.workerModuleData&&(o=o.workerModuleData),o});function i(){for(var o=[],f=arguments.length;f--;)o[f]=arguments[f];if(!M())return r.apply(void 0,o);if(!u){u=p(n,"registerModule",i.workerModuleData);var s=function(){u=null,m[n].delete(s)};(m[n]||(m[n]=new Set)).add(s)}return u.then(function(v){var k=v.isCallable;if(k)return p(n,"callModule",{id:a,args:o});throw new Error("Worker module function was called but `init` did not return a callable function")})}return i.workerModuleData={isWorkerModule:!0,id:a,name:l,dependencies:t,init:w(c),getTransferables:d&&w(d)},i.onMainThread=r,i}function L(e){m[e]&&m[e].forEach(function(t){t()}),g[e]&&(g[e].terminate(),delete g[e])}function w(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function I(e){var t=g[e];if(!t){var c=w(b);t=g[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),t.onmessage=function(d){var n=d.data,r=n.messageId,a=h[r];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete h[r],a(n)}}return t}function p(e,t,c){return new Promise(function(d,n){var r=++R;h[r]=function(a){a.success?d(a.result):n(new Error("Error in worker "+t+" call: "+a.error))},I(e).postMessage({messageId:r,action:t,data:c})})}export{T as d,L as t};
//# sourceMappingURL=troika-worker-utils-DbVzmR1E.js.map
