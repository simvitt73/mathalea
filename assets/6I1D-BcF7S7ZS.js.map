{"version":3,"file":"6I1D-BcF7S7ZS.js","sources":["../../src/exercices/6e/6I1D.ts"],"sourcesContent":["import 'blockly/blocks'\nimport * as Blockly from 'blockly/core'\nimport { javascriptGenerator } from 'blockly/javascript'\nimport * as En from 'blockly/msg/en'\nimport { ajouteFeedback } from '../../lib/interactif/questionMathLive'\nimport { context } from '../../modules/context'\nimport { runAStar } from '../../modules/findPath'\nimport { listeQuestionsToContenu, randint } from '../../modules/outils'\nimport Exercice from '../Exercice'\n\nexport const titre = \"Programmer le d√©placement d'un bus\"\nexport const dateDePublication = '15/07/2025'\n\nexport const interactifReady = true\nexport const interactifType = 'custom'\n\ndeclare module 'blockly/core' {\n  interface Workspace {\n    idkey?: string\n  }\n}\n\n/**\n * Programmer la construction d‚Äôun chemin simple : New programme de 6eme 2025\n * @author Mickael Guironnet\n */\n\nexport const uuid = 'f320c'\n\nexport const refs = {\n  'fr-fr': ['6I1D'],\n  'fr-2016': ['6I15'],\n  'fr-ch': [],\n}\nexport default class ExerciceLabyrintheChemin extends Exercice {\n  destroyers: (() => void)[] = []\n\n  constructor() {\n    super()\n    this.nbQuestions = 2\n    this.besoinFormulaireNumerique = [\n      'Nombre de lignes du labyrinthe (entre 2 et 8 ou bien 1 si vous laissez le hasard d√©cider)',\n      8,\n    ]\n    this.besoinFormulaire2Numerique = [\n      'Nombre de colonnes du labyrinthe (entre 2 et 8 ou bien 1 si vous laissez le hasard d√©cider)',\n      8,\n    ]\n    this.sup = 5\n    this.sup2 = 4\n  }\n\n  destroy() {\n    // MGu quan l'exercice est supprim√© par svelte : bouton supprim√©\n    this.destroyers.forEach((destroy) => destroy())\n    this.destroyers.length = 0\n  }\n\n  nouvelleVersion(): void {\n    // MGu quand l'exercice est modifi√©, on d√©truit les anciens listeners\n    this.destroyers.forEach((destroy) => destroy())\n    this.destroyers.length = 0\n    for (\n      let q = 0, cpt = 0, texte, texteCorr: string;\n      q < this.nbQuestions && cpt < 50;\n      cpt++\n    ) {\n      const nbL =\n        this.sup === 1 ? randint(2, 5) : Math.min(Math.max(2, this.sup), 5)\n      const nbC =\n        this.sup === 1 ? randint(3, 5) : Math.min(Math.max(3, this.sup2), 5)\n      const startCol = randint(0, nbC - 1)\n      const endCol = randint(0, nbC - 1, [startCol])\n      const parcours = this.generatePath(nbC, nbL, 0, startCol, nbL - 1, endCol)\n      const villeDepart =\n        parcours.villeParCoord[startCol][0] || 'Ville de d√©part'\n      const villeArrivee =\n        parcours.villeParCoord[endCol][nbL - 1] || \"Ville d'arriv√©e\"\n      texte = `Retrouver les instructions pour repr√©senter le parcours d'un bus entre ${villeDepart} et ${villeArrivee}.<br>`\n\n      if (context.isHtml) {\n        texte += this.generateGrapheSVG(\n          `${this.numeroExercice}_${q}`,\n          nbC,\n          nbL,\n          0,\n          startCol,\n          nbL - 1,\n          endCol,\n          parcours,\n        )\n      } else {\n        texte += this.generateGrapheTikz(\n          `${this.numeroExercice}_${q}`,\n          nbC,\n          nbL,\n          0,\n          startCol,\n          nbL - 1,\n          endCol,\n          parcours,\n        )\n      }\n      texteCorr =\n        'Le bus part du lieu : ' +\n        parcours.villeParCoord[startCol][0] +\n        ' et arrive au lieu : ' +\n        parcours.villeParCoord[endCol][nbL - 1] +\n        '.<br>'\n      texteCorr += 'Le bus suit le chemin suivant :<br>'\n      texteCorr +=\n        parcours.path\n          .map((p) => `${parcours.villeParCoord[p[0]][p[1]]}`)\n          .join(' ‚Üí ') + '<br>'\n      texteCorr +=\n        'Voici une solution possible des instructions pour le trajet du bus :<br>'\n      createSolutionStr(parcours.edges).forEach((instruction, index) => {\n        const parts = instruction.split('-')\n        const lieu = parts.length > 1 ? parts[1].trim() : instruction.trim()\n        texteCorr += `${index + 1} - ${lieu}<br>`\n      })\n      if (this.interactif) {\n        texte += `<div class=\"ml-2 py-2\" id=\"resultatCheckEx${this.numeroExercice}Q${q}\"></div>`\n        texte += ajouteFeedback(this, q)\n      }\n\n      /****************************************************/\n      if (this.questionJamaisPosee(q, texte)) {\n        this.listeQuestions[q] = texte\n        this.listeCorrections[q] = texteCorr\n        q++\n      }\n      listeQuestionsToContenu(this)\n    }\n  }\n\n  generatePath(\n    cols: number,\n    rows: number,\n    rowsStart: number,\n    colsStart: number,\n    rowsEnd: number,\n    colsEnd: number,\n  ): {\n    path: number[][]\n    edges: { from: number[]; to: number[] }[]\n    villeParCoord: string[][]\n  } {\n    const start: [number, number] = [colsStart, rowsStart]\n    const end: [number, number] = [colsEnd, rowsEnd]\n\n    const cityList = [\n      'le stade',\n      'la boulangerie',\n      'la patisserie',\n      \"l'√©cole\",\n      'la poste',\n      'la mairie',\n      'le fleuriste',\n      'le garagiste',\n      'la gare',\n      'la piscine',\n      'la pharmacie',\n      \"l'h√¥pital\",\n      'la banque',\n      'la librairie',\n      'le cin√©ma',\n      'le mus√©e',\n      'les pompiers',\n      'le march√©',\n      'le restaurant',\n      \"l'h√¥tel\",\n      'la laverie',\n      'le parking',\n      'la caserne',\n      'la station-service',\n      'le Bar',\n    ]\n\n    const getCityName = (() => {\n      const used = new Set()\n      return () => {\n        let name\n        do {\n          name = cityList[randint(0, cityList.length - 1)]\n        } while (used.has(name))\n        used.add(name)\n        return name\n      }\n    })()\n\n    function generateSimplePath(\n      start: [number, number],\n      end: [number, number],\n    ) {\n      let [x, y] = start\n      const [targetX, targetY] = end\n      const result = [[x, y]]\n\n      // Calcule les d√©placements n√©cessaires\n      const dx = targetX - x\n      const dy = targetY - y\n\n      // Liste de mouvements √† effectuer (pas √† pas)\n      const steps: Array<[number, number]> = []\n\n      for (let i = 0; i < Math.abs(dx); i++) {\n        steps.push([Math.sign(dx), 0])\n      }\n      for (let i = 0; i < Math.abs(dy); i++) {\n        steps.push([0, Math.sign(dy)])\n      }\n\n      // M√©lange al√©atoire de l'ordre des pas\n      for (let i = steps.length - 1; i > 0; i--) {\n        const j = randint(0, i)\n        const temp = steps[i]\n        steps[i] = steps[j]\n        steps[j] = temp\n      }\n\n      // Applique les mouvements\n      for (const [dx, dy] of steps) {\n        x += dx\n        y += dy\n        result.push([x, y])\n      }\n\n      return result\n    }\n\n    let path: number[][]\n    const paths2 = runAStar(rows, cols, rowsStart, colsStart, rowsEnd, colsEnd)\n    if (paths2) {\n      paths2.sort((a, b) => b.length - a.length) // On trie les chemins du plus court au plus long...\n      path = paths2[randint(0, paths2.length - 1)].map((node) => [\n        node.x,\n        node.y,\n      ])\n    } else {\n      path = generateSimplePath(start, end)\n    }\n\n    const edges: { from: number[]; to: number[] }[] = []\n    for (let i = 0; i < path.length - 1; i++) {\n      const from = path[i]\n      const to = path[i + 1]\n      edges.push({ from, to })\n    }\n\n    const villeParCoord: string[][] = []\n    for (let x = 0; x < cols; x++) {\n      villeParCoord[x] = []\n      for (let y = 0; y < rows; y++) {\n        villeParCoord[x][y] = getCityName()\n      }\n    }\n\n    return {\n      path,\n      edges,\n      villeParCoord,\n    }\n  }\n\n  generateGrapheTikz(\n    id: string,\n    cols: number,\n    rows: number,\n    rowsStart: number,\n    colsStart: number,\n    rowsEnd: number,\n    colsEnd: number,\n    parcours: {\n      path: number[][]\n      edges: { from: number[]; to: number[] }[]\n      villeParCoord: string[][]\n    },\n  ): string {\n    const flattenByRows = function (): string[] {\n      const result: string[] = []\n      for (let y = 0; y < rows; y++) {\n        for (let x = 0; x < cols; x++) {\n          result.push(removeFirstWord(parcours.villeParCoord[x][y]))\n        }\n      }\n      return result\n    }\n\n    const pathsString = parcours.path.map((p) => `${p[0]}/${p[1]}`).join(', ')\n\n    return `\n    \\\\begingroup\n\\\\begin{tikzpicture}[\n    >=Stealth, \n    every node/.style={\n        draw, ellipse, minimum height=10mm, text width=14mm, align=center, font=\\\\sffamily\\\\footnotesize\n    }\n]\n\n  % D√©finir variables locales pour les dimensions\n  \\\\pgfmathsetmacro{\\\\rows}{${rows}}\n  \\\\pgfmathsetmacro{\\\\cols}{${cols}}\n\n  % Liste des villes (au moins rows √ó cols)\n  \\\\def\\\\citylist{{${flattenByRows()\n    .map((v) => `\"${v}\"`)\n    .join(', ')}}}\n\n  % Chemin donn√© par une suite de coordonn√©es (x,y)\n  \\\\def\\\\pathcoords{${pathsString}}\n\n  % Extraction du premier et dernier √©l√©ment\n  \\\\def\\\\firstcoord{}\n  \\\\def\\\\lastcoord{}\n  \\\\foreach \\\\x/\\\\y [count=\\\\i] in \\\\pathcoords {\n    \\\\edef\\\\coord{\\\\x/\\\\y}\n    \\\\ifnum\\\\i=1\n      \\\\xdef\\\\firstcoord{\\\\coord}\n    \\\\fi\n    \\\\xdef\\\\lastcoord{\\\\coord}\n  }\n  \n  % Placement des n≈ìuds\n  \\\\foreach \\\\j in {0,...,\\\\numexpr\\\\rows-1} {\n    \\\\foreach \\\\i in {0,...,\\\\numexpr\\\\cols-1} {\n      \\\\pgfmathtruncatemacro{\\\\index}{\\\\j * \\\\cols + \\\\i}\n      \\\\pgfmathsetmacro{\\\\x}{\\\\i * 3} % horizontal spacing\n      \\\\pgfmathsetmacro{\\\\y}{(\\\\rows - 1 - \\\\j) * 2} % vertical spacing\n      \\\\edef\\\\coord{\\\\i/\\\\j}\n      \\\\ifx\\\\coord\\\\firstcoord\n        \\\\node[fill=gray!20] (C\\\\i\\\\j) at (\\\\x,\\\\y) {\\\\pgfmathparse{\\\\citylist[\\\\index]}\\\\pgfmathresult};\n      \\\\else\\\\ifx\\\\coord\\\\lastcoord\n        \\\\node[fill=gray!20] (C\\\\i\\\\j) at (\\\\x,\\\\y) {\\\\pgfmathparse{\\\\citylist[\\\\index]}\\\\pgfmathresult};\n      \\\\else\n        \\\\node (C\\\\i\\\\j) at (\\\\x,\\\\y) {\\\\pgfmathparse{\\\\citylist[\\\\index]}\\\\pgfmathresult};\n      \\\\fi\\\\fi\n    }\n  }\n\n  % Ar√™tes par d√©faut (grises)\n  \\\\foreach \\\\j in {0,...,\\\\numexpr\\\\rows-1} {\n    \\\\foreach \\\\i in {0,...,\\\\numexpr\\\\cols-2} {\n      \\\\draw[->,gray] (C\\\\i\\\\j) -- (C\\\\the\\\\numexpr\\\\i+1\\\\relax\\\\j);\n    }\n  }\n\n  \\\\foreach \\\\j in {0,...,\\\\numexpr\\\\rows-2} {\n    \\\\foreach \\\\i in {0,...,\\\\numexpr\\\\cols-1} {\n      \\\\draw[->,gray] (C\\\\i\\\\j) -- (C\\\\i\\\\the\\\\numexpr\\\\j+1\\\\relax);\n    }\n  }\n\n  % Chemin rouge\n   \\\\foreach \\\\xA/\\\\yA [count=\\\\i] in \\\\pathcoords {\n    \\\\ifnum\\\\i>1\n      \\\\pgfmathsetmacro{\\\\xprev}{\\\\xA}\n      \\\\pgfmathsetmacro{\\\\yprev}{\\\\yA}\n      \\\\draw[->, red] (C\\\\prevx\\\\prevy) -- (C\\\\xA\\\\yA);\n    \\\\fi\n    \\\\xdef\\\\prevx{\\\\xA}\n    \\\\xdef\\\\prevy{\\\\yA}\n  }\n\n  % Macros d'extraction\n  \\\\def\\\\getx#1/#2\\\\relax{#1} % Prend la partie avant le /\n  \\\\def\\\\gety#1/#2\\\\relax{#2} % Prend la partie apr√®s le /\n\n  % Extraction effective\n  \\\\edef\\\\fx{\\\\expandafter\\\\getx\\\\firstcoord\\\\relax}\n  \\\\edef\\\\fy{\\\\expandafter\\\\gety\\\\firstcoord\\\\relax}\n\n  % Convertir en coordonn√©es TikZ\n  \\\\pgfmathsetmacro\\\\xstart{\\\\fx * 3}\n  \\\\pgfmathsetmacro\\\\ystart{(\\\\rows - 1 - \\\\fy) * 2}\n\n  % Robot : une fl√®che en triangle\n  \\\\begin{scope}[shift={(\\\\xstart,\\\\ystart)}, rotate=0, scale=1,opacity=0.3]\n    \\\\filldraw[fill=gray, draw=black]\n      (-0.8,-0.3) -- (0.2,-0.3) -- (0.2,-0.5) -- (1,0) -- (0.2,0.5) -- (0.2,0.3) -- (-0.8,0.3) -- cycle;\n  \\\\end{scope}\n\n\\\\end{tikzpicture}\n\\\\endgroup\\\\\\\\\n   \nLes instructions √† utiliser sont les suivantes :\n\n\\\\setscratch{scale=0.8,line width=1pt}\n\\\\begin{scratch}\n\\\\blockmove{Avancer}\n\\\\end{scratch}\nou \n\\\\begin{scratch}\n\\\\blockmove{Tourner √† gauche}\n\\\\end{scratch}\nou \n\\\\begin{scratch}\n\\\\blockmove{Tourner √† droite}\n\\\\end{scratch}.\n `\n  }\n\n  generateGrapheSVG(\n    id: string,\n    cols: number,\n    rows: number,\n    rowsStart: number,\n    colsStart: number,\n    rowsEnd: number,\n    colsEnd: number,\n    parcours: {\n      path: number[][]\n      edges: { from: number[]; to: number[] }[]\n      villeParCoord: string[][]\n    },\n  ): string {\n    const svgWidth = cols * 100\n    const svgHeight = rows * 100\n    const start: [number, number] = [colsStart, rowsStart]\n    const orientation = { angle: 0 }\n    const end: [number, number] = [colsEnd, rowsEnd]\n    const pos = { x: start[0], y: start[1] }\n    const edges = parcours.edges\n    const path = parcours.path\n    const villeParCoord = parcours.villeParCoord\n\n    function resizeBlockly(event: Event) {\n      if (event instanceof CustomEvent && event.detail.uuid !== uuid) {\n        return\n      }\n      const workspace = retrieveWorkspace(`blocklyDiv${id}`)\n      if (workspace) {\n        const blocklyDiv = document.getElementById(`blocklyDiv${id}`)\n        if (blocklyDiv) {\n          if (blocklyDiv.offsetParent !== null) {\n            Blockly.svgResize(workspace as Blockly.WorkspaceSvg)\n          }\n        }\n      }\n    }\n\n    function destroyerListener() {\n      document.removeEventListener('questionDisplay', resizeBlockly)\n    }\n    this.destroyers.push(destroyerListener)\n\n    function drawArrow(\n      svg: SVGSVGElement,\n      x1: number,\n      y1: number,\n      x2: number,\n      y2: number,\n    ) {\n      const rx = 40\n      const ry = 20\n      const dx = x2 - x1\n      const dy = y2 - y1\n      const angle = Math.atan2(dy, dx)\n      const startX = x1 + rx * Math.cos(angle)\n      const startY = y1 + ry * Math.sin(angle)\n      const endX = x2 - rx * Math.cos(angle)\n      const endY = y2 - ry * Math.sin(angle)\n\n      const line = document.createElementNS(\n        'http://www.w3.org/2000/svg',\n        'line',\n      )\n      line.setAttribute('x1', String(startX))\n      line.setAttribute('y1', String(startY))\n      line.setAttribute('x2', String(endX))\n      line.setAttribute('y2', String(endY))\n      line.setAttribute('stroke', 'red')\n      line.setAttribute('stroke-width', '2')\n      line.setAttribute('marker-end', `url(#arrowhead${id})`)\n      svg.appendChild(line)\n    }\n\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n    svg.setAttribute('width', `${svgWidth}`)\n    svg.setAttribute('height', `${svgHeight}`)\n    svg.setAttribute('viewBox', `0 0 ${svgWidth} ${svgHeight}`)\n    svg.style.border = '1px solid black'\n\n    const positions: { [key: string]: [number, number] } = {}\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        const cx = x * 100 + 50\n        const cy = y * 100 + 50\n        positions[`${x},${y}`] = [cx, cy]\n      }\n    }\n\n    // Lignes entre voisins sans fl√®ches\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        const [cx, cy] = positions[`${x},${y}`]\n        const directions = [\n          [1, 0],\n          [0, 1],\n        ]\n        for (const [dx, dy] of directions) {\n          const nx = x + dx\n          const ny = y + dy\n          if (nx < cols && ny < rows) {\n            const [ncx, ncy] = positions[`${nx},${ny}`]\n            const line = document.createElementNS(\n              'http://www.w3.org/2000/svg',\n              'line',\n            )\n            line.setAttribute('x1', `${cx}`)\n            line.setAttribute('y1', `${cy}`)\n            line.setAttribute('x2', `${ncx}`)\n            line.setAttribute('y2', `${ncy}`)\n            line.setAttribute('stroke', 'black')\n            line.setAttribute('stroke-width', '1')\n            svg.appendChild(line)\n          }\n        }\n      }\n    }\n\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        // cercle gris pour voisins\n        const [cx, cy] = positions[`${x},${y}`]\n        const ellipse = document.createElementNS(\n          'http://www.w3.org/2000/svg',\n          'ellipse',\n        )\n        ellipse.setAttribute('cx', `${cx}`)\n        ellipse.setAttribute('cy', `${cy}`)\n        ellipse.setAttribute('rx', '40')\n        ellipse.setAttribute('ry', '20')\n        if (x === start[0] && y === start[1]) {\n          ellipse.setAttribute('fill', 'green')\n        } else if (x === end[0] && y === end[1]) {\n          ellipse.setAttribute('fill', 'blue')\n        } else {\n          ellipse.setAttribute('fill', '#ccc')\n        }\n        svg.appendChild(ellipse)\n\n        const name = villeParCoord[x][y] || 'Ville inconnue'\n        const text = document.createElementNS(\n          'http://www.w3.org/2000/svg',\n          'text',\n        )\n        text.setAttribute('x', `${cx}`)\n        text.setAttribute('y', `${cy + 5}`)\n        text.setAttribute('text-anchor', 'middle')\n        text.setAttribute('font-size', '12')\n        text.textContent = removeFirstWord(name)\n        svg.appendChild(text)\n      }\n    }\n\n    // Robot\n    const robot = document.createElementNS('http://www.w3.org/2000/svg', 'path')\n    // Points d‚Äôun petit triangle (fl√®che) centr√© sur (0, 0)\n    robot.setAttribute('d', 'M -8,-2 L 4,-2 L 4,-6 L 12,0 L 4,6 L 4,2 L -8,2 Z')\n    robot.setAttribute('fill', 'grey')\n    robot.setAttribute('stroke', 'red')\n    robot.setAttribute('id', 'robot')\n    // Positionner √† la case de d√©part\n    const [px, py] = positions[`${start[0]},${start[1]}`]\n    const scale = 1.2\n    robot.setAttribute(\n      'transform',\n      `translate(${px}, ${py}) rotate(${orientation.angle}) scale(${scale})`,\n    )\n    svg.appendChild(robot)\n\n    function moveDir(dx: number, dy: number): boolean {\n      const target = [pos.x + dx, pos.y + dy]\n      const exists = edges.find(\n        (edge) =>\n          edge.from[0] === pos.x &&\n          edge.from[1] === pos.y &&\n          edge.to[0] === target[0] &&\n          edge.to[1] === target[1],\n      )\n      if (exists) {\n        pos.x += dx\n        pos.y += dy\n        const [cx, cy] = positions[`${pos.x},${pos.y}`]\n        const btn = document.getElementById(id)\n        btn\n          ?.querySelector('#robot')\n          ?.setAttribute(\n            'transform',\n            `translate(${cx}, ${cy}) rotate(${orientation.angle}) scale(${scale})`,\n          )\n        return true\n      }\n      return false\n    }\n\n    function avancer() {\n      const debug = 0\n      if (orientation.angle === 0) {\n        const bg = moveDir(1, 0) // droite\n        if (bg && debug) ajouterBlocALaSuite('move_forward')\n      } else if (orientation.angle === 90) {\n        const bg = moveDir(0, 1) // bas\n        if (bg && debug) ajouterBlocALaSuite('move_forward')\n      } else if (orientation.angle === 180) {\n        const bg = moveDir(-1, 0) // gauche\n        if (bg && debug) ajouterBlocALaSuite('move_forward')\n      } else if (orientation.angle === 270) {\n        const bg = moveDir(0, -1) // haut\n        if (bg && debug) ajouterBlocALaSuite('move_forward')\n      }\n    }\n\n    function tourner(num: number) {\n      const debug = 0\n      // num = 1 ‚Üí droite, -1 ‚Üí gauche\n      if (num === 1) {\n        orientation.angle = (orientation.angle + 90) % 360\n        if (debug) ajouterBlocALaSuite('turn_right')\n      } else {\n        orientation.angle = (orientation.angle - 90) % 360\n        if (orientation.angle < 0) {\n          orientation.angle += 360 // Assurer que l'angle reste positif\n        }\n        if (debug) ajouterBlocALaSuite('turn_left')\n      }\n      rotate(orientation.angle)\n    }\n\n    function rotate(angle: number) {\n      // 0 ‚Üí droite\n      // 90 ‚Üí bas\n      // 180 ‚Üí gauche\n      // 270 ‚Üí haut\n      const btn = document.getElementById(id)\n      if (btn) {\n        const robotElem = btn.querySelector('#robot') as SVGPathElement\n        const transform = robotElem.getAttribute('transform') || ''\n        const updated = transform.replace(/rotate\\(\\d+\\)/, `rotate(${angle})`)\n        robotElem.setAttribute('transform', updated)\n      }\n    }\n\n    let workspace: Blockly.Workspace\n\n    function createBlockLy() {\n      Blockly.setLocale(En as unknown as { [key: string]: string })\n      Blockly.Msg['CONTROLS_REPEAT_TITLE'] = 'r√©p√©ter %1 fois'\n      Blockly.Msg['CONTROLS_REPEAT_INPUT_DO'] = 'faire'\n      if (!Blockly.Blocks['start']) {\n        Blockly.defineBlocksWithJsonArray([\n          {\n            type: 'start',\n            message0: 'D√©marrer',\n            nextStatement: null,\n            colour: 20,\n            hat: 'true',\n          },\n          {\n            type: 'move_forward',\n            message0: 'avancer',\n            previousStatement: null,\n            nextStatement: null,\n            colour: 160,\n          },\n          {\n            type: 'turn_left',\n            message0: 'tourner √† gauche',\n            previousStatement: null,\n            nextStatement: null,\n            colour: 210,\n          },\n          {\n            type: 'turn_right',\n            message0: 'tourner √† droite',\n            previousStatement: null,\n            nextStatement: null,\n            colour: 210,\n          },\n        ])\n      }\n\n      javascriptGenerator.forBlock['start'] = function (block) {\n        const next = javascriptGenerator.statementToCode(block, '')\n        return next\n      }\n      javascriptGenerator.forBlock['move_forward'] = function (\n        block,\n        generator,\n      ) {\n        return 'avancer();\\n'\n      }\n\n      javascriptGenerator.forBlock['turn_left'] = function (block, generator) {\n        return 'tourner(-1);\\n'\n      }\n\n      javascriptGenerator.forBlock['turn_right'] = function (block, generator) {\n        return 'tourner(1);\\n'\n      }\n\n      const startXml = `\n      <xml xmlns=\"https://developers.google.com/blockly/xml\">\n      <block type=\"start\" deletable=\"false\" movable=\"false\" x=\"10\" y=\"5\"></block>\n      </xml>`\n\n      const toolboxElement = document.getElementById('toolbox')\n      if (!toolboxElement) {\n        throw new Error(\"Toolbox element with id 'toolbox' not found.\")\n      }\n\n      const ws = retrieveWorkspace(`blocklyDiv${id}`)\n      if (ws) {\n        ws.dispose() // Dispose the existing workspace if it exists\n      }\n\n      const mediaPath = `${import.meta.env.BASE_URL}blockly/media/`\n\n      workspace = Blockly.inject(`blocklyDiv${id}`, {\n        media: mediaPath,\n        toolbox: toolboxElement,\n        sounds: false,\n        zoom: {\n          controls: true,\n          wheel: true,\n          startScale: 0.8,\n          maxScale: 2.5,\n          minScale: 0.3,\n          scaleSpeed: 1.2,\n          pinch: false,\n        },\n      })\n      // Apr√®s injection, on masque le bouton \"reset\"\n      const zoomControls = document.querySelector(\n        `#blocklyDiv${id} .blocklyZoomReset`,\n      )\n      if (zoomControls) {\n        ;(zoomControls as HTMLElement).style.display = 'none'\n      }\n      workspace.idkey = `blocklyDiv${id}` // Set the id for later retrieval\n\n      // Charger le bloc de d√©marrage\n      Blockly.Xml.domToWorkspace(\n        Blockly.utils.xml.textToDom(startXml),\n        workspace,\n      )\n      // window.Blockly = Blockly // Expose Blockly globally for debugging\n      Blockly.ContextMenuRegistry.registry.reset() // supprime le menu contextuel\n\n      document.addEventListener('questionDisplay', resizeBlockly)\n    }\n\n    function ajouterBlocALaSuite(type: string) {\n      // const workspace = Blockly.getMainWorkspace()\n      const workspace = retrieveWorkspace(`blocklyDiv${id}`)\n      if (!workspace) {\n        return\n      }\n      const topBlocks = workspace.getTopBlocks(true)\n      if (topBlocks.length === 0) {\n        console.warn('Aucun bloc de d√©part trouv√©.')\n        return\n      }\n\n      // Trouver le dernier bloc de la cha√Æne\n      let lastBlock = topBlocks[0]\n      while (lastBlock.getNextBlock()) {\n        const next = lastBlock.getNextBlock()\n        if (!next) break\n        lastBlock = next\n      }\n\n      // Cr√©er le nouveau bloc\n      const childBlock = Blockly.serialization.blocks.append(\n        {\n          type,\n        },\n        workspace,\n      )\n\n      // Connecter √† la suite\n      if (lastBlock.nextConnection && childBlock.previousConnection) {\n        lastBlock.nextConnection.connect(childBlock.previousConnection)\n      }\n    }\n\n    function resetRobot() {\n      // Positionner √† la case de d√©part\n      const btn = document.getElementById(id)\n      if (btn) {\n        const [px, py] = positions[`${start[0]},${start[1]}`]\n        pos.x = start[0]\n        pos.y = start[1]\n        orientation.angle = 0 // R√©initialiser l'orientation\n        btn\n          ?.querySelector('#robot')\n          ?.setAttribute(\n            'transform',\n            `translate(${px}, ${py}) rotate(${orientation.angle}) scale(${scale})`,\n          )\n      }\n      const btn2 = document\n        .getElementById(id)\n        ?.querySelector('#message-correct')\n      if (btn2) {\n        ;(btn2 as HTMLElement).style.display = 'none'\n      }\n      const btn3 = document.getElementById(id)?.querySelector('#message-faux')\n      if (btn3) {\n        ;(btn3 as HTMLElement).style.display = 'none'\n      }\n    }\n\n    // Reset workspace (supprime tous les blocs)\n    function resetWorkspace() {\n      const workspace = retrieveWorkspace(`blocklyDiv${id}`)\n      if (workspace) {\n        workspace.clear()\n        // Facultatif : remettre un bloc \"start\" par d√©faut\n        const xmlText =\n          '<xml><block type=\"start\" deletable=\"false\" movable=\"false\" x=\"20\" y=\"20\"></block></xml>'\n        const dom = Blockly.utils.xml.textToDom(xmlText)\n        Blockly.Xml.domToWorkspace(dom, workspace)\n      }\n    }\n\n    function runCode() {\n      const workspace = retrieveWorkspace(`blocklyDiv${id}`)\n      if (!workspace) {\n        return\n      }\n\n      // Important : initialiser le g√©n√©rateur\n      javascriptGenerator.init(workspace)\n      const blocks = workspace.getTopBlocks(true)\n      const startBlock = blocks.find((b) => b.type === 'start')\n      if (!startBlock) {\n        alert('Ajoutez un bloc \"D√©marrer\"')\n        return\n      }\n      let code = javascriptGenerator.blockToCode(startBlock)\n      if (Array.isArray(code)) {\n        code = code[0]\n      }\n      try {\n        // eslint-disable-next-line no-eval\n        eval(code)\n      } catch (e) {\n        console.error(e)\n      }\n      const btn = document.getElementById(id)?.querySelector('#message-encours')\n      if (btn) {\n        ;(btn as HTMLElement).style.display = 'none'\n      }\n      if (checkIfSolution()) {\n        const btn = document\n          .getElementById(id)\n          ?.querySelector('#message-correct')\n        if (btn) {\n          ;(btn as HTMLElement).style.display = 'block'\n        }\n      } else {\n        const btn = document.getElementById(id)?.querySelector('#message-faux')\n        if (btn) {\n          ;(btn as HTMLElement).style.display = 'block'\n        }\n      }\n    }\n\n    async function runCodeWithDelay() {\n      const workspace = retrieveWorkspace(`blocklyDiv${id}`)\n      if (!workspace) {\n        return\n      }\n\n      // Important : initialiser le g√©n√©rateur\n      javascriptGenerator.init(workspace)\n      const blocks = workspace.getTopBlocks(true)\n      const startBlock = blocks.find((b) => b.type === 'start')\n      if (!startBlock) {\n        alert('Ajoutez un bloc \"D√©marrer\"')\n        return\n      }\n      let code = javascriptGenerator.blockToCode(startBlock)\n      if (Array.isArray(code)) {\n        code = code[0]\n      }\n      const btnCorrect = document\n        .getElementById(id)\n        ?.querySelector<HTMLElement>('#message-correct')\n      if (btnCorrect) {\n        btnCorrect.style.display = 'none'\n      }\n      const btnFaux = document\n        .getElementById(id)\n        ?.querySelector<HTMLElement>('#message-faux')\n      if (btnFaux) {\n        btnFaux.style.display = 'none'\n      }\n      const btnEncours = document\n        .getElementById(id)\n        ?.querySelector<HTMLElement>('#message-encours')\n      if (btnEncours) {\n        btnEncours.style.display = 'block'\n      }\n      try {\n        const delayMs = 1000 // d√©lai en millisecondes entre chaque ligne\n\n        // D√©coupe du code ligne par ligne et insertion d'un sleep\n        const lines = code.split('\\n').filter((line) => line.trim() !== '')\n        const delayedCode = lines\n          .map((line) => `  ${line}\\n  await sleep(${delayMs});`)\n          .join('\\n')\n\n        const asyncWrapper = `(async () => {\n          const sleep = (ms) => new Promise(r => setTimeout(r, ms));\n        ${delayedCode}\n        })()`\n\n        // console.info('Ex√©cution du code :', asyncWrapper)\n\n        // eslint-disable-next-line no-eval\n        await eval(asyncWrapper)\n      } catch (e) {\n        console.error(e)\n      }\n      if (btnEncours) {\n        btnEncours.style.display = 'none'\n      }\n      if (checkIfSolution()) {\n        if (btnCorrect) btnCorrect.style.display = 'block'\n      } else {\n        if (btnFaux) btnFaux.style.display = 'block'\n      }\n    }\n\n    function checkIfSolution() {\n      const lastEdge = edges.at(-1)\n      if (!lastEdge) {\n        return false\n      }\n      const { to } = lastEdge\n      const dx = pos.y - to[1]\n      const dy = pos.x - to[0]\n      if (dx === 0 && dy === 0) {\n        // Le robot est √† la fin du parcours\n        return true\n      }\n      return false\n    }\n\n    function createSolution() {\n      resetRobot()\n      resetWorkspace()\n      for (const edge of edges) {\n        const from = edge.from\n        const to = edge.to\n        const dx = to[0] - from[0]\n        const dy = to[1] - from[1]\n        if (dx === 1 && dy === 0) {\n          // √† droite\n          if (orientation.angle === 0) {\n            ajouterBlocALaSuite('move_forward') // Avancer\n          } else if (orientation.angle === 270) {\n            ajouterBlocALaSuite('turn_right') // Tourner √† droite\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 0\n          } else if (orientation.angle === 180) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 0\n          } else if (orientation.angle === 90) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 0\n          }\n        } else if (dx === -1 && dy === 0) {\n          // √† gauche\n          if (orientation.angle === 180) {\n            ajouterBlocALaSuite('move_forward') // Avancer\n          } else if (orientation.angle === 0) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 180\n          } else if (orientation.angle === 90) {\n            ajouterBlocALaSuite('turn_right') // Tourner √† droite\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 180\n          } else if (orientation.angle === 270) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 180\n          }\n        } else if (dx === 0 && dy === 1) {\n          // en bas\n          if (orientation.angle === 90) {\n            ajouterBlocALaSuite('move_forward') // Avancer\n          } else if (orientation.angle === 0) {\n            ajouterBlocALaSuite('turn_right') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 90\n          } else if (orientation.angle === 180) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† droite\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 90\n          } else if (orientation.angle === 270) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n          }\n        } else if (dx === 0 && dy === -1) {\n          // en haut\n          if (orientation.angle === 270) {\n            ajouterBlocALaSuite('move_forward') // Avancer\n          } else if (orientation.angle === 0) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† droite\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 270\n          } else if (orientation.angle === 90) {\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('turn_left') // Tourner √† gauche\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 270\n          } else if (orientation.angle === 180) {\n            ajouterBlocALaSuite('turn_right') // Tourner √† droite\n            ajouterBlocALaSuite('move_forward') // Avancer\n            orientation.angle = 270\n          }\n        }\n      }\n      orientation.angle = 0\n    }\n\n    const listener = function () {\n      const btn = document.getElementById(id) as HTMLElement & {\n        _eventsBound?: boolean\n      }\n      if (btn && !btn._eventsBound) {\n        btn.querySelector('#btn-av')?.addEventListener('click', () => avancer())\n        btn\n          .querySelector('#btn-left')\n          ?.addEventListener('click', () => tourner(-1))\n        btn\n          .querySelector('#btn-right')\n          ?.addEventListener('click', () => tourner(1))\n        btn.querySelector('#resetRobot')?.addEventListener('click', resetRobot)\n        btn\n          .querySelector('#resetWorkspace')\n          ?.addEventListener('click', resetWorkspace)\n        btn\n          .querySelector('#showSolution')\n          ?.addEventListener('click', createSolution)\n        btn.querySelector('#runCode')?.addEventListener('click', runCode)\n        btn\n          .querySelector('#runCodeWithDelay')\n          ?.addEventListener('click', runCodeWithDelay)\n        createBlockLy()\n        btn._eventsBound = true // marquer comme attach√©\n      }\n      document.removeEventListener('exercicesAffiches', listener) // On retire l'√©couteur pour √©viter les doublons\n    }\n    document.addEventListener('exercicesAffiches', listener)\n\n    // Trac√© du chemin avec fl√®ches rouges\n    for (let i = 0; i < path.length - 1; i++) {\n      const [x1, y1] = positions[`${path[i][0]},${path[i][1]}`]\n      const [x2, y2] = positions[`${path[i + 1][0]},${path[i + 1][1]}`]\n      drawArrow(svg, x1, y1, x2, y2)\n    }\n\n    // Ajout du marqueur de fl√®che\n    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs')\n    defs.innerHTML = `\n     <marker id=\"arrowhead${id}\" markerWidth=\"6\" markerHeight=\"6\" refX=\"5\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\" viewBox=\"0 0 6 6\">\n  <path d=\"M 0 0 L 6 3 L 0 6 L 2 3 Z\" fill=\"red\" />\n</marker>\n    `\n    svg.insertBefore(defs, svg.firstChild)\n    svg.setAttribute('class', 'mathalea2d')\n    svg.setAttribute('viewBox', `0 0 ${svgWidth} ${svgHeight}`)\n    svg.setAttribute('style', 'display: inline-block')\n\n    const serializer = new XMLSerializer()\n    const svgString = serializer.serializeToString(svg) // svgElement est ton <svg>\n\n    return `<div id=${id}>\n    <div class=\"svgContainer\" style=\"display: inline-block\"> \n    ${svgString}<br>\n    \n  <!-- <button id=\"btn-av\">‚áí</button>\n  <button id=\"btn-left\" class=\"px-6 py-2.5 ml-6\">‚Ü™</button>\n  <button id=\"btn-right\" class=\"px-6 py-2.5 ml-6\">‚Ü©</button>\n  <button id=\"generate\" class=\"px-6 py-2.5 ml-6\">üîÅ Recommencer</button> -->\n  </div>\n  <xml id=\"toolbox\" style=\"display: none\">\n  <category name=\"D√©placement\">\n    <block type=\"move_forward\"></block>\n    <block type=\"turn_left\"></block>\n    <block type=\"turn_right\"></block>\n  </category>\n  <category name=\"Contr√¥le\">\n  <block type=\"start\"></block>\n    <block type=\"controls_repeat_ext\">\n      <value name=\"TIMES\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value>\n    </block>\n  </category>\n  </xml>\n\n  <div>\n  <button id=\"runCode\" class=\"px-6 py-2.5\" style=\"display:none\">‚ñ∂Ô∏è Ex√©cuter</button>\n  <button id=\"runCodeWithDelay\" class=\"px-6 py-2.5\" ${this.interactif ? 'style=\"display:none\"' : ''}>‚ñ∂Ô∏è Ex√©cuter (pas √† pas) </button>\n  <button id=\"resetWorkspace\" class=\"px-6 py-2.5\" ${this.interactif ? 'style=\"display:none\"' : ''}>‚ôªÔ∏è Reinit programme</button>\n  <button id=\"resetRobot\" class=\"px-6 py-2.5\" ${this.interactif ? 'style=\"display:none\"' : ''}>üîÅ Reinit bus</button>\n  <button id=\"showSolution\" class=\"px-6 py-2.5\" style=\"display:none\">üí° Show solution</button>\n  <div id=\"message-correct\" style=\"display: none; margin: 10px 10px 10px 10px; font-weight: bold; color: green; font-size: 1.2em;\">\n  üéâ Bravo, le bus est bien arriv√© !\n  </div>\n  <div id=\"message-faux\" style=\"display: none; margin: 10px 10px 10px 10px; font-weight: bold; color: red; font-size: 1.2em;\">\n   ‚ùå Attention, le bus n'est pas arriv√© √† sa destination finale!\n  </div>\n  <style>\n  @keyframes blink {\n    50% { opacity: 0; }\n  }\n  </style>\n  <div id=\"message-encours\" style=\"animation: blink 1s step-start infinite;display: none; margin: 10px 10px 10px 10px; font-weight: bold; font-size: 1.2em;\">\n  En cours d'ex√©cution...\n  </div>\n  <div id=\"blocklyDiv${id}\" style=\"height:300px;width:100%\"></div>\n  </div>\n  </div>\n`\n  }\n\n  correctionInteractive = (i: number) => {\n    if (i === undefined) return ''\n    if (this.answers === undefined) this.answers = {}\n    let result = 'KO'\n    const id: string = `${this.numeroExercice}_${i}`\n    const ws = retrieveWorkspace(`blocklyDiv${id}`)\n    if (ws) {\n      const jsonStr = exportBlocklyJSONUltraLight(ws)\n      this.answers[`blocklyDiv${id}`] = jsonStr\n      // const json = JSON.parse(jsonStr)\n      // Blockly.serialization.workspaces.load(json, ws)\n    }\n\n    const spanResultat = document.querySelector(\n      `#resultatCheckEx${this.numeroExercice}Q${i}`,\n    )\n    const divFeedback = document.querySelector<HTMLElement>(\n      `#feedbackEx${this.numeroExercice}Q${i}`,\n    )\n    if (spanResultat) spanResultat.innerHTML = ''\n\n    const btn = document.getElementById(id)\n    if (btn) {\n      btn.querySelector<HTMLElement>('#runCode')?.click()\n      const message = btn.querySelector<HTMLElement>('#message-correct')\n      if (message?.style.display !== 'none') {\n        result = 'OK'\n        if (spanResultat) spanResultat.innerHTML = 'üòé'\n      } else {\n        if (spanResultat) spanResultat.innerHTML = '‚òπÔ∏è'\n        if (divFeedback) {\n          divFeedback.innerHTML = \"Le bus n'est pas arriv√© √† destination\"\n          divFeedback.style.display = 'block'\n        }\n      }\n    }\n    return result\n  }\n}\n\nfunction retrieveWorkspace(name: string) {\n  const workspacesAll = Blockly.Workspace.getAll()\n  for (let k = 0; k < workspacesAll.length; k++) {\n    const ws = workspacesAll[k]\n    if (ws.idkey === name) {\n      return ws\n    }\n  }\n  return null\n}\n\nfunction exportBlocklyJSONUltraLight(workspace: Blockly.Workspace): string {\n  const fullJson = Blockly.serialization.workspaces.save(workspace)\n\n  // Liste noire des cl√©s √† supprimer\n  const keysToRemove = new Set([\n    'id',\n    'x',\n    'y',\n    'collapsed',\n    'deletable',\n    'movable',\n    'editable',\n    'enabled',\n    'inline',\n    'inputsInline',\n    'data',\n    'extraState',\n    'isShadow',\n    'disabled',\n  ])\n\n  // Fonction r√©cursive pour nettoyer l'objet\n  function clean(obj: any): any {\n    if (Array.isArray(obj)) {\n      return obj.map(clean)\n    } else if (obj && typeof obj === 'object') {\n      const newObj: any = {}\n      for (const key in obj) {\n        if (!keysToRemove.has(key)) {\n          newObj[key] = clean(obj[key])\n        }\n      }\n      return newObj\n    }\n    return obj\n  }\n\n  const cleanedJson = clean(fullJson)\n  return JSON.stringify(cleanedJson, null, 2)\n}\n\nfunction removeFirstWord(city: string) {\n  const town = city.replace(/^(les|la|le|l‚Äô|l')\\s*/i, '').trim()\n  return town.charAt(0).toUpperCase() + town.slice(1).toLowerCase()\n}\n\nfunction createSolutionStr(\n  edges: { from: number[]; to: number[] }[],\n): string[] {\n  const orientation = { angle: 0 }\n  const result: string[] = []\n  for (const edge of edges) {\n    const from = edge.from\n    const to = edge.to\n    const dx = to[0] - from[0]\n    const dy = to[1] - from[1]\n    if (dx === 1 && dy === 0) {\n      // √† droite\n      if (orientation.angle === 0) {\n        result.push('move_forward-Avancer') // Avancer\n      } else if (orientation.angle === 270) {\n        result.push('turn_right-Tourner √† droite') // Tourner √† droite\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 0\n      } else if (orientation.angle === 180) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 0\n      } else if (orientation.angle === 90) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 0\n      }\n    } else if (dx === -1 && dy === 0) {\n      // √† gauche\n      if (orientation.angle === 180) {\n        result.push('move_forward-Avancer') // Avancer\n      } else if (orientation.angle === 0) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 180\n      } else if (orientation.angle === 90) {\n        result.push('turn_right-Tourner √† droite') // Tourner √† droite\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 180\n      } else if (orientation.angle === 270) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 180\n      }\n    } else if (dx === 0 && dy === 1) {\n      // en bas\n      if (orientation.angle === 90) {\n        result.push('move_forward-Avancer') // Avancer\n      } else if (orientation.angle === 0) {\n        result.push('turn_right-Tourner √† droite') // Tourner √† droite\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 90\n      } else if (orientation.angle === 180) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 90\n      } else if (orientation.angle === 270) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n      }\n    } else if (dx === 0 && dy === -1) {\n      // en haut\n      if (orientation.angle === 270) {\n        result.push('move_forward-Avancer') // Avancer\n      } else if (orientation.angle === 0) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 270\n      } else if (orientation.angle === 90) {\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('turn_left-Tourner √† gauche') // Tourner √† gauche\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 270\n      } else if (orientation.angle === 180) {\n        result.push('turn_right-Tourner √† droite') // Tourner √† droite\n        result.push('move_forward-Avancer') // Avancer\n        orientation.angle = 270\n      }\n    }\n  }\n  orientation.angle = 0\n  return result\n}\n"],"names":["__publicField","i","result","id","ws","jsonStr","spanResultat","divFeedback","btn","message","destroy","q","cpt","texte","texteCorr","nbL","nbC","startCol","endCol","parcours","villeDepart","villeArrivee","p","instruction","index","parts","lieu","cols","rows","rowsStart","colsStart","rowsEnd","colsEnd","start","end","cityList","getCityName","used","name","generateSimplePath","y","targetX","targetY","dx","dy","steps","j","temp","path","paths2","a","b","node","edges","from","to","villeParCoord","x","flattenByRows","pathsString","v","event","workspace","blocklyDiv","Blockly.svgResize","svg","x1","y1","x2","y2","angle","startX","startY","endX","endY","line","cx","cy","directions","nx","ny","ncx","ncy","ellipse","text","target","edge","num","robotElem","updated","Blockly.setLocale","Blockly.Msg","Blockly.Blocks","Blockly.defineBlocksWithJsonArray","block","generator","startXml","toolboxElement","Blockly.inject","zoomControls","Blockly.Xml","Blockly.utils","Blockly.ContextMenuRegistry","type","topBlocks","lastBlock","next","childBlock","Blockly.serialization","px","py","btn2","_b","btn3","_c","dom","e","_a","lastEdge","workspacesAll","Blockly.Workspace","k","fullJson","keysToRemove","clean","obj","newObj","key","cleanedJson","city","town","orientation"],"mappings":"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"}