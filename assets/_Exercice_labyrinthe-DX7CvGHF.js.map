{"version":3,"mappings":"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","names":["ExerciceLabyrinthe","Exercice","__publicField","i","divFeedback","isValid","ratio","texte","texteCorr","context","container","containerCorrection","_a","Labyrinthe","LabyrintheElement","__vitePreload","n","el","resolve","checkReady","actualGoodCount","actualBadCount","btnScore","elCorrection","grid","r","c","cell","listeQuestionsToContenu"],"ignoreList":[],"sources":["../../src/exercices/_Exercice_labyrinthe.ts"],"sourcesContent":["import { Labyrinthe } from 'labyrinthe'\nimport type LabyrintheElement from 'labyrinthe/src/LabyrintheElement'\nimport { context } from '../modules/context'\nimport { listeQuestionsToContenu } from '../modules/outils'\nimport Exercice from './Exercice'\n\n/**\n * @author Rémi Angot\n */\nexport default class ExerciceLabyrinthe extends Exercice {\n  consigneDeplacement = '<br>Dans ce labyrinthe, on peut se déplacer horizontalement, verticalement et en diagonale.'\n  labyrinthe!: Labyrinthe\n  labyrintheElement!: LabyrintheElement\n  cols = 6\n  rows = 6\n  orientation?: 'horizontal' | 'vertical'\n  goodAnswers: string[] = []\n  badAnswers: string[] = []\n\n  constructor() {\n    super()\n    this.nbQuestions = 1\n    this.interactifObligatoire = true\n    this.nbQuestionsModifiable = false\n    this.exoCustomResultat = true\n  }\n\n  init() {}\n\n  nouvelleVersion() {\n    this.goodAnswers = []\n    this.badAnswers = []\n\n    if (this.labyrintheElement) {\n      this.labyrintheElement.remove()\n    }\n\n    let texte = ''\n    let texteCorr = ''\n    if (context.isHtml) {\n      texte = `<div\n        id=\"containerLabyrintheEx${this.numeroExercice}Q${0}\">\n      </div>\n      <div id=${`feedbackEx${this.numeroExercice}Q${0}`}\n        class=\"ml-2 py-2 text-coopmaths-warn-darkest dark:text-coopmathsdark-warn-darkest\"\n        >\n      </div>`\n\n      texteCorr = `<div\n        id=\"containerLabyrintheCorrectionEx${this.numeroExercice}Q${0}\">\n      </div>`\n      document.addEventListener('exercicesAffiches', async () => {\n        const container = document.querySelector(\n          `#containerLabyrintheEx${this.numeroExercice}Q${0}`,\n        )\n        const containerCorrection = document.querySelector(\n          `#containerLabyrintheCorrectionEx${this.numeroExercice}Q${0}`,\n        )\n        if (container) {\n          if (!this.labyrintheElement?.isConnected) {\n            container.innerHTML = ''\n            // Modèle temporaire\n            this.labyrinthe = new Labyrinthe({\n              seed: this.seed,\n              rows: this.rows,\n              cols: this.cols,\n              orientation: this.orientation,\n            })\n            this.init()\n            if (!customElements.get('labyrinthe-grid')) {\n              const { default: LabyrintheElement } = await import(\n                'labyrinthe/src/LabyrintheElement'\n              )\n              try {\n                customElements.define('labyrinthe-grid', LabyrintheElement as any)\n              } catch {}\n            }\n            const el = document.createElement(\n              'labyrinthe-grid',\n            ) as LabyrintheElement\n            el.seed = this.seed ?? ''\n            el.rows = this.rows\n            el.cols = this.cols\n            if (this.orientation) {\n              el.orientation = this.orientation\n            }\n            container.innerHTML = ''\n            // Cela lance connectedCallback qui regénère le chemin\n            container.appendChild(el)\n            await new Promise<void>((resolve) => {\n              const checkReady = () => {\n                if (el.ready) {\n                  resolve()\n                } else {\n                  setTimeout(checkReady, 30)\n                }\n              }\n              checkReady()\n            })\n\n            this.labyrintheElement = el\n            const actualGoodCount =\n              this.labyrintheElement.numberOfGoodAnswers ?? 0\n            const actualBadCount =\n              this.labyrintheElement.numberOfIncorrectAnswers ?? 0\n\n            // Nouveau labyrinthe avec le même seed\n            this.labyrinthe = new Labyrinthe({\n              seed: this.seed,\n              rows: this.rows,\n              cols: this.cols,\n              orientation: this.orientation,\n            })\n            this.labyrinthe.regenerate()\n\n            // Generate values using our labyrinthe's RNG\n            this.goodAnswers = []\n            this.badAnswers = []\n            for (let i = 0; i < actualGoodCount; i++) {\n              this.goodAnswers.push(String(this.generateGoodAnswers()))\n            }\n            for (let i = 0; i < actualBadCount; i++) {\n              this.badAnswers.push(String(this.generateBadAnswers()))\n            }\n            this.labyrintheElement.setValues(this.goodAnswers, this.badAnswers)\n          }\n          this.labyrintheElement.id = `labyrintheEx${this.numeroExercice}`\n          if (!this.interactif) {\n            this.labyrintheElement.disabled = true\n          }\n          this.labyrintheElement.addEventListener(\n            'labyrinthe:gameend',\n            (e: Event) => {\n              const btnScore = document.querySelector(\n                `#buttonScoreEx${this.numeroExercice}`,\n              )\n              ;(btnScore as HTMLButtonElement)?.click()\n            },\n          )\n        }\n        if (containerCorrection) {\n          containerCorrection.innerHTML = ''\n          const elCorrection = document.createElement(\n            'labyrinthe-grid',\n          ) as LabyrintheElement\n          elCorrection.seed = this.seed ?? ''\n          elCorrection.rows = this.rows\n          elCorrection.cols = this.cols\n          if (this.orientation) {\n            elCorrection.orientation = this.orientation\n          }\n\n          containerCorrection.appendChild(elCorrection)\n\n          await new Promise<void>((resolve) => {\n            const checkReady = () => {\n              if (elCorrection.ready) {\n                resolve()\n              } else {\n                setTimeout(checkReady, 30)\n              }\n            }\n            checkReady()\n          })\n\n          elCorrection.setValues(this.goodAnswers, this.badAnswers)\n          elCorrection.showCorrection()\n        }\n      })\n\n      setTimeout(() => {\n        // Gestion particulière du bouton score\n        const btnScore = document.querySelector(\n          `#buttonScoreEx${this.numeroExercice}`,\n        )\n        if (btnScore) {\n          ;(btnScore as HTMLButtonElement).style.display = 'none'\n        }\n      }, 500)\n    } else {\n      this.labyrinthe = new Labyrinthe({\n        seed: this.seed,\n        rows: this.rows,\n        cols: this.cols,\n        orientation: this.orientation,\n      })\n      this.init()\n      this.labyrinthe.regenerate()\n      let actualGoodCount = 0\n      let actualBadCount = 0\n      const grid = (this.labyrinthe as any).grid\n      if (grid && Array.isArray(grid)) {\n        for (let r = 0; r < this.rows; r++) {\n          for (let c = 0; c < this.cols; c++) {\n            const cell = grid[r]?.[c]\n            if (cell?.isGood === true) {\n              actualGoodCount++\n            } else if (cell?.isGood === false) {\n              actualBadCount++\n            }\n          }\n        }\n      }\n\n      this.goodAnswers = []\n      this.badAnswers = []\n      for (let i = 0; i < actualGoodCount; i++) {\n        this.goodAnswers.push(String(this.generateGoodAnswers()))\n      }\n      for (let i = 0; i < actualBadCount; i++) {\n        this.badAnswers.push(String(this.generateBadAnswers()))\n      }\n\n      this.labyrinthe.setValues(this.goodAnswers, this.badAnswers)\n\n      texte = `\\n\\n\\\\bigskip\\n${this.labyrinthe.generateLatex()}`\n      texteCorr = this.labyrinthe.generateLatexCorrection()\n    }\n\n    this.listeQuestions[0] = texte\n    this.listeCorrections[0] = texteCorr\n    listeQuestionsToContenu(this)\n  }\n\n  generateGoodAnswers(): number | string {\n    return 1\n  }\n\n  generateBadAnswers(): number | string {\n    return 0\n  }\n\n  correctionInteractive = (i: number) => {\n    if (this.answers == null) this.answers = {}\n    this.answers[`labyrintheEx${this.numeroExercice}`] =\n      this.labyrintheElement.state\n    const divFeedback = document.querySelector(\n      `#feedbackEx${this.numeroExercice}Q${i}`,\n    )\n    const isValid = this.labyrintheElement.win\n    if (divFeedback != null) {\n      if (isValid) {\n        divFeedback.innerHTML = 'Bravo !'\n        return ['OK', 'OK', 'OK', 'OK']\n      }\n      const ratio =\n        this.labyrintheElement.correctClicks / this.labyrintheElement.totalGood\n      if (ratio <= 0.25) {\n        return ['KO', 'KO', 'KO', 'KO']\n      } else if (ratio <= 0.5) {\n        return ['OK', 'KO', 'KO', 'KO']\n      } else if (ratio <= 0.75) {\n        return ['OK', 'OK', 'KO', 'KO']\n      }\n      return ['OK', 'OK', 'KO', 'KO']\n    }\n    throw new Error('Feedback not found')\n  }\n}\n"],"file":"_Exercice_labyrinthe-DX7CvGHF.js"}