var re=Object.defineProperty;var ae=(s,m,n)=>m in s?re(s,m,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[m]=n;var E=(s,m,n)=>ae(s,typeof m!="symbol"?m+"":m,n);import{a9 as le}from"./index-Dkwu26bg.js";import{T as K}from"./vendors/troika-three-text-CseoN0LQ.js";import{G as P,b as L,k as w,E as M,l as T,m as v,n as B,o as ce,V as x,p as I,F as H,O as ee,q as W,r as N,s as he,t as te,u as de,e as ue,v as me,w as ne,x as V,y as Z,z as X,c as pe,D as ye,A as F,H as Y,J as fe,K as ge,N as we,W as R,Q as j,X as $,B as U}from"./vendors/three-q_6hD11P.js";function xe(s,m,n,o,d=!1,r=!1){const a=new I,l=[],c=[],i=[];for(let e=0;e<s;e++){const t=e/s*Math.PI*2,h=m*Math.cos(t),u=m*Math.sin(t);c.push(new x(h,n,u)),i.push(new x(h,o,u))}if(d)for(let e=1;e<s-1;e++)l.push(c[0].x,c[0].y,c[0].z,c[e+1].x,c[e+1].y,c[e+1].z,c[e].x,c[e].y,c[e].z);if(r)for(let e=1;e<s-1;e++)l.push(i[0].x,i[0].y,i[0].z,i[e].x,i[e].y,i[e].z,i[e+1].x,i[e+1].y,i[e+1].z);for(let e=0;e<s;e++){const t=c[e],h=c[(e+1)%s],u=i[(e+1)%s],y=i[e];l.push(t.x,t.y,t.z,h.x,h.y,h.z,y.x,y.y,y.z),l.push(h.x,h.y,h.z,u.x,u.y,u.z,y.x,y.y,y.z)}return a.setAttribute("position",new H(l,3)),a.computeVertexNormals(),a}function be(s,m,n,o,d=!1){const r=new I,a=[],l=new x(0,o,0),c=[];for(let i=0;i<s;i++){const e=i/s*Math.PI*2,t=m*Math.cos(e),h=m*Math.sin(e);c.push(new x(t,n,h))}if(d)for(let i=1;i<s-1;i++)a.push(c[0].x,c[0].y,c[0].z,c[i+1].x,c[i+1].y,c[i+1].z,c[i].x,c[i].y,c[i].z);for(let i=0;i<s;i++){const e=c[i],t=c[(i+1)%s];a.push(e.x,e.y,e.z,t.x,t.y,t.z,l.x,l.y,l.z)}return r.setAttribute("position",new H(a,3)),r.computeVertexNormals(),r}function _e(s,m,n,o,d,r=!1,a=!1){const l=new I,c=[],i=[],e=[];for(let t=0;t<s;t++){const h=t/s*Math.PI*2;i.push(new x(m*Math.cos(h),o,m*Math.sin(h))),e.push(new x(n*Math.cos(h),d,n*Math.sin(h)))}if(r)for(let t=1;t<s-1;t++)c.push(i[0].x,i[0].y,i[0].z,i[t+1].x,i[t+1].y,i[t+1].z,i[t].x,i[t].y,i[t].z);if(a)for(let t=1;t<s-1;t++)c.push(e[0].x,e[0].y,e[0].z,e[t].x,e[t].y,e[t].z,e[t+1].x,e[t+1].y,e[t+1].z);for(let t=0;t<s;t++){const h=i[t],u=i[(t+1)%s],y=e[(t+1)%s],f=e[t];c.push(h.x,h.y,h.z,u.x,u.y,u.z,f.x,f.y,f.z),c.push(u.x,u.y,u.z,y.x,y.y,y.z,f.x,f.y,f.z)}return l.setAttribute("position",new H(c,3)),l.computeVertexNormals(),l}function J(s,m=!1){const n=new M(s);let o;m?o=new T({color:0,dashSize:.05,gapSize:.025,depthTest:!1,transparent:!0,opacity:.5}):o=new B({color:0,depthTest:!0,transparent:!0,opacity:1});const d=new v(n,o);return m&&d.computeLineDistances&&d.computeLineDistances(),d}(()=>{const s=new W(1,1,1),m=[new w({color:"red"}),new w({color:"red"}),new w({color:"green"}),new w({color:"green"}),new w({color:"blue"}),new w({color:"blue"})];return new L(s,m)})();(()=>{const s=new W(1,1,1),m=[new w({color:"red"}),new w({color:"red"}),new w({color:"green"}),new w({color:"green"}),new w({color:"blue"}),new w({color:"blue"})],n=new L(s,m),o=new M(s),d=new v(o,new B({color:0})),r=new P;return r.add(n),r.add(d),r})();function Ee(s,m=1,n){const o=le(6).map(l=>{var c;return((n==null?void 0:n.colors)??[16777215])[l%(((c=n==null?void 0:n.colors)==null?void 0:c.length)??1)]}),d=new W(m,m,m),r=[new w({color:o[0]}),new w({color:o[1]}),new w({color:o[2]}),new w({color:o[3]}),new w({color:o[4]}),new w({color:o[5]})],a=new L(d,r);if(a.position.set(...s),n!=null&&n.edges){const l=new M(d),c=new v(l,new B({color:n.edgesColor??0,opacity:n.edgesOpacity??1,transparent:(n.edgesOpacity??1)<1}));c.position.copy(a.position);const i=new P;return i.add(a),i.add(c),i}else return a}function Me(s){const m="images/earth_day_4096.jpg",n="images/earth_normal_2048.jpg",o=new N(s.radius??1,s.segmentsWidth??64,s.segmentsHeight??32),d=new te,r=new de({color:16777215,metalness:.2,roughness:.8,bumpScale:.1,normalScale:new ue(1,1),emissive:2236962}),a=new L(o,r);return s.position&&a.position.set(...s.position),s.greenwichAlignment&&(a.rotation.y=me.degToRad(s.greenwichAlignment)),d.load(m,l=>{var c;l.colorSpace=ne,r.map=l,r.needsUpdate=!0,(c=s.onTextureLoaded)==null||c.call(s)}),d.load(n,l=>{var c;r.normalMap=l,r.needsUpdate=!0,(c=s.onTextureLoaded)==null||c.call(s)}),a}function q(s){const m=s.spherePosition??[0,0,0],n=(s.sphereRadius??1)+(s.altitude??0),o=s.latitude*Math.PI/180,d=s.longitude*Math.PI/180,[r,a,l]=Q(s.latitude,s.longitude,n,m),c=new N(s.pointRadius??.03,16,16),i=new w({color:s.pointColor??16711680}),e=new L(c,i);e.position.set(r,a,l);const t=new P;if(t.add(e),s.label){const[h,u,y]=Q(s.latitude-3,s.longitude,n,m),f=new K,p=new x(h,u,y).normalize(),g=s.labelOffset??.05,b=p.clone().multiplyScalar(n+g);f.position.copy(b),f.text=s.label,f.fontSize=s.labelSize??.5,f.color=s.labelColor??"#ffffff",f.anchorX="center",f.anchorY="middle",f.font=s.font??"fonts/Arial Rounded Bold.ttf";const _=new he(0,d,0,"YXZ");_.x=-o,f.setRotationFromEuler(_),f.sync(),t.add(f)}return t}function ve(s){const m=new P;return s.points.forEach(n=>{m.add(q({spherePosition:s.spherePosition,sphereRadius:s.sphereRadius,...n}))}),m}function Q(s,m,n,o){const d=s*Math.PI/180,r=m*Math.PI/180;return[o[0]+n*Math.cos(d)*Math.sin(r),o[1]+n*Math.sin(d),o[2]+n*Math.cos(d)*Math.cos(r)]}function ze(s={}){const{position:m=[0,0,0],radius:n=1,parallels:o=4,meridians:d=8,segments:r=32,parallelColor:a=13421772,meridianColor:l=13421568,showParallels:c=!0,showMeridians:i=!0,showEquator:e=!0,equatorColor:t=16776960,equatorThickness:h=.02,showGreenwich:u=!1,greenwichColor:y=65535,greenwichThickness:f=.02}=s,p=new P;if(p.position.set(...m),c)for(let g=1;g<=o;g++){const b=Math.PI*g/(o+1),z=new V(0,0,n*Math.sin(b),n*Math.sin(b),0,2*Math.PI,!1,0).getPoints(r),S=new I().setFromPoints(z.map(k=>new x(k.x,n*Math.cos(b),k.y))),C=new B({color:a}),A=new Z(S,C);p.add(A)}if(i)for(let g=0;g<d;g++){const b=2*Math.PI*g/d,_=[];for(let A=0;A<=r;A++){const k=Math.PI*A/r,O=n*Math.sin(k)*Math.sin(b),D=n*Math.cos(k),G=n*Math.sin(k)*Math.cos(b);_.push(new x(O,D,G))}const z=new I().setFromPoints(_),S=new B({color:l}),C=new X(z,S);p.add(C)}if(e){const b=new V(0,0,n,n,0,2*Math.PI,!1,0).getPoints(r),_=new I().setFromPoints(b.map(C=>new x(C.x,0,C.y))),z=new B({color:t,linewidth:h?Math.max(1,h*10):2}),S=new Z(_,z);p.add(S)}if(u){const g=[];for(let S=0;S<=r;S++){const C=Math.PI*S/r,A=0,k=n*Math.cos(C),O=n*Math.sin(C);g.push(new x(A,k,O))}const b=new I().setFromPoints(g),_=new B({color:y,linewidth:f?Math.max(1,f*10):2}),z=new X(b,_);p.add(z)}return p}function Se(s){const m=new N(s.radius??200,64,32),n=new te,o=new pe({side:ye}),d=new L(m,o);return n.load(s.image,r=>{r.colorSpace=ne,o.map=r,o.needsUpdate=!0}),d}function Te(s,m){const n=[];function o(p){p instanceof I&&!(p instanceof M)?n.push(p):p.geometry instanceof I&&!(p.geometry instanceof M)?n.push(p.geometry):(p instanceof P||p instanceof ee)&&p.children.forEach(g=>o(g))}if(s.forEach(p=>o(p)),n.length===0)throw new Error("Aucune BufferGeometry trouvée pour la fusion");const d=ce(n,!0);if(!d)throw new Error("La fusion des géométries a échoué (vérifiez les entrées)");d.computeVertexNormals();const r=d.getAttribute("position"),a=new x(0,0,0);for(let p=0;p<r.count;p++)a.x+=r.getX(p),a.y+=r.getY(p),a.z+=r.getZ(p);const l=a.multiplyScalar(1/r.count);for(let p=0;p<r.count;p+=3){const g=r.getX(p),b=r.getY(p),_=r.getZ(p),z=r.getX(p+1),S=r.getY(p+1),C=r.getZ(p+1),A=r.getX(p+2),k=r.getY(p+2),O=r.getZ(p+2),D=new x(z-g,S-b,C-_),G=new x(A-g,k-b,O-_),se=new x().crossVectors(D,G).normalize(),oe=new x((g+z+A)/3,(b+S+k)/3,(_+C+O)/3),ie=l.clone().sub(oe).normalize();se.dot(ie)>0&&(r.setXYZ(p+1,A,k,O),r.setXYZ(p+2,z,S,C))}const c=new P,i=new L(d,new w({color:16777215,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));c.add(i);const e=new M(d),t=new T({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),h=new v(e,t);h.computeLineDistances(),c.add(h);const u=new M(d),y=new B({color:0,linewidth:2,transparent:!1,depthTest:!0}),f=new v(u,y);return c.add(f),c}function Fe(s,m,n,o,d=!1,r=!1,a=.5){const l=new P,c=xe(s,m,n,o,d,r),i=new L(c,new w({color:16777215,transparent:!0,opacity:a,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));l.add(i);const e=new M(c),t=new T({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),h=new v(e,t);h.computeLineDistances(),l.add(h);const u=new M(c),y=new B({color:0,linewidth:2,transparent:!1,depthTest:!0}),f=new v(u,y);return l.add(f),l}function De(s,m,n,o,d=!1,r=.5){const a=new P,l=be(s,m,n,o,d),c=new L(l,new w({color:16777215,transparent:!0,opacity:r,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));a.add(c);const i=new M(l),e=new T({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),t=new v(i,e);t.computeLineDistances(),a.add(t);const h=new M(l),u=new B({color:0,linewidth:2,transparent:!1,depthTest:!0}),y=new v(h,u);return a.add(y),a}function Ge(s,m,n,o,d,r=!1,a=!1,l=.5){const c=new P,i=_e(s,m,n,o,d,r,a),e=new L(i,new w({color:16777215,transparent:!0,opacity:l,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));c.add(e);const t=new M(i),h=new T({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),u=new v(t,h);u.computeLineDistances(),c.add(u);const y=new M(i),f=new B({color:0,linewidth:2,transparent:!1,depthTest:!0}),p=new v(y,f);return c.add(p),c}class Ce extends HTMLElement{constructor(){super(...arguments);E(this,"background",15658734);E(this,"width",500);E(this,"height",300);E(this,"renderer",null);E(this,"scene",null);E(this,"camera",null);E(this,"controls",null);E(this,"_objects",[]);E(this,"_imgElement");E(this,"_contentDescription");E(this,"_animationFrameId",null);E(this,"_fullscreenBtn");E(this,"_cameraPosition",new x(8,8,8));E(this,"_cameraTarget",new x(0,0,0));E(this,"_imgClickHandler")}set objects(n){this._objects=n,this.scene&&this.setObjects(n)}get objects(){return this._objects}connectedCallback(){var d,r;if(this.style.display="inline-block",this.width=parseInt(this.getAttribute("width")||"")||500,this.height=parseInt(this.getAttribute("height")||"")||300,this.style.width=`${this.width}px`,this.style.height=`${this.height}px`,this.style.position="relative",!this.camera){const a=new x(8,8,8),l=new x(0,0,0);this._cameraPosition=a.clone(),this._cameraTarget=l.clone(),this.camera=new F(35,this.width/this.height,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget)}const n=this.getAttribute("content");if(n)try{const a=JSON.parse(decodeURIComponent(n));this._contentDescription=a;const l=a.autoCenterZoomMargin??1.2;if(Array.isArray(a.cameraPosition)){const e=a.cameraPosition;this._cameraPosition.set(e[0],e[1],e[2]),this.camera&&this.camera.position.set(e[0],e[1],e[2])}if(Array.isArray(a.cameraTarget)){const e=a.cameraTarget;this._cameraTarget.set(e[0],e[1],e[2]),this.camera&&this.camera.lookAt(e[0],e[1],e[2]),this.controls&&(this.controls.target.set(e[0],e[1],e[2]),this.controls.update())}const c=a.objects.map(e=>{if(e.type==="geoPoint")return q(e);if(e.type==="geoPoints")return ve(e);if(e.type==="cube")return Ee(e.pos,e.size,{edges:e.edges,edgesColor:e.edgesColor,edgesOpacity:e.edgesOpacity,colors:e.colors??Le});if(e.type==="bufferGeometry"){if(e.geometry.type==="BufferGeometry"){const h=new Y().parse(e.geometry),u=new P,y=new L(h,new w({color:16777215,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));u.add(y);const f=new M(h),p=new T({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),g=new v(f,p);g.computeLineDistances(),u.add(g);const b=new M(h),_=new B({color:0,linewidth:2,transparent:!1,depthTest:!0}),z=new v(b,_);return u.add(z),u}else if(Array.isArray(e.geometry.geometries)){const t=new Y,h=e.geometry.geometries.filter(b=>b.type==="BufferGeometry").map(b=>t.parse(b));let u;h.length===1?u=h[0]:u=(void 0).mergeGeometries(h,!0);const y=new P,f=new L(u,new w({color:2236962,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));this.applyPolygonOffset(f),f.renderOrder=0,y.add(f);const p=J(u,!0);p.renderOrder=1;const g=J(u,!1);return g.renderOrder=2,y.add(p),y.add(g),y}}if(e.type==="realisticEarthSphere")return Me({...e,onTextureLoaded:()=>{this.renderStaticImage()}});if(e.type==="customWireSphere")return ze(e);if(e.type==="geoPoint")return q(e);if(e.type==="ambientLight")return new fe(e.color??16777215,e.intensity??1);if(e.type==="directionalLight"){const t=new ge(e.color??16777215,e.intensity??1);return e.position&&t.position.set(...e.position),t}if(e.type==="skySphere"){const t=Se({...e,onTextureLoaded:()=>{}});return t.isSkySphere=!0,t}if(e.type==="group")return new we().parse(e.object);if(e.type==="canvas3dButton"){const t=document.createElement("button");t.id=e.id,t.textContent=e.text,ke(t),t.type="button",t.style.cursor="pointer",e.position&&Object.assign(t.style,e.position),e.style&&Object.assign(t.style,e.style),t.style.zIndex="20",t.style.pointerEvents="auto";const h=()=>{this.dispatchEvent(new CustomEvent(e.onClick,{bubbles:!0,composed:!0}))};t.addEventListener("click",h);let u=this.querySelector(".canvas-threejs-overlay");return u||(u=document.createElement("div"),u.className="canvas-threejs-overlay",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.style.pointerEvents="none",u.style.zIndex="10",this.appendChild(u)),u.appendChild(t),null}return null}).filter(Boolean);this._objects=c,this.setObjects(c),Array.isArray((d=this._contentDescription)==null?void 0:d.cameraPosition)||Array.isArray((r=this._contentDescription)==null?void 0:r.cameraTarget)||this.autoCenterZoom(c,l);const i=this.querySelector(".canvas-threejs-overlay");i&&(i.style.display="none"),a.backgroundColor&&(this.background=a.backgroundColor,this.setBackground(a.backgroundColor))}catch(a){console.error("Erreur de parsing content:",a)}this._imgElement||(this._imgElement=document.createElement("img"),this._imgElement.style.position="absolute",this._imgElement.style.top="0",this._imgElement.style.left="0",this._imgElement.style.objectFit="contain",this._imgElement.style.zIndex="1",this._imgElement.style.pointerEvents="auto",this._imgElement.style.cursor="zoom-in",this._imgElement.style.width=this.width+"px",this._imgElement.style.height=this.height+"px",this._imgClickHandler=()=>this.enterFullscreen(),this._imgElement.addEventListener("click",this._imgClickHandler),this.appendChild(this._imgElement)),this._fullscreenBtn||(this._fullscreenBtn=document.createElement("button"),this._fullscreenBtn.innerHTML='<i class="bx bx-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',this._fullscreenBtn.title="Plein écran",this._fullscreenBtn.style.position="absolute",this._fullscreenBtn.style.top="5px",this._fullscreenBtn.style.right="5px",this._fullscreenBtn.style.zIndex="10",this._fullscreenBtn.style.pointerEvents="auto",this._fullscreenBtn.style.background="#fff",this._fullscreenBtn.style.border="1px solid #888",this._fullscreenBtn.style.borderRadius="6px",this._fullscreenBtn.style.width="48px",this._fullscreenBtn.style.height="48px",this._fullscreenBtn.style.display="flex",this._fullscreenBtn.style.alignItems="center",this._fullscreenBtn.style.justifyContent="center",this._fullscreenBtn.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",this._fullscreenBtn.style.cursor="pointer",this._fullscreenBtn.style.color="#222",this._fullscreenBtn.style.opacity="1",this._fullscreenBtn.onclick=()=>this.enterFullscreen(),this.appendChild(this._fullscreenBtn));const o=Be(this._objects);if(o.length>0){let a=0;o.forEach(l=>{l.addEventListener("synccomplete",()=>{a++,a===o.length&&this.renderStaticImage()},{once:!0})})}else this.renderStaticImage()}disconnectedCallback(){this._imgElement&&this._imgClickHandler&&(this._imgElement.removeEventListener("click",this._imgClickHandler),this._imgClickHandler=void 0),this.removeDynamicButtonListeners(),this.destroyRenderer()}renderStaticImage(){const n=this.width,o=this.height,d=document.createElement("canvas");d.width=n,d.height=o,d.style.width=n+"px",d.style.height=o+"px";const r=new R({canvas:d,antialias:!0,alpha:!0,preserveDrawingBuffer:!0});this.renderer&&this.background&&this.setBackground(this.background);const a=new j,l=new F(35,n/o,.1,1e3);l.position.copy(this._cameraPosition),l.lookAt(this._cameraTarget),this._objects.forEach(i=>a.add(i)),r.setSize(n,o,!1),r.render(a,l);const c=d.toDataURL("image/png");r.dispose(),typeof r.forceContextLoss=="function"&&r.forceContextLoss(),this._imgElement?(this._imgElement.style.width=n+"px",this._imgElement.style.height=o+"px",this._imgElement.width=n,this._imgElement.height=o,this._imgElement.src=c):console.error("Il n'y a pas de this._imgElement alors qu'on est dans renderStaticImage")}enterFullscreen(){if(this._imgElement&&this._fullscreenBtn&&(this._imgElement.style.display="none",this._fullscreenBtn.style.display="none"),window.innerWidth<800||/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)){const i=window.innerWidth,e=window.innerHeight,t=document.createElement("canvas");t.width=i,t.height=e,t.style.width="100vw",t.style.height="100vh",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="5000",document.body.appendChild(t),t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen();const h=document.createElement("button");h.type="button",h.style.position="fixed",h.style.top="20px",h.style.right="30px",h.style.zIndex="6000",h.style.background="#fff",h.style.border="1px solid #888",h.style.borderRadius="6px",h.style.width="48px",h.style.height="48px",h.style.fontSize="1.8em",h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center",h.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",h.style.cursor="pointer",h.innerHTML='<i class="bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',h.title="Quitter le plein écran",document.body.appendChild(h),this.renderer=new R({canvas:t,antialias:!0,alpha:!1}),this.renderer&&this.background&&this.setBackground(this.background),this.scene=new j,this.camera=new F(35,i/e,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget),this.controls=new $(this.camera,t),this.controls.target.copy(this._cameraTarget),this.controls.update(),this._objects.forEach(y=>this.scene.add(y)),this.renderer.setSize(i,e,!1),this.startAnimationLoop();const u=()=>{var y;document.body.contains(h)&&document.body.removeChild(h),this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),document.body.contains(t)&&document.body.removeChild(t),this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.renderStaticImage(),this._fullscreenBtn&&(this._fullscreenBtn.style.display=""),this._imgElement&&(this._imgElement.style.display=""),document.fullscreenElement&&((y=document.exitFullscreen)==null||y.call(document))};h.onclick=u,document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||u()},{once:!0});return}const o=document.createElement("button");o.type="button",o.style.position="fixed",o.style.top="20px",o.style.right="30px",o.style.zIndex="2000",o.style.background="#fff",o.style.border="1px solid #888",o.style.borderRadius="6px",o.style.width="48px",o.style.height="48px",o.style.fontSize="1.8em",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",o.style.cursor="pointer",o.innerHTML='<i class="bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',o.title="Quitter le plein écran",o.style.zIndex="6000",o.onclick=()=>{c()},document.body.appendChild(o);const d=window.innerWidth,r=window.innerHeight,a=document.createElement("canvas");a.width=d,a.height=r,a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="5000",document.body.appendChild(a);const l=this.querySelector(".canvas-threejs-overlay");l&&(l.style.position="fixed",l.style.display="block",l.style.top="0",l.style.left="0",l.style.width="100vw",l.style.height="100vh",l.style.zIndex="6000",l.style.pointerEvents="none",l.querySelectorAll("button").forEach(i=>{i.style.zIndex="6010",i.style.pointerEvents="auto"})),this.renderer=new R({canvas:a,antialias:!0,alpha:!1}),this.renderer&&this.background&&this.setBackground(this.background),this.scene=new j,this.camera=new F(35,d/r,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget),this.controls=new $(this.camera,a),this.controls.target.copy(this._cameraTarget),this.controls.update(),this._objects.forEach(i=>this.scene.add(i)),this.renderer.setSize(d,r,!1),this.startAnimationLoop();const c=()=>{document.body.contains(o)&&document.body.removeChild(o),l&&(l.style.position="absolute",l.style.display="none",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.zIndex="10",l.style.pointerEvents="none",l.querySelectorAll("button").forEach(i=>{i.style.zIndex="20",i.style.pointerEvents="auto"})),this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),document.body.removeChild(a),this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.renderStaticImage(),this._fullscreenBtn&&(this._fullscreenBtn.style.display=""),this._imgElement&&(this._imgElement.style.display="")}}setObjects(n){var o;this.scene&&(this.scene.clear(),n.forEach(d=>this.scene.add(d)),(o=this.renderer)==null||o.render(this.scene,this.camera))}startAnimationLoop(){if(this._animationFrameId)return;const n=()=>{var o;(o=this.renderer)==null||o.render(this.scene,this.camera),this.camera&&(this._cameraPosition.copy(this.camera.position),this.controls&&this._cameraTarget.copy(this.controls.target)),this._animationFrameId=requestAnimationFrame(n)};n()}stopAnimationLoop(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}applyPolygonOffset(n){const o=Array.isArray(n.material)?n.material:[n.material];for(const d of o)d.polygonOffset=!0,d.polygonOffsetFactor=1,d.polygonOffsetUnits=1}autoCenterZoom(n,o=1.2){const d=n.filter(t=>!t.isSkySphere).filter(t=>t.type!=="DirectionalLight"&&t.type!=="AmbientLight"),r=new U;d.forEach(t=>{if(t instanceof ee){const h=new U().setFromObject(t);if(r.union(h),t instanceof v&&t.userData.sourceGeometry){const u=new L(t.userData.sourceGeometry),y=new U().setFromObject(u);r.union(y)}}});const a=r.getCenter(new x),l=r.getSize(new x),c=l.x,i=l.y,e=l.z;if(o>0&&this.camera){const t=this.camera.fov*Math.PI/180,h=this.width/this.height,u=2*Math.atan(Math.tan(t/2)*h),y=i/(2*Math.tan(t/2)),f=c/(2*Math.tan(u/2)),p=o*Math.max(y,f,e),g=new x(a.x+p,a.y+p,a.z+p);this._cameraPosition.copy(g),this.camera.position.copy(g)}this._cameraTarget.copy(a),this.controls?(this.controls.target.copy(a),this.controls.update()):this.camera&&this.camera.lookAt(a)}destroyRenderer(){this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),this.renderer=null,this.scene=null,this.camera=null,this.controls=null}setBackground(n){this.renderer&&this.renderer.setClearColor(n)}removeDynamicButtonListeners(){const n=this.querySelector(".canvas-threejs-overlay");n&&(n.querySelectorAll("button").forEach(d=>{const r=d.cloneNode(!0);n.replaceChild(r,d)}),this.removeChild(n))}}customElements.define("canvas-3d",Ce);const Le=[16711680,10946825,16753500,14320679,16776960,13290010];function Re({id:s,content:m,width:n=200,height:o=200}){const d=encodeURIComponent(JSON.stringify(m));return`<canvas-3d id="${s}" content='${d}' width="${n}" height="${o}"></canvas-3d>`}function ke(s){s.className="inline-flex px-6 py-2.5 ml-6 bg-coopmaths-action dark:bg-coopmathsdark-action text-coopmaths-canvas dark:text-coopmathsdark-canvas font-medium text-xs leading-tight uppercase rounded shadow-md transform hover:bg-coopmaths-action-lightest dark:hover:bg-coopmathsdark-action-lightest hover:shadow-lg focus:bg-coopmaths-action-lightest dark:focus:bg-coopmathsdark-action-lightest focus:shadow-lg focus:outline-none focus:ring-0 active:bg-coopmaths-action-lightest dark:active:bg-coopmathsdark-action-lightest active:shadow-lg transition duration-150 ease-in-out",s.setAttribute("type","button")}function Be(s){const m=[];return s.forEach(n=>{n.traverse(o=>{o instanceof K&&m.push(o)})}),m}export{Re as a,De as b,Ge as c,Te as d,Fe as e,Q as s};
//# sourceMappingURL=Canvas3DElement-Ce07yeYA.js.map
