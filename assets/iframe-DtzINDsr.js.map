{"version":3,"file":"iframe-DtzINDsr.js","sources":["../../src/exercices/ressources/iframe.ts"],"sourcesContent":["import { get } from 'svelte/store'\nimport { updateIframeSize } from '../../lib/components/sizeTools'\nimport { exercicesParams } from '../../lib/stores/generalStore'\nimport { globalOptions } from '../../lib/stores/globalOptions'\nimport Exercice from '../Exercice'\nimport { createButon, createTextInput } from './_components'\n\nexport const uuid = 'iframe'\nexport const titre = 'Ressource externe'\nclass ressourceVideo extends Exercice {\n  container: HTMLDivElement\n  iframe: HTMLIFrameElement\n  fieldUrl: HTMLInputElement\n  button: HTMLButtonElement\n  url: URL = new URL('https://coopmaths.fr/alea')\n  constructor() {\n    super()\n    this.typeExercice = 'html'\n    this.container = document.createElement('div')\n    this.iframe = document.createElement('iframe')\n    this.iframe.setAttribute('width', '500')\n    this.iframe.setAttribute('height', '315')\n    window.addEventListener('resize', this.updateSize)\n    this.container.addEventListener('addedToDom', this.updateSize)\n    document.addEventListener('questionDisplay', this.updateSize)\n    this.iframe.classList.add('my-10')\n    this.fieldUrl = createTextInput({ placeholder: 'URL', autoCorrect: false })\n    this.button = createButon()\n    this.container.append(this.fieldUrl, this.button, this.iframe)\n    this.button.addEventListener('click', () => {\n      this.iframe.src = this.fieldUrl.value\n      this.sup = encodeURIComponent(this.fieldUrl.value)\n      exercicesParams.update((l) => {\n        if (\n          this.numeroExercice !== undefined &&\n          l[this.numeroExercice] !== undefined\n        ) {\n          l[this.numeroExercice].sup = encodeURIComponent(this.fieldUrl.value)\n        }\n        return l\n      })\n      this.updateSize()\n    })\n  }\n\n  private updateSize = () => {\n    updateIframeSize(this.container, this.iframe)\n  }\n\n  destroy() {\n    window.removeEventListener('resize', this.updateSize)\n    this.container.removeEventListener('addedToDom', this.updateSize)\n  }\n\n  get html() {\n    if (get(globalOptions).v === 'eleve') {\n      this.fieldUrl.remove()\n      this.button.remove()\n    }\n    if (this.sup !== undefined) {\n      let iframeUrl: string | URL\n      try {\n        iframeUrl = new URL(decodeURIComponent(this.sup))\n        if (\n          iframeUrl.protocol === 'http:' ||\n          iframeUrl.protocol === 'https:' ||\n          iframeUrl.protocol === 'ftp:'\n        ) {\n          iframeUrl = iframeUrl.href\n        } else {\n          iframeUrl = 'data:text/html,Erreur'\n        }\n      } catch (e) {\n        iframeUrl = 'data:text/html,Erreur'\n      }\n      this.iframe.src = iframeUrl\n      this.fieldUrl.value = decodeURIComponent(this.sup)\n    }\n    this.updateSize()\n    return this.container\n  }\n}\n\nexport default ressourceVideo\n"],"names":["uuid","titre","ressourceVideo","Exercice","__publicField","updateIframeSize","createTextInput","createButon","exercicesParams","l","get","globalOptions","iframeUrl"],"mappings":"w0FAOO,MAAMA,GAAO,SACPC,GAAQ,oBACrB,MAAMC,WAAuBC,CAAS,CAMpC,aAAc,CACZ,MAAA,EANFC,EAAA,kBACAA,EAAA,eACAA,EAAA,iBACAA,EAAA,eACAA,EAAA,WAAW,IAAI,IAAI,2BAA2B,GA+BtCA,EAAA,kBAAa,IAAM,CACzBC,EAAiB,KAAK,UAAW,KAAK,MAAM,CAC9C,GA9BE,KAAK,aAAe,OACpB,KAAK,UAAY,SAAS,cAAc,KAAK,EAC7C,KAAK,OAAS,SAAS,cAAc,QAAQ,EAC7C,KAAK,OAAO,aAAa,QAAS,KAAK,EACvC,KAAK,OAAO,aAAa,SAAU,KAAK,EACxC,OAAO,iBAAiB,SAAU,KAAK,UAAU,EACjD,KAAK,UAAU,iBAAiB,aAAc,KAAK,UAAU,EAC7D,SAAS,iBAAiB,kBAAmB,KAAK,UAAU,EAC5D,KAAK,OAAO,UAAU,IAAI,OAAO,EACjC,KAAK,SAAWC,EAAgB,CAAE,YAAa,MAAO,YAAa,GAAO,EAC1E,KAAK,OAASC,EAAA,EACd,KAAK,UAAU,OAAO,KAAK,SAAU,KAAK,OAAQ,KAAK,MAAM,EAC7D,KAAK,OAAO,iBAAiB,QAAS,IAAM,CAC1C,KAAK,OAAO,IAAM,KAAK,SAAS,MAChC,KAAK,IAAM,mBAAmB,KAAK,SAAS,KAAK,EACjDC,EAAgB,OAAQC,IAEpB,KAAK,iBAAmB,QACxBA,EAAE,KAAK,cAAc,IAAM,SAE3BA,EAAE,KAAK,cAAc,EAAE,IAAM,mBAAmB,KAAK,SAAS,KAAK,GAE9DA,EACR,EACD,KAAK,WAAA,CACP,CAAC,CACH,CAMA,SAAU,CACR,OAAO,oBAAoB,SAAU,KAAK,UAAU,EACpD,KAAK,UAAU,oBAAoB,aAAc,KAAK,UAAU,CAClE,CAEA,IAAI,MAAO,CAKT,GAJIC,EAAIC,CAAa,EAAE,IAAM,UAC3B,KAAK,SAAS,OAAA,EACd,KAAK,OAAO,OAAA,GAEV,KAAK,MAAQ,OAAW,CAC1B,IAAIC,EACJ,GAAI,CACFA,EAAY,IAAI,IAAI,mBAAmB,KAAK,GAAG,CAAC,EAE9CA,EAAU,WAAa,SACvBA,EAAU,WAAa,UACvBA,EAAU,WAAa,OAEvBA,EAAYA,EAAU,KAEtBA,EAAY,uBAEhB,MAAY,CACVA,EAAY,uBACd,CACA,KAAK,OAAO,IAAMA,EAClB,KAAK,SAAS,MAAQ,mBAAmB,KAAK,GAAG,CACnD,CACA,YAAK,WAAA,EACE,KAAK,SACd,CACF"}