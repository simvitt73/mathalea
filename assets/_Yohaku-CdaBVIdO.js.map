{"version":3,"file":"_Yohaku-CdaBVIdO.js","sources":["../../src/lib/saveAnswers.ts","../../src/exercices/6e/_Yohaku.ts"],"sourcesContent":["import type { IExercice } from '../lib/types'\n\n/**\n * Sauvegarde les r√©ponses d'un exercice de type tableau dont on connait le nombre de lignes et de colonnes\n */\nexport function saveAnswersFromTable(\n  exercice: IExercice,\n  indiceQuestion: number,\n  numberOfLines: number,\n  numberOfColumns: number,\n) {\n  for (let i = 1; i < numberOfLines + 1; i++) {\n    for (let j = 1; j < numberOfColumns + 1; j++) {\n      const input = document.querySelector(\n        `#champTexteEx${exercice.numeroExercice}Q${indiceQuestion}L${i}C${j}`,\n      ) as HTMLInputElement\n      if (input != null) {\n        const key = `Ex${exercice.numeroExercice}Q${indiceQuestion}L${i}C${j}`\n        if (input.value.length > 0 && typeof exercice.answers === 'object') {\n          exercice.answers[key] = input.value\n        }\n      }\n    }\n  }\n}\n","import {\n  contraindreValeur,\n  listeQuestionsToContenu,\n  randint,\n} from '../../modules/outils'\nimport { Yohaku } from '../../lib/outils/Yohaku'\nimport { ComputeEngine } from '@cortex-js/compute-engine'\nimport { context } from '../../modules/context'\nimport { saveAnswersFromTable } from '../../lib/saveAnswers'\nimport Exercice from '../Exercice'\nimport type { MathfieldElement } from 'mathlive'\n\nexport const titre = 'G√©n√©rateur de Yohaku'\nexport const interactifReady = true\nexport const interactifType = 'custom'\nexport const amcReady = true\nexport const amcType = 'AMCOpen'\n\nexport const uuid = '3a377'\n\nexport const refs = {\n  'fr-fr': ['Yohaku'],\n  'fr-ch': [],\n}\nexport const dateDeModifImportante = '16/12/2023'\n/**\n * @author Jean-Claude Lhote\n * @constructor\n */\nexport default class FabriqueAYohaku extends Exercice {\n  type:\n    | 'entiers'\n    | 'litt√©raux'\n    | 'expressions'\n    | 'fractions'\n    | 'entiers relatifs'\n    | 'fractions d√©nominateurs multiples'\n    | 'fractions positives d√©nominateurs premiers'\n\n  yohaku: Yohaku[]\n  constructor() {\n    super()\n    this.exoCustomResultat = true\n    this.nbQuestions = 3\n    this.sup = 30\n    this.sup2 = 1\n    this.sup3 = 3\n    this.sup4 = false\n    this.type = 'entiers'\n    this.yohaku = []\n    this.besoinFormulaireNumerique = ['Valeur maximale des donn√©es', 999]\n    this.besoinFormulaire2Numerique = [\n      'Op√©ration',\n      2,\n      '1 : Addition\\n2 : Multiplication',\n    ]\n    this.besoinFormulaire3Numerique = [\n      'Taille de la grille (nombre de cases horizontales)',\n      5,\n    ]\n    this.besoinFormulaire4CaseACocher = ['Avec aide', false]\n  }\n\n  nouvelleVersion() {\n    const type = this.type\n    for (\n      let i = 0, cpt = 0, texte, texteCorr;\n      i < this.nbQuestions && cpt < 50;\n\n    ) {\n      const donnees: string[] = []\n      const taille = contraindreValeur(2, 5, this.sup3, 3)\n      const valeurMax = contraindreValeur(taille ** 2 + 1, 999, this.sup, 30)\n      const operateur = this.sup2 === 1 ? 'addition' : 'multiplication'\n      const Case = this.sup4 ? randint(0, taille ** 2 - 1) : undefined\n      const largeur =\n        this.type === 'litt√©raux' ? (operateur === 'addition' ? 4 : 5) : 2\n      const yohaku = new Yohaku({\n        type,\n        taille,\n        largeur,\n        operation: operateur,\n        cellules: donnees,\n        Case,\n        valeurMax,\n      })\n      yohaku.calculeResultats()\n      const mot =\n        type === 'litt√©raux'\n          ? 'expressions'\n          : type.includes('frac')\n            ? 'fractions'\n            : 'nombres'\n      this.introduction =\n        operateur === 'addition'\n          ? `Trouver les ${mot} √† mettre dans les cases vides pour que les sommes de chaque ligne et chaque colonne soient exactes.`\n          : `Trouver les ${mot} √† mettre dans les cases vides pour que les produits de chaque ligne et chaque colonne soient exacts.`\n      this.introduction += `<br>Compl√©ter ${this.nbQuestions === 1 ? 'la' : 'chaque'} grille avec des ${mot} qui conviennent${this.sup4 ? '' : ' (plusieurs solutions possibles)'}.<br>`\n      texte = yohaku.representation({\n        numeroExercice: this.numeroExercice ?? 0,\n        question: i,\n        isInteractif: this.interactif,\n        classes: '',\n      })\n      texteCorr =\n        Case == null\n          ? \"La grille ci-dessous n'est donn√©e qu'√† titre d'exemple, il y a d'autres solutions.<br><br>\"\n          : ''\n      yohaku.solution = true\n      texteCorr += yohaku.representation({\n        numeroExercice: this.numeroExercice ?? 0,\n        question: i,\n        isInteractif: false,\n      })\n\n      this.yohaku[i] = yohaku\n      if (this.questionJamaisPosee(i, ...yohaku.cellules)) {\n        this.listeQuestions[i] = texte\n        this.listeCorrections[i] = texteCorr\n\n        if (context.isAmc) {\n          this.autoCorrection[i] = {\n            enonce: this.introduction + texte,\n            propositions: [\n              {\n                texte: '',\n                statut: 1, // OBLIGATOIRE (ici c'est le nombre de lignes du cadre pour la r√©ponse de l'√©l√®ve sur AMC)\n                sanscadre: true, // EE : ce champ est facultatif et permet (si true) de cacher le cadre et les lignes acceptant la r√©ponse de l'√©l√®ve\n              },\n            ],\n          }\n        }\n        i++\n      }\n      cpt++\n    }\n    listeQuestionsToContenu(this)\n  }\n\n  correctionInteractive = (i: number) => {\n    const taille = parseInt(this.sup3)\n    let cell\n    const spanResultat: HTMLSpanElement[][] = []\n    const saisies = []\n    const spanFeedback = document.querySelector(\n      `span#feedbackEx${this.numeroExercice}Q${i}`,\n    ) as HTMLSpanElement\n    saveAnswersFromTable(this, i, 2, this.sup3)\n    for (let l = 0; l < taille; l++) {\n      spanResultat[l] = []\n      for (let c = 0; c < taille; c++) {\n        cell = document.getElementById(\n          `champTexteEx${this.numeroExercice}Q${i}L${l + 1}C${c + 1}`,\n        ) as MathfieldElement\n        if (cell != null) {\n          spanResultat[l][c] = document.querySelector(\n            `span#resultatCheckEx${this.numeroExercice}Q${i}L${l + 1}C${c + 1}`,\n          ) as HTMLSpanElement\n          if (this.yohaku[i].type === 'litt√©raux') {\n            // on ne parse pas si c'est du litt√©ral. On blinde pour les champs vide.\n            if (cell.value != null)\n              saisies[l * taille + c] = cell.value.replace(',', '.') ?? '0'\n          } else {\n            if (cell.value != null)\n              saisies[l * taille + c] =\n                cell.value.replace(',', '.').replace(/\\((\\+?-?\\d+)\\)/, '$1') ??\n                '0'\n            // on peut taper des entiers dans les Yohaku fraction, mais ils doivent √™tre modifi√©s en fraction pour le calcul\n            if (\n              !isNaN(Number(saisies[l * taille + c])) &&\n              this.yohaku[i].type.includes('frac')\n            ) {\n              saisies[l * taille + c] = `\\\\frac{${saisies[l * taille + c]}}{1}`\n            }\n          }\n        } else if (cell == null && l * taille + c !== this.yohaku[i].Case) {\n          window.notify(\n            `Pas de cellule L${l + 1}C${c + 1} dans le document`,\n            {},\n          )\n        } else {\n          if (this.yohaku[i].Case != null) {\n            saisies[l * taille + c] =\n              this.yohaku[i].cellules[this.yohaku[i].Case]\n          }\n        }\n      }\n    }\n    const resultats = this.saisieCoherente(saisies, taille, i)\n    let resultat = 'OK'\n    let feedback = ''\n    for (const [data, value] of Object.entries(resultats)) {\n      feedback += `${data.replace('Colonne', 'Colonne ').replace('Ligne', 'Ligne ')} ${value ? 'correcte' : 'incorrecte'}.<br>`\n      resultat = value ? resultat : 'KO'\n    }\n\n    if (resultat === 'OK') {\n      for (let l = 0; l < taille; l++) {\n        for (let c = 0; c < taille; c++) {\n          if (spanResultat[l][c] != null) {\n            spanResultat[l][c].innerHTML = 'üòé'\n          }\n        }\n      }\n    } else {\n      for (let l = 0; l < taille; l++) {\n        for (let c = 0; c < taille; c++) {\n          if (spanResultat[l][c] != null) {\n            spanResultat[l][c].innerHTML = '‚òπÔ∏è'\n          }\n        }\n      }\n      resultat = 'KO'\n    }\n    if (spanFeedback != null) {\n      spanFeedback.innerHTML = feedback\n      spanFeedback.style.display = 'block'\n    }\n\n    return [\n      resultats.Ligne1 ? 'OK' : 'KO',\n      resultats.Ligne2 ? 'OK' : 'KO',\n      resultats.Colonne1 ? 'OK' : 'KO',\n      resultats.Colonne2 ? 'OK' : 'KO',\n    ]\n  }\n\n  saisieCoherente(\n    saisies: string[],\n    taille: number,\n    question: number,\n  ): Record<string, string> {\n    const engine = new ComputeEngine()\n    const test = function (yohaku: Yohaku[], i: number, valeurs: string[]) {\n      let resultatOK\n      const resultVal = engine.parse(String(yohaku[question].operate(valeurs)))\n      const resultatAttendu = engine.parse(yohaku[question].resultats[i])\n      if (yohaku[question].type === 'litt√©raux') {\n        resultatOK = resultVal.isSame(resultatAttendu)\n      } else {\n        resultatOK = resultVal.isEqual(resultatAttendu)\n      }\n      return resultatOK\n    }\n    let result = {}\n    for (let i = 0; i < taille; i++) {\n      const valeurs = []\n      for (let j = 0; j < taille; j++) {\n        valeurs.push(saisies[i + j * taille] ?? '0')\n      }\n      result = Object.assign(\n        result,\n        Object.fromEntries([\n          [`Colonne${i + 1}`, test(this.yohaku, i, valeurs)],\n        ]),\n      )\n    }\n    for (let i = taille; i < taille * 2; i++) {\n      const valeurs = []\n      for (let j = 0; j < taille; j++) {\n        valeurs.push(saisies[(i - taille) * taille + j] ?? '0')\n      }\n      result = Object.assign(\n        result,\n        Object.fromEntries([\n          [`Ligne${i - taille + 1}`, test(this.yohaku, i, valeurs)],\n        ]),\n      )\n    }\n    return result\n  }\n}\n"],"names":["saveAnswersFromTable","exercice","indiceQuestion","numberOfLines","numberOfColumns","i","j","input","key","titre","interactifReady","interactifType","amcReady","amcType","uuid","refs","dateDeModifImportante","FabriqueAYohaku","Exercice","__publicField","taille","cell","spanResultat","saisies","spanFeedback","l","c","resultats","resultat","feedback","data","value","type","cpt","texte","texteCorr","donnees","contraindreValeur","valeurMax","operateur","Case","randint","largeur","yohaku","Yohaku","mot","context","listeQuestionsToContenu","question","engine","ComputeEngine","test","valeurs","resultatOK","resultVal","resultatAttendu","result"],"mappings":"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"}