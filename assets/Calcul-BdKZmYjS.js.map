{"version":3,"file":"Calcul-BdKZmYjS.js","sources":["../../src/lib/mathFonctions/Calcul.ts"],"sourcesContent":["import type Trinome from '../../modules/Trinome'\n\n/**\n * Élément d'une opération (terme ou facteur ou ...)\n */\nexport class Operande {\n  value: string | number\n  constructor(value: string | number) {\n    this.value = value\n  }\n\n  get string(): string {\n    return this.value.toString()\n  }\n\n  toString({ parentheses }: { parentheses?: boolean } = {}): string {\n    if (parentheses) {\n      return `(${this.string})`\n    }\n    return this.string\n  }\n}\n\n/**\n * Opérande de la forme k * e^trinome\n */\nexport class ExponentialOperande extends Operande {\n  type: 'exponential'\n  polynome: Trinome\n  k: number\n  constructor({ polynome, k = 1 }: { polynome: Trinome; k?: number }) {\n    super(polynome.toString())\n    this.type = 'exponential'\n    this.polynome = polynome\n    this.k = k\n  }\n\n  get string(): string {\n    if (this.polynome.toString() === '') {\n      return String(this.k)\n    }\n    if (this.k === 0) {\n      return '0'\n    }\n    const kString = handle1(this.k)\n    return `${kString}e^{${this.polynome.toString()}}`\n  }\n}\n\n/**\n * Un calcul est un arbre qui a pour feuilles des opérandes ou des calculs\n * L'objectif de cette classe est de pouvoir gérer les calculs avec les étapes intermédiaires\n * et la gestion des parenthèses, signes et autres notations mathématiques\n */\nabstract class Calcul {\n  abstract string: string\n\n  toString({ parentheses }: { parentheses?: boolean } = {}): string {\n    if (parentheses) {\n      return `(${this.string})`\n    }\n    return this.string\n  }\n}\n\n/**\n * Addition de deux termes qui peuvent être des opérandes ou des calculs\n */\nexport class Add extends Calcul {\n  type: 'add'\n  operande1: Operande | Calcul | string\n  operande2: Operande | Calcul | string\n  constructor(\n    operande1: Operande | Calcul | string,\n    operande2: Operande | Calcul | string,\n  ) {\n    super()\n    this.type = 'add'\n    this.operande1 = operande1\n    this.operande2 = operande2\n  }\n\n  get result() {\n    if (\n      this.operande1 instanceof ExponentialOperande &&\n      this.operande2 instanceof ExponentialOperande\n    ) {\n      if (this.operande1.polynome.isEqual(this.operande2.polynome)) {\n        return new ExponentialOperande({\n          polynome: this.operande1.polynome,\n          k: this.operande1.k + this.operande2.k,\n        })\n      }\n    }\n    return this\n  }\n\n  get string(): string {\n    return `${this.operande1.toString()} + ${this.operande2.toString()}`\n  }\n}\n\n/**\n * Soustraction de deux termes qui peuvent être des opérandes ou des calculs\n */\nexport class Sub extends Calcul {\n  type: 'sub'\n  operande1: Operande | Calcul | string\n  operande2: Operande | Calcul | string\n  constructor(operande1: Operande | Calcul, operande2: Operande | Calcul) {\n    super()\n    this.type = 'sub'\n    this.operande1 = operande1\n    this.operande2 = operande2\n  }\n\n  get string(): string {\n    return `${this.operande1.toString()} - ${this.operande2.toString()}`\n  }\n\n  get result() {\n    if (\n      this.operande1 instanceof ExponentialOperande &&\n      this.operande2 instanceof ExponentialOperande\n    ) {\n      if (this.operande1.polynome.isEqual(this.operande2.polynome)) {\n        return new ExponentialOperande({\n          polynome: this.operande1.polynome,\n          k: this.operande1.k - this.operande2.k,\n        })\n      }\n    }\n    return this\n  }\n}\n\n/**\n * Multiplication de deux facteurs qui peuvent être des opérandes ou des calculs\n */\nexport class Mul extends Calcul {\n  type: 'mul'\n  operande1: Operande | Calcul | string\n  operande2: Operande | Calcul | string\n  constructor(\n    operande1: Operande | Calcul | string,\n    operande2: Operande | Calcul | string,\n  ) {\n    super()\n    this.type = 'mul'\n    this.operande1 = operande1\n    this.operande2 = operande2\n  }\n\n  get step(): string {\n    if (\n      this.operande1 instanceof ExponentialOperande &&\n      this.operande2 instanceof ExponentialOperande\n    ) {\n      if (this.operande1.k === 0 || this.operande2.k === 0) {\n        return ''\n      }\n      const kString = handle1(this.operande1.k * this.operande2.k)\n      return `${kString}e^{${this.operande1.polynome.toString()} + ${needParentheses(this.operande2.polynome.toString())}}`\n    }\n    return ''\n  }\n\n  get result() {\n    if (\n      this.operande1 instanceof ExponentialOperande &&\n      this.operande2 instanceof ExponentialOperande\n    ) {\n      return new ExponentialOperande({\n        polynome: this.operande1.polynome.add(this.operande2.polynome),\n        k: this.operande1.k * this.operande2.k,\n      })\n    }\n    return this\n  }\n\n  get string(): string {\n    const operande1HasParentheses =\n      this.operande1 instanceof Add || this.operande1 instanceof Sub\n    const operande2HasParentheses =\n      this.operande2 instanceof Add ||\n      this.operande2 instanceof Sub ||\n      this.operande2.toString()[0] === '-'\n    return `${this.operande1.toString({ parentheses: operande1HasParentheses })} \\\\times ${this.operande2.toString({ parentheses: operande2HasParentheses })}`\n  }\n}\n\n/**\n * Fraction avec un numérateur et un dénominateur qui peuvent être des opérandes ou des calculs\n */\nexport class Frac extends Calcul {\n  type: 'frac'\n  num: Operande | Calcul | string\n  den: Operande | Calcul | string\n  constructor(\n    num: Operande | Calcul | string,\n    den: Operande | Calcul | string,\n  ) {\n    super()\n    this.type = 'frac'\n    this.num = num\n    this.den = den\n  }\n\n  get step(): string {\n    if (\n      this.num instanceof ExponentialOperande &&\n      this.den instanceof ExponentialOperande\n    ) {\n      return `${handle1(this.num.k / this.den.k)}e^{${this.num.polynome.toString()} - ${needParentheses(this.den.polynome.toString())}}`\n    }\n    return ''\n  }\n\n  get result() {\n    if (\n      this.num instanceof ExponentialOperande &&\n      this.den instanceof ExponentialOperande\n    ) {\n      return new ExponentialOperande({\n        polynome: this.num.polynome.sub(this.den.polynome),\n        k: this.num.k / this.den.k,\n      })\n    }\n    return this\n  }\n\n  get string(): string {\n    return `\\\\dfrac{${this.num.toString()}}{${this.den.toString()}}`\n  }\n}\n\n/**\n * Puissance d'un opérande ou d'un calcul\n */\nexport class Pow extends Calcul {\n  type: 'pow'\n  operande: Operande | Calcul | string\n  exp: number\n  constructor(operande: Operande | Calcul, exp: number) {\n    super()\n    this.type = 'pow'\n    this.operande = operande\n    this.exp = exp\n  }\n\n  get string(): string {\n    return `${this.operande.toString({ parentheses: true })}^{${this.exp.toString()}}`\n  }\n\n  get step(): string {\n    if (this.operande instanceof ExponentialOperande) {\n      if (this.exp === 0 || this.operande.k === 0) {\n        return ''\n      }\n      const kString = handle1(this.operande.k ** this.exp)\n      return `${kString}e^{${needParentheses(this.operande.polynome.toString())} \\\\times ${needParentheses(this.exp)}}`\n    }\n    return ''\n  }\n\n  get result() {\n    if (this.operande instanceof ExponentialOperande) {\n      return new ExponentialOperande({\n        polynome: this.operande.polynome.mul(this.exp),\n        k: this.operande.k ** this.exp,\n      })\n    }\n    return this\n  }\n}\n\n/*\n * Quand mettre des parenthèses ?\n *\n * Pour une addition ou une soustraction :\n *   - Jamais pour l'opérande 1\n *   - Pour l'opérande 2 si c'est une addition, une soustraction ou un nombre négatif ou un positif avec le signe devant\n *\n * Pour une multiplication :\n *  - Pour l'opérande 1 si c'est une addition ou une soustraction\n *  - Pour l'opérande 2 si c'est une addition, une soustraction ou un nombre négatif ou un positif avec le signe devant\n *\n * */\n\nfunction handle1(k: number) {\n  if (k === 1) {\n    return ''\n  }\n  if (k === -1) {\n    return '-'\n  }\n  return String(k)\n}\n\nfunction needParentheses(expression: string | Operande | Calcul | number) {\n  const string = expression.toString()\n  if (string.includes('+') || string.includes('-')) {\n    return `(${string})`\n  }\n  return string\n}\n"],"names":["Operande","value","__publicField","parentheses","ExponentialOperande","polynome","k","handle1","Calcul","Add","operande1","operande2","Sub","Mul","needParentheses","operande1HasParentheses","operande2HasParentheses","Frac","num","den","Pow","operande","exp","expression","string"],"mappings":"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"}