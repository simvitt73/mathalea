{"version":3,"file":"Figures2D-C8-KKsFd.js","sources":["../../src/lib/2d/Figures2D.ts"],"sourcesContent":["import { context } from '../../modules/context'\nimport type { Droite } from './droites'\nimport { ObjetMathalea2D } from './ObjetMathalea2D'\nimport { pointAbstrait, type PointAbstrait } from './PointAbstrait'\nimport { type Segment } from './segmentsVecteurs'\nimport { rotation, symetrieAxiale } from './transformations'\n\n// ne fonctionne qu'avec cx=0 et cy=0... je ne sais pas pourquoi.\n// Donc si cx = 0 et cy = 0, alors, il y a plein de code qui ne sert à rien.\nfunction computeSymmetryMatrix(\n  progress: number,\n  angleDeg: number,\n  cx: number,\n  cy: number,\n) {\n  const angle = (angleDeg * Math.PI) / 180\n  const cosA = Math.cos(angle)\n  const sinA = Math.sin(angle)\n\n  const sy = 1 - 2 * progress\n\n  const a = cosA * cosA + sinA * sinA * sy\n  const b = cosA * sinA * (1 - sy)\n  const c = cosA * sinA * (1 - sy)\n  const d = sinA * sinA + cosA * cosA * sy\n\n  const tx = cx - a * cx - c * cy\n  const ty = cy - b * cx - d * cy\n\n  return { a, b, c, d, tx, ty }\n}\nfunction rotatedBoundingBoxWithCenter(\n  xmin: number,\n  ymin: number,\n  xmax: number,\n  ymax: number,\n  alpha: number,\n  cx: number,\n  cy: number,\n): [number, number, number, number] {\n  const w2 = (xmax - xmin) / 2\n  const h2 = (ymax - ymin) / 2\n\n  const cosA = Math.cos(alpha)\n  const sinA = Math.sin(alpha)\n\n  const dx = Math.abs(w2 * cosA) + Math.abs(h2 * sinA)\n  const dy = Math.abs(w2 * sinA) + Math.abs(h2 * cosA)\n\n  const centerX = (xmin + xmax) / 2\n  const centerY = (ymin + ymax) / 2\n\n  const rotatedCenterX = cosA * (centerX - cx) - sinA * (centerY - cy) + cx\n  const rotatedCenterY = sinA * (centerX - cx) + cosA * (centerY - cy) + cy\n\n  return [\n    rotatedCenterX - dx,\n    rotatedCenterY - dy,\n    rotatedCenterX + dx,\n    rotatedCenterY + dy,\n  ]\n}\n// Classe de base pour les formes 2D sans les méthodes de transformation et d'animation de Figure2D\nexport class Shape2D extends ObjetMathalea2D {\n  codeSvg: string\n  codeTikz: string\n  x: number\n  y: number\n  angle: number\n  scale: { x: number; y: number }\n  width: number // laargeur en cm\n  height: number // hauteur en cm\n  pixelsParCm: number\n  bordures: [number, number, number, number] // [xmin, ymin, xmax, ymax]\n  opacite = 1\n  constructor({\n    name = '',\n    codeSvg,\n    codeTikz,\n    x = 0,\n    y = 0,\n    angle = 0,\n    scale = { x: 1, y: 1 },\n    width,\n    height,\n    pixelsParCm = context.pixelsParCm,\n    opacite = 1,\n    bordures,\n  }: {\n    name?: string\n    codeSvg: string\n    codeTikz: string\n    x?: number\n    y?: number\n    angle?: number\n    scale?: { x: number; y: number }\n    width: number\n    height: number\n    pixelsParCm?: number\n    opacite?: number\n    bordures?: [number, number, number, number]\n  }) {\n    super()\n    this.name = name\n    this.codeSvg = codeSvg\n    this.codeTikz = codeTikz\n    this.x = x\n    this.y = y\n    this.angle = angle\n    this.scale = scale\n    this.width = width\n    this.height = height\n    this.pixelsParCm = pixelsParCm\n    this.opacite = opacite\n    this.bordures = bordures ?? [\n      this.x - this.width / 2,\n      this.y - this.height / 2,\n      this.x + this.width / 2,\n      this.y + this.height / 2,\n    ]\n  }\n\n  svg(coeff: number) {\n    return `<g opacity=${this.opacite} transform=\"translate(${(this.x * coeff).toFixed(2)}, ${(-this.y * coeff).toFixed(2)}) ${this.scale.x !== 1 || this.scale.y !== 1 || coeff !== 20 ? `scale(${((this.scale.x * coeff) / 20).toFixed(3)},${((this.scale.y * coeff) / 20).toFixed(3)})` : ''} ${this.angle !== 0 ? `rotate(${(-this.angle).toFixed(2)})` : ''}\">${this.codeSvg}</g>`\n  }\n\n  tikz() {\n    // const tikzCenterX = this.width / 2\n    // const tikzCenterY = this.height / 2\n    return `\\\\begin{scope}[fill opacity=${this.opacite}, shift={(${this.x.toFixed(2)},${this.y.toFixed(2)})}${this.scale.x !== 1 ? `, xscale=${this.scale.x.toFixed(3)}` : ''}${this.scale.y !== 1 ? `, yscale=${this.scale.y.toFixed(3)}` : ''}${this.angle !== 0 ? `, rotate around={${this.angle}:(0,0)}` : ''}]\n    ${this.codeTikz}\n    \\\\end{scope}`\n  }\n\n  updateBordures() {\n    this.bordures = [\n      this.x - this.width / 2,\n      this.y - this.height / 2,\n      this.x + this.width / 2,\n      this.y + this.height / 2,\n    ]\n    if (this.angle !== 0) {\n      this.bordures = rotatedBoundingBoxWithCenter(\n        this.bordures[0],\n        this.bordures[1],\n        this.bordures[2],\n        this.bordures[3],\n        (this.angle * Math.PI) / 180,\n        this.x,\n        this.y,\n      )\n    }\n  }\n\n  rotate(angle: number) {\n    this.angle += angle\n    this.bordures = rotatedBoundingBoxWithCenter(\n      this.bordures[0],\n      this.bordures[1],\n      this.bordures[2],\n      this.bordures[3],\n      (angle * Math.PI) / 180,\n      this.x,\n      this.y,\n    )\n    return this\n  }\n\n  dilate(factor: { x: number; y: number } | number) {\n    if (typeof factor === 'number') {\n      factor = { x: factor, y: factor }\n    }\n    this.scale.x *= factor.x\n    this.scale.y *= factor.y\n    this.width = this.width * factor.x\n    this.height = this.height * factor.y\n    let xmin = this.bordures[0]\n    let ymin = this.bordures[1]\n    let xmax = this.bordures[2]\n    let ymax = this.bordures[3]\n    xmin = (xmin - this.x) * factor.x + this.x\n    ymin = (ymin - this.y) * factor.y + this.y\n    xmax = (xmax - this.x) * factor.x + this.x\n    ymax = (ymax - this.y) * factor.y + this.y\n    this.bordures = [xmin, ymin, xmax, ymax]\n    return this\n  }\n\n  translate(dx: number, dy: number) {\n    this.x += dx\n    this.y += dy\n    this.bordures = [\n      this.bordures[0] + dx,\n      this.bordures[1] + dy,\n      this.bordures[2] + dx,\n      this.bordures[3] + dy,\n    ]\n    return this\n  }\n\n  flip(axes: 'x' | 'y' | 'xy' = 'x') {\n    if (axes === 'x') {\n      this.scale.x = -this.scale.x\n      this.angle = -this.angle\n    } else if (axes === 'y') {\n      this.scale.y = -this.scale.y\n      this.angle = -this.angle\n    } else if (axes === 'xy') {\n      this.scale.x = -this.scale.x\n      this.scale.y = -this.scale.y\n    }\n    return this\n  }\n\n  clone() {\n    const codeTikz = String(this.codeTikz)\n    const codeSvg = String(this.codeSvg)\n    const x = Number(this.x)\n    const y = Number(this.y)\n    const angle = Number(this.angle)\n    const scale = { x: this.scale.x, y: this.scale.y }\n    const width = Number(this.width)\n    const height = Number(this.height)\n    const pixelsParCm = Number(this.pixelsParCm)\n    return new Shape2D({\n      codeSvg,\n      codeTikz,\n      x,\n      y,\n      angle,\n      scale,\n      width,\n      height,\n      pixelsParCm,\n      opacite: this.opacite,\n      bordures: this.bordures,\n    })\n  }\n}\n\n// Classe pour les figures 2D avec des méthodes de transformation et d'animation basée sur Shape2D\nexport class Figure2D extends Shape2D {\n  codeSvg: string\n  codeTikz: string\n  scale: { x: number; y: number }\n  angle: number\n  width: number // laargeur en cm\n  height: number // hauteur en cm\n  pixelsParCm: number\n  axes: Segment[]\n  nonAxe: Segment | null\n  centre: PointAbstrait | null\n  nbAxes: number\n  name: string\n  bordures: [number, number, number, number] // [xmin, ymin, xmax, ymax]\n  opacite: number\n  constructor({\n    codeSvg,\n    codeTikz,\n    x = 0,\n    y = 0,\n    angle = 0,\n    scale = { x: 1, y: 1 },\n    width = 0,\n    height = 0,\n    pixelsParCm = context.pixelsParCm,\n    axes = [],\n    nonAxe = null,\n    centre = null,\n    nbAxes,\n    opacite = 1,\n    name = Date.now().toString(),\n    bordures,\n  }: {\n    codeSvg: string\n    codeTikz: string\n    x?: number\n    y?: number\n    angle?: number\n    scale?: { x: number; y: number }\n    width: number\n    height: number\n    pixelsParCm?: number\n    axes?: Segment[]\n    centre?: PointAbstrait | null\n    nbAxes?: number\n    opacite?: number\n    name?: string\n    nonAxe?: Segment | null\n    bordures?: [number, number, number, number]\n  }) {\n    super({ codeSvg, codeTikz, x, y, angle, scale, width, height })\n    this.name = name\n    this.x = x\n    this.y = y\n    this.width = width\n    this.height = height\n    this.pixelsParCm = pixelsParCm\n    this.angle = angle\n    this.scale = scale\n    this.codeSvg = codeSvg\n    this.codeTikz = codeTikz\n    this.opacite = opacite\n    this.bordures = [\n      this.x - this.width / 2,\n      this.y - this.height / 2,\n      this.x + this.width / 2,\n      this.y + this.height / 2,\n    ]\n    this.axes = axes\n    this.nonAxe = nonAxe\n    this.nbAxes = nbAxes ?? this.axes.length\n    this.centre = centre\n    if (this.angle !== 0) {\n      this.bordures = rotatedBoundingBoxWithCenter(\n        this.bordures[0],\n        this.bordures[1],\n        this.bordures[2],\n        this.bordures[3],\n        (this.angle * Math.PI) / 180,\n        this.x,\n        this.y,\n      )\n    }\n  }\n\n  svg(coeff: number) {\n    return `<g opacity=${this.opacite} transform=\"translate(${(this.x * coeff).toFixed(2)}, ${(-this.y * coeff).toFixed(2)}) scale(${this.scale.x.toFixed(3)},${this.scale.y.toFixed(3)}) rotate(${(-this.angle).toFixed(2)})\">${this.codeSvg}</g>`\n  }\n\n  tikz() {\n    // const tikzCenterX = this.width / 2\n    // const tikzCenterY = this.height / 2\n    return `\\\\begin{scope}[fill opacity=${this.opacite}, shift={(${this.x.toFixed(2)},${this.y.toFixed(2)})}, xscale=${this.scale.x.toFixed(3)}, yscale=${this.scale.y.toFixed(3)}, rotate around={${-this.angle.toFixed(2)}:(0,0)}]\n    ${this.codeTikz}\n    \\\\end{scope}`\n  }\n\n  rotate(angle: number) {\n    this.angle += angle\n    this.bordures = rotatedBoundingBoxWithCenter(\n      this.bordures[0],\n      this.bordures[1],\n      this.bordures[2],\n      this.bordures[3],\n      (this.angle * Math.PI) / 180,\n      this.x,\n      this.y,\n    )\n    return this\n  }\n\n  dilate(factor: { x: number; y: number } | number) {\n    if (typeof factor === 'number') {\n      factor = { x: factor, y: factor }\n    }\n    this.scale.x *= factor.x\n    this.scale.y *= factor.y\n    this.width = this.width * factor.x\n    this.height = this.height * factor.y\n    let xmin = this.bordures[0]\n    let ymin = this.bordures[1]\n    let xmax = this.bordures[2]\n    let ymax = this.bordures[3]\n    xmin = (xmin - this.x) * factor.x + this.x\n    ymin = (ymin - this.y) * factor.y + this.y\n    xmax = (xmax - this.x) * factor.x + this.x\n    ymax = (ymax - this.y) * factor.y + this.y\n    this.bordures = [xmin, ymin, xmax, ymax]\n    return this\n  }\n\n  translate(dx: number, dy: number) {\n    this.x += dx\n    this.y += dy\n    this.bordures = [\n      this.bordures[0] + dx,\n      this.bordures[1] + dy,\n      this.bordures[2] + dx,\n      this.bordures[3] + dy,\n    ]\n    return this\n  }\n\n  flip(axes: 'x' | 'y' | 'xy' = 'x') {\n    if (axes === 'x') {\n      this.scale.x = -this.scale.x\n      this.angle = -this.angle\n    } else if (axes === 'y') {\n      this.scale.y = -this.scale.y\n      this.angle = -this.angle\n    } else if (axes === 'xy') {\n      this.scale.x = -this.scale.x\n      this.scale.y = -this.scale.y\n    }\n    return this\n  }\n\n  symetrie(axe: Droite) {\n    // Calcul de l'angle de l'axe par rapport à l'horizontale\n    const angleAxe =\n      (Math.atan2(axe.y1 - axe.y2, axe.x2 - axe.x1) * 180) / Math.PI\n    // Calcul du centre de symétrie (image de (this.x, this.y) par la symétrie d'axe 'axe')\n    // Formule de la symétrie orthogonale d'un point (px, py) par rapport à la droite passant par (x1, y1), (x2, y2)\n    const { a, b, c, d, tx, ty } = computeSymmetryMatrix(1, angleAxe, 0, 0)\n\n    const svg = `<g transform=\"matrix(${a}, ${b}, ${c}, ${d}, ${tx}, ${ty})\">${this.codeSvg}</g>`\n    const xImg = a * this.x - c * this.y + tx\n    const yImg = -b * this.x + d * this.y - ty\n    // Calcul du code TikZ pour la symétrie\n    // On applique la même transformation que pour le SVG, mais en TikZ\n    // L'angle de symétrie est angleAxe, le centre est (0,0) car la matrice est centrée sur (0,0)\n    // Inversion de l'axe des y pour TikZ (y vers le haut)\n    const tikz = `\\\\begin{scope}[cm={${a.toFixed(4)},${-b.toFixed(4)},${-c.toFixed(4)},${d.toFixed(4)},(${tx.toFixed(4)},${-ty.toFixed(4)})}]\n  ${this.codeTikz}\n  \\\\end{scope}`\n    // Nouvelle instance avec les mêmes propriétés, mais codeSvg/codeTikz modifiés\n    const symForme = new Figure2D({\n      codeSvg: svg,\n      codeTikz: tikz,\n      x: xImg,\n      y: yImg,\n      // L'angle après symétrie : 2 * angleAxe - this.angle\n      angle: (360 - this.angle) % 360,\n      scale: this.scale,\n      width: this.width,\n      height: this.height,\n      pixelsParCm: this.pixelsParCm,\n      axes: this.axes.map((el) => symetrieAxiale(el, axe)),\n      nonAxe: this.nonAxe,\n      centre: this.centre == null ? null : symetrieAxiale(this.centre, axe),\n      nbAxes: this.nbAxes,\n      opacite: this.opacite,\n      name: this.name + '_sym',\n    })\n    symForme.bordures = rotatedBoundingBoxWithCenter(\n      symForme.bordures[0],\n      symForme.bordures[1],\n      symForme.bordures[2],\n      symForme.bordures[3],\n      (angleAxe * Math.PI) / 180,\n      xImg,\n      yImg,\n    )\n    return symForme\n  }\n\n  copy(newName: string) {\n    const codeTikz = String(this.codeTikz)\n    const codeSvg = String(this.codeSvg)\n    const x = Number(this.x)\n    const y = Number(this.y)\n    const angle = Number(this.angle)\n    const scale = { x: this.scale.x, y: this.scale.y }\n    const width = Number(this.width)\n    const height = Number(this.height)\n    const pixelsParCm = Number(this.pixelsParCm)\n    const axes = this.axes.map((el) => el)\n    const centre = this.centre\n    const nbAxes = Number(this.nbAxes)\n    const opacite = Number(this.opacite)\n    const name = newName\n    return new Figure2D({\n      codeSvg,\n      codeTikz,\n      x,\n      y,\n      angle,\n      scale,\n      width,\n      height,\n      pixelsParCm,\n      axes,\n      centre,\n      nbAxes,\n      opacite,\n      name,\n    })\n  }\n\n  rotationAnimee({\n    angleStart = 0,\n    angleEnd = 180,\n    cx,\n    cy,\n    duration = '2s',\n    repeatCount = 'indefinite',\n    loop = true,\n    delay = 0,\n  }: {\n    angleStart?: number\n    angleEnd?: number\n    duration?: string\n    repeatCount?: string\n    loop?: boolean\n    delay?: number\n    cx?: number\n    cy?: number\n  }) {\n    if (cx === undefined) {\n      cx = this.x * this.pixelsParCm\n    } else cx *= this.pixelsParCm\n    if (cy === undefined) {\n      cy = -this.y * this.pixelsParCm\n    } else cy *= -this.pixelsParCm\n    return new Figure2D({\n      codeSvg: `<g> \n      <animateTransform\n      attributeName=\"transform\"\n      type=\"rotate\"\n      from=\"${angleStart} ${cx} ${cy}\"\n      to=\"${angleEnd} ${cx} ${cy}\"\n      dur=\"${duration}\"\n      repeatCount=\"${repeatCount}\"\n      begin=\"${loop ? `0s; ${delay}s` : '0s'}\"\n      keyTimes=\"0;0.4;0.5;0.9;1\"\n      values=\"${angleStart} ${cx} ${cy};${angleEnd} ${cx} ${cy};${angleEnd} ${cx} ${cy};${angleStart} ${cx} ${cy};${angleStart} ${cx} ${cy}\"\n      />\n        <g transform=\"translate(${this.x * this.pixelsParCm}, ${-this.y * this.pixelsParCm}) scale(${this.scale.x},${this.scale.y}) rotate(${-this.angle})\">${this.codeSvg}</g>\n      </g>`,\n      codeTikz: `\\\\begin{scope}[shift={(${this.x},${this.y})}, xscale=${this.scale.x}, yscale=${this.scale.y}, rotate around={${this.angle}:(0,0)}]${this.codeTikz}\\\\end{scope})`,\n      width: this.width,\n      height: this.height,\n      pixelsParCm: this.pixelsParCm,\n    })\n  }\n\n  dilatationAnimee({\n    cx,\n    cy,\n    factorXStart = 1,\n    factorXEnd = -1,\n    factorYStart = 1,\n    factorYEnd = 1,\n    duration = '1s',\n    repeatCount = 'infinite',\n    loop = true,\n    delay = 0,\n  }: {\n    factorXStart?: number\n    factorXEnd?: number\n    factorYStart?: number\n    factorYEnd?: number\n    duration?: string\n    repeatCount?: string\n    loop?: boolean\n    delay?: number\n    cx?: number\n    cy?: number\n  }) {\n    if (cx === undefined) {\n      cx = this.x * this.pixelsParCm\n    }\n    if (cy === undefined) {\n      cy = -this.y * this.pixelsParCm\n    }\n    return new Figure2D({\n      codeSvg: `<g transform=\"translate(${cx}, ${cy})\"> \n      <g>\n      <animateTransform\n      attributeName=\"transform\"\n      type=\"scale\"\n      from=\"${factorXStart} ${factorYStart}\"\n      to=\"${factorXEnd} ${factorYEnd}\"\n      dur=\"${duration}\"\n      repeatCount=\"${repeatCount}\"\n      begin=\"${loop ? `0s; ${delay}s` : '0s'}\"\n      keyTimes=\"0;0.4;0.5;0.9;1\"\n      values=\"${factorXStart} ${factorYStart};${factorXEnd} ${factorYEnd};${factorXEnd} ${factorYEnd};${factorXStart} ${factorYStart};${factorXStart} ${factorYStart}\"\n      />\n        <g transform=\" scale(${this.scale.x},${this.scale.y}) rotate(${-this.angle})\">${this.codeSvg}</g>\n      </g>\n      </g>`,\n      codeTikz: `\\\\begin{scope}[shift={(${this.x},${this.y})}, xscale=${this.scale.x}, yscale=${this.scale.y}, rotate around={${this.angle}:(0,0)}]${this.codeTikz}\\\\end{scope})`,\n      width: this.width,\n      height: this.height,\n      pixelsParCm: this.pixelsParCm,\n    })\n  }\n\n  translationAnimee({\n    dx,\n    dy,\n    duration = '1s',\n    repeatCount = 'infinite',\n    loop = true,\n    delay = 0,\n  }: {\n    dx: number\n    dy: number\n    duration?: string\n    repeatCount?: string\n    loop?: boolean\n    delay?: number\n  }) {\n    return new Figure2D({\n      codeSvg: `<g>\n      <animateTransform\n      attributeName=\"transform\"\n      type=\"translate\"\n      from=\"${this.x * this.pixelsParCm} ${-this.y * this.pixelsParCm}\"\n      to=\"${this.x * this.pixelsParCm + dx} ${-this.y * this.pixelsParCm - dy}\"\n      dur=\"${duration}\"\n      repeatCount=\"${repeatCount}\"\n      begin=\"${loop ? `0s; ${delay}s` : '0s'}\"\n      keyTimes=\"0;0.4;0.5;0.9;1\"\n      values=\"${this.x * this.pixelsParCm} ${-this.y * this.pixelsParCm};${this.x * this.pixelsParCm + dx} ${-this.y * this.pixelsParCm - dy};${this.x * this.pixelsParCm + dx} ${-this.y * this.pixelsParCm - dy};${this.x * this.pixelsParCm} ${-this.y * this.pixelsParCm};${this.x * this.pixelsParCm} ${-this.y * this.pixelsParCm}\"\n      />\n        <g transform=\" scale(${this.scale.x},${this.scale.y}) rotate(${-this.angle})\">${this.codeSvg}</g>\n      </g>`,\n      codeTikz: `\\\\begin{scope}[shift={(${this.x},${this.y})}, xscale=${this.scale.x}, yscale=${this.scale.y}, rotate around={${this.angle}:(0,0)}]${this.codeTikz}\\\\end{scope})`,\n      width: this.width,\n      height: this.height,\n      pixelsParCm: this.pixelsParCm,\n    })\n  }\n\n  get axesAngles() {\n    let angles: number[] = []\n    if (this.Axes.length > 0) {\n      angles = this.Axes.map((el) => {\n        const angle = (Math.atan2(el.y1 - el.y2, el.x2 - el.x1) * 180) / Math.PI\n        return angle\n      })\n    } else if (this.nonAxe) {\n      const angle =\n        (Math.atan2(\n          this.nonAxe.y1 - this.nonAxe.y2,\n          this.nonAxe.x2 - this.nonAxe.x1,\n        ) *\n          180) /\n        Math.PI\n      angles = [angle]\n    }\n    return angles\n  }\n\n  loopReflectionAnimee(\n    axe: Droite,\n    id: string,\n    onDirectionChange?: (direction: number) => void,\n  ) {\n    const copieAnimee = new Figure2D({\n      codeSvg: `<g id=\"${id}\" style=\"filter: drop-shadow(0px 0px 0px rgb(80, 80, 80))\">\n        ${this.svg(this.pixelsParCm)}\n      </g>`,\n      codeTikz: this.tikz(),\n      width: this.width / this.scale.x,\n      height: this.height / this.scale.y,\n      pixelsParCm: this.pixelsParCm,\n      scale: { x: 1, y: 1 },\n      angle: 0,\n      x: 0,\n      y: 0,\n      opacite: 1,\n    })\n\n    const ppcm = this.pixelsParCm\n\n    copieAnimee.name = id\n    document.addEventListener('exercicesAffiches', () => {\n      const figure = document.getElementById(id)\n      if (!figure) return\n\n      const cx = (axe.x1 + axe.x2) / 2\n      const cy = (axe.y1 + axe.y2) / 2\n\n      const clipPath = document.createElementNS(\n        'http://www.w3.org/2000/svg',\n        'clipPath',\n      )\n      const clipId = 'clip-' + id\n      clipPath.setAttribute('id', clipId)\n      const rect = document.createElementNS(\n        'http://www.w3.org/2000/svg',\n        'rect',\n      )\n      rect.setAttribute('id', `clipingRect_${id}`)\n      const largeur = 500\n      const hauteur = 500\n      rect.setAttribute('x', String(cx * ppcm - largeur / 2))\n      rect.setAttribute('y', String(cy * ppcm - hauteur / 2))\n      rect.setAttribute('width', String(largeur))\n      rect.setAttribute('height', String(hauteur))\n      clipPath.appendChild(rect)\n      figure.appendChild(clipPath)\n      figure.setAttribute('clip-path', `url(#${clipId})`)\n\n      let progress = 0\n      let direction = 1\n\n      const angleAxe =\n        (Math.atan2(axe.y1 - axe.y2, axe.x2 - axe.x1) * 180) / Math.PI\n\n      function animateLoop() {\n        if (figure == null) return\n        progress += 0.004 * direction\n        if (progress > 1) {\n          progress = 1\n          direction = -1\n          if (onDirectionChange) onDirectionChange(direction)\n          setTimeout(() => {\n            requestAnimationFrame(animateLoop)\n          }, 2000)\n          return\n        } else if (progress < 0) {\n          progress = 0\n          direction = 1\n          if (onDirectionChange) onDirectionChange(direction)\n          setTimeout(() => {\n            requestAnimationFrame(animateLoop)\n          }, 200)\n          return\n        }\n        const shadowOffsetX =\n          (1 - Math.abs(Math.cos(progress * Math.PI))) *\n          5 *\n          Math.cos((angleAxe * Math.PI) / 180)\n        const shadowOffsetY =\n          (1 - Math.abs(Math.cos(progress * Math.PI))) *\n          5 *\n          Math.sin((angleAxe * Math.PI) / 180)\n        const shadowStyle = `drop-shadow(${shadowOffsetX}px ${shadowOffsetY}px 5px rgb(80, 80, 80))`\n        figure.setAttribute('style', `filter: ${shadowStyle}`)\n\n        const { a, b, c, d, tx, ty } = computeSymmetryMatrix(\n          progress,\n          angleAxe,\n          cx * ppcm,\n          cy * ppcm,\n        )\n        figure.setAttribute(\n          'transform',\n          `matrix(${a} ${b} ${c} ${d} ${tx} ${ty})`,\n        )\n\n        requestAnimationFrame(animateLoop)\n      }\n\n      animateLoop()\n    })\n    return copieAnimee\n  }\n\n  // Fonction pour créer une figure animée avec une réflexion automatique selon les axes de la figure\n  autoReflectionAnimee(id: string, cx: number, cy: number) {\n    const copieAnimee = new Figure2D({\n      codeSvg: `<g id=\"${id}\" style=\"filter: drop-shadow(0px 0px 0px rgb(80, 80, 80))\"> \n      ${this.svg(20)}\n       transform=\"matrix(1 0 0 1 0 0)\"\n      </g>`, // >\n      codeTikz: this.tikz(),\n      width: this.width / this.scale.x,\n      height: this.height / this.scale.y,\n      pixelsParCm: this.pixelsParCm,\n      scale: { x: 1, y: 1 },\n      angle: 0,\n      x: 0,\n      y: 0,\n      opacite: 1,\n      axes: this.Axes,\n      nonAxe: this.nonAxe,\n      centre: this.centre,\n    })\n\n    const ppcm = this.pixelsParCm\n\n    copieAnimee.name = id\n    document.addEventListener('exercicesAffiches', () => {\n      // Création du clipPath\n\n      const figure = document.getElementById(id)\n      const clipPath = document.createElementNS(\n        'http://www.w3.org/2000/svg',\n        'clipPath',\n      )\n      const clipId = 'clip-' + id\n      clipPath.setAttribute('id', clipId)\n      const rect = document.createElementNS(\n        'http://www.w3.org/2000/svg',\n        'rect',\n      )\n      rect.setAttribute('id', `clipingRect_${id}`)\n      const largeur = 500 // Suffisamment grand pour couvrir la figure\n      const hauteur = 500\n      rect.setAttribute('x', String(cx * ppcm)) // String(cx - largeur / 2))\n      rect.setAttribute('y', String(cy * ppcm - hauteur / 2))\n      rect.setAttribute('width', String(largeur))\n      rect.setAttribute('height', String(hauteur))\n      clipPath.appendChild(rect)\n      figure?.appendChild(clipPath)\n      figure?.setAttribute('clip-path', `url(#${clipId})`)\n\n      // Clone the figure content and append it to the shadow group\n\n      let progress = 0\n      let currentSymmetry = 0\n      let animating = false\n\n      function animateSymmetry(angleDeg: number, onComplete: () => void) {\n        // Création du rectangle bord gauche centré en (cx, cy) avec largeur et hauteur suffisantes\n        const rect = document.getElementById(`clipingRect_${id}`)\n        if (!rect) return\n        const largeur = 500 // Suffisamment grand pour couvrir la figure\n        const hauteur = 500\n        rect.setAttribute('x', String(cx * ppcm))\n        rect.setAttribute('y', String(cy * ppcm - hauteur / 2))\n        rect.setAttribute('width', String(largeur))\n        rect.setAttribute('height', String(hauteur))\n\n        // Rotation du rectangle autour de (cx, cy) pour orienter la coupe\n        rect.setAttribute(\n          'transform',\n          `rotate(${angleDeg + 90}, ${cx * ppcm}, ${cy * ppcm})`,\n        )\n\n        // Application du clipPath à la copie\n        progress = 0\n\n        function step() {\n          progress += 0.004\n          if (progress > 1) progress = 1\n          const shadowOffsetX =\n            (1 - Math.abs(Math.cos(progress * Math.PI))) *\n            5 *\n            Math.cos((angleDeg * Math.PI) / 180)\n          const shadowOffsetY =\n            (1 - Math.abs(Math.cos(progress * Math.PI))) *\n            5 *\n            Math.sin((angleDeg * Math.PI) / 180)\n          const shadowStyle = `drop-shadow(${shadowOffsetX}px ${shadowOffsetY}px 2px rgb(80, 80, 80))`\n          const rect = document.getElementById(`${id}`)\n          rect?.setAttribute('style', `filter: ${shadowStyle}`)\n\n          const { a, b, c, d, tx, ty } = computeSymmetryMatrix(\n            progress,\n            angleDeg,\n            cx * ppcm,\n            cy * ppcm,\n          )\n          figure?.setAttribute(\n            'transform',\n            `matrix(${a} ${b} ${c} ${d} ${tx} ${ty})`,\n          )\n\n          if (progress < 1) {\n            requestAnimationFrame(step)\n          } else {\n            onComplete()\n          }\n        }\n\n        requestAnimationFrame(step)\n      }\n\n      function loopSymetries(symetries: number[]) {\n        if (animating) return\n        animating = true\n\n        function next() {\n          const angle = symetries[currentSymmetry]\n          animateSymmetry(angle, () => {\n            currentSymmetry = (currentSymmetry + 1) % symetries.length\n            setTimeout(next, 500) // petite pause entre chaque symétrie\n          })\n        }\n        next()\n      }\n\n      const symetries = copieAnimee.axesAngles\n      if (symetries.length === 0) {\n        figure?.setAttribute('transform', 'scale(1,1)')\n      } else {\n        loopSymetries(symetries)\n      }\n    })\n    return copieAnimee\n  }\n\n  set Axes(axes: Segment[]) {\n    this.axes = axes\n    this.nbAxes = axes.length\n  }\n\n  get Axes() {\n    return this.axes.map((el) => rotation(el, pointAbstrait(0, 0), this.angle))\n  }\n}\n\nexport function shapeToFigure2D(shape: Shape2D): Figure2D {\n  return new Figure2D({\n    codeSvg: shape.codeSvg,\n    codeTikz: shape.codeTikz,\n    x: shape.x,\n    y: shape.y,\n    angle: shape.angle,\n    scale: shape.scale,\n    width: shape.width,\n    height: shape.height,\n    pixelsParCm: shape.pixelsParCm,\n    opacite: shape.opacite,\n    bordures: shape.bordures,\n    axes: [],\n    nonAxe: null,\n    centre: null,\n    nbAxes: 0,\n    name: Date.now().toString(),\n  })\n}\nexport function figure2DToShape(figure: Figure2D): Shape2D {\n  return new Shape2D({\n    codeSvg: figure.codeSvg,\n    codeTikz: figure.codeTikz,\n    x: figure.x,\n    y: figure.y,\n    angle: figure.angle,\n    scale: figure.scale,\n    width: figure.width,\n    height: figure.height,\n    pixelsParCm: figure.pixelsParCm,\n    opacite: figure.opacite,\n    bordures: figure.bordures,\n  })\n}\n"],"names":["computeSymmetryMatrix","progress","angleDeg","cx","cy","angle","cosA","sinA","sy","a","b","c","tx","ty","rotatedBoundingBoxWithCenter","xmin","ymin","xmax","ymax","alpha","w2","h2","dx","dy","centerX","centerY","rotatedCenterX","rotatedCenterY","Shape2D","ObjetMathalea2D","name","codeSvg","codeTikz","x","y","scale","width","height","pixelsParCm","context","opacite","bordures","__publicField","coeff","factor","axes","Figure2D","nonAxe","centre","nbAxes","axe","angleAxe","d","svg","xImg","yImg","tikz","symForme","el","symetrieAxiale","newName","angleStart","angleEnd","duration","repeatCount","loop","delay","factorXStart","factorXEnd","factorYStart","factorYEnd","angles","id","onDirectionChange","copieAnimee","ppcm","figure","clipPath","clipId","rect","largeur","hauteur","direction","animateLoop","shadowOffsetX","shadowOffsetY","shadowStyle","currentSymmetry","animating","animateSymmetry","onComplete","step","loopSymetries","symetries","next","rotation","pointAbstrait"],"mappings":"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"}