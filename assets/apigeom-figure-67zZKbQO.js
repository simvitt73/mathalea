var g=Object.defineProperty;var b=(o,a,t)=>a in o?g(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t;var r=(o,a,t)=>b(o,typeof a!="symbol"?a+"":a,t);import{R as c,p as x,q as y,s as v,T as h,S as A}from"./vendors/apigeom-DuS4UMKQ.js";import{C as l}from"./vendors/svelte-BrkG1v2Q.js";import{P as C,bb as p,bd as E}from"./index-BB3ZcMz7.js";function L(o){if(!Array.from(o.elements.values()).some(s=>s instanceof c))return;function a(){let s=2;o.elements.forEach(e=>{if(e instanceof c){if(e.denominator===2)return;const u=e.numerator;e.denominator--,s=e.denominator,e.redraw(),e.numerator=u}e instanceof h&&(e.text=`L'unité est partagée en ${s} parts égales.`)})}function t(){let s=2;o.elements.forEach(e=>{if(e instanceof c){const u=e.numerator;e.denominator++,s=e.denominator,e.redraw(),e.numerator=u}e instanceof h&&(e.text=`L'unité est partagée en ${s} parts égales.`)})}function i(){o.elements.forEach(s=>{s instanceof c&&(s.numerator=0)})}o.setToolbar({position:"top",tools:["FILL"]});const n=document.createElement("p");n.textContent="Brouillon non évalué",n.classList.add("italic","font-black","text-coopmaths-struct","ml-10","my-auto"),o.addCustomButton({action:a,tooltip:"Diminuer le nombre de parts",url:x}),o.addCustomButton({action:t,record:!0,tooltip:"Augmenter le nombre de parts",url:y}),o.addCustomButton({action:i,tooltip:"Réinitialiser le coloriage",url:v}),o.divButtons.appendChild(n),o.container.classList.add("border-2","border-coopmaths-struct","p-2","rounded-md"),o.container.style.overflowX="auto",o.divUserMessage.style.display="none",Array.from(o.elements.values()).some(s=>s instanceof h)||o.create("TextByPosition",{text:"L'unité est partagée en 2 parts égales.",x:0,y:-1.5,anchor:"bottomLeft",isChild:!1})}const m=class m extends HTMLElement{constructor(){super(...arguments);r(this,"figure");r(this,"destroyed",!1);r(this,"oldZoom",1);r(this,"idApigeom");r(this,"onReload",t=>{var n;if(!((n=this.figure)!=null&&n.options))return;const i=t.detail;this.figure.loadJson(JSON.parse(i)),l(p).isChoosen&&l(p).state==="solutions"&&(this.figure.divButtons.style.display="none",this.figure.divUserMessage.style.display="none")});r(this,"onReloadBound",this.onReload.bind(this));r(this,"onZoom",t=>{var n;if(console.log("zoomChanged event received"),!((n=this.figure)!=null&&n.options))return;const i=Number(t.detail.zoom);i!==this.oldZoom&&(this.oldZoom=i,this.figure.zoom(i,{changeHeight:!0,changeWidth:!0,changeLeft:!1,changeBottom:!1}))});r(this,"onZoomBound",this.onZoom.bind(this));r(this,"boundApplyZoom",this.applyZoom.bind(this))}static get observedAttributes(){return["figure-json","numero-exercice","auto-index","index","x-min","y-min","width","height","animation","default-action","interactive","has-feedback","id-addendum"]}resolveIndex(){return this.hasAttribute("auto-index")?"A"+m.autoIndex++:""}connectedCallback(){C.isHtml&&(this.render(),this.createFigure(),this.bindEvents())}disconnectedCallback(){this.destroy()}attributeChangedCallback(t,i,n){}render(){var u;const t=Number(this.getAttribute("index")??0),i=Number(this.getAttribute("numero-exercice")??0),n=this.hasAttribute("has-feedback"),d=this.resolveIndex();this.idApigeom=`apigeomEx${i}F${t}${this.getAttribute("id-addendum")??""}${d}`,this.figure=new A({xMin:Number(this.getAttribute("x-min")??0),yMin:Number(this.getAttribute("y-min")??0),width:Number(this.getAttribute("width")??400),height:Number(this.getAttribute("height")??400)});const s=this.querySelector('script[type="application/json"]');if(!s)return;const e=(u=s.textContent)==null?void 0:u.trim();e&&(this.figure.loadJson(JSON.parse(e)),L(this.figure),this.innerHTML=`
      <script type="application/json">${e}<\/script>
      <div class="m-6 leading-none" id="${this.idApigeom}"></div>
      ${n&&!d?`
        <span id="resultatCheckEx${i}Q${t}"></span>
        <div class="ml-2 py-2 text-coopmaths-warn-darkest dark:text-coopmathsdark-warn-darkest"
             id="feedbackEx${i}Q${t}"></div>`:""}
    `)}createFigure(){var d;if(this.figure===void 0)return;const t=this.hasAttribute("interactive");this.figure.isDynamic=t,this.figure.divButtons.style.display=t?"grid":"none";const i=this.querySelector(`#${this.idApigeom}`);if(!i)return;this.figure.setContainer(i);const n=this.getAttribute("default-action");n&&((d=this.figure.buttons.get(n))==null||d.click()),this.applyZoom()}applyZoom(){const t=Number(l(E).z);t!==this.oldZoom&&this.figure&&(this.oldZoom=t,this.figure.zoom(t,{changeHeight:!0,changeWidth:!0,changeLeft:!1,changeBottom:!1}))}bindEvents(){document.addEventListener(this.idApigeom,this.onReloadBound),document.addEventListener("zoomChanged",this.onZoomBound),document.addEventListener("exercicesAffiches",this.boundApplyZoom)}destroy(){var t,i;this.destroyed||(this.destroyed=!0,document.removeEventListener(this.idApigeom,this.onReloadBound),document.removeEventListener("zoomChanged",this.onZoomBound),document.removeEventListener("exercicesAffiches",this.boundApplyZoom),(i=(t=this.figure)==null?void 0:t.destroy)==null||i.call(t),this.figure=void 0)}};r(m,"autoIndex",0);let f=m;function N(){customElements.get("apigeom-figure")||customElements.define("apigeom-figure",f)}export{N as h};
//# sourceMappingURL=apigeom-figure-67zZKbQO.js.map
