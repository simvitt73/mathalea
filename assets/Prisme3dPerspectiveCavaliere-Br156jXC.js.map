{"version":3,"file":"Prisme3dPerspectiveCavaliere-Br156jXC.js","sources":["../../src/lib/3d/3dProjectionMathalea2d/Prisme3dPerspectiveCavaliere.ts"],"sourcesContent":["import { colorToLatexOrHTML } from '../../2d/colorToLatexOrHtml'\nimport { ObjetMathalea2D } from '../../2d/ObjetMathalea2D'\nimport { polygone, renommePolygone } from '../../2d/polygones'\nimport { segment } from '../../2d/segmentsVecteurs'\nimport { labelPoint } from '../../2d/textes'\nimport { estDansPolygone, longueur } from '../../2d/utilitairesGeometriques'\nimport { pointSurSegment } from '../../2d/utilitairesPoint'\nimport { choisitLettresDifferentes } from '../../outils/aleatoires'\nimport {\n  Polygone3d,\n  Vecteur3d,\n  arete3d,\n  translation3d,\n  vecteur3d,\n} from './elementsEtTransformations3d'\n\n/**\n * Classe du prisme droit\n * Ce prisme droit est optimisé dans son tracé des arêtes cachées pour des bases dans le plan (xOy) et son vecteur normal selon (Oz)\n * Pour d'autres usages, il faut approfondir la fonction mais laissé en l'état car justement pas d'autre usage demandé.\n * @param {Polygone3d} base Une des deux bases du prisme droit\n * @param {Vecteur3d} vecteur Vecteur normal à la base dont la norme indique la hauteur du prisme droit.\n * @param {string} [color = 'black'] Couleur des arêtes du prisme droit : du type 'blue' ou du type '#f15929'\n * @param {boolean} [affichageNom = false] Permet (ou pas) l'affichage du nom des sommets du prisme.\n * @property {Polygone3d} base1 La base entièrement visible du prisme droit\n * @property {Vecteur3d} vecteur Vecteur normal à la base dont la norme indique la hauteur du prisme droit.\n * @property {string} [color = 'black'] Couleur des arêtes du prisme droit : du type 'blue' ou du type '#f15929'\n * @property {boolean} [affichageNom = false] Permet (ou pas) l'affichage du nom des sommets du prisme.\n * @property {Array} c2d Contient les commandes à tracer en 2d de cette fonction\n * @property {string} nom Nom du prisme\n * @author Eric Elter (d'après version précédente de Jean-Claude Lhote)\n * @class\n */\n\nexport class Prisme3d extends ObjetMathalea2D {\n  constructor(\n    base: Polygone3d,\n    vecteur: Vecteur3d,\n    color: string = 'black',\n    affichageNom = false,\n    nomBase2?: string,\n    positionLabels2?: string[],\n  ) {\n    super()\n    this.affichageNom = affichageNom\n    this.color = colorToLatexOrHTML(color)\n    base.color = this.color[0]\n    this.vecteur = vecteur\n    if (this.vecteur.y === 0 && this.vecteur.x === 0) {\n      this.base1 =\n        this.vecteur.z >= 1\n          ? base\n          : translation3d(\n              base,\n              vecteur3d(this.vecteur.x, this.vecteur.y, -this.vecteur.z),\n            )\n      this.base2 = this.vecteur.z < 1 ? base : translation3d(base, this.vecteur)\n    } else {\n      this.base1 = base\n      this.base2 = translation3d(base, vecteur)\n    }\n    this.base2.color = this.base1.color\n    this.c2d = []\n    let s\n    // On trace this.base1 (toujours visible)\n    for (let i = 0; i < this.base1.listePoints.length; i++) {\n      this.c2d.push(this.base1.c2d[i])\n    }\n    // On cherche les sommets cachés de this.base2\n    let toutesLesAretesSontVisibles = true\n    for (let i = 0; i < this.base1.listePoints.length; i++) {\n      const areteVisibleOuPas = estDansPolygone(\n        pointSurSegment(\n          this.base1.listePoints[i].c2d,\n          this.base2.listePoints[i].c2d,\n          longueur(\n            this.base1.listePoints[i].c2d,\n            this.base2.listePoints[i].c2d,\n          ) / 50,\n        ),\n        polygone(this.base1.listePoints2d),\n      )\n      this.base2.listePoints[i].isVisible = !areteVisibleOuPas\n      toutesLesAretesSontVisibles =\n        !areteVisibleOuPas && toutesLesAretesSontVisibles\n    }\n    // On trace les arêtes de this.base2\n    for (let i = 0; i < this.base2.listePoints.length; i++) {\n      s = arete3d(\n        this.base2.listePoints[i],\n        this.base2.listePoints[\n          i + 1 === this.base2.listePoints.length ? 0 : i + 1\n        ],\n        this.color[0],\n      )\n      if (toutesLesAretesSontVisibles) {\n        // Cas particulier où aucun sommet de this.base2 n'est caché (cas de certains tétraèdres)\n        let areteVisibleOuPas = true\n        for (let ee = 0; ee < this.base1.listePoints.length; ee++) {\n          const areteLiaison = segment(\n            this.base1.listePoints[ee].c2d,\n            this.base2.listePoints[ee].c2d,\n          )\n          areteVisibleOuPas =\n            areteVisibleOuPas && !!areteLiaison.estSecant(s.c2d)\n        }\n        s = arete3d(\n          this.base2.listePoints[i],\n          this.base2.listePoints[\n            i + 1 === this.base2.listePoints.length ? 0 : i + 1\n          ],\n          this.color[0],\n          !areteVisibleOuPas,\n        )\n      }\n      this.c2d.push(s.c2d)\n    }\n    // On trace les arêtes de liaison entre les bases\n    for (let i = 0; i < this.base1.listePoints.length; i++) {\n      s = arete3d(\n        this.base1.listePoints[i],\n        this.base2.listePoints[i],\n        this.color[0],\n      )\n      this.c2d.push(s.c2d)\n    }\n\n    if (this.affichageNom) {\n      let p = polygone(this.base1.listePoints2d)\n      const listeLettres = choisitLettresDifferentes(\n        this.base1.listePoints.length,\n        'OQWX',\n      )\n      const nomBase1 = base.listePoints2d.map(\n        (el, index) => el.nom ?? listeLettres[index],\n      )\n\n      renommePolygone(p, nomBase1)\n      for (let ee = 0; ee < this.base1.listePoints2d.length; ee++) {\n        this.base1.listePoints2d[ee].positionLabel =\n          base.listePoints2d[ee].positionLabel ?? 'above'\n      }\n      this.c2d.push(labelPoint(...p.listePoints))\n      p = polygone(this.base2.listePoints2d)\n      const listeDeLettres2 = choisitLettresDifferentes(\n        this.base1.listePoints.length,\n        'OQWX' + nomBase1,\n      )\n      renommePolygone(p, nomBase2 ?? listeDeLettres2)\n      for (let ee = 0; ee < this.base2.listePoints2d.length; ee++) {\n        this.base2.listePoints2d[ee].positionLabel =\n          positionLabels2?.[ee] ?? 'below'\n      }\n      this.c2d.push(labelPoint(...p.listePoints))\n      this.nom = nomBase1 + (nomBase2 ?? '')\n    }\n  }\n}\n/**\n * Crée un prisme droit\n * Ce prisme droit est optimisé dans son tracé des arêtes cachées pour des bases dans le plan (xOy) et son vecteur normal selon (Oz)\n * Pour d'autres usages, il faut approfondir la fonction mais laissé en l'état car justement pas d'autre usage demandé.\n * @param {Polygone3d} base Une des deux bases du prisme droit\n * @param {Vecteur3d} vecteur Vecteur normal à la base dont la norme indique la hauteur du prisme droit.\n * @param {string} [color = 'black'] Couleur des arêtes du prisme droit : du type 'blue' ou du type '#f15929'\n * @param {boolean} [affichageNom = false] Permet (ou pas) l'affichage du nom des sommets du prisme.\n * @param {string} [nomBase2] Nom de la base 2\n * @param {string[]} [positionLabels2] Position des labels de la base 2\n * @example prisme3d(p, v)\n * // Retourne un prisme droit de base p dont un vecteur normal à la base est v.\n * @example prisme3d(p, v, 'blue', true)\n * // Retourne un prisme droit de base p dont un vecteur normal à la base est v, de couleur V et dont les sommets sont nommés\n * @author Eric Elter (d'après version précédente de Jean-Claude Lhote)\n * @return {Prisme3d}\n */\nexport function prisme3d(\n  base: Polygone3d,\n  vecteur: Vecteur3d,\n  color: string = 'black',\n  affichageNom = false,\n  nomBase2?: string,\n  positionLabels2?: string[],\n) {\n  return new Prisme3d(\n    base,\n    vecteur,\n    color,\n    affichageNom,\n    nomBase2,\n    positionLabels2,\n  )\n}\n"],"names":["Prisme3d","ObjetMathalea2D","base","vecteur","color","affichageNom","nomBase2","positionLabels2","colorToLatexOrHTML","translation3d","vecteur3d","s","i","toutesLesAretesSontVisibles","areteVisibleOuPas","estDansPolygone","pointSurSegment","longueur","polygone","arete3d","ee","areteLiaison","segment","p","listeLettres","choisitLettresDifferentes","nomBase1","el","index","renommePolygone","labelPoint","listeDeLettres2","prisme3d"],"mappings":"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"}