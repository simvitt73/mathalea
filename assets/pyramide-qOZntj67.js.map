{"version":3,"file":"pyramide-qOZntj67.js","sources":["../../src/modules/pyramide.ts"],"sourcesContent":["import { BoiteBuilder } from '../lib/2d/BoiteBuilder'\nimport { choice } from '../lib/outils/arrayOutils'\nimport { stringNombre } from '../lib/outils/texNombre'\nimport type { NestedObjetMathalea2dArray } from '../types/2d'\nimport type FractionEtendue from './FractionEtendue'\nimport { fraction } from './fractions'\nimport { randint } from './outils'\n\n/**\n * @author Jean-claude Lhote\n */\nexport default class Pyramide {\n  operation: '+' | '*'\n  nombreEtages: number\n  valeurs: number[][] | FractionEtendue[][]\n  isVisible: boolean[][]\n  fractionOn: boolean\n\n  /**\n   *\n   * @param {object} param0\n   * @param {string} param0.operation\n   * @param {number} param0.nombreEtages\n   * @param {number[]|number[][]} param0.rangeData\n   * @param {number[]}  param0.exclusions\n   * @param {boolean} param0.fractionOn\n   */\n  constructor({\n    operation = '+',\n    nombreEtages = 3,\n    rangeData = [1, 10],\n    exclusions = [],\n    fractionOn = false,\n  }: {\n    operation: '+' | '*'\n    nombreEtages: number\n    rangeData: [number, number] | [[number, number], [number, number]]\n    exclusions: number[]\n    fractionOn: boolean\n  }) {\n    this.operation = operation\n    this.nombreEtages = nombreEtages\n    this.valeurs = []\n    this.isVisible = []\n    this.fractionOn = fractionOn\n\n    for (let y = nombreEtages - 1; y >= 0; y--) {\n      this.valeurs[y] = []\n      this.isVisible[y] = []\n      for (let x = 0, num, den; x <= y; x++) {\n        if (y === nombreEtages - 1) {\n          if (this.fractionOn) {\n            const rd = rangeData as [[number, number], [number, number]]\n            den = choice(rd[1])\n            num = randint(rd[0][0], rd[0][1], exclusions.concat([den]))\n            this.valeurs[y][x] = fraction(num, den).simplifie()\n          } else {\n            const rd = rangeData as [number, number]\n            this.valeurs[y][x] = randint(rd[0], rd[1], exclusions)\n          }\n        } else {\n          switch (operation) {\n            case '+':\n              if (this.fractionOn) {\n                this.valeurs[y][x] = (this.valeurs[y + 1][x] as FractionEtendue)\n                  .sommeFraction(this.valeurs[y + 1][x + 1] as FractionEtendue)\n                  .simplifie()\n              } else {\n                this.valeurs[y][x] =\n                  Number(this.valeurs[y + 1][x]) +\n                  Number(this.valeurs[y + 1][x + 1])\n              }\n              break\n            case '*':\n              if (this.fractionOn) {\n                this.valeurs[y][x] = (this.valeurs[y + 1][x] as FractionEtendue)\n                  .produitFraction(\n                    this.valeurs[y + 1][x + 1] as FractionEtendue,\n                  )\n                  .simplifie()\n              } else {\n                this.valeurs[y][x] =\n                  Number(this.valeurs[y + 1][x]) *\n                  Number(this.valeurs[y + 1][x + 1])\n              }\n\n              break\n          }\n        }\n        this.isVisible[y][x] = false\n      }\n    }\n  }\n\n  visible(x: number, y: number) {\n    return this.isVisible[y][x]\n  }\n\n  estSolvable(x: number, y: number): boolean {\n    if (this.visible(x, y)) return true\n    else if (y === this.nombreEtages - 1) return false\n    else return this.estSolvable(x, y + 1) && this.estSolvable(x + 1, y + 1)\n  }\n\n  choisisUneCaseNonVisible(): [number, number] {\n    let x, y\n    let trouve = false\n    let cpt = 0\n    do {\n      cpt++\n      y = randint(1, this.nombreEtages - 1)\n      x = randint(0, y)\n      let seul = true\n      for (let i = 0; i < y; i++) {\n        if (i !== x && !this.visible(i, y)) seul = false\n      }\n      if (seul && cpt < 20) trouve = false\n      else trouve = !this.visible(x, y)\n    } while (!trouve)\n    return [x, y]\n  }\n\n  aleatoirise() {\n    let solvable = false\n    do {\n      const [x, y] = this.choisisUneCaseNonVisible()\n      this.isVisible[y][x] = true\n      solvable = this.estSolvable(0, 0)\n    } while (!solvable)\n  }\n\n  representeMoi(xO = 0, yO = 0): NestedObjetMathalea2dArray {\n    const objets = []\n    const hCase = this.fractionOn ? 2 : 1\n    for (let y = this.nombreEtages; y > 0; y--) {\n      for (let x = 0; x < y; x++) {\n        //  if (this.isVisible[y - 1][x]) {\n        /* objets.push(boite({\n                                                       Xmin: xO + x * 4 + (this.nombreEtages - y) * 2,\n                                                       Ymin: yO + (this.nombreEtages - y) * hCase,\n                                                       Xmax: xO + x * 4 + 4 + (this.nombreEtages - y) * 2,\n                                                       Ymax: yO + (1 + this.nombreEtages - y) * hCase,\n                                                       texteIn: this.fractionOn ? `$${this.valeurs[y - 1][x].texFractionSimplifiee}$` : stringNombre(this.valeurs[y - 1][x], 0),\n                                                       texteOpacite: 1\n                                                     }))\n                                                     */\n        objets.push(\n          new BoiteBuilder({\n            xMin: xO + x * 4 + (this.nombreEtages - y) * 2,\n            yMin: yO + (this.nombreEtages - y) * hCase,\n            xMax: xO + x * 4 + 4 + (this.nombreEtages - y) * 2,\n            yMax: yO + (1 + this.nombreEtages - y) * hCase,\n          })\n            .addTextIn({\n              textIn: !this.isVisible[y - 1][x]\n                ? ''\n                : this.fractionOn\n                  ? (this.valeurs[y - 1][x] as FractionEtendue)\n                      .texFractionSimplifiee\n                  : stringNombre(Number(this.valeurs[y - 1][x]), 0),\n              opacity: 1,\n            })\n            .render(),\n        )\n      }\n    }\n    return objets\n  }\n}\n"],"names":["Pyramide","operation","nombreEtages","rangeData","exclusions","fractionOn","__publicField","y","x","num","den","rd","choice","randint","fraction","trouve","cpt","seul","i","solvable","xO","yO","objets","hCase","BoiteBuilder","stringNombre"],"mappings":"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"}